/*! For license information please see main.a787d9fb.js.LICENSE.txt */
(()=>{var __webpack_modules__={635:function(e,t,n){e.exports=function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var i=function(e){try{return!!e()}catch(e){return!0}},o=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),s=o,a=Function.prototype,c=a.call,u=s&&a.bind.bind(c,c),l=s?u:function(e){return function(){return c.apply(e,arguments)}},d=l({}.isPrototypeOf),h=function(e){return e&&e.Math==Math&&e},p=h("object"==typeof globalThis&&globalThis)||h("object"==typeof window&&window)||h("object"==typeof self&&self)||h("object"==typeof t&&t)||function(){return this}()||t||Function("return this")(),f=o,m=Function.prototype,g=m.apply,_=m.call,E="object"==typeof Reflect&&Reflect.apply||(f?_.bind(g):function(){return _.apply(g,arguments)}),v=l,y=v({}.toString),b=v("".slice),T=function(e){return b(y(e),8,-1)},S=T,w=l,R=function(e){if("Function"===S(e))return w(e)},I="object"==typeof document&&document.all,C={all:I,IS_HTMLDDA:void 0===I&&void 0!==I},A=C.all,O=C.IS_HTMLDDA?function(e){return"function"==typeof e||e===A}:function(e){return"function"==typeof e},N={},k=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),D=o,P=Function.prototype.call,L=D?P.bind(P):function(){return P.apply(P,arguments)},M={},x={}.propertyIsEnumerable,U=Object.getOwnPropertyDescriptor,F=U&&!x.call({1:2},1);M.f=F?function(e){var t=U(this,e);return!!t&&t.enumerable}:x;var j,V,B=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},G=i,q=T,W=Object,H=l("".split),K=G((function(){return!W("z").propertyIsEnumerable(0)}))?function(e){return"String"==q(e)?H(e,""):W(e)}:W,z=function(e){return null==e},Y=z,J=TypeError,X=function(e){if(Y(e))throw J("Can't call method on "+e);return e},Q=K,Z=X,$=function(e){return Q(Z(e))},ee=O,te=C.all,ne=C.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:ee(e)||e===te}:function(e){return"object"==typeof e?null!==e:ee(e)},re={},ie=re,oe=p,se=O,ae=function(e){return se(e)?e:void 0},ce=function(e,t){return arguments.length<2?ae(ie[e])||ae(oe[e]):ie[e]&&ie[e][t]||oe[e]&&oe[e][t]},ue="undefined"!=typeof navigator&&String(navigator.userAgent)||"",le=p,de=ue,he=le.process,pe=le.Deno,fe=he&&he.versions||pe&&pe.version,me=fe&&fe.v8;me&&(V=(j=me.split("."))[0]>0&&j[0]<4?1:+(j[0]+j[1])),!V&&de&&(!(j=de.match(/Edge\/(\d+)/))||j[1]>=74)&&(j=de.match(/Chrome\/(\d+)/))&&(V=+j[1]);var ge=V,_e=ge,Ee=i,ve=p.String,ye=!!Object.getOwnPropertySymbols&&!Ee((function(){var e=Symbol();return!ve(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&_e&&_e<41})),be=ye&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Te=ce,Se=O,we=d,Re=Object,Ie=be?function(e){return"symbol"==typeof e}:function(e){var t=Te("Symbol");return Se(t)&&we(t.prototype,Re(e))},Ce=String,Ae=function(e){try{return Ce(e)}catch(e){return"Object"}},Oe=O,Ne=Ae,ke=TypeError,De=function(e){if(Oe(e))return e;throw ke(Ne(e)+" is not a function")},Pe=De,Le=z,Me=function(e,t){var n=e[t];return Le(n)?void 0:Pe(n)},xe=L,Ue=O,Fe=ne,je=TypeError,Ve={exports:{}},Be=p,Ge=Object.defineProperty,qe=function(e,t){try{Ge(Be,e,{value:t,configurable:!0,writable:!0})}catch(r){Be[e]=t}return t},We="__core-js_shared__",He=p[We]||qe(We,{}),Ke=He;(Ve.exports=function(e,t){return Ke[e]||(Ke[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var ze=Ve.exports,Ye=X,Je=Object,Xe=function(e){return Je(Ye(e))},Qe=Xe,Ze=l({}.hasOwnProperty),$e=Object.hasOwn||function(e,t){return Ze(Qe(e),t)},et=l,tt=0,nt=Math.random(),rt=et(1..toString),it=function(e){return"Symbol("+(void 0===e?"":e)+")_"+rt(++tt+nt,36)},ot=ze,st=$e,at=it,ct=ye,ut=be,lt=p.Symbol,dt=ot("wks"),ht=ut?lt.for||lt:lt&&lt.withoutSetter||at,pt=function(e){return st(dt,e)||(dt[e]=ct&&st(lt,e)?lt[e]:ht("Symbol."+e)),dt[e]},ft=L,mt=ne,gt=Ie,_t=Me,Et=function(e,t){var n,r;if("string"===t&&Ue(n=e.toString)&&!Fe(r=xe(n,e)))return r;if(Ue(n=e.valueOf)&&!Fe(r=xe(n,e)))return r;if("string"!==t&&Ue(n=e.toString)&&!Fe(r=xe(n,e)))return r;throw je("Can't convert object to primitive value")},vt=TypeError,yt=pt("toPrimitive"),bt=function(e,t){if(!mt(e)||gt(e))return e;var n,r=_t(e,yt);if(r){if(void 0===t&&(t="default"),n=ft(r,e,t),!mt(n)||gt(n))return n;throw vt("Can't convert object to primitive value")}return void 0===t&&(t="number"),Et(e,t)},Tt=Ie,St=function(e){var t=bt(e,"string");return Tt(t)?t:t+""},wt=ne,Rt=p.document,It=wt(Rt)&&wt(Rt.createElement),Ct=function(e){return It?Rt.createElement(e):{}},At=Ct,Ot=!k&&!i((function(){return 7!=Object.defineProperty(At("div"),"a",{get:function(){return 7}}).a})),Nt=k,kt=L,Dt=M,Pt=B,Lt=$,Mt=St,xt=$e,Ut=Ot,Ft=Object.getOwnPropertyDescriptor;N.f=Nt?Ft:function(e,t){if(e=Lt(e),t=Mt(t),Ut)try{return Ft(e,t)}catch(e){}if(xt(e,t))return Pt(!kt(Dt.f,e,t),e[t])};var jt=i,Vt=O,Bt=/#|\.prototype\./,Gt=function(e,t){var n=Wt[qt(e)];return n==Kt||n!=Ht&&(Vt(t)?jt(t):!!t)},qt=Gt.normalize=function(e){return String(e).replace(Bt,".").toLowerCase()},Wt=Gt.data={},Ht=Gt.NATIVE="N",Kt=Gt.POLYFILL="P",zt=Gt,Yt=De,Jt=o,Xt=R(R.bind),Qt=function(e,t){return Yt(e),void 0===t?e:Jt?Xt(e,t):function(){return e.apply(t,arguments)}},Zt={},$t=k&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),en=ne,tn=String,nn=TypeError,rn=function(e){if(en(e))return e;throw nn(tn(e)+" is not an object")},on=k,sn=Ot,an=$t,cn=rn,un=St,ln=TypeError,dn=Object.defineProperty,hn=Object.getOwnPropertyDescriptor,pn="enumerable",fn="configurable",mn="writable";Zt.f=on?an?function(e,t,n){if(cn(e),t=un(t),cn(n),"function"==typeof e&&"prototype"===t&&"value"in n&&mn in n&&!n[mn]){var r=hn(e,t);r&&r[mn]&&(e[t]=n.value,n={configurable:fn in n?n[fn]:r[fn],enumerable:pn in n?n[pn]:r[pn],writable:!1})}return dn(e,t,n)}:dn:function(e,t,n){if(cn(e),t=un(t),cn(n),sn)try{return dn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw ln("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var gn=Zt,_n=B,En=k?function(e,t,n){return gn.f(e,t,_n(1,n))}:function(e,t,n){return e[t]=n,e},vn=p,yn=E,bn=R,Tn=O,Sn=N.f,wn=zt,Rn=re,In=Qt,Cn=En,An=$e,On=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return yn(e,this,arguments)};return t.prototype=e.prototype,t},Nn=function(e,t){var n,r,i,o,s,a,c,u,l,d=e.target,h=e.global,p=e.stat,f=e.proto,m=h?vn:p?vn[d]:(vn[d]||{}).prototype,g=h?Rn:Rn[d]||Cn(Rn,d,{})[d],_=g.prototype;for(o in t)r=!(n=wn(h?o:d+(p?".":"#")+o,e.forced))&&m&&An(m,o),a=g[o],r&&(c=e.dontCallGetSet?(l=Sn(m,o))&&l.value:m[o]),s=r&&c?c:t[o],r&&typeof a==typeof s||(u=e.bind&&r?In(s,vn):e.wrap&&r?On(s):f&&Tn(s)?bn(s):s,(e.sham||s&&s.sham||a&&a.sham)&&Cn(u,"sham",!0),Cn(g,o,u),f&&(An(Rn,i=d+"Prototype")||Cn(Rn,i,{}),Cn(Rn[i],o,s),e.real&&_&&(n||!_[o])&&Cn(_,o,s)))},kn=Math.ceil,Dn=Math.floor,Pn=Math.trunc||function(e){var t=+e;return(t>0?Dn:kn)(t)},Ln=Pn,Mn=function(e){var t=+e;return t!=t||0===t?0:Ln(t)},xn=Mn,Un=Math.max,Fn=Math.min,jn=function(e,t){var n=xn(e);return n<0?Un(n+t,0):Fn(n,t)},Vn=Mn,Bn=Math.min,Gn=function(e){return e>0?Bn(Vn(e),9007199254740991):0},qn=Gn,Wn=function(e){return qn(e.length)},Hn=$,Kn=jn,zn=Wn,Yn=function(e){return function(t,n,r){var i,o=Hn(t),s=zn(o),a=Kn(r,s);if(e&&n!=n){for(;s>a;)if((i=o[a++])!=i)return!0}else for(;s>a;a++)if((e||a in o)&&o[a]===n)return e||a||0;return!e&&-1}},Jn={includes:Yn(!0),indexOf:Yn(!1)},Xn=Jn.includes;Nn({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return Xn(this,e,arguments.length>1?arguments[1]:void 0)}});var Qn=re,Zn=function(e){return Qn[e+"Prototype"]},$n=Zn("Array").includes,er=ne,tr=T,nr=pt("match"),rr=function(e){var t;return er(e)&&(void 0!==(t=e[nr])?!!t:"RegExp"==tr(e))},ir=rr,or=TypeError,sr={};sr[pt("toStringTag")]="z";var ar="[object z]"===String(sr),cr=ar,ur=O,lr=T,dr=pt("toStringTag"),hr=Object,pr="Arguments"==lr(function(){return arguments}()),fr=cr?lr:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=hr(e),dr))?n:pr?lr(t):"Object"==(r=lr(t))&&ur(t.callee)?"Arguments":r},mr=fr,gr=String,_r=function(e){if("Symbol"===mr(e))throw TypeError("Cannot convert a Symbol value to a string");return gr(e)},Er=pt("match"),vr=Nn,yr=function(e){if(ir(e))throw or("The method doesn't accept regular expressions");return e},br=X,Tr=_r,Sr=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[Er]=!1,"/./"[e](t)}catch(e){}}return!1},wr=l("".indexOf);vr({target:"String",proto:!0,forced:!Sr("includes")},{includes:function(e){return!!~wr(Tr(br(this)),Tr(yr(e)),arguments.length>1?arguments[1]:void 0)}});var Rr=Zn("String").includes,Ir=d,Cr=$n,Ar=Rr,Or=Array.prototype,Nr=String.prototype,kr=function(e){var t=e.includes;return e===Or||Ir(Or,e)&&t===Or.includes?Cr:"string"==typeof e||e===Nr||Ir(Nr,e)&&t===Nr.includes?Ar:t},Dr=r(kr),Pr=De,Lr=Xe,Mr=K,xr=Wn,Ur=TypeError,Fr=function(e){return function(t,n,r,i){Pr(n);var o=Lr(t),s=Mr(o),a=xr(o),c=e?a-1:0,u=e?-1:1;if(r<2)for(;;){if(c in s){i=s[c],c+=u;break}if(c+=u,e?c<0:a<=c)throw Ur("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=u)c in s&&(i=n(i,s[c],c,o));return i}},jr={left:Fr(!1),right:Fr(!0)},Vr=i,Br=function(e,t){var n=[][e];return!!n&&Vr((function(){n.call(null,t||function(){return 1},1)}))},Gr="undefined"!=typeof process&&"process"==T(process),qr=jr.left;Nn({target:"Array",proto:!0,forced:!Gr&&ge>79&&ge<83||!Br("reduce")},{reduce:function(e){var t=arguments.length;return qr(this,e,t,t>1?arguments[1]:void 0)}});var Wr=Zn("Array").reduce,Hr=d,Kr=Wr,zr=Array.prototype,Yr=function(e){var t=e.reduce;return e===zr||Hr(zr,e)&&t===zr.reduce?Kr:t},Jr=Yr,Xr=r(Jr);let Qr=!0,Zr=!0;function $r(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function ei(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function ti(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Qr=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ni(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Zr=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function ri(){if("object"==typeof window){if(Qr)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function ii(e,t){Zr&&console.warn(e+" is deprecated, please use "+t+" instead.")}function oi(e){return"[object Object]"===Object.prototype.toString.call(e)}function si(e){var t;return oi(e)?Xr(t=Object.keys(e)).call(t,(function(t,n){const r=oi(e[n]),i=r?si(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function ai(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?ai(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{ai(e,e.get(t),n)}))})))}function ci(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&ai(e,n,i)}))})),i}var ui=it,li=ze("keys"),di=function(e){return li[e]||(li[e]=ui(e))},hi=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),pi=$e,fi=O,mi=Xe,gi=hi,_i=di("IE_PROTO"),Ei=Object,vi=Ei.prototype,yi=gi?Ei.getPrototypeOf:function(e){var t=mi(e);if(pi(t,_i))return t[_i];var n=t.constructor;return fi(n)&&t instanceof n?n.prototype:t instanceof Ei?vi:null},bi=l,Ti=De,Si=O,wi=String,Ri=TypeError,Ii=function(e,t,n){try{return bi(Ti(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},Ci=rn,Ai=function(e){if("object"==typeof e||Si(e))return e;throw Ri("Can't set "+wi(e)+" as a prototype")},Oi=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Ii(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Ci(n),Ai(r),t?e(n,r):n.__proto__=r,n}}():void 0),Ni={},ki={},Di=$e,Pi=$,Li=Jn.indexOf,Mi=ki,xi=l([].push),Ui=function(e,t){var n,r=Pi(e),i=0,o=[];for(n in r)!Di(Mi,n)&&Di(r,n)&&xi(o,n);for(;t.length>i;)Di(r,n=t[i++])&&(~Li(o,n)||xi(o,n));return o},Fi=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ji=Ui,Vi=Fi.concat("length","prototype");Ni.f=Object.getOwnPropertyNames||function(e){return ji(e,Vi)};var Bi={};Bi.f=Object.getOwnPropertySymbols;var Gi=ce,qi=Ni,Wi=Bi,Hi=rn,Ki=l([].concat),zi=Gi("Reflect","ownKeys")||function(e){var t=qi.f(Hi(e)),n=Wi.f;return n?Ki(t,n(e)):t},Yi=$e,Ji=zi,Xi=N,Qi=Zt,Zi={},$i=Ui,eo=Fi,to=Object.keys||function(e){return $i(e,eo)},no=k,ro=$t,io=Zt,oo=rn,so=$,ao=to;Zi.f=no&&!ro?Object.defineProperties:function(e,t){oo(e);for(var n,r=so(t),i=ao(t),o=i.length,s=0;o>s;)io.f(e,n=i[s++],r[n]);return e};var co,uo=ce("document","documentElement"),lo=rn,ho=Zi,po=Fi,fo=ki,mo=uo,go=Ct,_o="prototype",Eo="script",vo=di("IE_PROTO"),yo=function(){},bo=function(e){return"<"+Eo+">"+e+"</"+Eo+">"},To=function(e){e.write(bo("")),e.close();var t=e.parentWindow.Object;return e=null,t},So=function(){try{co=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;So="undefined"!=typeof document?document.domain&&co?To(co):(t=go("iframe"),n="java"+Eo+":",t.style.display="none",mo.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(bo("document.F=Object")),e.close(),e.F):To(co);for(var r=po.length;r--;)delete So[_o][po[r]];return So()};fo[vo]=!0;var wo=Object.create||function(e,t){var n;return null!==e?(yo[_o]=lo(e),n=new yo,yo[_o]=null,n[vo]=e):n=So(),void 0===t?n:ho.f(n,t)},Ro=ne,Io=En,Co=Error,Ao=l("".replace),Oo=String(Co("zxcasd").stack),No=/\n\s*at [^:]*:[^\n]*/,ko=No.test(Oo),Do=B,Po=!i((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Do(1,7)),7!==e.stack)})),Lo=En,Mo=function(e,t){if(ko&&"string"==typeof e&&!Co.prepareStackTrace)for(;t--;)e=Ao(e,No,"");return e},xo=Po,Uo=Error.captureStackTrace,Fo={},jo=Fo,Vo=pt("iterator"),Bo=Array.prototype,Go=function(e){return void 0!==e&&(jo.Array===e||Bo[Vo]===e)},qo=fr,Wo=Me,Ho=z,Ko=Fo,zo=pt("iterator"),Yo=function(e){if(!Ho(e))return Wo(e,zo)||Wo(e,"@@iterator")||Ko[qo(e)]},Jo=L,Xo=De,Qo=rn,Zo=Ae,$o=Yo,es=TypeError,ts=function(e,t){var n=arguments.length<2?$o(e):t;if(Xo(n))return Qo(Jo(n,e));throw es(Zo(e)+" is not iterable")},ns=L,rs=rn,is=Me,os=function(e,t,n){var r,i;rs(e);try{if(!(r=is(e,"return"))){if("throw"===t)throw n;return n}r=ns(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return rs(r),n},ss=Qt,as=L,cs=rn,us=Ae,ls=Go,ds=Wn,hs=d,ps=ts,fs=Yo,ms=os,gs=TypeError,_s=function(e,t){this.stopped=e,this.result=t},Es=_s.prototype,vs=function(e,t,n){var r,i,o,s,a,c,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),m=ss(t,l),g=function(e){return r&&ms(r,"normal",e),new _s(!0,e)},_=function(e){return d?(cs(e),f?m(e[0],e[1],g):m(e[0],e[1])):f?m(e,g):m(e)};if(h)r=e.iterator;else if(p)r=e;else{if(!(i=fs(e)))throw gs(us(e)+" is not iterable");if(ls(i)){for(o=0,s=ds(e);s>o;o++)if((a=_(e[o]))&&hs(Es,a))return a;return new _s(!1)}r=ps(e,i)}for(c=h?e.next:r.next;!(u=as(c,r)).done;){try{a=_(u.value)}catch(e){ms(r,"throw",e)}if("object"==typeof a&&a&&hs(Es,a))return a}return new _s(!1)},ys=_r,bs=Nn,Ts=d,Ss=yi,ws=Oi,Rs=function(e,t,n){for(var r=Ji(t),i=Qi.f,o=Xi.f,s=0;s<r.length;s++){var a=r[s];Yi(e,a)||n&&Yi(n,a)||i(e,a,o(t,a))}},Is=wo,Cs=En,As=B,Os=function(e,t){Ro(t)&&"cause"in t&&Io(e,"cause",t.cause)},Ns=function(e,t,n,r){xo&&(Uo?Uo(e,t):Lo(e,"stack",Mo(n,r)))},ks=vs,Ds=function(e,t){return void 0===e?arguments.length<2?"":t:ys(e)},Ps=pt("toStringTag"),Ls=Error,Ms=[].push,xs=function(e,t){var n,r=Ts(Us,this);ws?n=ws(Ls(),r?Ss(this):Us):(n=r?this:Is(Us),Cs(n,Ps,"Error")),void 0!==t&&Cs(n,"message",Ds(t)),Ns(n,xs,n.stack,1),arguments.length>2&&Os(n,arguments[2]);var i=[];return ks(e,Ms,{that:i}),Cs(n,"errors",i),n};ws?ws(xs,Ls):Rs(xs,Ls,{name:!0});var Us=xs.prototype=Is(Ls.prototype,{constructor:As(1,xs),message:As(1,""),name:As(1,"AggregateError")});bs({global:!0,constructor:!0,arity:2},{AggregateError:xs});var Fs,js,Vs,Bs=O,Gs=p.WeakMap,qs=Bs(Gs)&&/native code/.test(String(Gs)),Ws=p,Hs=ne,Ks=En,zs=$e,Ys=He,Js=di,Xs=ki,Qs="Object already initialized",Zs=Ws.TypeError,$s=Ws.WeakMap;if(qs||Ys.state){var ea=Ys.state||(Ys.state=new $s);ea.get=ea.get,ea.has=ea.has,ea.set=ea.set,Fs=function(e,t){if(ea.has(e))throw Zs(Qs);return t.facade=e,ea.set(e,t),t},js=function(e){return ea.get(e)||{}},Vs=function(e){return ea.has(e)}}else{var ta=Js("state");Xs[ta]=!0,Fs=function(e,t){if(zs(e,ta))throw Zs(Qs);return t.facade=e,Ks(e,ta,t),t},js=function(e){return zs(e,ta)?e[ta]:{}},Vs=function(e){return zs(e,ta)}}var na,ra,ia,oa={set:Fs,get:js,has:Vs,enforce:function(e){return Vs(e)?js(e):Fs(e,{})},getterFor:function(e){return function(t){var n;if(!Hs(t)||(n=js(t)).type!==e)throw Zs("Incompatible receiver, "+e+" required");return n}}},sa=k,aa=$e,ca=Function.prototype,ua=sa&&Object.getOwnPropertyDescriptor,la=aa(ca,"name"),da={EXISTS:la,PROPER:la&&"something"===function(){}.name,CONFIGURABLE:la&&(!sa||sa&&ua(ca,"name").configurable)},ha=En,pa=function(e,t,n,r){return r&&r.enumerable?e[t]=n:ha(e,t,n),e},fa=i,ma=O,ga=ne,_a=wo,Ea=yi,va=pa,ya=pt("iterator"),ba=!1;[].keys&&("next"in(ia=[].keys())?(ra=Ea(Ea(ia)))!==Object.prototype&&(na=ra):ba=!0);var Ta=!ga(na)||fa((function(){var e={};return na[ya].call(e)!==e}));ma((na=Ta?{}:_a(na))[ya])||va(na,ya,(function(){return this}));var Sa={IteratorPrototype:na,BUGGY_SAFARI_ITERATORS:ba},wa=fr,Ra=ar?{}.toString:function(){return"[object "+wa(this)+"]"},Ia=ar,Ca=Zt.f,Aa=En,Oa=$e,Na=Ra,ka=pt("toStringTag"),Da=function(e,t,n,r){if(e){var i=n?e:e.prototype;Oa(i,ka)||Ca(i,ka,{configurable:!0,value:t}),r&&!Ia&&Aa(i,"toString",Na)}},Pa=Sa.IteratorPrototype,La=wo,Ma=B,xa=Da,Ua=Fo,Fa=function(){return this},ja=function(e,t,n,r){var i=t+" Iterator";return e.prototype=La(Pa,{next:Ma(+!r,n)}),xa(e,i,!1,!0),Ua[i]=Fa,e},Va=Nn,Ba=L,Ga=ja,qa=yi,Wa=Da,Ha=pa,Ka=Fo,za=Sa,Ya=da.PROPER,Ja=za.BUGGY_SAFARI_ITERATORS,Xa=pt("iterator"),Qa="keys",Za="values",$a="entries",ec=function(){return this},tc=function(e,t,n,r,i,o,s){Ga(n,t,r);var a,c,u,l=function(e){if(e===i&&m)return m;if(!Ja&&e in p)return p[e];switch(e){case Qa:case Za:case $a:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",h=!1,p=e.prototype,f=p[Xa]||p["@@iterator"]||i&&p[i],m=!Ja&&f||l(i),g="Array"==t&&p.entries||f;if(g&&(a=qa(g.call(new e)))!==Object.prototype&&a.next&&(Wa(a,d,!0,!0),Ka[d]=ec),Ya&&i==Za&&f&&f.name!==Za&&(h=!0,m=function(){return Ba(f,this)}),i)if(c={values:l(Za),keys:o?m:l(Qa),entries:l($a)},s)for(u in c)(Ja||h||!(u in p))&&Ha(p,u,c[u]);else Va({target:t,proto:!0,forced:Ja||h},c);return s&&p[Xa]!==m&&Ha(p,Xa,m,{name:i}),Ka[t]=m,c},nc=function(e,t){return{value:e,done:t}},rc=$,ic=Fo,oc=oa;Zt.f;var sc=tc,ac=nc,cc="Array Iterator",uc=oc.set,lc=oc.getterFor(cc);sc(Array,"Array",(function(e,t){uc(this,{type:cc,target:rc(e),index:0,kind:t})}),(function(){var e=lc(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,ac(void 0,!0)):ac("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values"),ic.Arguments=ic.Array;var dc=Zt,hc=function(e,t,n){return dc.f(e,t,n)},pc=ce,fc=hc,mc=k,gc=pt("species"),_c=d,Ec=TypeError,vc=function(e,t){if(_c(t,e))return e;throw Ec("Incorrect invocation")},yc=O,bc=He,Tc=l(Function.toString);yc(bc.inspectSource)||(bc.inspectSource=function(e){return Tc(e)});var Sc=bc.inspectSource,wc=l,Rc=i,Ic=O,Cc=fr,Ac=Sc,Oc=function(){},Nc=[],kc=ce("Reflect","construct"),Dc=/^\s*(?:class|function)\b/,Pc=wc(Dc.exec),Lc=!Dc.exec(Oc),Mc=function(e){if(!Ic(e))return!1;try{return kc(Oc,Nc,e),!0}catch(e){return!1}},xc=function(e){if(!Ic(e))return!1;switch(Cc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Lc||!!Pc(Dc,Ac(e))}catch(e){return!0}};xc.sham=!0;var Uc,Fc,jc,Vc,Bc=!kc||Rc((function(){var e;return Mc(Mc.call)||!Mc(Object)||!Mc((function(){e=!0}))||e}))?xc:Mc,Gc=Bc,qc=Ae,Wc=TypeError,Hc=rn,Kc=function(e){if(Gc(e))return e;throw Wc(qc(e)+" is not a constructor")},zc=z,Yc=pt("species"),Jc=function(e,t){var n,r=Hc(e).constructor;return void 0===r||zc(n=Hc(r)[Yc])?t:Kc(n)},Xc=l([].slice),Qc=TypeError,Zc=function(e,t){if(e<t)throw Qc("Not enough arguments");return e},$c=/(?:ipad|iphone|ipod).*applewebkit/i.test(ue),eu=p,tu=E,nu=Qt,ru=O,iu=$e,ou=i,su=uo,au=Xc,cu=Ct,uu=Zc,lu=$c,du=Gr,hu=eu.setImmediate,pu=eu.clearImmediate,fu=eu.process,mu=eu.Dispatch,gu=eu.Function,_u=eu.MessageChannel,Eu=eu.String,vu=0,yu={},bu="onreadystatechange";ou((function(){Uc=eu.location}));var Tu=function(e){if(iu(yu,e)){var t=yu[e];delete yu[e],t()}},Su=function(e){return function(){Tu(e)}},wu=function(e){Tu(e.data)},Ru=function(e){eu.postMessage(Eu(e),Uc.protocol+"//"+Uc.host)};hu&&pu||(hu=function(e){uu(arguments.length,1);var t=ru(e)?e:gu(e),n=au(arguments,1);return yu[++vu]=function(){tu(t,void 0,n)},Fc(vu),vu},pu=function(e){delete yu[e]},du?Fc=function(e){fu.nextTick(Su(e))}:mu&&mu.now?Fc=function(e){mu.now(Su(e))}:_u&&!lu?(Vc=(jc=new _u).port2,jc.port1.onmessage=wu,Fc=nu(Vc.postMessage,Vc)):eu.addEventListener&&ru(eu.postMessage)&&!eu.importScripts&&Uc&&"file:"!==Uc.protocol&&!ou(Ru)?(Fc=Ru,eu.addEventListener("message",wu,!1)):Fc=bu in cu("script")?function(e){su.appendChild(cu("script"))[bu]=function(){su.removeChild(this),Tu(e)}}:function(e){setTimeout(Su(e),0)});var Iu={set:hu,clear:pu},Cu=function(){this.head=null,this.tail=null};Cu.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var Au,Ou,Nu,ku,Du,Pu=Cu,Lu=/ipad|iphone|ipod/i.test(ue)&&"undefined"!=typeof Pebble,Mu=/web0s(?!.*chrome)/i.test(ue),xu=p,Uu=Qt,Fu=N.f,ju=Iu.set,Vu=Pu,Bu=$c,Gu=Lu,qu=Mu,Wu=Gr,Hu=xu.MutationObserver||xu.WebKitMutationObserver,Ku=xu.document,zu=xu.process,Yu=xu.Promise,Ju=Fu(xu,"queueMicrotask"),Xu=Ju&&Ju.value;if(!Xu){var Qu=new Vu,Zu=function(){var e,t;for(Wu&&(e=zu.domain)&&e.exit();t=Qu.get();)try{t()}catch(e){throw Qu.head&&Au(),e}e&&e.enter()};Bu||Wu||qu||!Hu||!Ku?!Gu&&Yu&&Yu.resolve?((ku=Yu.resolve(void 0)).constructor=Yu,Du=Uu(ku.then,ku),Au=function(){Du(Zu)}):Wu?Au=function(){zu.nextTick(Zu)}:(ju=Uu(ju,xu),Au=function(){ju(Zu)}):(Ou=!0,Nu=Ku.createTextNode(""),new Hu(Zu).observe(Nu,{characterData:!0}),Au=function(){Nu.data=Ou=!Ou}),Xu=function(e){Qu.head||Au(),Qu.add(e)}}var $u=Xu,el=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},tl=p.Promise,nl="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,rl=!nl&&!Gr&&"object"==typeof window&&"object"==typeof document,il=p,ol=tl,sl=O,al=zt,cl=Sc,ul=pt,ll=rl,dl=nl,hl=ge,pl=ol&&ol.prototype,fl=ul("species"),ml=!1,gl=sl(il.PromiseRejectionEvent),_l=al("Promise",(function(){var e=cl(ol),t=e!==String(ol);if(!t&&66===hl)return!0;if(!pl.catch||!pl.finally)return!0;if(!hl||hl<51||!/native code/.test(e)){var n=new ol((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[fl]=r,!(ml=n.then((function(){}))instanceof r))return!0}return!t&&(ll||dl)&&!gl})),El={CONSTRUCTOR:_l,REJECTION_EVENT:gl,SUBCLASSING:ml},vl={},yl=De,bl=TypeError,Tl=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw bl("Bad Promise constructor");t=e,n=r})),this.resolve=yl(t),this.reject=yl(n)};vl.f=function(e){return new Tl(e)};var Sl,wl,Rl=Nn,Il=Gr,Cl=p,Al=L,Ol=pa,Nl=Da,kl=function(e){var t=pc(e);mc&&t&&!t[gc]&&fc(t,gc,{configurable:!0,get:function(){return this}})},Dl=De,Pl=O,Ll=ne,Ml=vc,xl=Jc,Ul=Iu.set,Fl=$u,jl=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}},Vl=el,Bl=Pu,Gl=oa,ql=tl,Wl=El,Hl=vl,Kl="Promise",zl=Wl.CONSTRUCTOR,Yl=Wl.REJECTION_EVENT,Jl=Gl.getterFor(Kl),Xl=Gl.set,Ql=ql&&ql.prototype,Zl=ql,$l=Ql,ed=Cl.TypeError,td=Cl.document,nd=Cl.process,rd=Hl.f,id=rd,od=!!(td&&td.createEvent&&Cl.dispatchEvent),sd="unhandledrejection",ad=function(e){var t;return!(!Ll(e)||!Pl(t=e.then))&&t},cd=function(e,t){var n,r,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{a?(s||(2===t.rejection&&pd(t),t.rejection=1),!0===a?n=o:(l&&l.enter(),n=a(o),l&&(l.exit(),i=!0)),n===e.promise?u(ed("Promise-chain cycle")):(r=ad(n))?Al(r,n,c,u):c(n)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},ud=function(e,t){e.notified||(e.notified=!0,Fl((function(){for(var n,r=e.reactions;n=r.get();)cd(n,e);e.notified=!1,t&&!e.rejection&&dd(e)})))},ld=function(e,t,n){var r,i;od?((r=td.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Cl.dispatchEvent(r)):r={promise:t,reason:n},!Yl&&(i=Cl["on"+e])?i(r):e===sd&&jl("Unhandled promise rejection",n)},dd=function(e){Al(Ul,Cl,(function(){var t,n=e.facade,r=e.value;if(hd(e)&&(t=Vl((function(){Il?nd.emit("unhandledRejection",r,n):ld(sd,n,r)})),e.rejection=Il||hd(e)?2:1,t.error))throw t.value}))},hd=function(e){return 1!==e.rejection&&!e.parent},pd=function(e){Al(Ul,Cl,(function(){var t=e.facade;Il?nd.emit("rejectionHandled",t):ld("rejectionhandled",t,e.value)}))},fd=function(e,t,n){return function(r){e(t,r,n)}},md=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,ud(e,!0))},gd=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw ed("Promise can't be resolved itself");var r=ad(t);r?Fl((function(){var n={done:!1};try{Al(r,t,fd(gd,n,e),fd(md,n,e))}catch(t){md(n,t,e)}})):(e.value=t,e.state=1,ud(e,!1))}catch(t){md({done:!1},t,e)}}};zl&&($l=(Zl=function(e){Ml(this,$l),Dl(e),Al(Sl,this);var t=Jl(this);try{e(fd(gd,t),fd(md,t))}catch(e){md(t,e)}}).prototype,(Sl=function(e){Xl(this,{type:Kl,done:!1,notified:!1,parent:!1,reactions:new Bl,rejection:!1,state:0,value:void 0})}).prototype=Ol($l,"then",(function(e,t){var n=Jl(this),r=rd(xl(this,Zl));return n.parent=!0,r.ok=!Pl(e)||e,r.fail=Pl(t)&&t,r.domain=Il?nd.domain:void 0,0==n.state?n.reactions.add(r):Fl((function(){cd(r,n)})),r.promise})),wl=function(){var e=new Sl,t=Jl(e);this.promise=e,this.resolve=fd(gd,t),this.reject=fd(md,t)},Hl.f=rd=function(e){return e===Zl||void 0===e?new wl(e):id(e)}),Rl({global:!0,constructor:!0,wrap:!0,forced:zl},{Promise:Zl}),Nl(Zl,Kl,!1,!0),kl(Kl);var _d=pt("iterator"),Ed=!1;try{var vd=0,yd={next:function(){return{done:!!vd++}},return:function(){Ed=!0}};yd[_d]=function(){return this},Array.from(yd,(function(){throw 2}))}catch(e){}var bd=tl,Td=function(e,t){if(!t&&!Ed)return!1;var n=!1;try{var r={};r[_d]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Sd=El.CONSTRUCTOR||!Td((function(e){bd.all(e).then(void 0,(function(){}))})),wd=L,Rd=De,Id=vl,Cd=el,Ad=vs;Nn({target:"Promise",stat:!0,forced:Sd},{all:function(e){var t=this,n=Id.f(t),r=n.resolve,i=n.reject,o=Cd((function(){var n=Rd(t.resolve),o=[],s=0,a=1;Ad(e,(function(e){var c=s++,u=!1;a++,wd(n,t,e).then((function(e){u||(u=!0,o[c]=e,--a||r(o))}),i)})),--a||r(o)}));return o.error&&i(o.value),n.promise}});var Od=Nn,Nd=El.CONSTRUCTOR;tl&&tl.prototype,Od({target:"Promise",proto:!0,forced:Nd,real:!0},{catch:function(e){return this.then(void 0,e)}});var kd=L,Dd=De,Pd=vl,Ld=el,Md=vs;Nn({target:"Promise",stat:!0,forced:Sd},{race:function(e){var t=this,n=Pd.f(t),r=n.reject,i=Ld((function(){var i=Dd(t.resolve);Md(e,(function(e){kd(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var xd=L,Ud=vl;Nn({target:"Promise",stat:!0,forced:El.CONSTRUCTOR},{reject:function(e){var t=Ud.f(this);return xd(t.reject,void 0,e),t.promise}});var Fd=rn,jd=ne,Vd=vl,Bd=function(e,t){if(Fd(e),jd(t)&&t.constructor===e)return t;var n=Vd.f(e);return(0,n.resolve)(t),n.promise},Gd=Nn,qd=tl,Wd=El.CONSTRUCTOR,Hd=Bd,Kd=ce("Promise"),zd=!Wd;Gd({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Hd(zd&&this===Kd?qd:this,e)}});var Yd=L,Jd=De,Xd=vl,Qd=el,Zd=vs;Nn({target:"Promise",stat:!0,forced:Sd},{allSettled:function(e){var t=this,n=Xd.f(t),r=n.resolve,i=n.reject,o=Qd((function(){var n=Jd(t.resolve),i=[],o=0,s=1;Zd(e,(function(e){var a=o++,c=!1;s++,Yd(n,t,e).then((function(e){c||(c=!0,i[a]={status:"fulfilled",value:e},--s||r(i))}),(function(e){c||(c=!0,i[a]={status:"rejected",reason:e},--s||r(i))}))})),--s||r(i)}));return o.error&&i(o.value),n.promise}});var $d=L,eh=De,th=ce,nh=vl,rh=el,ih=vs,oh="No one promise resolved";Nn({target:"Promise",stat:!0,forced:Sd},{any:function(e){var t=this,n=th("AggregateError"),r=nh.f(t),i=r.resolve,o=r.reject,s=rh((function(){var r=eh(t.resolve),s=[],a=0,c=1,u=!1;ih(e,(function(e){var l=a++,d=!1;c++,$d(r,t,e).then((function(e){d||u||(u=!0,i(e))}),(function(e){d||u||(d=!0,s[l]=e,--c||o(new n(s,oh)))}))})),--c||o(new n(s,oh))}));return s.error&&o(s.value),r.promise}});var sh=Nn,ah=tl,ch=i,uh=ce,lh=O,dh=Jc,hh=Bd,ph=ah&&ah.prototype;sh({target:"Promise",proto:!0,real:!0,forced:!!ah&&ch((function(){ph.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=dh(this,uh("Promise")),n=lh(e);return this.then(n?function(n){return hh(t,e()).then((function(){return n}))}:e,n?function(n){return hh(t,e()).then((function(){throw n}))}:e)}});var fh=l,mh=Mn,gh=_r,_h=X,Eh=fh("".charAt),vh=fh("".charCodeAt),yh=fh("".slice),bh=function(e){return function(t,n){var r,i,o=gh(_h(t)),s=mh(n),a=o.length;return s<0||s>=a?e?"":void 0:(r=vh(o,s))<55296||r>56319||s+1===a||(i=vh(o,s+1))<56320||i>57343?e?Eh(o,s):r:e?yh(o,s,s+2):i-56320+(r-55296<<10)+65536}},Th={codeAt:bh(!1),charAt:bh(!0)},Sh=Th.charAt,wh=_r,Rh=oa,Ih=tc,Ch=nc,Ah="String Iterator",Oh=Rh.set,Nh=Rh.getterFor(Ah);Ih(String,"String",(function(e){Oh(this,{type:Ah,string:wh(e),index:0})}),(function(){var e,t=Nh(this),n=t.string,r=t.index;return r>=n.length?Ch(void 0,!0):(e=Sh(n,r),t.index+=e.length,Ch(e,!1))}));var kh=re.Promise,Dh={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ph=p,Lh=fr,Mh=En,xh=Fo,Uh=pt("toStringTag");for(var Fh in Dh){var jh=Ph[Fh],Vh=jh&&jh.prototype;Vh&&Lh(Vh)!==Uh&&Mh(Vh,Uh,Fh),xh[Fh]=xh.Array}var Bh=kh,Gh=r(Bh);const qh=ri;function Wh(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let s=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>{var n;return Dr(n=e.label.toLowerCase()).call(n,t)}))));return!s&&n.length&&Dr(t).call(t,"back")&&(s=n[n.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),qh("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return qh("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Gh.reject(o(e))))))}}}function Hh(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Kh(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else ei(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function zh(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Yh(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Gh(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function Jh(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>ci(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),ei(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>ci(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Gh.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Gh.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Xh(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function Qh(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Xh(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((e=>e.track===t));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Gh.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zh(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function $h(e,t){ei(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var ep=Object.freeze({__proto__:null,fixNegotiationNeeded:$h,shimAddTrackRemoveTrack:Qh,shimAddTrackRemoveTrackWithNative:Xh,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:zh,shimGetStats:Yh,shimGetUserMedia:Wh,shimMediaStream:Hh,shimOnTrack:Kh,shimPeerConnection:Zh,shimSenderReceiverGetStats:Jh});function tp(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){ii("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function np(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rp(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function ip(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Gh.resolve(new Map)}}function op(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),ei(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function sp(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){ii("removeStream","removeTrack"),this.getSenders().forEach((t=>{var n;t.track&&Dr(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)}))})}function ap(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function cp(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function up(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function lp(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Gh.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function dp(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Gh.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var hp=Object.freeze({__proto__:null,shimAddTransceiver:cp,shimCreateAnswer:dp,shimCreateOffer:lp,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Gh.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:up,shimGetUserMedia:tp,shimOnTrack:np,shimPeerConnection:rp,shimRTCDataChannel:ap,shimReceiverGetStats:op,shimRemoveStream:sp,shimSenderGetStats:ip});function pp(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),Dr(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{var t;this._localStreams?Dr(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{Dr(n).call(n,e.track)&&this.removeTrack(e)}))})}}function fp(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),Dr(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,this.dispatchEvent(n)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function mp(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Gh.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Gh.resolve()):i};let a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Gh.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Gh.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),Gh.resolve()):r},t.addIceCandidate=a}function gp(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(_p(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function _p(e){return e&&void 0!==e.video?Object.assign({},e,{video:si(e.video)}):e}function Ep(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(ii("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function vp(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function yp(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function bp(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Tp=Object.freeze({__proto__:null,shimAudioContext:bp,shimCallbacksAPI:mp,shimConstraints:_p,shimCreateOfferLegacy:yp,shimGetUserMedia:gp,shimLocalStreamsAPI:pp,shimRTCIceServerUrls:Ep,shimRemoteStreamsAPI:fp,shimTrackEventTransceiver:vp}),Sp="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",wp=X,Rp=_r,Ip=Sp,Cp=l("".replace),Ap=RegExp("^["+Ip+"]+"),Op=RegExp("(^|[^"+Ip+"])["+Ip+"]+$"),Np=function(e){return function(t){var n=Rp(wp(t));return 1&e&&(n=Cp(n,Ap,"")),2&e&&(n=Cp(n,Op,"$1")),n}},kp={start:Np(1),end:Np(2),trim:Np(3)},Dp=da.PROPER,Pp=i,Lp=Sp,Mp=kp.trim;Nn({target:"String",proto:!0,forced:function(e){return Pp((function(){return!!Lp[e]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[e]()||Dp&&Lp[e].name!==e}))}("trim")},{trim:function(){return Mp(this)}});var xp=Zn("String").trim,Up=d,Fp=xp,jp=String.prototype,Vp=function(e){var t=e.trim;return"string"==typeof e||e===jp||Up(jp,e)&&t===jp.trim?Fp:t},Bp=r(Vp),Gp={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:void 0===n[t[r]]&&(n[t[r]]=t[r+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let i=0;i<r.length;i++)n=r[i].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let o=3;o<r.length;o++){const i=r[o],s=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){const r=t.parseRtpMap(s),o=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=o.length?t.parseFmtp(o[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{i.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=s.length>0&&s[0].ssrc;let c;const u=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));u.length>0&&u[0].length>1&&u[0][0]===a&&(c=u[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substring(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=l}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let t=0;t<r.length;t++)switch(r[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[t].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},e.exports=t}(Gp);var qp=Gp.exports,Wp=r(qp),Hp=e({__proto__:null,default:Wp},[qp]);function Kp(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Wp.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,ei(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function zp(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||ei(e,"icecandidate",(e=>{if(e.candidate){const t=Wp.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Yp(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=Wp.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Wp.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Wp.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=o(arguments[0],e);let s;s=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>s}),this._sctp=a}return s.apply(this,arguments)}}function Jp(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},ei(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function Xp(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function Qp(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==Bp(e).call(e))).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Zp(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Gh.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Gh.resolve())})}function $p(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}var ef=Object.freeze({__proto__:null,removeExtmapAllowMixed:Qp,shimAddIceCandidateNullOrEmpty:Zp,shimConnectionState:Xp,shimMaxMessageSize:Yp,shimParameterlessSetLocalDescription:$p,shimRTCIceCandidate:Kp,shimRTCIceCandidateRelayProtocol:zp,shimSendThrowTypeError:Jp});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=ri,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=$r(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=$r(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=$r(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:ef,extractVersion:$r,disableLog:ti,disableWarnings:ni,sdp:Hp};switch(r.browser){case"chrome":if(!ep||!Zh||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=ep,Zp(e,r),$p(e),Wh(e,r),Hh(e),Zh(e,r),Kh(e),Qh(e,r),zh(e),Yh(e),Jh(e),$h(e,r),Kp(e),zp(e),Xp(e),Yp(e,r),Jp(e),Qp(e,r);break;case"firefox":if(!hp||!rp||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=hp,Zp(e,r),$p(e),tp(e,r),rp(e,r),np(e),sp(e),ip(e),op(e),ap(e),cp(e),up(e),lp(e),dp(e),Kp(e),Xp(e),Yp(e,r),Jp(e);break;case"safari":if(!Tp||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Tp,Zp(e,r),$p(e),Ep(e),yp(e),mp(e),pp(e),fp(e),vp(e),gp(e),bp(e),Kp(e),zp(e),Yp(e,r),Jp(e),Qp(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var tf=Zn("Array").keys,nf=fr,rf=$e,of=d,sf=tf,af=Array.prototype,cf={DOMTokenList:!0,NodeList:!0},uf=function(e){var t=e.keys;return e===af||of(af,e)&&t===af.keys||rf(cf,nf(e))?sf:t},lf=r(uf),df=Ae,hf=TypeError,pf=St,ff=Zt,mf=B,gf=function(e,t,n){var r=pf(t);r in e?ff.f(e,r,mf(0,n)):e[r]=n},_f=jn,Ef=Wn,vf=gf,yf=Array,bf=Math.max,Tf=function(e,t,n){for(var r=Ef(e),i=_f(t,r),o=_f(void 0===n?r:n,r),s=yf(bf(o-i,0)),a=0;i<o;i++,a++)vf(s,a,e[i]);return s.length=a,s},Sf=Tf,wf=Math.floor,Rf=function(e,t){var n=e.length,r=wf(n/2);return n<8?If(e,t):Cf(e,Rf(Sf(e,0,r),t),Rf(Sf(e,r),t),t)},If=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},Cf=function(e,t,n,r){for(var i=t.length,o=n.length,s=0,a=0;s<i||a<o;)e[s+a]=s<i&&a<o?r(t[s],n[a])<=0?t[s++]:n[a++]:s<i?t[s++]:n[a++];return e},Af=Rf,Of=ue.match(/firefox\/(\d+)/i),Nf=!!Of&&+Of[1],kf=/MSIE|Trident/.test(ue),Df=ue.match(/AppleWebKit\/(\d+)\./),Pf=!!Df&&+Df[1],Lf=Nn,Mf=l,xf=De,Uf=Xe,Ff=Wn,jf=function(e,t){if(!delete e[t])throw hf("Cannot delete property "+df(t)+" of "+df(e))},Vf=_r,Bf=i,Gf=Af,qf=Br,Wf=Nf,Hf=kf,Kf=ge,zf=Pf,Yf=[],Jf=Mf(Yf.sort),Xf=Mf(Yf.push),Qf=Bf((function(){Yf.sort(void 0)})),Zf=Bf((function(){Yf.sort(null)})),$f=qf("sort"),em=!Bf((function(){if(Kf)return Kf<70;if(!(Wf&&Wf>3)){if(Hf)return!0;if(zf)return zf<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Yf.push({k:t+r,v:n})}for(Yf.sort((function(e,t){return t.v-e.v})),r=0;r<Yf.length;r++)t=Yf[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));Lf({target:"Array",proto:!0,forced:Qf||!Zf||!$f||!em},{sort:function(e){void 0!==e&&xf(e);var t=Uf(this);if(em)return void 0===e?Jf(t):Jf(t,e);var n,r,i=[],o=Ff(t);for(r=0;r<o;r++)r in t&&Xf(i,t[r]);for(Gf(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Vf(t)>Vf(n)?1:-1}}(e)),n=Ff(i),r=0;r<n;)t[r]=i[r++];for(;r<o;)jf(t,r++);return t}});var tm=Zn("Array").sort,nm=d,rm=tm,im=Array.prototype,om=function(e){var t=e.sort;return e===im||nm(im,e)&&t===im.sort?rm:t},sm=r(om),am={exports:{}};!function(e,n){!function(t,r){var i="function",o="undefined",s="object",a="string",c="major",u="model",l="name",d="type",h="vendor",p="version",f="architecture",m="console",g="mobile",_="tablet",E="smarttv",v="wearable",y="embedded",b="Amazon",T="Apple",S="ASUS",w="BlackBerry",R="Browser",I="Chrome",C="Firefox",A="Google",O="Huawei",N="LG",k="Microsoft",D="Motorola",P="Opera",L="Samsung",M="Sharp",x="Sony",U="Xiaomi",F="Zebra",j="Facebook",V="Chromium OS",B="Mac OS",G=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},q=function(e,t){return typeof e===a&&-1!==W(t).indexOf(W(e))},W=function(e){return e.toLowerCase()},H=function(e,t){if(typeof e===a)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},K=function(e,t){for(var n,o,a,c,u,l,d=0;d<t.length&&!u;){var h=t[d],p=t[d+1];for(n=o=0;n<h.length&&!u&&h[n];)if(u=h[n++].exec(e))for(a=0;a<p.length;a++)l=u[++o],typeof(c=p[a])===s&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,l):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=l?l.replace(c[1],c[2]):r:this[c[0]]=l?c[1].call(this,l,c[2]):r:4===c.length&&(this[c[0]]=l?c[3].call(this,l.replace(c[1],c[2])):r):this[c]=l||r;d+=2}},z=function(e,t){for(var n in t)if(typeof t[n]===s&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(q(t[n][i],e))return"?"===n?r:n}else if(q(t[n],e))return"?"===n?r:n;return e},Y={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[l,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[l,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[l,p],[/opios[\/ ]+([\w\.]+)/i],[p,[l,P+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[l,P]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[l,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[l,"UC"+R]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[p,[l,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[p,[l,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[l,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[l,"IE"]],[/yabrowser\/([\w\.]+)/i],[p,[l,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[l,/(.+)/,"$1 Secure "+R],p],[/\bfocus\/([\w\.]+)/i],[p,[l,C+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[l,P+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[l,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[l,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[l,P+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[l,"MIUI "+R]],[/fxios\/([-\w\.]+)/i],[p,[l,C]],[/\bqihu|(qi?ho?o?|360)browser/i],[[l,"360 "+R]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[l,/(.+)/,"$1 "+R],p],[/(comodo_dragon)\/([\w\.]+)/i],[[l,/_/g," "],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[l,p],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[l],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[l,j],p],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[l,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[l,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[l,I+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[l,I+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[l,"Android "+R]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[l,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[l,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,l],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[l,[p,z,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[l,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[l,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[l,C+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[l,p],[/(cobalt)\/([\w\.]+)/i],[l,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,W]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[f,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[f,"armhf"]],[/windows (ce|mobile); ppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[f,/ower/,"",W]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[f,W]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[h,L],[d,_]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[u,[h,L],[d,g]],[/\((ip(?:hone|od)[\w ]*);/i],[u,[h,T],[d,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[h,T],[d,_]],[/(macintosh);/i],[u,[h,T]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[h,M],[d,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[h,O],[d,_]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[h,O],[d,g]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[u,/_/g," "],[h,U],[d,g]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[h,U],[d,_]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[h,"OPPO"],[d,g]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[h,"Vivo"],[d,g]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[u,[h,"Realme"],[d,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[h,D],[d,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[h,D],[d,_]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[h,N],[d,_]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[h,N],[d,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[h,"Lenovo"],[d,_]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[h,"Nokia"],[d,g]],[/(pixel c)\b/i],[u,[h,A],[d,_]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[h,A],[d,g]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[h,x],[d,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[h,x],[d,_]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[h,"OnePlus"],[d,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[h,b],[d,_]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[h,b],[d,g]],[/(playbook);[-\w\),; ]+(rim)/i],[u,h,[d,_]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[h,w],[d,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[h,S],[d,_]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[h,S],[d,g]],[/(nexus 9)/i],[u,[h,"HTC"],[d,_]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[u,/_/g," "],[d,g]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[h,"Acer"],[d,_]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[h,"Meizu"],[d,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,u,[d,g]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,u,[d,_]],[/(surface duo)/i],[u,[h,k],[d,_]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[h,"Fairphone"],[d,g]],[/(u304aa)/i],[u,[h,"AT&T"],[d,g]],[/\bsie-(\w*)/i],[u,[h,"Siemens"],[d,g]],[/\b(rct\w+) b/i],[u,[h,"RCA"],[d,_]],[/\b(venue[\d ]{2,7}) b/i],[u,[h,"Dell"],[d,_]],[/\b(q(?:mv|ta)\w+) b/i],[u,[h,"Verizon"],[d,_]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[h,"Barnes & Noble"],[d,_]],[/\b(tm\d{3}\w+) b/i],[u,[h,"NuVision"],[d,_]],[/\b(k88) b/i],[u,[h,"ZTE"],[d,_]],[/\b(nx\d{3}j) b/i],[u,[h,"ZTE"],[d,g]],[/\b(gen\d{3}) b.+49h/i],[u,[h,"Swiss"],[d,g]],[/\b(zur\d{3}) b/i],[u,[h,"Swiss"],[d,_]],[/\b((zeki)?tb.*\b) b/i],[u,[h,"Zeki"],[d,_]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],u,[d,_]],[/\b(ns-?\w{0,9}) b/i],[u,[h,"Insignia"],[d,_]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[h,"NextBook"],[d,_]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],u,[d,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],u,[d,g]],[/\b(ph-1) /i],[u,[h,"Essential"],[d,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[h,"Envizen"],[d,_]],[/\b(trio[-\w\. ]+) b/i],[u,[h,"MachSpeed"],[d,_]],[/\btu_(1491) b/i],[u,[h,"Rotor"],[d,_]],[/(shield[\w ]+) b/i],[u,[h,"Nvidia"],[d,_]],[/(sprint) (\w+)/i],[h,u,[d,g]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[h,k],[d,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[h,F],[d,_]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[h,F],[d,g]],[/smart-tv.+(samsung)/i],[h,[d,E]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[h,L],[d,E]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,N],[d,E]],[/(apple) ?tv/i],[h,[u,T+" TV"],[d,E]],[/crkey/i],[[u,I+"cast"],[h,A],[d,E]],[/droid.+aft(\w)( bui|\))/i],[u,[h,b],[d,E]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[h,M],[d,E]],[/(bravia[\w ]+)( bui|\))/i],[u,[h,x],[d,E]],[/(mitv-\w{5}) bui/i],[u,[h,U],[d,E]],[/Hbbtv.*(technisat) (.*);/i],[h,u,[d,E]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,H],[u,H],[d,E]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,E]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,u,[d,m]],[/droid.+; (shield) bui/i],[u,[h,"Nvidia"],[d,m]],[/(playstation [345portablevi]+)/i],[u,[h,x],[d,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[h,k],[d,m]],[/((pebble))app/i],[h,u,[d,v]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[h,T],[d,v]],[/droid.+; (glass) \d/i],[u,[h,A],[d,v]],[/droid.+; (wt63?0{2,3})\)/i],[u,[h,F],[d,v]],[/(quest( 2| pro)?)/i],[u,[h,j],[d,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[d,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[u,[d,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[d,_]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,_]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,g]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[l,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[l,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[l,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,l]],os:[[/microsoft (windows) (vista|xp)/i],[l,p],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[l,[p,z,Y]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[l,"Windows"],[p,z,Y]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[l,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[l,B],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,l],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[l,p],[/\(bb(10);/i],[p,[l,w]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[l,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[l,C+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[l,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[l,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[l,I+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[l,V],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[l,p],[/(sunos) ?([\w\.\d]*)/i],[[l,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[l,p]]},X=function(e,n){if(typeof e===s&&(n=e,e=r),!(this instanceof X))return new X(e,n).getResult();var m=typeof t!==o&&t.navigator?t.navigator:r,E=e||(m&&m.userAgent?m.userAgent:""),v=m&&m.userAgentData?m.userAgentData:r,y=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(J,n):J;return this.getBrowser=function(){var e={};return e[l]=r,e[p]=r,K.call(e,E,y.browser),e[c]=function(e){return typeof e===a?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e[p]),m&&m.brave&&typeof m.brave.isBrave==i&&(e[l]="Brave"),e},this.getCPU=function(){var e={};return e[f]=r,K.call(e,E,y.cpu),e},this.getDevice=function(){var e={};return e[h]=r,e[u]=r,e[d]=r,K.call(e,E,y.device),!e[d]&&v&&v.mobile&&(e[d]=g),"Macintosh"==e[u]&&m&&typeof m.standalone!==o&&m.maxTouchPoints&&m.maxTouchPoints>2&&(e[u]="iPad",e[d]=_),e},this.getEngine=function(){var e={};return e[l]=r,e[p]=r,K.call(e,E,y.engine),e},this.getOS=function(){var e={};return e[l]=r,e[p]=r,K.call(e,E,y.os),!e[l]&&v&&"Unknown"!=v.platform&&(e[l]=v.platform.replace(/chrome os/i,V).replace(/macos/i,B)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return E},this.setUA=function(e){return E=typeof e===a&&e.length>350?H(e,350):e,this},this.setUA(E),this};X.VERSION="0.7.34",X.BROWSER=G([l,p,c]),X.CPU=G([f]),X.DEVICE=G([u,h,d,m,g,E,_,v,y]),X.ENGINE=X.OS=G([l,p]),e.exports&&(n=e.exports=X),n.UAParser=X;var Q=typeof t!==o&&(t.jQuery||t.Zepto);if(Q&&!Q.ua){var Z=new X;Q.ua=Z.getResult(),Q.ua.get=function(){return Z.getUA()},Q.ua.set=function(e){Z.setUA(e);var t=Z.getResult();for(var n in t)Q.ua[n]=t[n]}}}("object"==typeof window?window:t)}(am,am.exports);var cm=r(am.exports),um=fr,lm=$e,dm=z,hm=Fo,pm=pt("iterator"),fm=Object,mm=function(e){if(dm(e))return!1;var t=fm(e);return void 0!==t[pm]||"@@iterator"in t||lm(hm,um(t))},gm=r(mm),_m=p;Nn({global:!0,forced:_m.globalThis!==_m},{globalThis:_m});var Em=r(p);function vm(e,t){return function(){return e.apply(t,arguments)}}const{toString:ym}=Object.prototype,{getPrototypeOf:bm}=Object,Tm=(Sm=Object.create(null),e=>{const t=ym.call(e);return Sm[t]||(Sm[t]=t.slice(8,-1).toLowerCase())});var Sm;const wm=e=>(e=e.toLowerCase(),t=>Tm(t)===e),Rm=e=>t=>typeof t===e,{isArray:Im}=Array,Cm=Rm("undefined"),Am=wm("ArrayBuffer"),Om=Rm("string"),Nm=Rm("function"),km=Rm("number"),Dm=e=>null!==e&&"object"==typeof e,Pm=e=>{if("object"!==Tm(e))return!1;const t=bm(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||gm(e))},Lm=wm("Date"),Mm=wm("File"),xm=wm("Blob"),Um=wm("FileList"),Fm=wm("URLSearchParams");function jm(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),Im(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let s;for(n=0;n<o;n++)s=r[n],t.call(null,e[s],s,e)}}function Vm(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const Bm=void 0!==Em?Em:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,Gm=e=>!Cm(e)&&e!==Bm,qm=(Wm="undefined"!=typeof Uint8Array&&bm(Uint8Array),e=>Wm&&e instanceof Wm);var Wm;const Hm=wm("HTMLFormElement"),Km=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),zm=wm("RegExp"),Ym=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};jm(n,((n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)})),Object.defineProperties(e,r)},Jm="abcdefghijklmnopqrstuvwxyz",Xm="0123456789",Qm={DIGIT:Xm,ALPHA:Jm,ALPHA_DIGIT:Jm+Jm.toUpperCase()+Xm},Zm=wm("AsyncFunction");var $m={isArray:Im,isArrayBuffer:Am,isBuffer:function(e){return null!==e&&!Cm(e)&&null!==e.constructor&&!Cm(e.constructor)&&Nm(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||Nm(e.append)&&("formdata"===(t=Tm(e))||"object"===t&&Nm(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Am(e.buffer),t},isString:Om,isNumber:km,isBoolean:e=>!0===e||!1===e,isObject:Dm,isPlainObject:Pm,isUndefined:Cm,isDate:Lm,isFile:Mm,isBlob:xm,isRegExp:zm,isFunction:Nm,isStream:e=>Dm(e)&&Nm(e.pipe),isURLSearchParams:Fm,isTypedArray:qm,isFileList:Um,forEach:jm,merge:function e(){const{caseless:t}=Gm(this)&&this||{},n={},r=(r,i)=>{const o=t&&Vm(n,i)||i;Pm(n[o])&&Pm(r)?n[o]=e(n[o],r):Pm(r)?n[o]=e({},r):Im(r)?n[o]=r.slice():n[o]=r};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&jm(arguments[i],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return jm(t,((t,r)=>{n&&Nm(t)?e[r]=vm(t,n):e[r]=t}),{allOwnKeys:r}),e},trim:e=>Bp(e)?Bp(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,o,s;const a={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)s=i[o],r&&!r(s,e,t)||a[s]||(t[s]=e[s],a[s]=!0);e=!1!==n&&bm(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Tm,kindOfTest:wm,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(Im(e))return e;let t=e.length;if(!km(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Hm,hasOwnProperty:Km,hasOwnProp:Km,reduceDescriptors:Ym,freezeMethods:e=>{Ym(e,((t,n)=>{if(Nm(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];Nm(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return Im(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:Vm,global:Bm,isContextDefined:Gm,ALPHABET:Qm,generateString:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qm.ALPHA_DIGIT,n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&Nm(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(Dm(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=Im(e)?[]:{};return jm(e,((e,t)=>{const o=n(e,r+1);!Cm(o)&&(i[t]=o)})),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:Zm,isThenable:e=>e&&(Dm(e)||Nm(e))&&Nm(e.then)&&Nm(e.catch)};function eg(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}$m.inherits(eg,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:$m.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const tg=eg.prototype,ng={};function rg(e){return $m.isPlainObject(e)||$m.isArray(e)}function ig(e){return $m.endsWith(e,"[]")?e.slice(0,-2):e}function og(e,t,n){return e?e.concat(t).map((function(e,t){return e=ig(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{ng[e]={value:e}})),Object.defineProperties(eg,ng),Object.defineProperty(tg,"isAxiosError",{value:!0}),eg.from=(e,t,n,r,i,o)=>{const s=Object.create(tg);return $m.toFlatObject(e,s,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),eg.call(s,e.message,t,n,r,i),s.cause=e,s.name=e.name,o&&Object.assign(s,o),s};const sg=$m.toFlatObject($m,{},null,(function(e){return/^is[A-Z]/.test(e)}));function ag(e,t,n){if(!$m.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=$m.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!$m.isUndefined(t[e])}))).metaTokens,i=n.visitor||u,o=n.dots,s=n.indexes,a=(n.Blob||"undefined"!=typeof Blob&&Blob)&&$m.isSpecCompliantForm(t);if(!$m.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if($m.isDate(e))return e.toISOString();if(!a&&$m.isBlob(e))throw new eg("Blob is not supported. Use a Buffer instead.");return $m.isArrayBuffer(e)||$m.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,i){let a=e;if(e&&!i&&"object"==typeof e)if($m.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if($m.isArray(e)&&function(e){return $m.isArray(e)&&!e.some(rg)}(e)||($m.isFileList(e)||$m.endsWith(n,"[]"))&&(a=$m.toArray(e)))return n=ig(n),a.forEach((function(e,r){!$m.isUndefined(e)&&null!==e&&t.append(!0===s?og([n],r,o):null===s?n:n+"[]",c(e))})),!1;return!!rg(e)||(t.append(og(i,n,o),c(e)),!1)}const l=[],d=Object.assign(sg,{defaultVisitor:u,convertValue:c,isVisitable:rg});if(!$m.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!$m.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),$m.forEach(n,(function(n,o){!0===(!($m.isUndefined(n)||null===n)&&i.call(t,n,$m.isString(o)?Bp(o).call(o):o,r,d))&&e(n,r?r.concat(o):[o])})),l.pop()}}(e),t}function cg(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function ug(e,t){this._pairs=[],e&&ag(e,this,t)}const lg=ug.prototype;function dg(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function hg(e,t,n){if(!t)return e;const r=n&&n.encode||dg,i=n&&n.serialize;let o;if(o=i?i(t,n):$m.isURLSearchParams(t)?t.toString():new ug(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}lg.append=function(e,t){this._pairs.push([e,t])},lg.toString=function(e){const t=e?function(t){return e.call(this,t,cg)}:cg;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var pg=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){$m.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},fg={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},mg={exports:{}},gg=Nn,_g=k,Eg=Zt.f;gg({target:"Object",stat:!0,forced:Object.defineProperty!==Eg,sham:!_g},{defineProperty:Eg});var vg=re.Object,yg=mg.exports=function(e,t,n){return vg.defineProperty(e,t,n)};vg.defineProperty.sham&&(yg.sham=!0);var bg=r(mg.exports),Tg=T,Sg=Array.isArray||function(e){return"Array"==Tg(e)},wg=TypeError,Rg=Sg,Ig=Bc,Cg=ne,Ag=pt("species"),Og=Array,Ng=function(e){var t;return Rg(e)&&(t=e.constructor,(Ig(t)&&(t===Og||Rg(t.prototype))||Cg(t)&&null===(t=t[Ag]))&&(t=void 0)),void 0===t?Og:t},kg=function(e,t){return new(Ng(e))(0===t?0:t)},Dg=i,Pg=ge,Lg=pt("species"),Mg=function(e){return Pg>=51||!Dg((function(){var t=[];return(t.constructor={})[Lg]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},xg=Nn,Ug=i,Fg=Sg,jg=ne,Vg=Xe,Bg=Wn,Gg=function(e){if(e>9007199254740991)throw wg("Maximum allowed index exceeded");return e},qg=gf,Wg=kg,Hg=Mg,Kg=ge,zg=pt("isConcatSpreadable"),Yg=Kg>=51||!Ug((function(){var e=[];return e[zg]=!1,e.concat()[0]!==e})),Jg=function(e){if(!jg(e))return!1;var t=e[zg];return void 0!==t?!!t:Fg(e)};xg({target:"Array",proto:!0,arity:1,forced:!Yg||!Hg("concat")},{concat:function(e){var t,n,r,i,o,s=Vg(this),a=Wg(s,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(Jg(o=-1===t?s:arguments[t]))for(i=Bg(o),Gg(c+i),n=0;n<i;n++,c++)n in o&&qg(a,c,o[n]);else Gg(c+1),qg(a,c++,o);return a.length=c,a}});var Xg={},Qg=T,Zg=$,$g=Ni.f,e_=Tf,t_="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Xg.f=function(e){return t_&&"Window"==Qg(e)?function(e){try{return $g(e)}catch(e){return e_(t_)}}(e):$g(Zg(e))};var n_={},r_=pt;n_.f=r_;var i_=re,o_=$e,s_=n_,a_=Zt.f,c_=function(e){var t=i_.Symbol||(i_.Symbol={});o_(t,e)||a_(t,e,{value:s_.f(e)})},u_=L,l_=ce,d_=pt,h_=pa,p_=function(){var e=l_("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=d_("toPrimitive");t&&!t[r]&&h_(t,r,(function(e){return u_(n,this)}),{arity:1})},f_=Qt,m_=K,g_=Xe,__=Wn,E_=kg,v_=l([].push),y_=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,u,l,d){for(var h,p,f=g_(c),m=m_(f),g=f_(u,l),_=__(m),E=0,v=d||E_,y=t?v(c,_):n||s?v(c,0):void 0;_>E;E++)if((a||E in m)&&(p=g(h=m[E],E,f),e))if(t)y[E]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return E;case 2:v_(y,h)}else switch(e){case 4:return!1;case 7:v_(y,h)}return o?-1:r||i?i:y}},b_={forEach:y_(0),map:y_(1),filter:y_(2),some:y_(3),every:y_(4),find:y_(5),findIndex:y_(6),filterReject:y_(7)},T_=Nn,S_=p,w_=L,R_=l,I_=k,C_=ye,A_=i,O_=$e,N_=d,k_=rn,D_=$,P_=St,L_=_r,M_=B,x_=wo,U_=to,F_=Ni,j_=Xg,V_=Bi,B_=N,G_=Zt,q_=Zi,W_=M,H_=pa,K_=hc,z_=ze,Y_=ki,J_=it,X_=pt,Q_=n_,Z_=c_,$_=p_,eE=Da,tE=oa,nE=b_.forEach,rE=di("hidden"),iE="Symbol",oE="prototype",sE=tE.set,aE=tE.getterFor(iE),cE=Object[oE],uE=S_.Symbol,lE=uE&&uE[oE],dE=S_.TypeError,hE=S_.QObject,pE=B_.f,fE=G_.f,mE=j_.f,gE=W_.f,_E=R_([].push),EE=z_("symbols"),vE=z_("op-symbols"),yE=z_("wks"),bE=!hE||!hE[oE]||!hE[oE].findChild,TE=I_&&A_((function(){return 7!=x_(fE({},"a",{get:function(){return fE(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=pE(cE,t);r&&delete cE[t],fE(e,t,n),r&&e!==cE&&fE(cE,t,r)}:fE,SE=function(e,t){var n=EE[e]=x_(lE);return sE(n,{type:iE,tag:e,description:t}),I_||(n.description=t),n},wE=function(e,t,n){e===cE&&wE(vE,t,n),k_(e);var r=P_(t);return k_(n),O_(EE,r)?(n.enumerable?(O_(e,rE)&&e[rE][r]&&(e[rE][r]=!1),n=x_(n,{enumerable:M_(0,!1)})):(O_(e,rE)||fE(e,rE,M_(1,{})),e[rE][r]=!0),TE(e,r,n)):fE(e,r,n)},RE=function(e,t){k_(e);var n=D_(t),r=U_(n).concat(OE(n));return nE(r,(function(t){I_&&!w_(IE,n,t)||wE(e,t,n[t])})),e},IE=function(e){var t=P_(e),n=w_(gE,this,t);return!(this===cE&&O_(EE,t)&&!O_(vE,t))&&(!(n||!O_(this,t)||!O_(EE,t)||O_(this,rE)&&this[rE][t])||n)},CE=function(e,t){var n=D_(e),r=P_(t);if(n!==cE||!O_(EE,r)||O_(vE,r)){var i=pE(n,r);return!i||!O_(EE,r)||O_(n,rE)&&n[rE][r]||(i.enumerable=!0),i}},AE=function(e){var t=mE(D_(e)),n=[];return nE(t,(function(e){O_(EE,e)||O_(Y_,e)||_E(n,e)})),n},OE=function(e){var t=e===cE,n=mE(t?vE:D_(e)),r=[];return nE(n,(function(e){!O_(EE,e)||t&&!O_(cE,e)||_E(r,EE[e])})),r};C_||(uE=function(){if(N_(lE,this))throw dE("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?L_(arguments[0]):void 0,t=J_(e),n=function(e){this===cE&&w_(n,vE,e),O_(this,rE)&&O_(this[rE],t)&&(this[rE][t]=!1),TE(this,t,M_(1,e))};return I_&&bE&&TE(cE,t,{configurable:!0,set:n}),SE(t,e)},H_(lE=uE[oE],"toString",(function(){return aE(this).tag})),H_(uE,"withoutSetter",(function(e){return SE(J_(e),e)})),W_.f=IE,G_.f=wE,q_.f=RE,B_.f=CE,F_.f=j_.f=AE,V_.f=OE,Q_.f=function(e){return SE(X_(e),e)},I_&&K_(lE,"description",{configurable:!0,get:function(){return aE(this).description}})),T_({global:!0,constructor:!0,wrap:!0,forced:!C_,sham:!C_},{Symbol:uE}),nE(U_(yE),(function(e){Z_(e)})),T_({target:iE,stat:!0,forced:!C_},{useSetter:function(){bE=!0},useSimple:function(){bE=!1}}),T_({target:"Object",stat:!0,forced:!C_,sham:!I_},{create:function(e,t){return void 0===t?x_(e):RE(x_(e),t)},defineProperty:wE,defineProperties:RE,getOwnPropertyDescriptor:CE}),T_({target:"Object",stat:!0,forced:!C_},{getOwnPropertyNames:AE}),$_(),eE(uE,iE),Y_[rE]=!0;var NE=ye&&!!Symbol.for&&!!Symbol.keyFor,kE=Nn,DE=ce,PE=$e,LE=_r,ME=ze,xE=NE,UE=ME("string-to-symbol-registry"),FE=ME("symbol-to-string-registry");kE({target:"Symbol",stat:!0,forced:!xE},{for:function(e){var t=LE(e);if(PE(UE,t))return UE[t];var n=DE("Symbol")(t);return UE[t]=n,FE[n]=t,n}});var jE=Nn,VE=$e,BE=Ie,GE=Ae,qE=NE,WE=ze("symbol-to-string-registry");jE({target:"Symbol",stat:!0,forced:!qE},{keyFor:function(e){if(!BE(e))throw TypeError(GE(e)+" is not a symbol");if(VE(WE,e))return WE[e]}});var HE=Sg,KE=O,zE=T,YE=_r,JE=l([].push),XE=Nn,QE=ce,ZE=E,$E=L,ev=l,tv=i,nv=O,rv=Ie,iv=Xc,ov=function(e){if(KE(e))return e;if(HE(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?JE(n,i):"number"!=typeof i&&"Number"!=zE(i)&&"String"!=zE(i)||JE(n,YE(i))}var o=n.length,s=!0;return function(e,t){if(s)return s=!1,t;if(HE(this))return t;for(var r=0;r<o;r++)if(n[r]===e)return t}}},sv=ye,av=String,cv=QE("JSON","stringify"),uv=ev(/./.exec),lv=ev("".charAt),dv=ev("".charCodeAt),hv=ev("".replace),pv=ev(1..toString),fv=/[\uD800-\uDFFF]/g,mv=/^[\uD800-\uDBFF]$/,gv=/^[\uDC00-\uDFFF]$/,_v=!sv||tv((function(){var e=QE("Symbol")();return"[null]"!=cv([e])||"{}"!=cv({a:e})||"{}"!=cv(Object(e))})),Ev=tv((function(){return'"\\udf06\\ud834"'!==cv("\udf06\ud834")||'"\\udead"'!==cv("\udead")})),vv=function(e,t){var n=iv(arguments),r=ov(t);if(nv(r)||void 0!==e&&!rv(e))return n[1]=function(e,t){if(nv(r)&&(t=$E(r,this,av(e),t)),!rv(t))return t},ZE(cv,null,n)},yv=function(e,t,n){var r=lv(n,t-1),i=lv(n,t+1);return uv(mv,e)&&!uv(gv,i)||uv(gv,e)&&!uv(mv,r)?"\\u"+pv(dv(e,0),16):e};cv&&XE({target:"JSON",stat:!0,arity:3,forced:_v||Ev},{stringify:function(e,t,n){var r=iv(arguments),i=ZE(_v?vv:cv,null,r);return Ev&&"string"==typeof i?hv(i,fv,yv):i}});var bv=Bi,Tv=Xe;Nn({target:"Object",stat:!0,forced:!ye||i((function(){bv.f(1)}))},{getOwnPropertySymbols:function(e){var t=bv.f;return t?t(Tv(e)):[]}}),c_("asyncIterator"),c_("hasInstance"),c_("isConcatSpreadable"),c_("iterator"),c_("match"),c_("matchAll"),c_("replace"),c_("search"),c_("species"),c_("split");var Sv=p_;c_("toPrimitive"),Sv();var wv=ce,Rv=Da;c_("toStringTag"),Rv(wv("Symbol"),"Symbol"),c_("unscopables"),Da(p.JSON,"JSON",!0);var Iv=re.Symbol,Cv=pt,Av=Zt.f,Ov=Cv("metadata"),Nv=Function.prototype;void 0===Nv[Ov]&&Av(Nv,Ov,{value:null}),c_("dispose"),c_("metadata");var kv=Iv;c_("asyncDispose");var Dv=l,Pv=ce("Symbol"),Lv=Pv.keyFor,Mv=Dv(Pv.prototype.valueOf),xv=Pv.isRegisteredSymbol||function(e){try{return void 0!==Lv(Mv(e))}catch(e){return!1}};Nn({target:"Symbol",stat:!0},{isRegisteredSymbol:xv});for(var Uv=ze,Fv=ce,jv=l,Vv=Ie,Bv=pt,Gv=Fv("Symbol"),qv=Gv.isWellKnownSymbol,Wv=Fv("Object","getOwnPropertyNames"),Hv=jv(Gv.prototype.valueOf),Kv=Uv("wks"),zv=0,Yv=Wv(Gv),Jv=Yv.length;zv<Jv;zv++)try{var Xv=Yv[zv];Vv(Gv[Xv])&&Bv(Xv)}catch(e){}var Qv=function(e){if(qv&&qv(e))return!0;try{for(var t=Hv(e),n=0,r=Wv(Kv),i=r.length;n<i;n++)if(Kv[r[n]]==t)return!0}catch(e){}return!1};Nn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Qv}),c_("matcher"),c_("observable"),Nn({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:xv}),Nn({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Qv}),c_("metadataKey"),c_("patternMatch"),c_("replaceAll");var Zv=r(kv),$v=r(n_.f("iterator"));function ey(e){return ey="function"==typeof Zv&&"symbol"==typeof $v?function(e){return typeof e}:function(e){return e&&"function"==typeof Zv&&e.constructor===Zv&&e!==Zv.prototype?"symbol":typeof e},ey(e)}var ty=r(n_.f("toPrimitive"));function ny(e){var t=function(e,t){if("object"!==ey(e)||null===e)return e;var n=e[ty];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==ey(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===ey(t)?t:String(t)}function ry(e,t,n){return(t=ny(t))in e?bg(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var iy=i,oy=pt("iterator"),sy=!iy((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[oy]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),ay=pa,cy=Nn,uy=p,ly=L,dy=l,hy=k,py=sy,fy=pa,my=hc,gy=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:ay(e,r,t[r],n);return e},_y=Da,Ey=ja,vy=oa,yy=vc,by=O,Ty=$e,Sy=Qt,wy=fr,Ry=rn,Iy=ne,Cy=_r,Ay=wo,Oy=B,Ny=ts,ky=Yo,Dy=Zc,Py=Af,Ly=pt("iterator"),My="URLSearchParams",xy=My+"Iterator",Uy=vy.set,Fy=vy.getterFor(My),jy=vy.getterFor(xy),Vy=Object.getOwnPropertyDescriptor,By=function(e){if(!hy)return uy[e];var t=Vy(uy,e);return t&&t.value},Gy=By("fetch"),qy=By("Request"),Wy=By("Headers"),Hy=qy&&qy.prototype,Ky=Wy&&Wy.prototype,zy=uy.RegExp,Yy=uy.TypeError,Jy=uy.decodeURIComponent,Xy=uy.encodeURIComponent,Qy=dy("".charAt),Zy=dy([].join),$y=dy([].push),eb=dy("".replace),tb=dy([].shift),nb=dy([].splice),rb=dy("".split),ib=dy("".slice),ob=/\+/g,sb=Array(4),ab=function(e){return sb[e-1]||(sb[e-1]=zy("((?:%[\\da-f]{2}){"+e+"})","gi"))},cb=function(e){try{return Jy(e)}catch(t){return e}},ub=function(e){var t=eb(e,ob," "),n=4;try{return Jy(t)}catch(e){for(;n;)t=eb(t,ab(n--),cb);return t}},lb=/[!'()~]|%20/g,db={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},hb=function(e){return db[e]},pb=function(e){return eb(Xy(e),lb,hb)},fb=Ey((function(e,t){Uy(this,{type:xy,iterator:Ny(Fy(e).entries),kind:t})}),"Iterator",(function(){var e=jy(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),mb=function(e){this.entries=[],this.url=null,void 0!==e&&(Iy(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Qy(e,0)?ib(e,1):e:Cy(e)))};mb.prototype={type:My,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,s,a,c=ky(e);if(c)for(n=(t=Ny(e,c)).next;!(r=ly(n,t)).done;){if(o=(i=Ny(Ry(r.value))).next,(s=ly(o,i)).done||(a=ly(o,i)).done||!ly(o,i).done)throw Yy("Expected sequence with length 2");$y(this.entries,{key:Cy(s.value),value:Cy(a.value)})}else for(var u in e)Ty(e,u)&&$y(this.entries,{key:u,value:Cy(e[u])})},parseQuery:function(e){if(e)for(var t,n,r=rb(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=rb(t,"="),$y(this.entries,{key:ub(tb(n)),value:ub(Zy(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],$y(n,pb(e.key)+"="+pb(e.value));return Zy(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var gb=function(){yy(this,_b);var e=Uy(this,new mb(arguments.length>0?arguments[0]:void 0));hy||(this.size=e.entries.length)},_b=gb.prototype;if(gy(_b,{append:function(e,t){var n=Fy(this);Dy(arguments.length,2),$y(n.entries,{key:Cy(e),value:Cy(t)}),hy||this.length++,n.updateURL()},delete:function(e){for(var t=Fy(this),n=Dy(arguments.length,1),r=t.entries,i=Cy(e),o=n<2?void 0:arguments[1],s=void 0===o?o:Cy(o),a=0;a<r.length;){var c=r[a];if(c.key!==i||void 0!==s&&c.value!==s)a++;else if(nb(r,a,1),void 0!==s)break}hy||(this.size=r.length),t.updateURL()},get:function(e){var t=Fy(this).entries;Dy(arguments.length,1);for(var n=Cy(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Fy(this).entries;Dy(arguments.length,1);for(var n=Cy(e),r=[],i=0;i<t.length;i++)t[i].key===n&&$y(r,t[i].value);return r},has:function(e){for(var t=Fy(this).entries,n=Dy(arguments.length,1),r=Cy(e),i=n<2?void 0:arguments[1],o=void 0===i?i:Cy(i),s=0;s<t.length;){var a=t[s++];if(a.key===r&&(void 0===o||a.value===o))return!0}return!1},set:function(e,t){var n=Fy(this);Dy(arguments.length,1);for(var r,i=n.entries,o=!1,s=Cy(e),a=Cy(t),c=0;c<i.length;c++)(r=i[c]).key===s&&(o?nb(i,c--,1):(o=!0,r.value=a));o||$y(i,{key:s,value:a}),hy||(this.size=i.length),n.updateURL()},sort:function(){var e=Fy(this);Py(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=Fy(this).entries,r=Sy(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new fb(this,"keys")},values:function(){return new fb(this,"values")},entries:function(){return new fb(this,"entries")}},{enumerable:!0}),fy(_b,Ly,_b.entries,{name:"entries"}),fy(_b,"toString",(function(){return Fy(this).serialize()}),{enumerable:!0}),hy&&my(_b,"size",{get:function(){return Fy(this).entries.length},configurable:!0,enumerable:!0}),_y(gb,My),cy({global:!0,constructor:!0,forced:!py},{URLSearchParams:gb}),!py&&by(Wy)){var Eb=dy(Ky.has),vb=dy(Ky.set),yb=function(e){if(Iy(e)){var t,n=e.body;if(wy(n)===My)return t=e.headers?new Wy(e.headers):new Wy,Eb(t,"content-type")||vb(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Ay(e,{body:Oy(0,Cy(n)),headers:Oy(0,t)})}return e};if(by(Gy)&&cy({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Gy(e,arguments.length>1?yb(arguments[1]):{})}}),by(qy)){var bb=function(e){return yy(this,Hy),new qy(e,arguments.length>1?yb(arguments[1]):{})};Hy.constructor=bb,bb.prototype=Hy,cy({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:bb})}}var Tb={URLSearchParams:gb,getState:Fy},Sb=r(re.URLSearchParams),wb={isBrowser:!0,classes:{URLSearchParams:void 0!==Sb?Sb:ug,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const Rb="undefined"!=typeof window&&"undefined"!=typeof document,Ib=(Cb="undefined"!=typeof navigator&&navigator.product,Rb&&["ReactNative","NativeScript","NS"].indexOf(Cb)<0);var Cb;const Ab="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts;function Ob(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ob(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ob(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var kb=Nb(Nb({},Object.freeze({__proto__:null,hasBrowserEnv:Rb,hasStandardBrowserEnv:Ib,hasStandardBrowserWebWorkerEnv:Ab})),wb),Db=rn,Pb=L,Lb=$e,Mb=d,xb=function(){var e=Db(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Ub=RegExp.prototype,Fb=function(e){var t=e.flags;return void 0!==t||"flags"in Ub||Lb(e,"flags")||!Mb(Ub,e)?t:Pb(xb,e)},jb=Th.charAt,Vb=L,Bb=rn,Gb=O,qb=T,Wb=/./.exec,Hb=TypeError,Kb=Nn,zb=L,Yb=R,Jb=ja,Xb=nc,Qb=X,Zb=Gn,$b=_r,eT=rn,tT=z,nT=T,rT=rr,iT=Fb,oT=Me,sT=i,aT=Jc,cT=function(e,t,n){return t+(n?jb(e,t).length:1)},uT=function(e,t){var n=e.exec;if(Gb(n)){var r=Vb(n,e,t);return null!==r&&Bb(r),r}if("RegExp"===qb(e))return Vb(Wb,e,t);throw Hb("RegExp#exec called on incompatible receiver")},lT=oa,dT=pt("matchAll"),hT="RegExp String",pT=hT+" Iterator",fT=lT.set,mT=lT.getterFor(pT),gT=TypeError,_T=Yb("".indexOf),ET=Yb("".matchAll),vT=!!ET&&!sT((function(){ET("a",/./)})),yT=Jb((function(e,t,n,r){fT(this,{type:pT,regexp:e,string:t,global:n,unicode:r,done:!1})}),hT,(function(){var e=mT(this);if(e.done)return Xb(void 0,!0);var t=e.regexp,n=e.string,r=uT(t,n);return null===r?(e.done=!0,Xb(void 0,!0)):e.global?(""===$b(r[0])&&(t.lastIndex=cT(n,Zb(t.lastIndex),e.unicode)),Xb(r,!1)):(e.done=!0,Xb(r,!1))})),bT=function(e){var t,n,r,i=eT(this),o=$b(e),s=aT(i,RegExp),a=$b(iT(i));return t=new s(s===RegExp?i.source:i,a),n=!!~_T(a,"g"),r=!!~_T(a,"u"),t.lastIndex=Zb(i.lastIndex),new yT(t,o,n,r)};Kb({target:"String",proto:!0,forced:vT},{matchAll:function(e){var t,n,r,i,o=Qb(this);if(tT(e)){if(vT)return ET(o,e)}else{if(rT(e)&&(t=$b(Qb(iT(e))),!~_T(t,"g")))throw gT("`.matchAll` does not allow non-global regexes");if(vT)return ET(o,e);if(void 0===(r=oT(e,dT))&&"RegExp"==nT(e)&&(r=bT),r)return zb(r,e,o)}return n=$b(o),i=new RegExp(e,"g"),zb(bT,i,n)}});var TT=Zn("String").matchAll,ST=d,wT=TT,RT=String.prototype,IT=function(e){var t=e.matchAll;return"string"==typeof e||e===RT||ST(RT,e)&&t===RT.matchAll?wT:t},CT=r(IT);function AT(e){function t(e,n,r,i){let o=e[i++];if("__proto__"===o)return!0;const s=Number.isFinite(+o),a=i>=e.length;return o=!o&&$m.isArray(r)?r.length:o,a?($m.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!s):(r[o]&&$m.isObject(r[o])||(r[o]=[]),t(e,n,r[o],i)&&$m.isArray(r[o])&&(r[o]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],t[o]=e[o];return t}(r[o])),!s)}if($m.isFormData(e)&&$m.isFunction(e.entries)){const n={};return $m.forEachEntry(e,((e,r)=>{t(function(e){return CT($m).call($m,/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null}const OT={transitional:fg,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=$m.isObject(e);if(i&&$m.isHTMLForm(e)&&(e=new FormData(e)),$m.isFormData(e))return r?JSON.stringify(AT(e)):e;if($m.isArrayBuffer(e)||$m.isBuffer(e)||$m.isStream(e)||$m.isFile(e)||$m.isBlob(e))return e;if($m.isArrayBufferView(e))return e.buffer;if($m.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return ag(e,new kb.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return kb.isNode&&$m.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=$m.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return ag(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if($m.isString(e))try{return(t||JSON.parse)(e),Bp($m).call($m,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||OT.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&$m.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw eg.from(e,eg.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:kb.classes.FormData,Blob:kb.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};$m.forEach(["delete","get","head","post","put","patch"],(e=>{OT.headers[e]={}}));var NT=OT;const kT=$m.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),DT=Symbol("internals");function PT(e){var t;return e&&Bp(t=String(e)).call(t).toLowerCase()}function LT(e){return!1===e||null==e?e:$m.isArray(e)?e.map(LT):String(e)}function MT(e,t,n,r,i){return $m.isFunction(r)?r.call(this,t,n):(i&&(t=n),$m.isString(t)?$m.isString(r)?-1!==t.indexOf(r):$m.isRegExp(r)?r.test(t):void 0:void 0)}class xT{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=PT(t);if(!i)throw new Error("header name must be a non-empty string");const o=$m.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=LT(e))}const o=(e,t)=>$m.forEach(e,((e,n)=>i(e,n,t)));var s;return $m.isPlainObject(e)||e instanceof this.constructor?o(e,t):$m.isString(e)&&(e=Bp(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Bp(s=e).call(s))?o((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){var o,s;i=e.indexOf(":"),n=Bp(o=e.substring(0,i)).call(o).toLowerCase(),r=Bp(s=e.substring(i+1)).call(s),!n||t[n]&&kT[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t):null!=e&&i(t,e,n),this}get(e,t){if(e=PT(e)){const n=$m.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if($m.isFunction(t))return t.call(this,e,n);if($m.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=PT(e)){const n=$m.findKey(this,e);return!(!n||void 0===this[n]||t&&!MT(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=PT(e)){const i=$m.findKey(n,e);!i||t&&!MT(0,n[i],i,t)||(delete n[i],r=!0)}}return $m.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!MT(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return $m.forEach(this,((r,i)=>{var o;const s=$m.findKey(n,i);if(s)return t[s]=LT(r),void delete t[i];const a=e?function(e){return Bp(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):Bp(o=String(i)).call(o);a!==i&&delete t[i],t[a]=LT(r),n[a]=!0})),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return $m.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&$m.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((e=>{let[t,n]=e;return t+": "+n})).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach((e=>t.set(e))),t}static accessor(e){const t=(this[DT]=this[DT]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=PT(e);t[r]||(function(e,t){const n=$m.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return $m.isArray(e)?e.forEach(r):r(e),this}}xT.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),$m.reduceDescriptors(xT.prototype,((e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}})),$m.freezeMethods(xT);var UT=xT;function FT(e,t){const n=this||NT,r=t||n,i=UT.from(r.headers);let o=r.data;return $m.forEach(e,(function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)})),i.normalize(),o}function jT(e){return!(!e||!e.__CANCEL__)}function VT(e,t,n){eg.call(this,null==e?"canceled":e,eg.ERR_CANCELED,t,n),this.name="CanceledError"}$m.inherits(VT,eg,{__CANCEL__:!0});var BT=kb.hasStandardBrowserEnv?{write(e,t,n,r,i,o){const s=[e+"="+encodeURIComponent(t)];$m.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),$m.isString(r)&&s.push("path="+r),$m.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function GT(e,t){return e&&!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var qT=kb.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=$m.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};function WT(e,t){let n=0;const r=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,o=0,s=0;return t=void 0!==t?t:1e3,function(a){const c=Date.now(),u=r[s];i||(i=c),n[o]=a,r[o]=c;let l=s,d=0;for(;l!==o;)d+=n[l++],l%=e;if(o=(o+1)%e,o===s&&(s=(s+1)%e),c-i<t)return;const h=u&&c-u;return h?Math.round(1e3*d/h):void 0}}(50,250);return i=>{const o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-n,c=r(a);n=o;const u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&o<=s?(s-o)/c:void 0,event:i};u[t?"download":"upload"]=!0,e(u)}}var HT="undefined"!=typeof XMLHttpRequest&&function(e){return new Gh((function(t,n){let r=e.data;const i=UT.from(e.headers).normalize();let o,s,{responseType:a,withXSRFToken:c}=e;function u(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}if($m.isFormData(r))if(kb.hasStandardBrowserEnv||kb.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if(!1!==(s=i.getContentType())){const[e,...t]=s?s.split(";").map((e=>Bp(e).call(e))).filter(Boolean):[];i.setContentType([e||"multipart/form-data",...t].join("; "))}let l=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(t+":"+n))}const d=GT(e.baseURL,e.url);function h(){if(!l)return;const r=UT.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new eg("Request failed with status code "+n.status,[eg.ERR_BAD_REQUEST,eg.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),u()}),(function(e){n(e),u()}),{data:a&&"text"!==a&&"json"!==a?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:r,config:e,request:l}),l=null}if(l.open(e.method.toUpperCase(),hg(d,e.params,e.paramsSerializer),!0),l.timeout=e.timeout,"onloadend"in l?l.onloadend=h:l.onreadystatechange=function(){l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))&&setTimeout(h)},l.onabort=function(){l&&(n(new eg("Request aborted",eg.ECONNABORTED,e,l)),l=null)},l.onerror=function(){n(new eg("Network Error",eg.ERR_NETWORK,e,l)),l=null},l.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||fg;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new eg(t,r.clarifyTimeoutError?eg.ETIMEDOUT:eg.ECONNABORTED,e,l)),l=null},kb.hasStandardBrowserEnv&&(c&&$m.isFunction(c)&&(c=c(e)),c||!1!==c&&qT(d))){const t=e.xsrfHeaderName&&e.xsrfCookieName&&BT.read(e.xsrfCookieName);t&&i.set(e.xsrfHeaderName,t)}void 0===r&&i.setContentType(null),"setRequestHeader"in l&&$m.forEach(i.toJSON(),(function(e,t){l.setRequestHeader(t,e)})),$m.isUndefined(e.withCredentials)||(l.withCredentials=!!e.withCredentials),a&&"json"!==a&&(l.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&l.addEventListener("progress",WT(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",WT(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=t=>{l&&(n(!t||t.type?new VT(null,e,l):t),l.abort(),l=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const p=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(d);p&&-1===kb.protocols.indexOf(p)?n(new eg("Unsupported protocol "+p+":",eg.ERR_BAD_REQUEST,e)):l.send(r||null)}))};const KT={http:null,xhr:HT};$m.forEach(KT,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));const zT=e=>"- ".concat(e),YT=e=>$m.isFunction(e)||null===e||!1===e;var JT={getAdapter:e=>{e=$m.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let o=0;o<t;o++){let t;if(n=e[o],r=n,!YT(n)&&(r=KT[(t=String(n)).toLowerCase()],void 0===r))throw new eg("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+o]=r}if(!r){const e=Object.entries(i).map((e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")}));throw new eg("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(zT).join("\n"):" "+zT(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:KT};function XT(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new VT(null,e)}function QT(e){return XT(e),e.headers=UT.from(e.headers),e.data=FT.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),JT.getAdapter(e.adapter||NT.adapter)(e).then((function(t){return XT(e),t.data=FT.call(e,e.transformResponse,t),t.headers=UT.from(t.headers),t}),(function(t){return jT(t)||(XT(e),t&&t.response&&(t.response.data=FT.call(e,e.transformResponse,t.response),t.response.headers=UT.from(t.response.headers))),Gh.reject(t)}))}function ZT(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const $T=e=>e instanceof UT?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZT(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZT(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e):e;function eS(e,t){t=t||{};const n={};function r(e,t,n){return $m.isPlainObject(e)&&$m.isPlainObject(t)?$m.merge.call({caseless:n},e,t):$m.isPlainObject(t)?$m.merge({},t):$m.isArray(t)?t.slice():t}function i(e,t,n){return $m.isUndefined(t)?$m.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function o(e,t){if(!$m.isUndefined(t))return r(void 0,t)}function s(e,t){return $m.isUndefined(t)?$m.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function a(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(e,t)=>i($T(e),$T(t),!0)};return $m.forEach(Object.keys(Object.assign({},e,t)),(function(r){const o=c[r]||i,s=o(e[r],t[r],r);$m.isUndefined(s)&&o!==a||(n[r]=s)})),n}const tS="1.6.8",nS={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{nS[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const rS={};nS.transitional=function(e,t,n){function r(e,t){return"[Axios v"+tS+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new eg(r(i," has been removed"+(t?" in "+t:"")),eg.ERR_DEPRECATED);return t&&!rS[i]&&(rS[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var iS={assertOptions:function(e,t,n){if("object"!=typeof e)throw new eg("options must be an object",eg.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const o=r[i],s=t[o];if(s){const t=e[o],n=void 0===t||s(t,o,e);if(!0!==n)throw new eg("option "+o+" must be "+n,eg.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new eg("Unknown option "+o,eg.ERR_BAD_OPTION)}},validators:nS};const oS=iS.validators;let sS=class{constructor(e){this.defaults=e,this.interceptors={request:new pg,response:new pg}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=eS(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&iS.assertOptions(n,{silentJSONParsing:oS.transitional(oS.boolean),forcedJSONParsing:oS.transitional(oS.boolean),clarifyTimeoutError:oS.transitional(oS.boolean)},!1),null!=r&&($m.isFunction(r)?t.paramsSerializer={serialize:r}:iS.assertOptions(r,{encode:oS.function,serialize:oS.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&$m.merge(i.common,i[t.method]);i&&$m.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=UT.concat(o,i);const s=[];let a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,s.unshift(e.fulfilled,e.rejected))}));const c=[];let u;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let l,d=0;if(!a){const e=[QT.bind(this),void 0];for(e.unshift.apply(e,s),e.push.apply(e,c),l=e.length,u=Gh.resolve(t);d<l;)u=u.then(e[d++],e[d++]);return u}l=s.length;let h=t;for(d=0;d<l;){const t=s[d++],n=s[d++];try{h=t(h)}catch(e){n.call(this,e);break}}try{u=QT.call(this,h)}catch(e){return Gh.reject(e)}for(d=0,l=c.length;d<l;)u=u.then(c[d++],c[d++]);return u}getUri(e){return hg(GT((e=eS(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};$m.forEach(["delete","get","head","options"],(function(e){sS.prototype[e]=function(t,n){return this.request(eS(n||{},{method:e,url:t,data:(n||{}).data}))}})),$m.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(eS(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}sS.prototype[e]=t(),sS.prototype[e+"Form"]=t(!0)}));var aS=sS;class cS{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Gh((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Gh((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new VT(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new cS((function(t){e=t})),cancel:e}}}var uS=cS;const lS={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(lS).forEach((e=>{let[t,n]=e;lS[n]=t}));var dS=lS;const hS=function e(t){const n=new aS(t),r=vm(aS.prototype.request,n);return $m.extend(r,aS.prototype,n,{allOwnKeys:!0}),$m.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(eS(t,n))},r}(NT);hS.Axios=aS,hS.CanceledError=VT,hS.CancelToken=uS,hS.isCancel=jT,hS.VERSION=tS,hS.toFormData=ag,hS.AxiosError=eg,hS.Cancel=hS.CanceledError,hS.all=function(e){return Gh.all(e)},hS.spread=function(e){return function(t){return e.apply(null,t)}},hS.isAxiosError=function(e){return $m.isObject(e)&&!0===e.isAxiosError},hS.mergeConfig=eS,hS.AxiosHeaders=UT,hS.formToJSON=e=>AT($m.isHTMLForm(e)?new FormData(e):e),hS.getAdapter=JT.getAdapter,hS.HttpStatusCode=dS,hS.default=hS;var pS=hS;const fS=()=>{};function mS(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:fS};return e.promise=new Gh(((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}const gS=new Map,_S=new Map,ES=new Map;let vS=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),yS=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const bS=new cm;let TS=bS.getResult(),SS=null;function wS(e){if(!SS){e&&bS.setUA(e),TS=bS.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return yS.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return yS.CHROME;case"Safari":case"Mobile Safari":return yS.SAFARI;case"Edge":return yS.EDGE;case"Firefox":return yS.FIREFOX;case"QQ":case"QQBrowser":return yS.QQ;case"Opera":return yS.OPERA;case"WeChat":return yS.WECHAT;default:return e.browser.name||""}}(TS),n=RS(TS),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(TS),i=TS.os.version,o=RS(TS,!1),s=TS.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:o,deviceType:s};SS={name:t,version:n,os:r,osVersion:i,browserVersion:o,deviceType:s}}return SS}function RS(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function IS(){return wS().os}function CS(){const e=wS();return"".concat(e.os," ").concat(e.osVersion)}function AS(){const e=wS();return!!("WebKit"===TS.engine.name&&e.os===vS.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==yS.SAFARI||PS()&&e.name!==yS.SAFARI)}function OS(){return wS().name===yS.CHROME}function NS(){return wS().name===yS.SAFARI}function kS(){return wS().name===yS.EDGE}function DS(){return wS().name===yS.FIREFOX}function PS(){return wS().os===vS.IOS}function LS(e){const t=wS();return!(t.name!==yS.CHROME||!t.osVersion)&&Number(t.version)>=e}function MS(e){const t=wS();return!(t.name!==yS.EDGE||!t.osVersion)&&Number(t.version)>=e}function xS(e){const t=wS();return!(t.name!==yS.SAFARI||!t.osVersion)&&Number(t.version)>=e}function US(e,t,n){const r=wS();if(r.os!==vS.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function FS(e,t,n){const r=wS();if(r.name!==yS.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function jS(e){const t=wS();return!(t.name!==yS.OPERA||!t.osVersion)&&Number(t.version)>=e}function VS(){const e=wS();return!(e.name!==yS.CHROME||!e.osVersion)&&Number(e.version)<=90}function BS(){const e=wS();if(e.os!==vS.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function GS(){const e=wS();if(e.os!==vS.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function qS(){const e=wS();if(e.os!==vS.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function WS(){const e=wS();if(e.os!==vS.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function HS(){return NS()&&navigator.maxTouchPoints>0}function KS(){return wS().name===yS.WECHAT}function zS(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function YS(){const e=IS();return function(){const{deviceType:e}=wS();return"mobile"===e||"tablet"===e}()||e===vS.ANDROID||e===vS.IOS||e===vS.HARMONY_OS}function JS(){const e=wS();return e.name!==yS.EDGE&&e.name!==yS.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function XS(){return IS()===vS.ANDROID}function QS(){const e=wS();return XS()&&(e.name===yS.CHROME||e.name===yS.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function ZS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZS(Object(n),!0).forEach((function(t){ew(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ew(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let tw=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class nw extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),ew(this,"code",void 0),ew(this,"message",void 0),ew(this,"data",void 0),ew(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}}function rw(e,t){if("boolean"!=typeof e)throw new nw(tw.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function iw(e,t,n){if(!Dr(n).call(n,e))throw new nw(tw.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function ow(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new nw(tw.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function sw(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new nw(tw.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&ow(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&ow(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&ow(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&ow(e.ideal,"".concat(t,".ideal"),1,1/0)}else ow(e,t,1,1/0)}function aw(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new nw(tw.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!lw(e,n,r,i))throw new nw(tw.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function cw(e,t){if(!Array.isArray(e))throw new nw(tw.INVALID_PARAMS,"".concat(t," should be an array"))}function uw(e){return null==e}function lw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}function dw(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const r=e.getUint32(t,n),i=e.getUint32(t+4,n),o=Number(!!n),s=Number(!n);return BigInt(r*s+i*o)<<BigInt(32)|BigInt(r*o+i*s)}function hw(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);const i=Number(n>>BigInt(32)),o=Number(n&BigInt(4294967295));r?(e.setUint32(t+4,i,r),e.setUint32(t,o,r)):(e.setUint32(t,i,r),e.setUint32(t+4,o,r))}var pw=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(pw||{}),fw=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(fw||{});const mw=new class{constructor(){ew(this,"_clientSize",null),ew(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),ew(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),ew(this,"getStyle",(e=>window.getComputedStyle(e,null))),ew(this,"checkCssVisibleProperty",(e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:o,opacity:s,filter:a}=r;return("none"===i||Dr(t=["hidden","collapse"]).call(t,o)||Number(s)<.1)&&(n=!1),!!n&&(a&&a.split(" ").filter((e=>{var t;const n=e.split("(")[0];return Dr(t=["brightness","blur","opacity"]).call(t,n)})).map((e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]})).forEach((e=>{const[t,r]=e;switch(t){case"brightness":(r<.1||r>3)&&(n=!1);break;case"blur":r>3&&(n=!1);break;case"opacity":r<.1&&(n=!1)}})),n)})),ew(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0;const i=e=>t(e);let o=e;for(;o&&r;)i(o)||(n=!1,r=!1),o=o.parentElement,o||(r=!1);return n})),ew(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),ew(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:r,right:i,top:o,bottom:s}=e.getBoundingClientRect(),a=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:o,bottom:s,clientWidth:a,clientHeight:c,clientMin:Math.min(a,c)}})),ew(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),ew(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),ew(this,"checkCoverForAPoint",((e,t,n)=>{const r=this.elementFromPoint(e,t);return null!==r&&r!==n})),ew(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,o=t/6,s=[],a=10**6;for(let c=0;c<5;c++)for(let e=0;e<5;e++){const t=(n*a+(0===c?.1:4===c?(i*c*a-1e5)/a:i*c)*a)/a,u=(r*a+(0===e?.1:4===e?(o*e*a-1e5)/a:o*e)*a)/a;s.push({x:t,y:u})}return[...s]})),ew(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),ew(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),ew(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:o,clientMin:s}=this._clientSize;let a,c,u,l;if(e<0)a=0;else{if(!(e<o))return!1;a=e}if(t<0)return!1;if(c=t<o?t:o,n<0)u=0;else{if(!(n<i))return!1;u=n}if(r<0)return!1;l=r<i?r:i;const d=c-a,h=l-u;return this.checkSizeIsVisible(d,h,s)})),ew(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),ew(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(pw.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(pw.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(pw.SIZE)}}return this.returnHiddenResult(pw.STYLE)}return this.returnHiddenResult(fw.UNMOUNTED)}return this.returnHiddenResult(fw.INVALID_HTML_ELEMENT)})),ew(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function gw(e){return(new TextEncoder).encode(e)}const _w=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Ew=async e=>function(e,t){let n="";return new Uint8Array(e).forEach((e=>{n+=e.toString(t).padStart(2,"0")})),n}(await crypto.subtle.digest("SHA-256",gw(e)),16);let vw=class{constructor(){ew(this,"_events",{}),ew(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map((e=>e));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let o=0;o<t.length;o+=1){const n=t[o];n.once&&this.off(e,n.listener),n.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}}))}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},yw=null;function bw(){if(yw)return yw;if(window.electron)return yw=window.electron;if(!window.require)return null;try{return yw=window.require("electron"),yw}catch(e){return null}}let Tw=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),Sw=function(e){return e.TRACER="tracer",e}({});function ww(e){return ow(e.timeout,"config.timeout",0,1e5),ow(e.timeoutFactor,"config.timeoutFactor",0,100,!1),ow(e.maxRetryCount,"config.maxRetryConfig",0,1/0),ow(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Rw=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Iw=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Cw(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function Aw(e){return aw(e.turnServerURL,"turnServerURL"),aw(e.username,"username"),aw(e.password,"password"),e.udpport&&ow(e.udpport,"udpport",1,99999,!0),e.forceturn&&rw(e.forceturn,"forceturn"),e.security&&rw(e.security,"security"),e.tcpport&&ow(e.tcpport,"tcpport",1,99999,!0),!0}function Ow(e){return void 0!==e.level&&iw(e.level,"level",[1,2,3]),void 0!==e.delay&&ow(e.delay,"delay",0,3e3,!0),!0}let Nw=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),kw=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),Dw=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Pw=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Lw(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?Gh.reject(new nw(tw.UNEXPECTED_ERROR,"can not emit promise")):new Gh(((n,i)=>{e.emit(t,...r,n,i)}))}function Mw(e,t){if(0===e.getListeners(t).length)return Gh.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Lw(e,t,...r)}function xw(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Uw(e,t,...r)}function Uw(e,t){let n=null,r=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];if(e.emit(t,...o,(e=>{n=e}),(e=>{r=e})),null!==r)throw r;if(null===n)throw new nw(tw.UNEXPECTED_ERROR,"handler is not sync");return n}const Fw=new class extends vw{set networkState(e){this.emit(Pw.NETWORK_STATE_CHANGE,e,this._networkState),e===Dw.ONLINE?this.emit(Pw.ONLINE):e===Dw.OFFLINE&&(this.onlineWaiter=new Gh((e=>{this.once(Pw.ONLINE,(()=>{this.onlineWaiter=void 0,e(Dw.ONLINE)}))})),this.emit(Pw.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Dw.ONLINE}constructor(){super(),ew(this,"_moduleName","network-indicator"),ew(this,"_networkState",Dw.ONLINE),ew(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=Dw.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=Dw.OFFLINE}))}};function jw(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function Vw(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function Bw(e){void 0!==Gh?Gh.resolve().then(e):setTimeout(e,0)}function Gw(e){return JSON.parse(JSON.stringify(e))}function qw(e){try{return Gw(e)}catch(t){return e}}const Ww={};function Hw(e,t){Ww[t]||(Ww[t]=!0,e())}function Kw(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function zw(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function Yw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const e=new Uint8Array(t);e.set(n),n=e}return n}function Jw(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Xr(t).call(t,((e,t)=>e+t.length),0),i=new Uint8Array(new ArrayBuffer(r));let o=0;return t.forEach((e=>{i.set(e,o),o+=e.length})),i}function Xw(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function Qw(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?Xw(e):e.size})),t+138}function Zw(e){const t=new nw(tw.TIMEOUT,"timeout");return new Gh(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function $w(e){return new Gh((t=>{window.setTimeout(t,e)}))}function eR(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+eR(e-n.length,"")}function tR(){return eR(32,"").toUpperCase()}const nR=()=>{},rR=new class{constructor(){ew(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,o=new Array(i>4?i-4:0),s=4;s<i;s++)o[s-4]=arguments[s];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const s=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:s,args:o,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,$S($S({},i),{},{fn:e,args:o,skipFn:r}))}else{const i=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:o,skipFn:r})}}},iR=rR.throttleByKey.bind(rR);function oR(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function sR(e,t){if(!oR(e)||!oR(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=sR(e[r],t[r]);return n}{const n=$S({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=sR(e[r],t[r]):n[r]=t[r]);return n}}function aR(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function cR(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function uR(e){const t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,s){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,s)),o),n)}function o(e,t,n,r,o,s,a){return i(t&n|~t&r,e,t,o,s,a)}function s(e,t,n,r,o,s,a){return i(t&r|n&~r,e,t,o,s,a)}function a(e,t,n,r,o,s,a){return i(t^n^r,e,t,o,s,a)}function c(e,t,n,r,o,s,a){return i(n^(t|~r),e,t,o,s,a)}const u=function(e){let t;const n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e);let l,d,h,p,f,m=1732584193,g=-271733879,_=-1732584194,E=271733878;for(l=0;l<u.length;l+=16)d=m,h=g,p=_,f=E,m=o(m,g,_,E,u[l+0],7,-680876936),E=o(E,m,g,_,u[l+1],12,-389564586),_=o(_,E,m,g,u[l+2],17,606105819),g=o(g,_,E,m,u[l+3],22,-1044525330),m=o(m,g,_,E,u[l+4],7,-176418897),E=o(E,m,g,_,u[l+5],12,1200080426),_=o(_,E,m,g,u[l+6],17,-1473231341),g=o(g,_,E,m,u[l+7],22,-45705983),m=o(m,g,_,E,u[l+8],7,1770035416),E=o(E,m,g,_,u[l+9],12,-1958414417),_=o(_,E,m,g,u[l+10],17,-42063),g=o(g,_,E,m,u[l+11],22,-1990404162),m=o(m,g,_,E,u[l+12],7,1804603682),E=o(E,m,g,_,u[l+13],12,-40341101),_=o(_,E,m,g,u[l+14],17,-1502002290),g=o(g,_,E,m,u[l+15],22,1236535329),m=s(m,g,_,E,u[l+1],5,-165796510),E=s(E,m,g,_,u[l+6],9,-1069501632),_=s(_,E,m,g,u[l+11],14,643717713),g=s(g,_,E,m,u[l+0],20,-373897302),m=s(m,g,_,E,u[l+5],5,-701558691),E=s(E,m,g,_,u[l+10],9,38016083),_=s(_,E,m,g,u[l+15],14,-660478335),g=s(g,_,E,m,u[l+4],20,-405537848),m=s(m,g,_,E,u[l+9],5,568446438),E=s(E,m,g,_,u[l+14],9,-1019803690),_=s(_,E,m,g,u[l+3],14,-187363961),g=s(g,_,E,m,u[l+8],20,1163531501),m=s(m,g,_,E,u[l+13],5,-1444681467),E=s(E,m,g,_,u[l+2],9,-51403784),_=s(_,E,m,g,u[l+7],14,1735328473),g=s(g,_,E,m,u[l+12],20,-1926607734),m=a(m,g,_,E,u[l+5],4,-378558),E=a(E,m,g,_,u[l+8],11,-2022574463),_=a(_,E,m,g,u[l+11],16,1839030562),g=a(g,_,E,m,u[l+14],23,-35309556),m=a(m,g,_,E,u[l+1],4,-1530992060),E=a(E,m,g,_,u[l+4],11,1272893353),_=a(_,E,m,g,u[l+7],16,-155497632),g=a(g,_,E,m,u[l+10],23,-1094730640),m=a(m,g,_,E,u[l+13],4,681279174),E=a(E,m,g,_,u[l+0],11,-358537222),_=a(_,E,m,g,u[l+3],16,-722521979),g=a(g,_,E,m,u[l+6],23,76029189),m=a(m,g,_,E,u[l+9],4,-640364487),E=a(E,m,g,_,u[l+12],11,-421815835),_=a(_,E,m,g,u[l+15],16,530742520),g=a(g,_,E,m,u[l+2],23,-995338651),m=c(m,g,_,E,u[l+0],6,-198630844),E=c(E,m,g,_,u[l+7],10,1126891415),_=c(_,E,m,g,u[l+14],15,-1416354905),g=c(g,_,E,m,u[l+5],21,-57434055),m=c(m,g,_,E,u[l+12],6,1700485571),E=c(E,m,g,_,u[l+3],10,-1894986606),_=c(_,E,m,g,u[l+10],15,-1051523),g=c(g,_,E,m,u[l+1],21,-2054922799),m=c(m,g,_,E,u[l+8],6,1873313359),E=c(E,m,g,_,u[l+15],10,-30611744),_=c(_,E,m,g,u[l+6],15,-1560198380),g=c(g,_,E,m,u[l+13],21,1309151649),m=c(m,g,_,E,u[l+4],6,-145523070),E=c(E,m,g,_,u[l+11],10,-1120210379),_=c(_,E,m,g,u[l+2],15,718787259),g=c(g,_,E,m,u[l+9],21,-343485551),m=r(m,d),g=r(g,h),_=r(_,p),E=r(E,f);return n(m)+n(g)+n(_)+n(E)}let lR=1,dR=console,hR=class{static setLogger(e){dR=e}constructor(e){ew(this,"lockingPromise",Gh.resolve()),ew(this,"locks",0),ew(this,"name",""),ew(this,"lockId",void 0),this.lockId=lR++,e&&(this.name=e),dR.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,dR.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));const n=new Gh((n=>{t=()=>{this.locks-=1,dR.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:"")),n()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}};function pR(e,t){return function(n,r,i){const o=i.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(r));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return await o.apply(this,a)}finally{i()}},i}}const fR={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function mR(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function gR(e,t,n,r){const i=Object.assign({},fR,r);let o=i.timeout;const s=async()=>{await function(e){return new Gh((t=>{window.setTimeout(t,e)}))}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)};let a=!1;const c=new Gh((async(r,o)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(a)return o(new nw(tw.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return r(n);if(c+1===i.maxRetryCount)return r(n);await s()}catch(e){if(!n(e,c))return o(e);if(c+1===i.maxRetryCount)return o(e);await s()}}}));return c.cancel=()=>a=!0,c}class _R{constructor(e){ew(this,"input",[]),ew(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:Xr(e=this.input).call(e,((e,t)=>e+t))/this.input.length}}let ER,vR=0,yR=0;function bR(e,t,n,r){return new Gh(((i,o)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),vR+=Xw(t.data)):n&&(t.data.size?vR+=t.data.size:t.data instanceof FormData?vR+=Qw(t.data):vR+=Xw(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,pS.request(t).then((e=>{"string"==typeof e.data?yR+=Xw(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?yR+=e.data.byteLength:yR+=Xw(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{pS.isCancel(e)?o(new nw(tw.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new nw(tw.NETWORK_TIMEOUT,e.message)):e.response?o(new nw(tw.NETWORK_RESPONSE_ERROR,e.response.status)):o(new nw(tw.NETWORK_ERROR,e.message))}))}))}async function TR(e,t){const n=new Blob([t.data],{type:"buffer"});return await bR(e,$S($S({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const SR=()=>void 0!==window.isSecureContext,wR=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const e=n[1],t=n[2];return"".concat(e,".").concat(100*(Number(t)+1))}return"4.0.0.999"}("4.21.0"),RR=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let IR=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const CR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},AR="v4.21.0-0-g16fdae2c-dirty(6/3/2024, 2:55:18 PM)",OR={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:void 0,ENABLE_CC_FALLBACK:void 0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:CR,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0};function NR(e,t,n){var r,i,o;Dr(r=Object.keys(OR)).call(r,e)&&(!n&&Dr(i=Object.keys(DR)).call(i,e)||(OR[e]=t,"ENABLE_VIDEO_SEI"===e&&!0===t&&(OR.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(o=!!t,OR.USE_NEW_NETWORK_CONFIG=o,o&&(OR.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],OR.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],OR.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],OR.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],OR.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",OR.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",OR.GATEWAY_DOMAINS=["edge.sd-rtn.com"]))))}function kR(e){return OR[e]}const DR={};var PR=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(PR||{});class LR{constructor(e,t,n,r){ew(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:IR.Default}}dispatch(e){this.state=function(e,t){switch(t.type){case PR.SET_SESSION_ID:return $S($S({},e),{},{sessionId:t.sessionId});case PR.SET_P2P_ID:return $S($S({},e),{},{p2pId:t.p2pId});case PR.SET_UID:return $S($S({},e),{},{uid:t.uid});case PR.SET_INT_UID:return $S($S({},e),{},{intUid:t.intUid});case PR.SET_PUB_ID:return $S($S({},e),{},{pubId:t.pubId});case PR.KEY_METRIC_CLIENT_CREATED:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{clientCreated:t.metric})});case PR.KEY_METRIC_JOIN_START:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{joinStart:t.metric})});case PR.AVOID_JOIN_START:return $S($S({},e),{},{avoidJoinStart:t.avoidJoinStart});case PR.KEY_METRIC_JOIN_END:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{joinEnd:t.metric})});case PR.KEY_METRIC_REQUEST_AP_START:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{requestAPStart:t.metric})});case PR.KEY_METRIC_REQUEST_AP_END:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{requestAPEnd:t.metric})});case PR.KEY_METRIC_JOIN_GATEWAY_START:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case PR.KEY_METRIC_JOIN_GATEWAY_END:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case PR.KEY_METRIC_PEER_CONNECTION_START:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case PR.KEY_METRIC_PEER_CONNECTION_END:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case PR.KEY_METRIC_DESCRIPTION_START:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{descriptionStart:t.metric})});case PR.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case PR.KEY_METRIC_ICE_CONNECTION_END:return $S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case PR.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,r=n.findIndex((e=>e.trackId===t.metric.trackId));return-1!==r?(n[r]=$S($S({},n[r]),t.metric),$S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{publish:[...n]})})):$S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case PR.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,r=n.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==r?(n[r]=$S($S({},n[r]),t.metric),$S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{subscribe:[...n]})})):$S($S({},e),{},{keyMetrics:$S($S({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case PR.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case PR.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=$S($S({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case PR.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case PR.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case PR.SET_USE_DATACHANNEL:return $S($S({},e),{},{useDataChannel:t.val});case PR.SET_USE_P2P:return $S($S({},e),{},{useP2P:t.val});case PR.SET_TRANSPORT_TYPE:return $S($S({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:PR.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:PR.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:PR.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:PR.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:PR.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:PR.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:PR.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(e){this.dispatch({type:PR.SET_USE_DATACHANNEL,val:e})}get useDataChannel(){return this.state.useDataChannel}set useP2P(e){this.dispatch({type:PR.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:PR.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:PR.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:PR.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:PR.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:PR.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:PR.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:PR.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:PR.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:PR.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:PR.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:PR.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:PR.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:PR.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:PR.KEY_METRIC_PUBLISH,metric:$S($S({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,o,s){this.dispatch({type:PR.KEY_METRIC_SUBSCRIBE,metric:$S($S($S($S($S({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),o&&{streamAdded:o}),s&&{firstDecoded:s})})}massSubscribe(e,t,n,r){e.forEach((e=>{this.dispatch({type:PR.KEY_METRIC_SUBSCRIBE,metric:$S($S($S({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:PR.RECORD_JOIN_CHANNEL_SERVICE,record:$S($S({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:PR.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:PR.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:PR.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:PR.AVOID_JOIN_START,avoidJoinStart:e})}}let MR=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});const xR=128,UR=96,FR=1e3,jR=10;let VR=0;function BR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BR(Object(n),!0).forEach((function(t){qR(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qR(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const WR=new class extends vw{constructor(){super(...arguments),qR(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class HR{constructor(e){qR(this,"logger",void 0),qR(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function KR(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function zR(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const YR={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},JR=Date.now(),XR=e=>{for(const t in YR)if(Object.prototype.hasOwnProperty.call(YR,t)&&YR[t]===e)return t;return"DEFAULT"},QR=new class{constructor(){qR(this,"proxyServerURL",void 0),qR(this,"logLevel",YR.DEBUG),qR(this,"uploadState","collecting"),qR(this,"uploadLogWaitingList",[]),qR(this,"uploadLogUploadingList",[]),qR(this,"uploadErrorCount",0),qR(this,"currentLogID",0),qR(this,"url",void 0),qR(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[YR.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[YR.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[YR.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[YR.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[YR.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){NR("UPLOAD_LOG",!0)}disableLogUpload(){NR("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new HR(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-JR<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-JR);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=KR()+" Agora-SDK [".concat(XR(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=KR()+" %cAgora-SDK [".concat(XR(r),"]:");let o=[];if(!kR("USE_NEW_LOG"))switch(r){case YR.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case YR.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case YR.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case YR.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-JR<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-JR);const r=Math.max(0,Math.min(4,t[0]));t[0]=KR()+" Agora-SDK [".concat(XR(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!kR("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=zR()+" Agora-SDK [".concat(XR(e),"]:"):n[0]=zR()+" Agora-SDK [".concat(XR(e),"]:");let i="";n.forEach((e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:wR,process_id:kR("PROCESS_ID"),payload:JSON.stringify(e)};return gR((async()=>{const e=await pS.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(kR("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(kR("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}}),(()=>(this.uploadLogUploadingList=[],!1)),(t=>{const n={status:-1,message:t.message,errorRange:e.map((e=>e.log_item_id))};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),WR.reportLogUploadError(n),!0}),{timeout:kR("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:kR("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,kR("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),kR("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),kR("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),kR("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var ZR;function $R(e){return aw(e.reportId,"params.reportId",0,100,!1),aw(e.category,"params.category",0,100,!1),aw(e.event,"params.event",0,100,!1),aw(e.label,"params.label",0,100,!1),ow(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(ZR={}).FREE="free",ZR.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const eI={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let tI=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),nI=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({}),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}({});class rI{constructor(){qR(this,"baseInfoMap",new Map),qR(this,"proxyServer",void 0),qR(this,"eventUploadTimer",void 0),qR(this,"setSessionIdTimer",void 0),qR(this,"url",void 0),qR(this,"backupUrl",void 0),qR(this,"_appId",void 0),qR(this,"keyEventUploadPendingItems",[]),qR(this,"normalEventUploadPendingItems",[]),qR(this,"apiInvokeUploadPendingItems",[]),qR(this,"apiInvokeCount",0),qR(this,"ltsList",[]),qR(this,"lastSendNormalEventTime",Date.now()),qR(this,"customReportCounterTimer",void 0),qR(this,"customReportCount",0),qR(this,"extApiInvoke",(async e=>{for(const t of e){const e=GR(GR({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Sw.TRACER});this.sendApiInvoke(e)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),kR("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),kR("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void QR.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,QR.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,o=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null}),s=!!kR("SHOW_REPORT_INVOKER_LOG");s&&QR.info("".concat(t.name," start"),t.options);let a=!1;$w(t.timeout).then((()=>{a||(this.sendApiInvoke(GR(GR({},o()),{},{error:tw.API_INVOKE_TIMEOUT,success:!1})),QR.debug("".concat(t.name," timeout")))}));const c=new nw(tw.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(a)throw c;return a=!0,this.sendApiInvoke(GR(GR({},o()),{},{success:!0},t.reportResult&&{result:e})),s&&QR.info("".concat(t.name," onSuccess")),e};return n?iR(r,t.name+"Success",n,(()=>a=!0)):r()},onError:e=>{const r=()=>{if(a)throw e;a=!0,this.sendApiInvoke(GR(GR({},o()),{},{success:!1,error:e})),s&&QR.info("".concat(t.name," onFailure"),e.toString())};return n?iR(r,t.name+"Error",n,(()=>a=!0)):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:kR("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:RR?"global":"oversea",areas:kR("AREAS")&&kR("AREAS").join(",")},t.extend),{stringUid:o,channelProfile:s,channelMode:a,isABTestSuccess:c,lsid:u,clientRole:l}=t,d=Date.now(),h=GR(GR({},r),{},{eventType:tI.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:AR,lts:d,elapse:d-n,extend:JSON.stringify(i),mode:t.mode,process:kR("PROCESS_ID"),appType:kR("APP_TYPE"),success:!0,version:wR,stringUid:o,channelProfile:s,channelMode:a,isABTestSuccess:c,lsid:u,clientType:20,clientRole:l,serviceId:kR("PROCESS_ID"),extensionID:kR("PLUGIN_INFO").join(",")||"",preload:t.preload?1:0});this.send({type:nI.SESSION,data:h},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR({},r),{},{eventType:tI.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:nI.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR({},r),{},{eventType:tI.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:nI.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:o,avoidJoinStartTime:s,isProxy:a,addr:c}=t,u=i-(o&&s?s:n.startTime),l=GR(GR({},r),{},{eventType:tI.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:u,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel}),d=l.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),o)this.send({type:nI.JOIN_GATEWAY,data:l},!0);else{let e;if(c)if(a){const t=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=c.match(/p=[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:a?1:0}}else{const t=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=c.match(/(:|p=)[0-9]{1,6}/g);e={isSuccess:d,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:a?1:0}}else e={isSuccess:d,gatewayIp:"",port:"",isProxy:a?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);const t=Object.assign({},l,e,{eventType:tI.REJOIN_GATEWAY});this.send({type:nI.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=GR(GR({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:nI.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR({},r),{},{eventType:tI.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:nI.PUBLISH,data:o},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,o=Date.now(),s=GR(GR({},i),{},{eventType:tI.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?s.peerSuid=t.peerid:s.peer=t.peerid,this.send({type:nI.SUBSCRIBE,data:s},!0)}wsCompressorInit(e){var t;const n=[...lf(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const o=i.info,s=Date.now(),a=GR(GR({},o),{},{eventType:tI.WS_COMPRESSOR_INIT,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,status:e.status?1:2});this.send({type:nI.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=GR(GR(GR({},o),r),{},{elapse:s-i.startTime,eventType:t,lts:s,firstDecodeFrame:Math.max(s-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:a},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=GR(GR(GR({},o),r),{},{elapse:s-i.startTime,eventType:t,lts:s});this.send({type:n,data:a},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR(GR({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:tI.PC_STATS,lts:i});this.send({type:nI.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR(GR({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),eventType:tI.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:nI.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=GR(GR(GR({},o),r),{},{eventType:t,lts:s});this.send({type:n,data:a},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR({},r),{},{eventType:tI.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:nI.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR({},r),{},{eventType:tI.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:nI.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR({},r),{},{eventType:tI.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:nI.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?QR.debug("reportProxyServerurl: ".concat(e)):QR.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:nI.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=Xw(JSON.stringify(e));let o=0;const s=[];let a=0;for(let c=0;c<r.length;c++)a+=r.charCodeAt(c)<=127?1:3,a<=n-i||(s[s.length]=$S($S({},e),{},{[t]:r.substring(o,c)}),o=c,a=r.charCodeAt(c)<=127?1:3);return o!==r.length-1&&(s[s.length]=$S($S({},e),{},{[t]:r.substring(o)})),s})(GR(GR(GR({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach((e=>this.send({type:nI.WORKER_EVENT,data:e},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR(GR({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:nI.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR(GR({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:nI.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=GR(GR(GR({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:nI.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>kR("CUSTOM_REPORT_LIMIT"))throw new nw(tw.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),r=t.map((t=>({type:nI.USER_ANALYTICS,data:GR(GR({sid:e},t),{},{lts:n})})));try{kR("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(e){throw QR.error("send custom report message failed",e.toString()),new nw(tw.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=kR("NOT_REPORT_EVENT");if(e.tag&&Dr(t)&&Dr(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:o}=n.info;let s;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof nw){const{code:t,message:n}=e.error;s=t||n||e.error.toString()}else s=e.error.toString();const a={invokeId:e.invokeId,sid:e.sid,cname:r,cid:o,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?s:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:nI.API_INVOKE,data:a},!1),!0}appendSessionId(){rI.__CLIENT_LIST__.forEach((e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const t=this.apiInvokeUploadPendingItems.shift();t&&(t.sid=e._sessionId,this.sendApiInvoke(Object.assign({},t)))}}}))}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>kR("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(const o of[...n]){var i;-1!==this.ltsList.indexOf(o.data.lts)?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),sm(i=this.ltsList).call(i,((e,t)=>e-t)))}return t||(this.lastSendNormalEventTime=Date.now()),kR("ENABLE_EVENT_REPORT")?(n.length&&(kR("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{kR("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>kR("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-kR("NORMAL_EVENT_QUEUE_CAPACITY")),QR.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){Fw.networkState===Dw.OFFLINE&&await Gh.race([Fw.onlineWaiter,$w(2*fR.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach((e=>{const n=gw(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(nI).forEach((n=>{let[r,i]=n;i===e.type&&(t=EventNameToID[r])})),t})(e),o=new DataView(r);o.setUint16(0,n.byteLength,!0),o.setUint8(2,255&i),o.setUint8(3,i>>>8&255),o.setUint8(4,i>>>16&255),t=_w(t,new Uint8Array(r)),t=_w(t,n)})),t},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(kR("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(kR("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(kR("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(kR("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await bR(r,{timeout:1e4,data:t(e),headers:GR(GR({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((e=>JSON.stringify(e))),vid:(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0])};Fw.networkState===Dw.OFFLINE&&await Gh.race([Fw.onlineWaiter,$w(2*fR.maxRetryTimeout)]);const r=t?"/events/proto-raws":"/events/messages";let i=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(kR("EVENT_REPORT_DOMAIN"),"&p=").concat(kR("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(kR("EVENT_REPORT_DOMAIN"),":").concat(kR("STATS_COLLECTOR_PORT")).concat(r));for(let o=0;o<2;o+=1){1===o&&(i=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(kR("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(kR("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(kR("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(kR("STATS_COLLECTOR_PORT")).concat(r)));try{t?await TR(i,{timeout:1e4,data:n}):await bR(i,{timeout:1e4,data:n})}catch(t){if(1===o)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},eI);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Sw.TRACER}).onSuccess()}}function iI(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){const i=r.value;if("function"==typeof i){const o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];let a=r;if(e.argsMap)try{a=e.argsMap(this,...r)}catch(e){QR.warning(e),a=[]}try{JSON.stringify(a)}catch(e){QR.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),a=[]}const c=(e.report||oI).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(n)),options:a,tag:Sw.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,r);return t instanceof Gh?t.then((t=>(c.onSuccess(e.reportResult&&t),t))).catch((e=>{throw c.onError(e),e})):(c.onSuccess(e.reportResult&&t),t)}catch(e){throw c.onError(e),e}}}return r}}qR(rI,"__CLIENT_LIST__",[]);const oI=new rI;WR.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=Fw.networkState,oI.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Sw.TRACER}).onSuccess("logUploadError")}));const sI=["CHINA","GLOBAL"],aI=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let a=0;a<6;a++)i.push("1");const o=i.join(""),s={};return s[e]=r,s[t]=o,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=aI,RR||(OR.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],OR.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],OR.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],OR.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],OR.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],OR.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],OR.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",OR.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",OR.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",OR.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",OR.AREAS=["NORTH_AMERICA","OVERSEA"]);const cI=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],uI=[];function lI(e,t){return!!t&&uI.some((n=>n.uid===e&&n.channelName===t))}rI.__CLIENT_LIST__=uI;var dI=b_.forEach,hI=Br("forEach")?[].forEach:function(e){return dI(this,e,arguments.length>1?arguments[1]:void 0)};Nn({target:"Array",proto:!0,forced:[].forEach!=hI},{forEach:hI});var pI=Zn("Array").forEach,fI=fr,mI=$e,gI=d,_I=pI,EI=Array.prototype,vI={DOMTokenList:!0,NodeList:!0},yI=function(e){var t=e.forEach;return e===EI||gI(EI,e)&&t===EI.forEach||mI(vI,fI(e))?_I:t},bI=r(yI),TI=Xe,SI=to;Nn({target:"Object",stat:!0,forced:i((function(){SI(1)}))},{keys:function(e){return SI(TI(e))}});var wI=r(re.Object.keys),RI=r(Jr),II=Nn,CI=Sg,AI=l([].reverse),OI=[1,2];II({target:"Array",proto:!0,forced:String(OI)===String(OI.reverse())},{reverse:function(){return CI(this)&&(this.length=this.length),AI(this)}});var NI=Zn("Array").reverse,kI=d,DI=NI,PI=Array.prototype,LI=function(e){var t=e.reverse;return e===PI||kI(PI,e)&&t===PI.reverse?DI:t},MI=LI,xI=r(MI),UI=Nn,FI=Sg,jI=Bc,VI=ne,BI=jn,GI=Wn,qI=$,WI=gf,HI=pt,KI=Xc,zI=Mg("slice"),YI=HI("species"),JI=Array,XI=Math.max;UI({target:"Array",proto:!0,forced:!zI},{slice:function(e,t){var n,r,i,o=qI(this),s=GI(o),a=BI(e,s),c=BI(void 0===t?s:t,s);if(FI(o)&&(n=o.constructor,(jI(n)&&(n===JI||FI(n.prototype))||VI(n)&&null===(n=n[YI]))&&(n=void 0),n===JI||void 0===n))return KI(o,a,c);for(r=new(void 0===n?JI:n)(XI(c-a,0)),i=0;a<c;a++,i++)a in o&&WI(r,i,o[a]);return r.length=i,r}});var QI=Zn("Array").slice,ZI=d,$I=QI,eC=Array.prototype,tC=function(e){var t=e.slice;return e===eC||ZI(eC,e)&&t===eC.slice?$I:t},nC=r(tC);function rC(e,t,n,r,i){var o,s,a,c={};return bI(o=wI(r)).call(o,(function(e){c[e]=r[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=RI(s=xI(a=nC(n).call(n)).call(a)).call(s,(function(n,r){return r(e,t,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer&&(bg(e,t,c),c=null),c}var iC=Zn("Array").values,oC=fr,sC=$e,aC=d,cC=iC,uC=Array.prototype,lC={DOMTokenList:!0,NodeList:!0},dC=function(e){var t=e.values;return e===uC||aC(uC,e)&&t===uC.values||sC(lC,oC(e))?cC:t},hC=r(dC);let pC=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),fC=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),mC=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),gC=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),_C=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),EC=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),vC=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),yC=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),bC=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),TC=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),SC=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),wC=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),RC=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),IC=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});class CC extends nw{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),ry(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(e,QR)}throw(){super.throw(QR)}}function AC(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw QR.error("Invalid Channel Name ".concat(e)),new CC(tw.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function OC(e){if(!function(e){return"number"==typeof e&&Math.floor(e)===e&&0<=e&&e<=4294967295}(e)&&!lw(e,1,255))throw new CC(tw.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");"string"==typeof e&&QR.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let NC=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming",e}({}),kC=function(e){return e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN",e}({});const DC={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},PC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function LC(e,t){aw(e.url,"".concat(t,".url"),1,1e3,!1),uw(e.x)||ow(e.x,"".concat(t,".x"),0,1e4),uw(e.y)||ow(e.y,"".concat(t,".y"),0,1e4),uw(e.width)||ow(e.width,"".concat(t,".width"),0,1e4),uw(e.height)||ow(e.height,"".concat(t,".height"),0,1e4),uw(e.zOrder)||ow(e.zOrder,"".concat(t,".zOrder"),0,255),uw(e.alpha)||ow(e.alpha,"".concat(t,".alpha"),0,1,!1)}const MC={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},xC={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let UC=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),FC=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),jC=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function VC(e){if(!e.channelName)throw new CC(tw.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new CC(tw.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&aw(e.token,"info.token",1,2047),OC(e.uid),AC(e.channelName),!0}let BC=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),GC=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),qC=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),WC=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),HC=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),KC=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal",e}({}),zC=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),YC=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),JC=function(e){return e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel",e}({}),XC=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const QC=[XC.AFRICA,XC.ASIA,XC.CHINA,XC.EUROPE,XC.GLOBAL,XC.INDIA,XC.JAPAN,XC.NORTH_AMERICA,XC.OCEANIA,XC.OVERSEA,XC.SOUTH_AMERICA];let ZC=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const $C={CHINA:{},ASIA:{CODE:ZC.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ZC.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ZC.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ZC.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ZC.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ZC.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ZC.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ZC.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ZC.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ZC.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ZC.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ZC.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ZC.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};RR&&($C.CHINA={CODE:ZC.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let eA=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class tA extends vw{constructor(e,t){super(),ry(this,"onICEConnectionStateChange",void 0),ry(this,"onConnectionStateChange",void 0),ry(this,"onDTLSTransportStateChange",void 0),ry(this,"onDTLSTransportError",void 0),ry(this,"onICETransportStateChange",void 0),ry(this,"onFirstAudioReceived",void 0),ry(this,"onFirstVideoReceived",void 0),ry(this,"onFirstAudioDecoded",void 0),ry(this,"onFirstVideoDecoded",void 0),ry(this,"onFirstVideoDecodedTimeout",void 0),ry(this,"onSelectedLocalCandidateChanged",void 0),ry(this,"onSelectedRemoteCandidateChanged",void 0),ry(this,"getLocalVideoStats",void 0)}}class nA extends tA{constructor(e,t){super(e,t),ry(this,"establishPromise",void 0)}}let rA=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),iA=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),oA=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),sA=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),aA=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),cA=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),uA=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),lA=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),dA=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),hA=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),pA=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e}({}),fA=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),mA=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),gA=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),_A=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),EA=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),vA=function(e){return e.ABORT="abort",e}({}),yA=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),bA=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const TA={[mC.ACCESS_POINT]:{[EC.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[EC.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[EC.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[EC.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[EC.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[EC.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[EC.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[mC.UNILBS]:{[_C.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[_C.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[_C.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[_C.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[_C.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[_C.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[_C.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[_C.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[_C.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[_C.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[_C.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[_C.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[mC.STRING_UID_ALLOCATOR]:{[gC.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[gC.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[gC.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function SA(e){const t=TA[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===mC.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const wA={[vC.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[vC.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[vC.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[vC.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[vC.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[vC.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[vC.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[vC.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[vC.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[vC.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[vC.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[vC.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[vC.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[vC.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[vC.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[vC.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[vC.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[vC.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[vC.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[vC.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[vC.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[vC.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[vC.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[vC.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[vC.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[vC.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[vC.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[vC.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[vC.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[vC.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[vC.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[vC.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[vC.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[vC.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[vC.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[vC.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[vC.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[vC.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[vC.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[vC.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[vC.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[vC.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[vC.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[vC.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[vC.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[vC.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[vC.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[vC.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[vC.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[vC.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[vC.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[vC.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[vC.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[vC.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[vC.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[vC.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[vC.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[vC.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[vC.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[vC.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[vC.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[vC.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[vC.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function RA(e){return wA[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function IA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function CA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?IA(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function AA(e){return e.every((e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))}function OA(e,t){if("string"==typeof e)return e;const{proxy:n,host:r,port:i}=e;if(t){const e=kR("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const NA=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,kA=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,DA=/wss:\/\/(.+):([0-9]+)\/?/,PA=/wss:\/\/(.[^\/]+)\/?/;let LA=0;class MA{constructor(e,t){ry(this,"id",0),ry(this,"store",void 0),ry(this,"recordIndex",void 0),ry(this,"websockets",[]),ry(this,"try443PortDuration",2e3),ry(this,"forceCloseWSDuration",5e3),ry(this,"try443PortTimeout",null),ry(this,"forceCloseTimeout",null),ry(this,"isTry443PortFailed",!1),ry(this,"isNormalPortFailed",!1),ry(this,"useDoubleDomain",!1),ry(this,"useProxy",!1),ry(this,"startTime",Date.now()),this.id=++LA,this.try443PortDuration=kR("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach((e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;const t=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];QR.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});const r=kR("GATEWAY_DOMAINS"),i=Date.now(),o=[],s=r.find((t=>{var n;return Dr(n=e.host).call(n,t)}));s||(this.useDoubleDomain=!1);const a=[];if(this.useDoubleDomain)r.forEach((n=>{a.push(OA(CA(CA({},e),{},{host:e.host.replace(s,n)}),t))}));else{const n=CA({},e);if(t&&s){const e=r.find((e=>e!==s));e&&(n.host=n.host.replace(s,e))}a.push(OA(n,t))}try{a.forEach((e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",o.push(t),this.logger("ws is connecting:",t.url)}))}catch(r){if(this.logger("ws create failed"),o.forEach((e=>e.close())),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new CC(tw.WS_ERR,"init websocket failed! Error: ".concat(r.toString()))}const c=mS();return this.store&&this.store.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},this.recordIndex),o.forEach((e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach((t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))})),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState)),t?this.isTry443PortFailed=AA(o):this.isNormalPortFailed=AA(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:zC.A_ROUND_WS_FAILED}))},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))})),this.websockets.push(...o),n||(()=>{const n=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.websockets.forEach((e=>e.readyState!==WebSocket.OPEN&&e.close()))};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{if(this.logger("2s timeout, isWebsocket created: ",c.isResolved),c.isResolved)return n();wS().os===vS.MAC_OS&&DS()&&n(),this.createWebSocket(e,!0,!0).then((e=>c.resolve(e))).catch((e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration)}),this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,r){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,r;return[,t,n,r]=e.match(NA)||[],t||([,n,r]=e.match(kA)||[]),n&&r||([,n,r]=e.match(DA)||[]),n&&r||([,n]=e.match(PA)||[]),n||QR.warning("un-destructible url: ",e),{proxy:t,host:n,port:r||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(QR.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally((()=>this.clearTimeout()))}}function xA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class UA extends vw{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Dr(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(IC.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(IC.CONNECTED):"closed"===this._state?this.emit(IC.CLOSED):"failed"===this._state&&this.emit(IC.FAILED))}resetReconnectCount(e){QR.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),ry(this,"connectionID",0),ry(this,"currentURLIndex",0),ry(this,"urls",[]),ry(this,"_reconnectMode","tryNext"),ry(this,"reconnectReason",void 0),ry(this,"_initMutex",new hR("websocket")),ry(this,"name",void 0),ry(this,"_state","closed"),ry(this,"reconnectInterrupter",void 0),ry(this,"websocket",void 0),ry(this,"retryConfig",void 0),ry(this,"reconnectCount",0),ry(this,"forceCloseTimeout",5e3),ry(this,"onlineReconnectListener",void 0),ry(this,"useCompress",void 0),ry(this,"tryDoubleDomain",!1),ry(this,"use443PortOnly",!1),ry(this,"wsInflateLength",0),ry(this,"wsDeflateLength",0),ry(this,"closeEstablishingWs",(()=>{})),ry(this,"store",void 0),ry(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xA(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=i;const{timeout:s,timeoutFactor:a}=t,c=Math.max(300,Math.floor(3*s/5)),u=Math.max(1.2,Math.floor(8*a)/10);Dw.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=u),Fw.on(Pw.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===Dw.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=u):(this.retryConfig.timeout=s,this.retryConfig.timeoutFactor=a))}))}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{const e=mS(),t=this.urls[this.currentURLIndex];this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(IC.CLOSED,(()=>{e.reject(new nw(tw.WS_DISCONNECT))})),this.once(IC.CONNECTED,e.resolve),await e.promise}catch(e){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout((()=>e.close()),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void QR.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),QR.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new nw(tw.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new nw(tw.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const n=mS();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),QR.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(QR.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new nw(tw.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=xw(this,IC.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void QR.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return n.reject(new nw(tw.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},o=e=>{this.emit(IC.ON_MESSAGE,e)},s=e=>{QR.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),kR("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=kR("GATEWAY_WSS_ADDRESS")),QR.debug("[".concat(this.name,"] start connect, url:"),e);const a=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,r&&r(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=o,this.websocket.onerror=s,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this.joinGatewayRecordIndex=a}catch(e){const t="closed"===this.state,r=e instanceof nw,o=r&&e.code===tw.WS_ABORT,s=r&&e.code===tw.WS_ERR,c=r?e.message:e&&(e.reason||e.toString());QR.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:o?"aborted":"error",errors:[e]},a),t||s?(n.reject(t?new nw(tw.WS_DISCONNECT,"websocket is closed: ".concat(c)):new nw(tw.WS_ERR,"init websocket failed: ".concat(c))),s&&QR.error("[".concat(this.name,"] init websocket failed: ").concat(c))):i&&i(e)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;QR.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Fw.isOnline||!Fw.onlineWaiter||(this.onlineReconnectListener=Fw.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){const t=mR(this.reconnectCount,this.retryConfig);QR.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await Gh.race([$w(t),this.onlineReconnectListener||new Gh((()=>{}))])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const r=async(e,t)=>{this.emit(IC.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)this.emit(IC.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);QR.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(IC.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e)}else"recover"===e&&(QR.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(IC.RECONNECT_WAITTING_FINISH,e),this.urls=await Lw(this,IC.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(n){var i;QR.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const r=null==n||null===(i=n.data)||void 0===i?void 0:i.desc;return Array.isArray(r)&&Dr(r).call(r,"dynamic key expired")?(this.emit(IC.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class FA extends UA{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const n=mS(),r=function(e,t){return new MA(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{QR.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new nw(tw.WS_ABORT,"choose best websocket aborted"))};const i=kR("GATEWAY_DOMAINS");return QR.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class jA extends UA{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new Gh(((n,r)=>{let i=!1;const o=[];this.closeEstablishingWs=()=>{QR.debug("[choose-best-ws] close establishing websockets"),o.forEach((e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),r(new nw(tw.WS_ABORT,"choose best websocket aborted"))};const s=kR("GATEWAY_DOMAINS");let a;const c=e.indexOf("?h="),u=s.find((t=>-1!==c?Dr(e).call(e,t,c):Dr(e).call(e,t)));QR.debug("[choose-best-ws] currentDomain: ",u,", domains: ",s);let l=!this.tryDoubleDomain||!u;if(!l&&u){var d;const h=Date.now();try{s.forEach((t=>{const n=-1===c?e.replace(u,t):e.substr(0,c)+e.substr(c).replace(u,t),r=new WebSocket(n);r.binaryType="arraybuffer",o.push(r),QR.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(e){for(QR.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach((e=>e.close()));o.length;)o.pop();l=!0}null===(d=this.store)||void 0===d||d.recordJoinChannelService({urls:o.map((e=>e.url)),service:"gateway"},t),o.forEach((e=>{e.onopen=()=>{if(i)return;const t=Date.now()-h;QR.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),o.filter((t=>t!==e)).forEach((e=>{QR.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),i=!0,n(e)},e.onclose=e=>{a=e,i||o.find((e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)))||(QR.debug("[choose-best-ws] all websocket is closed"),i=!0,r(a))},e.onmessage=t=>{QR.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}})),$w(this.forceCloseTimeout).then((()=>{o.forEach((e=>{e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(l){var h;let i;QR.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),o.push(i),i.binaryType="arraybuffer"}catch(e){const n=new nw(tw.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return QR.error("[".concat(this.name,"]").concat(n)),void r(n)}i.onopen=()=>{n(i)},i.onclose=e=>{r(e)},i.onmessage=e=>{QR.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},$w(this.forceCloseTimeout).then((()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()}))}})).then((e=>(this.closeEstablishingWs=void 0,e))).catch((e=>{throw this.closeEstablishingWs=void 0,e}))}}class VA extends vw{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===yC.CONNECTED?this.emit(bC.WS_CONNECTED):e===yC.RECONNECTING?this.emit(bC.WS_RECONNECTING,this._websocketReconnectReason):e===yC.CLOSED&&this.emit(bC.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),ry(this,"_disconnectedReason",void 0),ry(this,"_websocketReconnectReason",void 0),ry(this,"_connectionState",yC.CLOSED),ry(this,"reconnectToken",void 0),ry(this,"websocket",void 0),ry(this,"openConnectionTime",void 0),ry(this,"clientId",void 0),ry(this,"lastMsgTime",Date.now()),ry(this,"uploadCache",[]),ry(this,"uploadCacheInterval",void 0),ry(this,"rttRolling",new _R(5)),ry(this,"pingpongTimer",void 0),ry(this,"wsInflateDataTimer",void 0),ry(this,"pingpongTimeoutCount",0),ry(this,"joinResponse",void 0),ry(this,"multiIpOption",void 0),ry(this,"initError",void 0),ry(this,"spec",void 0),ry(this,"store",void 0),ry(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(bC.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===wC.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===wC.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(Iw.UID_BANNED);break;case 15:this.close(Iw.IP_BANNED);break;case 16:this.close(Iw.CHANNEL_BANNED)}if(t._type===wC.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case vC.ERR_LICENSE_MISSING:this.close(Iw.LICENSE_MISSING);break;case vC.ERR_LICENSE_EXPIRED:this.close(Iw.LICENSE_EXPIRED);break;case vC.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Iw.LICENSE_MINUTES_EXCEEDED);break;case vC.ERR_LICENSE_PERIOD_INVALID:this.close(Iw.LICENSE_PERIOD_INVALID);break;case vC.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Iw.LICENSE_MULTIPLE_SDK_SERVICE);break;case vC.ERR_LICENSE_ILLEGAL:this.close(Iw.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new FA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,kR("JOIN_GATEWAY_USE_DUAL_DOMAIN"),kR("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===yC.CONNECTED&&this.reconnect("retry",kw.OFFLINE)}))}async request(e,t,n,r){const i=eR(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new Gh(((t,n)=>{if(this.connectionState===yC.CONNECTED)return t();const r=()=>{this.off(bC.WS_CLOSED,i),t()},i=()=>{this.off(bC.WS_CONNECTED,r),n(new CC(tw.WS_ABORT))};this.once(bC.WS_CONNECTED,r),this.once(bC.WS_CLOSED,i),e!==TC.PUBLISH&&e!==TC.PUBLISH_DATASTREAM&&e!==TC.SUBSCRIBE&&e!==TC.SUBSCRIBE_DATASTREAM&&e!==TC.UNSUBSCRIBE&&e!==TC.UNSUBSCRIBE_DATASTREAM&&e!==TC.UNPUBLISH&&e!==TC.UNPUBLISH_DATASTREAM&&e!==TC.CONTROL&&e!==TC.RESTART_ICE||this.once(bC.DISCONNECT_P2P,(()=>{n(new CC(tw.DISCONNECT_P2P))})),e!==TC.PUBLISH&&e!==TC.RESTART_ICE||this.once(bC.ABORT_P2P_EXECUTION,(()=>{n(new CC(tw.DISCONNECT_P2P))}))}));if(this.connectionState!==yC.CONNECTING&&this.connectionState!==yC.RECONNECTING||e===TC.JOIN||e===TC.REJOIN||await a(),this.websocket.sendMessage(o,!0),r)return;const c=new Gh(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(bC.WS_CLOSED,c),this.off(bC.WS_RECONNECTING,c),this.emit(bC.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new CC(tw.WS_ABORT,"type: ".concat(e))),this.off(bC.WS_CLOSED,c),this.off(bC.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(bC.WS_CLOSED,c),this.once(bC.WS_RECONNECTING,c),$w(kR("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(QR.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(bC.REQUEST_TIMEOUT,e,t))}))}));let u=null;try{u=await c}catch(r){if(this.connectionState===yC.CLOSED||e===TC.LEAVE)throw new CC(tw.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===TC.JOIN||e===TC.REJOIN?null:(await a(),await this.request(e,t))}if(u.isSuccess)return u.message;const l=Number(u.message.error_code||u.message.code),d=RA(l),h=new CC(tw.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(u.message.error_str),{code:l,data:u.message});return"success"===d.action?u.message:(QR.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===vC.ERR_TOO_MANY_BROADCASTERS?e===TC.JOIN||e===TC.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(l===vC.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,QR.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",kw.MULTI_IP)):this.reconnect(d.action,kw.SERVER_ERROR),e===TC.JOIN||e===TC.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Gh((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void QR.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(SC.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=kR("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==yC.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),kR("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Gh(((t,n)=>{this.once(bC.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(bC.WS_CLOSED,(()=>n(this.initError||new CC(tw.WS_ABORT)))),this.connectionState=yC.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Iw.LEAVE,this.connectionState=yC.CLOSED,QR.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===Iw.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new FA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,kR("JOIN_GATEWAY_USE_DUAL_DOMAIN"),kR("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(bC.ABORT_P2P_EXECUTION);const e=await Lw(this,bC.REQUEST_JOIN_INFO),t=await this.request(TC.JOIN,e);if(!t)return this.emit(bC.REPORT_JOIN_GATEWAY,zC.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(bC.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yC.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new CC(tw.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Uw(this,bC.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(TC.REJOIN,e);return!!t&&(this.connectionState=yC.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(wC.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(wC.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(wC.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(wC.MUTE_AUDIO,{uid:e.uid}):this.emit(wC.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(wC.MUTE_VIDEO,{uid:e.uid}):this.emit(wC.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(wC.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(wC.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(wC.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(wC.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(wC.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){QR.debug("[".concat(this.clientId,"] receive notification: "),e);const t=RA(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(Iw.UID_BANNED),void this.close()):void this.reconnect(t.action,kw.SERVER_ERROR);QR.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=kR("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(QR.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>kR("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",kw.TIMEOUT):this.request(TC.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),kR("REPORT_STATS")&&this.send(TC.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(SC.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(IC.RECONNECT_WAITTING_FINISH,(e=>{this.emit(bC.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(IC.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(bC.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(IC.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(IC.CLOSED,(()=>{this.connectionState=yC.CLOSED})),this.websocket.on(IC.FAILED,(()=>{this._disconnectedReason=Iw.NETWORK_ERROR,this.connectionState=yC.CLOSED})),this.websocket.on(IC.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===yC.CONNECTED?this.connectionState=yC.RECONNECTING:this.connectionState=yC.CONNECTING})),this.websocket.on(IC.WILL_RECONNECT,((e,t,n)=>{const r=Uw(this,bC.IS_P2P_DISCONNECTED),i=r||"retry"!==e;r&&"retry"===e&&(QR.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=zC.P2P_DISCONNECTED),i&&(QR.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(bC.REPORT_JOIN_GATEWAY,t||zC.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(bC.NEED_RENEW_SESSION,this.websocket.currentURLIndex>=this.websocket.urls.length-1?"recover":e),this.emit(bC.DISCONNECT_P2P)),n(e)})),this.websocket.on(IC.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{QR.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",kw.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(bC.REPORT_JOIN_GATEWAY,e.message||e.code||zC.UNKNOWN_REASON,this.url||""),e instanceof CC){if(e.code===tw.UNEXPECTED_RESPONSE&&e.data.code===vC.ERR_NO_AUTHORIZED)return this.initError=new CC(tw.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),QR.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",kw.SERVER_ERROR);QR.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",kw.SERVER_ERROR):(this.initError=e,this.close())}}))})),this.websocket.on(IC.REQUEST_NEW_URLS,((e,t)=>{Lw(this,bC.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(IC.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(wC.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}let BA=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function GA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?GA(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GA(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function WA(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(kR("TURN_DOMAIN")):(QR.info("Unidentified as ip: ".concat(e,", use as host")),e)}function HA(e,t){e.addresses||(e.addresses=[]);const n=function(e,t){if(kR("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map((e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}}));const n=kR("GATEWAY_DOMAINS");let r=n[1]&&Dr(t).call(t,n[1])?1:0;return e.map((e=>{let{domain_prefix:t,port:i,ip:o}=e;if(t)return{address:"".concat(t,".").concat(n[r++%n.length],":").concat(i)};const s=/^[\.\:\d]+$/.test(o),a=s?"".concat(o.replace(/[^\d]/g,"-"),".").concat(n[r++%n.length],":").concat(i):"".concat(o,":").concat(i);return s||QR.info("Unidentified as ip: ".concat(o,", use as host")),{ip:o,port:i,address:a}}))}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&"string"==typeof r){const e=r.split(";");for(let t=0;t<e.length;t++){var i;const r=Bp(i=e[t]).call(i);n[t]&&r&&(n[t].ip6=r)}}return{gatewayAddrs:n,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function KA(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function zA(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(KA(t.width),"x").concat(KA(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function YA(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function JA(e,t){let n,r,i;switch(t){case BA.CHOOSE_SERVER:r=4096,i="choose server";break;case BA.CLOUD_PROXY:r=1048576,i="proxy";break;case BA.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case BA.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new CC(tw.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((t=>{t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((e=>qA(qA({},e),{},{ticket:t.buffer.cert}))),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:qA(qA({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!n)throw new CC(tw.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function XA(e,t){return await Gh.all(e.addresses.map((async e=>({address:WA(e.ip),tcpport:e.port,udpport:e.port,username:t&&kR("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():aI.username,password:t&&kR("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Ew(t.toString()):aI.password}))))}function QA(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(KA(e.height),KA(e.width)),1):(QR.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ZA(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:o,protocol:s}=e;return"local-candidate"===r?{candidateType:t,relayProtocol:n,protocol:s}:{candidateType:t,relayProtocol:n,address:i,port:o,protocol:s}}function $A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class eO extends vw{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Dr(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(pA.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(pA.CONNECTED):"closed"===this._state?this.emit(pA.CLOSED):"failed"===this._state&&this.emit(pA.FAILED))}constructor(e,t,n,r){super(),ry(this,"connectionID",0),ry(this,"currentURLIndex",0),ry(this,"reconnectReason",void 0),ry(this,"_reconnectMode","tryNext"),ry(this,"_initMutex",void 0),ry(this,"_name",void 0),ry(this,"_state","closed"),ry(this,"_reconnectInterrupter",void 0),ry(this,"_url",void 0),ry(this,"_retryConfig",void 0),ry(this,"_reconnectCount",0),ry(this,"_forceCloseTimeout",5e3),ry(this,"_onlineReconnectListener",void 0),ry(this,"_closeEstablishingTransmitter",(()=>{})),ry(this,"_store",void 0),ry(this,"_joinChannelServiceRecordIndex",void 0),ry(this,"_transmitter",void 0),ry(this,"_useCompress",void 0),ry(this,"_inflateLength",0),ry(this,"_deflateLength",0),this._store=r,this._name=e,this._retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$A(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this._useCompress=n}resetReconnectCount(e){QR.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const e=this._transmitter;t?setTimeout((()=>e.close()),500):e.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(e,t){if(!this._transmitter)return void QR.warning("[".concat(this._name,"] can not reconnect, no websocket"));var n;void 0!==e&&(this.reconnectMode=e),QR.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(n=this._store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this._joinChannelServiceRecordIndex));const r=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),r&&r.bind(this._transmitter)({code:9999,reason:t})}getInflateData(){const e=this._inflateLength,t=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:t}}setInflateData(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let tO=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class nO{constructor(e,t,n){ry(this,"version",1),ry(this,"initialRTO",void 0),ry(this,"maxBatchAckCount",void 0),ry(this,"maxRTO",void 0),ry(this,"initialRTT",void 0),ry(this,"ID",void 0),ry(this,"rtt",void 0),ry(this,"packetNumber",1),ry(this,"rtoRatioMap",new Map),ry(this,"timeoutMap",new Map),ry(this,"unorderedPacketQueue",[]),ry(this,"batchAckPacketQueue",[]),ry(this,"lastOrderedPacketNumber",0),ry(this,"batchAckTimer",void 0),ry(this,"sendImpl",void 0),ry(this,"receiveImpl",void 0),this.sendImpl=e,this.receiveImpl=t,this.ID=eR(7,"transmitter-"),this.initialRTO=void 0!==(null==n?void 0:n.initialRTO)?n.initialRTO:kR("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:kR("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:kR("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null==n?void 0:n.maxBatchAckCount)?n.maxBatchAckCount:kR("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null==n?void 0:n.maxRTO)?n.maxRTO:kR("TRANSMITTER_MAX_RTO")}packetize(e,t){return{type:tO.Default,version:this.version,packetNumber:t,payload:e}}serialize(e){switch(e.type){case tO.Default:{let t;t="string"==typeof e.payload?(new TextEncoder).encode(e.payload):e.payload;const n=new ArrayBuffer(t.length+15),r=new DataView(n);return r.setUint16(0,e.version),r.setUint8(2,e.type),r.setUint32(3,e.packetNumber),hw(r,7,BigInt(e.sendTs)),new Uint8Array(r.buffer).set(t,15),n}case tO.Ack:{const t=new ArrayBuffer(16),n=new DataView(t);return n.setUint16(0,e.version),n.setUint8(2,e.type),n.setUint32(3,e.maxAckPacketNumber),n.setUint8(7,e.shift),hw(n,8,BigInt(e.ackSendTs)),t}}}deserialize(e){const t=new DataView(e),n=t.getUint16(0),r=t.getUint8(2);switch(r){case tO.Default:{const i=t.getUint32(3),o=dw(t,7),s=e.slice(15),a=(new TextDecoder).decode(s);return{version:n,type:r,packetNumber:i,sendTs:Number(o),payload:a}}case tO.Ack:{const e=t.getUint32(3),i=t.getUint8(7),o=dw(t,8);return{version:n,type:r,maxAckPacketNumber:e,shift:i,ackSendTs:Number(o)}}default:throw QR.error("[".concat(this.ID,"] Unrecognized packet type ").concat(r)),new Error("Unrecognized packet type ".concat(r))}}sendMessage(e){const t=this.packetize(e,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const n=this.calculateRTO(t),r=window.setTimeout((()=>{this.resendMessage(t)}),n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}onData(e){const t=this.deserialize(e);t.type===tO.Default?this.ack(t):t.type===tO.Ack&&(this.updateRTT(t,Math.round(performance.now())),this.clearRTO(t))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach((e=>{let[t,n]=e;window.clearTimeout(n)})),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(e){const t=this.calculateRTO(e),n=window.setTimeout((()=>{this.resendMessage(e)}),t);this.timeoutMap.set(e.packetNumber,n),this.sendPacket(e)}calculateRTO(e){const t=this.rtoRatioMap.get(e.packetNumber);if(void 0===t)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;{const n=9*this.rtt/8*t;return this.rtoRatioMap.set(e.packetNumber,t+1),n>this.maxRTO?this.maxRTO:n}}updateRTT(e,t){const n=e.ackSendTs;this.rtt=this.rtt*(7/8)+(t-n-this.rtt)/8}ack(e){if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout((()=>{this.batchAck()}),this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){const e=this.unorderedPacketQueue[0];if(!e){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(e.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:tO.Ack,version:this.version};this.sendPacket(t)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:tO.Ack,version:this.version};this.sendPacket(t)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:tO.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}sendPacket(e){e.type===tO.Default&&(e.sendTs=Math.round(performance.now()));const t=this.serialize(e);this.sendImpl(t)}clearRTO(e){for(let t=e.maxAckPacketNumber-e.shift;t<=e.maxAckPacketNumber;t++){const e=this.timeoutMap.get(t);void 0!==e&&window.clearTimeout(e),this.timeoutMap.delete(t),this.rtoRatioMap.delete(t)}}}class rO extends eO{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),ry(this,"_initMutex",void 0),ry(this,"_reconnectInterrupter",void 0),ry(this,"_url",void 0),ry(this,"_transmitter",void 0),ry(this,"_addresses",void 0),ry(this,"_reliableTransmission",void 0),this._initMutex=new hR("datachannel");const{timeout:n,timeoutFactor:r}=t,i=Math.max(300,Math.floor(3*n/5)),o=Math.max(1.2,Math.floor(8*r)/10);Dw.ONLINE&&(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o),Fw.on(Pw.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===Dw.ONLINE?(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o):(this._retryConfig.timeout=n,this._retryConfig.timeoutFactor=r))}))}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this._forceCloseTimeout=t;const n=(t,n)=>{this._addresses=e,this.currentURLIndex=this._addresses.findIndex((e=>e.fingerprint||kR("FINGERPRINT")));const r=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(r).then(t).catch(n),this.once(pA.CLOSED,(()=>n(new CC(tw.WS_DISCONNECT)))),this.once(pA.CONNECTED,(()=>t()))};return this._initMutex.lock().then((e=>new Gh(((e,t)=>{n(e,t)})).then((()=>{e()})).catch((()=>{e()}))))}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new CC(tw.WS_ABORT,"datachannel is not ready");try{t||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(e){throw new CC(tw.WS_ERR,"send datachannel signal message error"+e.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(e){const t=JSON.stringify(e);return{compressed:t,compressedLength:t.length,origin:e}}sendMessageWithUint8Array(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}createTransmitterConnection(e){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new Gh(((t,n)=>{var r;const i=()=>{QR.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),t()},o=async e=>{var r;if(null===(r=this._closeEstablishingTransmitter)||void 0===r||r.call(this),QR.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const r=xw(this,pA.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,i=await this.reconnectWithAction(r);if("closed"===this.state)return void QR.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!i)return n(new CC(tw.WS_DISCONNECT,"datachannel reconnect failed: ".concat(e.code))),void this.close(!0);t()}else n(new CC(tw.WS_DISCONNECT,"datachannel close: ".concat(e.code))),this.close()},s=e=>{var t;null===(t=this._reliableTransmission)||void 0===t||t.onData(e.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),QR.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(e)));const a=null===(r=this._store)||void 0===r?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),c=Date.now();Lw(this,pA.TO_CONNECT_DATACHANNEL,e).then((e=>{var t,n;if(!e)throw new Error("transmissonInfo not exist yet");const{transmitter:r,close:u}=e;this._transmitter=r,null===(t=this._store)||void 0===t||t.signalChannelOpen();const l=Date.now()-c;QR.debug("[choose dc] dc open cost ".concat(l,"ms")),this._reliableTransmission=new nO((e=>{var t;this._transmitter&&"open"===this._transmitter.readyState&&(null===(t=this._transmitter)||void 0===t||t.send(e))}),(e=>{"string"==typeof e&&this.emit(pA.ON_MESSAGE,e)})),this._closeEstablishingTransmitter=()=>{var e;null===(e=this._reliableTransmission)||void 0===e||e.close(),this._reliableTransmission=void 0,u()},i&&i(),r.onclose=o,r.onmessage=s,null===(n=this._store)||void 0===n||n.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this._joinChannelServiceRecordIndex=a})).catch((e=>{var t;if(null===(t=this._store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:e instanceof CC&&e.code===tw.WS_ABORT?"aborted":"error",errors:[e]},a),"closed"!==this.state){if(e instanceof CC&&e.code===tw.WS_ERR){const t=new CC(tw.WS_ERR,"init datachannel failed! Error: ".concat(e.toString()));return QR.error("[".concat(this._name,"]").concat(t)),void n(t)}o&&o(e)}else n(new CC(tw.WS_DISCONNECT,"datachannel is closed: ".concat(e.toString())))}))}))}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount)return!1;if(!this._addresses)return!1;if("closed"===this.state)return!1;this._onlineReconnectListener||Fw.networkState!==Dw.OFFLINE||(this._onlineReconnectListener=Fw.onlineWaiter&&Fw.onlineWaiter.then((()=>{this._onlineReconnectListener=void 0})));let n=!0;if(this._reconnectInterrupter=()=>{n=!1},t){const t=mR(this._reconnectCount,this._retryConfig);QR.debug("[".concat(this._name,"] wait ").concat(t,"ms to reconnect datachannel, mode: ").concat(e)),await Gh.race([$w(t),this._onlineReconnectListener||new Gh((()=>{}))])}if("closed"===this.state||!n)return!1;this._reconnectCount+=1;const r=async(e,t)=>{this.emit(pA.RECONNECT_CREATE_CONNECTION,t),await this.createTransmitterConnection(e)};try{if("retry"===e){const t=this._addresses[this.currentURLIndex];this.emit(pA.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else if("tryNext"===e){this.currentURLIndex+=1;for(let e=this.currentURLIndex;e<this._addresses.length;e++){if(this._addresses[e].fingerprint||kR("FINGERPRINT")){this.currentURLIndex=e;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return QR.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);QR.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const t=this._addresses[this.currentURLIndex];this.emit(pA.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else"recover"===e&&(QR.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(pA.RECONNECT_WAITTING_FINISH,e),this.emit(pA.FAILBACK));return!0}catch(n){var i,o;return QR.error("[".concat(this._name,"] reconnect failed"),n.toString()),null!=n&&null!==(i=n.data)&&void 0!==i&&i.desc&&Array.isArray(n.data.desc)&&n.data.desc.length&&Dr(o=n.data.desc).call(o,"dynamic key expired")?(this.emit(pA.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,t)}}}class iO extends vw{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===yC.CONNECTED?this.emit(bC.WS_CONNECTED):e===yC.RECONNECTING?this.emit(bC.WS_RECONNECTING,this._websocketReconnectReason):e===yC.CLOSED&&this.emit(bC.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),ry(this,"_disconnectedReason",void 0),ry(this,"_websocketReconnectReason",void 0),ry(this,"_connectionState",yC.CLOSED),ry(this,"reconnectToken",void 0),ry(this,"websocket",void 0),ry(this,"openConnectionTime",void 0),ry(this,"clientId",void 0),ry(this,"lastMsgTime",Date.now()),ry(this,"uploadCache",[]),ry(this,"uploadCacheInterval",void 0),ry(this,"rttRolling",new _R(5)),ry(this,"pingpongTimer",void 0),ry(this,"inflateDataTimer",void 0),ry(this,"pingpongTimeoutCount",0),ry(this,"joinResponse",void 0),ry(this,"multiIpOption",void 0),ry(this,"initError",void 0),ry(this,"spec",void 0),ry(this,"store",void 0),ry(this,"onWebsocketMessage",(e=>{if(e instanceof ArrayBuffer)return void this.emit(bC.ON_BINARY_DATA,e);const t=JSON.parse(e);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")&&(this.emit(t._type,t._message),t._type===wC.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===wC.ON_USER_BANNED))switch(t._message.error_code){case 14:this.close(Iw.UID_BANNED);break;case 15:this.close(Iw.IP_BANNED);break;case 16:this.close(Iw.CHANNEL_BANNED)}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new rO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===yC.CONNECTED&&this.reconnect("retry",hA.OFFLINE)}))}async request(e,t,n,r){const i=eR(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new Gh(((t,n)=>{if(this.connectionState===yC.CONNECTED)return t();const r=()=>{this.off(bC.WS_CLOSED,i),t()},i=()=>{this.off(bC.WS_CONNECTED,r),n(new CC(tw.WS_ABORT))};this.once(bC.WS_CONNECTED,r),this.once(bC.WS_CLOSED,i),e!==TC.PUBLISH&&e!==TC.SUBSCRIBE&&e!==TC.UNSUBSCRIBE&&e!==TC.UNPUBLISH&&e!==TC.CONTROL&&e!==TC.RESTART_ICE||this.once(bC.DISCONNECT_P2P,(()=>{n(new CC(tw.DISCONNECT_P2P))})),e!==TC.PUBLISH&&e!==TC.RESTART_ICE||this.once(bC.ABORT_P2P_EXECUTION,(()=>{n(new CC(tw.DISCONNECT_P2P))}))}));if(this.connectionState!==yC.CONNECTING&&this.connectionState!==yC.RECONNECTING||e===TC.JOIN||e===TC.REJOIN||await a(),e===TC.LEAVE&&(this.websocket.unbindDcCloseEventListener(),r=!0),this.websocket.sendMessage(o,!0,!1),r)return;const c=new Gh(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(bC.WS_CLOSED,c),this.off(bC.WS_RECONNECTING,c),this.emit(bC.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new CC(tw.WS_ABORT,"type: ".concat(e))),this.off(bC.WS_CLOSED,c),this.off(bC.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(bC.WS_CLOSED,c),this.once(bC.WS_RECONNECTING,c),$w(kR("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(QR.warning("dc request timeout, type: ".concat(e)),this.emit(bC.REQUEST_TIMEOUT,e,t))}))}));let u=null;try{u=await c}catch(r){if(this.connectionState===yC.CLOSED||e===TC.LEAVE)throw new CC(tw.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===TC.JOIN||e===TC.REJOIN?null:(await a(),await this.request(e,t))}if(u.isSuccess)return u.message;const l=Number(u.message.error_code||u.message.code),d=RA(l),h=new CC(tw.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(u.message.error_str),{code:l,data:u.message});return"success"===d.action?u.message:(QR.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===vC.ERR_TOO_MANY_BROADCASTERS?e===TC.JOIN||e===TC.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(l===vC.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,QR.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",hA.MULTI_IP)):this.reconnect(d.action,hA.SERVER_ERROR),e===TC.JOIN||e===TC.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Gh((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void QR.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(SC.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=kR("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==yC.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),kR("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Gh(((n,r)=>{this.once(bC.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(bC.WS_CLOSED,(()=>r(this.initError||new CC(tw.WS_ABORT)))),this.connectionState=yC.CONNECTING,this.websocket.init(e).catch(r),this.websocket.once(pA.FAILBACK,(()=>{void 0===this.openConnectionTime&&r(new CC(tw.INIT_DATACHANNEL_TIMEOUT))})),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval((()=>{this.handleInflateData()}),2e4),setTimeout((()=>{t&&void 0===this.openConnectionTime&&(QR.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),r(new CC(tw.INIT_DATACHANNEL_TIMEOUT)))}),kR("DC_JOIN_WITH_FAILBACK"))}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Iw.LEAVE,this.connectionState=yC.CLOSED,QR.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===Iw.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new rO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(bC.ABORT_P2P_EXECUTION);const e=await Lw(this,bC.DATACHANNEL_CONNECTING),t=await this.request(TC.JOIN,e);if(!t)return this.emit(bC.REPORT_JOIN_GATEWAY,tw.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(bC.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yC.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new CC(tw.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Uw(this,bC.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(TC.REJOIN,e);return!!t&&(this.connectionState=yC.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(wC.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(wC.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(wC.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(wC.MUTE_AUDIO,{uid:e.uid}):this.emit(wC.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(wC.MUTE_VIDEO,{uid:e.uid}):this.emit(wC.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(wC.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(wC.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(wC.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(wC.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(wC.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){QR.debug("[".concat(this.clientId,"] receive notification: "),e);const t=RA(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(Iw.UID_BANNED),void this.close()):void this.reconnect(t.action,hA.SERVER_ERROR);QR.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=kR("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(QR.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>kR("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",hA.TIMEOUT):this.request(TC.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),kR("REPORT_STATS")&&this.send(TC.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleInflateData(){const{inflateLength:e,deflateLength:t}=this.websocket.getInflateData();0!==e&&0!==t&&this.upload(SC.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(pA.RECONNECT_WAITTING_FINISH,(e=>{this.emit(bC.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(pA.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(bC.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(pA.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pA.CLOSED,(()=>{this.connectionState=yC.CLOSED})),this.websocket.on(pA.FAILED,(()=>{this._disconnectedReason=Iw.NETWORK_ERROR,this.connectionState=yC.CLOSED})),this.websocket.on(pA.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===yC.CONNECTED?this.connectionState=yC.RECONNECTING:this.connectionState=yC.CONNECTING})),this.websocket.on(pA.WILL_RECONNECT,((e,t)=>{if(Uw(this,bC.IS_P2P_DISCONNECTED)&&"retry"===e)return QR.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(bC.NEED_RENEW_SESSION),this.emit(bC.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(QR.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(bC.NEED_RENEW_SESSION),this.emit(bC.DISCONNECT_P2P)),t(e)})),this.websocket.on(pA.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{QR.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",hA.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(bC.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof CC&&e.code===tw.UNEXPECTED_RESPONSE&&e.data.code===vC.ERR_NO_AUTHORIZED)return QR.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",hA.SERVER_ERROR);QR.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",hA.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(pA.REQUEST_NEW_URLS,((e,t)=>{Lw(this,bC.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(pA.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(wC.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(pA.TO_CONNECT_DATACHANNEL,(async(e,t,n)=>Lw(this,bC.DATACHANNEL_PRECONNECT,e).then(t).catch(n))),this.websocket.on(pA.FAILBACK,(()=>{void 0!==this.openConnectionTime&&this.emit(bC.DATACHANNEL_FAILBACK)}))}}class oO extends vw{constructor(e,t){super(),ry(this,"signal",void 0),ry(this,"token",void 0),ry(this,"tokenTimeout",void 0),ry(this,"tokenInterval",void 0),ry(this,"_sequence",0),ry(this,"userMap",new Map),ry(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const n=()=>{this.signal.connectionState===yC.CONNECTED&&this.check(),0===this.userMap.size?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*kR("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,r,i){var o,s,a;if(0===this.userMap.size)return;const c=Array.from(hC(o=this.userMap).call(o))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),r=null!==(s=r)&&void 0!==s?s:eR(6,""),i=null!==(a=i)&&void 0!==a?a:this._sequence++;const u={_id:r,_type:e,_seq:i,_message:t,token:"".concat(this.token,"_").concat(c)};kR("SHOW_P2P_LOG")&&QR.debug("send message",u,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(u)).forEach((e=>{this.signal.request(TC.DATA_STREAM,{payload:zw(this.encoder.encode(e))})}));const l=new Gh(((t,i)=>{const o=window.setTimeout((()=>{this.off("res-@".concat(r,"_ack"),s),this.off("res-@".concat(r),c),this.off(vA.ABORT,a),QR.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),0===this.userMap.size?i(new nw(tw.INVALID_REMOTE_USER)):i(new nw(tw.TIMEOUT))}),kR("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),s=()=>{o&&window.clearTimeout(o),this.off(vA.ABORT,a),n&&t()},a=()=>{o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),s),this.off("res-@".concat(r),c),i(new nw(tw.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(vA.ABORT,a),this.once("res-@".concat(r,"_ack"),s);const c=(n,c)=>{l=!0,o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),s),this.off(vA.ABORT,a),"success"===n?t(c):i(new nw(tw.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let l=!1;n||(this.once("res-@".concat(r),c),$w(kR("SIGNAL_REQUEST_TIMEOUT")).then((()=>{l||QR.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(u))})))}));try{return await l}catch(o){if(o.code===tw.TIMEOUT)return await this.send(e,t,n,r,i);throw o}}onMessage(e){var t;const{_uid:n}=e;let r,i=this.userMap.get(n);if(i)r=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==EA.CHECK)return;const{token:t}=e;r=new Map,i={uid:n,isStart:!0,token:t,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,i),this.signal.emit(wC.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var o;const{id:t,total:i}=e,s=null!==(o=r.get(t))&&void 0!==o?o:[];if(s.push(e),r.has(t)||r.set(t,s),s.length!==i)return;{const i=sm(s).call(s,((e,t)=>e.index-t.index)).map((e=>e.payload)).join("");r.delete(t),(e=JSON.parse(i))._uid=n}}const{_type:s,token:a}=e;if(Dr(t=[EA.ACK,EA.CHECK]).call(t,s))return s===EA.CHECK&&this.handleCheckToken(i,a),void this.receiveMessage(e);a==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):QR.debug('Receive unexpected message", '.concat(a,", cur_token: ").concat(i.token,"_").concat(this.token),e)}check(){const e={_id:eR(6,""),token:this.token,_type:EA.CHECK};kR("SHOW_P2P_LOG")&&QR.debug("send message",e),this.signal.request(TC.DATA_STREAM,{payload:zw(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:EA.ACK,token:this.token};kR("SHOW_P2P_LOG")&&QR.debug("send message",t),this.signal.request(TC.DATA_STREAM,{payload:zw(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(EA.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach((e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){const r=t.get(n);t.delete(n),this.receiveMessage(r),e.nextExpectedSequenceNumber++}}))};if(!e)return void t();const{_uid:n,_seq:r}=e,i=this.userMap.get(n),{receivedMessagesMap:o,isStart:s,nextExpectedSequenceNumber:a}=i;if(r<a)return this.ack(e._id),void QR.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));o.set(r,e),s&&r===a&&(this.receiveMessage(e),o.delete(a),i.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:n,_message:r,_uid:i}=e;if(kR("SHOW_P2P_LOG")&&QR.debug("receive message",e),t){let o;switch(e._type!==EA.ACK&&(r&&(o=JSON.parse(r)),this.ack(e._id)),e._type){case EA.CANDIDATE:case EA.CONTROL:this.signal.emit(n,o,i);break;case EA.PUBLISH:case EA.UNPUBLISH:case EA.RESTART_ICE:case EA.CALL:o.uid=i,Lw(this.signal,n,o).then((t=>{this.response(e._id,t)})).catch((()=>{this.response(e._id,void 0,!0)}));break;case EA.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case EA.RESPONSE:{const{success:e,message:n}=o;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(e){if(e.length<oO.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:n}=JSON.parse(e),r=eR(6,"");let i=0,o=800;const s=Math.ceil(e.length/o);for(;e.length>0;){i++;const a={id:r,index:i,total:s,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(n)};JSON.stringify(a).length>oO.MAX_MESSAGE_SIZE?o-=50:(t.push(a),e=e.slice(o))}return t.map((e=>JSON.stringify(e)))}handleCheckToken(e,t){return e.token!==t?(QR.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{QR.debug("token timeout, ".concat(t)),this.reset(e.uid)}),kR("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await Lw(this.signal,EA.CALL,void 0),t=await this.send(EA.CALL,e);this.signal.emit(bC.P2P_CONNECTION,t,!0)}async reset(e,t){const n=this.userMap.get(e);n&&(this.emit(vA.ABORT),this.signal.emit(wC.ON_USER_OFFLINE,{uid:n.uid,reason:bA.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(QR.debug("change local token from ".concat(t," to ").concat(t)),this.token=eR(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(vA.ABORT)}}ry(oO,"MAX_SIZE",1),ry(oO,"MAX_MESSAGE_SIZE",1024);class sO extends vw{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===yC.CONNECTED?this.emit(bC.WS_CONNECTED):e===yC.RECONNECTING?this.emit(bC.WS_RECONNECTING,this._websocketReconnectReason):e===yC.CLOSED&&this.emit(bC.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),ry(this,"_disconnectedReason",void 0),ry(this,"_websocketReconnectReason",void 0),ry(this,"_connectionState",yC.CLOSED),ry(this,"reconnectToken",void 0),ry(this,"p2pToken",void 0),ry(this,"websocket",void 0),ry(this,"openConnectionTime",void 0),ry(this,"clientId",void 0),ry(this,"lastMsgTime",Date.now()),ry(this,"uploadCache",[]),ry(this,"uploadCacheInterval",void 0),ry(this,"rttRolling",new _R(5)),ry(this,"pingpongTimer",void 0),ry(this,"pingpongTimeoutCount",0),ry(this,"joinResponse",void 0),ry(this,"multiIpOption",void 0),ry(this,"initError",void 0),ry(this,"spec",void 0),ry(this,"store",void 0),ry(this,"_external_signal",void 0),ry(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(bC.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case wC.ON_DATA_STREAM:return void this.handleDataStream(t._message);case wC.MUTE_AUDIO:case wC.MUTE_VIDEO:case wC.ON_P2P_LOST:case wC.ON_USER_ONLINE:return;case wC.ON_USER_OFFLINE:const{uid:e}=t._message;return QR.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===wC.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===wC.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(Iw.UID_BANNED);break;case 15:this.close(Iw.IP_BANNED);break;case 16:this.close(Iw.CHANNEL_BANNED)}if(t._type===wC.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case vC.ERR_LICENSE_MISSING:this.close(Iw.LICENSE_MISSING);break;case vC.ERR_LICENSE_EXPIRED:this.close(Iw.LICENSE_EXPIRED);break;case vC.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Iw.LICENSE_MINUTES_EXCEEDED);break;case vC.ERR_LICENSE_PERIOD_INVALID:this.close(Iw.LICENSE_PERIOD_INVALID);break;case vC.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Iw.LICENSE_MULTIPLE_SDK_SERVICE);break;case vC.ERR_LICENSE_ILLEGAL:this.close(Iw.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new FA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,kR("JOIN_GATEWAY_USE_DUAL_DOMAIN"),kR("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===yC.CONNECTED&&this.reconnect("retry",kw.OFFLINE)})),this.p2pToken=eR(6,""),this._external_signal=new oO(this,this.p2pToken)}async request(e,t,n,r){const i=eR(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new Gh(((e,t)=>{if(this.connectionState===yC.CONNECTED)return e();const n=()=>{this.off(bC.WS_CLOSED,r),e()},r=()=>{this.off(bC.WS_CONNECTED,n),t(new nw(tw.WS_ABORT))};this.once(bC.WS_CONNECTED,n),this.once(bC.WS_CLOSED,r)}));if(this.connectionState!==yC.CONNECTING&&this.connectionState!==yC.RECONNECTING||e===TC.JOIN||e===TC.REJOIN||await a(),this.websocket.sendMessage(o,!0),r)return;const c=new Gh(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(bC.WS_CLOSED,c),this.off(bC.WS_RECONNECTING,c),this.emit(bC.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new nw(tw.WS_ABORT,"type: ".concat(e))),this.off(bC.WS_CLOSED,c),this.off(bC.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(bC.WS_CLOSED,c),this.once(bC.WS_RECONNECTING,c),$w(kR("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(QR.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(bC.REQUEST_TIMEOUT,e,t))}))}));let u=null;try{u=await c}catch(r){if(this.connectionState===yC.CLOSED||e===TC.LEAVE)throw new nw(tw.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===TC.JOIN||e===TC.REJOIN?null:(await a(),await this.request(e,t))}if(u.isSuccess)return u.message;const l=Number(u.message.error_code||u.message.code),d=RA(l),h=new nw(tw.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(u.message.error_str),{code:l,data:u.message});return"success"===d.action?u.message:(QR.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===vC.ERR_TOO_MANY_BROADCASTERS?e===TC.JOIN||e===TC.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(l===vC.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,QR.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",kw.MULTI_IP)):this.reconnect(d.action,kw.SERVER_ERROR),e===TC.JOIN||e===TC.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Gh((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}uploadWRTCStats(e){if(!this.store.sessionId)return void QR.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(SC.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=kR("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==yC.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),kR("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Gh(((t,n)=>{this.once(bC.WS_CONNECTED,(()=>t(this.joinResponse))),this.once(bC.WS_CLOSED,(()=>n(this.initError||new nw(tw.WS_ABORT)))),this.connectionState=yC.CONNECTING,this.websocket.init(e).catch(n)}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Iw.LEAVE,this.connectionState=yC.CLOSED,QR.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===Iw.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new FA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,kR("JOIN_GATEWAY_USE_DUAL_DOMAIN"),kR("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=eR(6,""),this._external_signal.clear(),this._external_signal=new oO(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(bC.ABORT_P2P_EXECUTION);const e=await Lw(this,bC.REQUEST_JOIN_INFO),t=await this.request(TC.JOIN,e);if(!t)return this.emit(bC.REPORT_JOIN_GATEWAY,tw.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(bC.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yC.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;const n=Kw(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||Dr(t=Object.values(EA)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(wC.ON_DATA_STREAM,e)}catch(t){this.emit(wC.ON_DATA_STREAM,e)}}handleNotification(e){QR.debug("[".concat(this.clientId,"] receive notification: "),e);const t=RA(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(Iw.UID_BANNED),void this.close()):void this.reconnect(t.action,kw.SERVER_ERROR);QR.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=kR("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(QR.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>kR("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",kw.TIMEOUT):this.request(TC.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),kR("REPORT_STATS")&&this.send(TC.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWebsocketEvents(){this.websocket.on(IC.RECONNECT_WAITTING_FINISH,(e=>{this.emit(bC.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(IC.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(bC.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(IC.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(IC.CLOSED,(()=>{this.connectionState=yC.CLOSED})),this.websocket.on(IC.FAILED,(()=>{this._disconnectedReason=Iw.NETWORK_ERROR,this.connectionState=yC.CLOSED})),this.websocket.on(IC.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===yC.CONNECTED?this.connectionState=yC.RECONNECTING:this.connectionState=yC.CONNECTING})),this.websocket.on(IC.WILL_RECONNECT,((e,t,n)=>{"retry"!==e?(QR.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(bC.NEED_RENEW_SESSION)):QR.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)})),this.websocket.on(IC.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((e=>{if(this.emit(bC.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof nw&&e.code===tw.UNEXPECTED_RESPONSE&&e.data.code===vC.ERR_NO_AUTHORIZED)return QR.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",kw.SERVER_ERROR);QR.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",kw.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(IC.REQUEST_NEW_URLS,((e,t)=>{Lw(this,bC.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(IC.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(wC.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}function aO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aO(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const uO=new Map;class lO extends vw{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(KC.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(KC.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){QR.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),ry(this,"store",void 0),ry(this,"joinInfo",void 0),ry(this,"key",void 0),ry(this,"ntpOffset",0),ry(this,"signal",void 0),ry(this,"role",void 0),ry(this,"inChannelInfo",{joinAt:null,duration:0}),ry(this,"spec",void 0),ry(this,"_state","DISCONNECTED"),ry(this,"_statsCollector",void 0),ry(this,"_disconnectedReason",void 0),ry(this,"isSignalRecover",!1),ry(this,"hasChangeBGPAddress",!1),ry(this,"trafficStatsInterval",void 0),ry(this,"networkQualityInterval",void 0),ry(this,"_joinGatewayStartTime",0),ry(this,"_signalTimeout",!1),ry(this,"_clientRoleOptions",void 0),ry(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new sO(cO(cO({},t),{},{retryConfig:t.websocketRetryConfig}),e):this.store.useDataChannel?new iO(cO(cO({},t),{},{retryConfig:t.websocketRetryConfig}),e):new VA(cO(cO({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){if(this.signal instanceof iO){let t=!1;"disabled"!==e.cloudProxyServer?(QR.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(e.cloudProxyServer,")")),t=!0):"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length>255||"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length<22?(QR.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),t=!0):e.apResponse.addresses.some((e=>e.fingerprint))||kR("FINGERPRINT")||(QR.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),t=!0),t&&this.resetSignal()}this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const r=Date.now();let i=uO.get(e.cname);if(i||(i=new Map,uO.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new CC(tw.UID_CONFLICT);throw oI.joinGateway(e.sid,{lts:r,succ:!1,ec:t.message,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:this.signal instanceof iO?"1":"0"}),this._isProactiveJoin=!1,t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=r;const s=e.proxyServer;try{let t;if(QR.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof iO?"datachannel":"websocket"," join uid ").concat(o)),this.signal instanceof iO)t=await this.signal.init(e.apResponse.addresses,n);else{const r=e.gatewayAddrs.map((t=>{let{address:n}=t;const[r,i]=n.split(":"),o={host:r,port:i};return e.proxyServer&&(o.proxy=e.proxyServer),o}));t=await this.signal.init(r,n)}o=t.uid,QR.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof iO?"datachannel":"websocket"," join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){if(t&&t.code===tw.INIT_WEBSOCKET_TIMEOUT)throw QR.warning("[".concat(this.store.clientId,"] User join failed"),t.toString()),t;if(t&&t.code===tw.INIT_DATACHANNEL_TIMEOUT)throw QR.warning("[".concat(this.store.clientId,"] User join datachannel failed"),t.toString()),this.resetSignal(),t;throw QR.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),oI.joinGateway(e.sid,{lts:r,succ:!1,ec:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!s,signalChannel:this.signal instanceof iO?"1":"0"}),this._isProactiveJoin=!1,i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),QR.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((e=>{QR.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(KC.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(KC.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(KC.NETWORK_QUALITY,{uplinkNetworkQuality:YA(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:YA(this._statsCollector.trafficStats.B_dnq)}):this.emit(KC.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==Iw.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==yC.CONNECTED||await function(e,t){return t===1/0?e:Gh.race([e,Zw(t)])}(this.signal.request(TC.LEAVE,void 0,!0),3e3)}catch(e){QR.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==Iw.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new CC(tw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:kR("PUB_EXTEND"),twcc:!!kR("PUBLISH_TWCC"),rtx:!!kR("USE_PUB_RTX")};try{return(await this.signal.request(TC.PUBLISH,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===vC.ERR_PUBLISH_REQUEST_INVALID)return QR.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw r}}async publishDataChannel(e,t,n){var r;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new CC(tw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(r=t.maxRetransmits)&&void 0!==r?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(TC.PUBLISH_DATASTREAM,i,!0)}catch(r){if(n&&r.data&&r.data.code===vC.ERR_PUBLISH_REQUEST_INVALID)return QR.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),r.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw r}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new CC(tw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(TC.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){QR.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new CC(tw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Gh.all(e.map((e=>this.signal.request(TC.UNPUBLISH_DATASTREAM,{channel_id:e},!0))))}catch(e){QR.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new CC(tw.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!kR("SUBSCRIBE_TWCC"),rtx:!!kR("USE_SUB_RTX")||void 0,extend:kR("SUB_EXTEND"),svc:Array.isArray(kR("SVC"))&&0!==kR("SVC").length?kR("SVC"):void 0};try{return await this.signal.request(TC.PRE_SUBSCRIBE,r,!0)}catch(r){if(n&&r.data&&r.data.code===vC.ERR_SUBSCRIBE_REQUEST_INVALID)return QR.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),r.toString()),this.presubscribe(e,t,!1);throw r}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new CC(tw.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!kR("SUBSCRIBE_TWCC"),rtx:!!kR("USE_SUB_RTX"),extend:kR("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(kR("SVC"))&&0!==kR("SVC").length?kR("SVC"):void 0};try{return(await this.signal.request(TC.SUBSCRIBE,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===vC.ERR_SUBSCRIBE_REQUEST_INVALID)return QR.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw r}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new CC(tw.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(TC.SUBSCRIBE_DATASTREAM,r,!0)}catch(r){if(n&&r.data&&r.data.code===vC.ERR_SUBSCRIBE_REQUEST_INVALID)return QR.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),r.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw r}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new CC(tw.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!kR("USE_SUB_RTX"),twcc:!!kR("SUBSCRIBE_TWCC"),svc:Array.isArray(kR("SVC"))&&0!==kR("SVC").length?kR("SVC"):void 0};try{return await this.signal.request(TC.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===vC.ERR_SUBSCRIBE_REQUEST_INVALID)return QR.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(TC.SET_VIDEO_PROFILE,t);QR.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(TC.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){QR.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new CC(tw.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Gh.all(e.map((e=>this.signal.request(TC.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0))))}catch(e){QR.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(TC.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){QR.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(TC.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(TC.GATEWAY_INFO)}async renewToken(e){await this.signal.request(TC.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),"CONNECTED"!==this.state)return void(this.role=e);let n,r=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(TC.SET_CLIENT_ROLE,{role:e,level:r,delay:n,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(TC.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(TC.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(TC.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(TC.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(TC.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.signal instanceof sO)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),cO({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(TC.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=uO.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:aI.username,password:aI.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(cO(cO({},aI),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(TC.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach((e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((t=>t.peer_uid===e.peer_uid));t&&t.B_st!==e.B_st&&Bw((()=>{this.emit(KC.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new CC(tw.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=Object.assign({},this.joinInfo.apResponse);let n=kR("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n=void 0}n&&n.length>128&&(n=void 0);const r=cO({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:wR,browser:navigator.userAgent,process_id:kR("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:kR("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:kR("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:kR("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof kR("SUBSCRIBE_AUDIO_FILTER_TOPN")?kR("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof kR("ENABLE_PUBLISH_AUDIO_FILTER")?kR("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof kR("ENABLE_USER_LICENSE_CHECK")?kR("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===kR("USE_PUB_RTX")||!0===kR("USE_SUB_RTX")||void 0,disableFEC:kR("DISABLE_FEC"),enableNTPReport:!!kR("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!kR("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof kR("ENABLE_DATASTREAM_2")?kR("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!kR("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof kR("USE_XR")?kR("USE_XR"):void 0,enableLossbasedBwe:"boolean"==typeof kR("ENABLE_LOSSBASED_BWE")?kR("ENABLE_LOSSBASED_BWE"):void 0,enableAutCC:"boolean"==typeof kR("ENABLE_AUT_CC")?kR("ENABLE_AUT_CC"):void 0,enableCCFallback:"boolean"==typeof kR("ENABLE_CC_FALLBACK")?kR("ENABLE_CC_FALLBACK"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(r.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(r.aes_mode=this.joinInfo.aesmode,kR("ENCRYPT_AES")?(r.aes_secret=this.joinInfo.aespassword,r.aes_encrypt=!0):r.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(r.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(r.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(r.default_video_stream=this.joinInfo.defaultVideoStream),r}getRejoinMessage(){if(!this.joinInfo)throw new CC(tw.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(bC.WS_RECONNECT_WAITTING_FINISH,(e=>{var t;Dr(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&oI.adjustSessionStartTime(this.joinInfo.sid)})),this.signal.on(bC.WS_RECONNECT_CREATE_CONNECTION,(e=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(bC.WS_RECONNECTING,(e=>{this.joinInfo&&oI.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||kw.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",oI.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(bC.WS_CLOSED,(e=>{let t;switch(e){case Iw.LEAVE:t=kw.LEAVE;break;case Iw.UID_BANNED:case Iw.IP_BANNED:case Iw.CHANNEL_BANNED:case Iw.SERVER_ERROR:t=kw.SERVER_ERROR;break;case Iw.FALLBACK:t=kw.FALLBACK;break;case Iw.LICENSE_MISSING:case Iw.LICENSE_EXPIRED:case Iw.LICENSE_MINUTES_EXCEEDED:case Iw.LICENSE_PERIOD_INVALID:case Iw.LICENSE_MULTIPLE_SDK_SERVICE:case Iw.LICENSE_ILLEGAL:case Iw.TOKEN_EXPIRE:t=e;break;default:t=kw.NETWORK_ERROR}QR.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+kw.NETWORK_ERROR)),this.joinInfo&&oI.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Iw.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==Iw.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(bC.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(QR.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),oI.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof iO?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void QR.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));NR("EVENT_REPORT_DOMAIN",e[1]),NR("EVENT_REPORT_BACKUP_DOMAIN",e[1]),NR("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}})),this.signal.on(wC.ON_UPLINK_STATS,(e=>{this._statsCollector.updateUplinkStats(e)})),this.signal.on(bC.REQUEST_RECOVER,((e,t,n)=>{if(!this.joinInfo)return n(new CC(tw.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Lw(this,KC.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)})),this.signal.on(bC.REQUEST_JOIN_INFO,(async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=await Lw(this,KC.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(t=this.joinInfo)||void 0===t?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i,version:"2"}}))})),this.signal.on(bC.REQUEST_REJOIN_INFO,(e=>{e(this.getRejoinMessage())})),this.signal.on(bC.REPORT_JOIN_GATEWAY,((e,t)=>{this.joinInfo&&(oI.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof iO?"1":"0"}),this._isProactiveJoin=!1)})),this.signal.on(bC.IS_P2P_DISCONNECTED,(e=>{e(Uw(this,KC.IS_P2P_DISCONNECTED))})),this.signal.on(bC.DISCONNECT_P2P,(()=>{this.emit(KC.DISCONNECT_P2P)})),this.signal.on(bC.NEED_RENEW_SESSION,(e=>{this.emit(KC.NEED_RENEW_SESSION,e)})),this.signal.on(bC.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(bC.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(bC.JOIN_RESPONSE,(e=>{const t=this.getCurrentGatewayAddress();this.emit(KC.JOIN_RESPONSE,e,t)})),this.signal.on(bC.DATACHANNEL_PRECONNECT,(async(e,t,n)=>{this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress();return Lw(this,KC.DATACHANNEL_PRECONNECT,e,r).then(t).catch(n)})),this.signal.on(bC.DATACHANNEL_CONNECTING,(async e=>{const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await Lw(this,KC.REQUEST_DC_CONNECTION_PARAMS);e(this.getJoinMessage({ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r,version:"2"}}))})),this.signal.on(bC.DATACHANNEL_FAILBACK,(()=>{QR.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(KC.DATACHANNEL_FAILBACK)}))}async tryUnsubBeforeResub(e,t){try{await this.signal.request(TC.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw QR.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(TC.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw QR.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(TC.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw QR.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(TC.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw QR.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map((e=>({stream_id:e.stream_id,stream_type:e.stream_type})))};try{await this.signal.request(TC.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw QR.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find((e=>e.stream_type===HC.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(TC.CONTROL,n,!0,!0)}catch(e){throw QR.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find((e=>e.stream_type===HC.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(TC.CONTROL,n,!0,!0)}catch(e){throw QR.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const n={action:e===rA.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(TC.CONTROL,n,!0,!0)}catch(e){throw QR.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const n={action:e===rA.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(TC.CONTROL,n,!0,!0)}catch(e){throw QR.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(TC.RESTART_ICE,t,!0)}catch(e){throw QR.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,kw.P2P_FAILED)}getCurrentGatewayAddress(){var e;if(!kR("GATEWAY_WSS_ADDRESS"))return null!==(e=this.joinInfo)&&void 0!==e&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(TC.SET_PARAMETER,{enablePublishAudioFilter:e})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Iw.FALLBACK)),this.store.useDataChannel=!1,this.signal=new VA(cO(cO({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(KC.RESET_SIGNAL,JC.websocket)}}let dO=0,hO=0;function pO(e,t,n,r){return new Gh(((i,o)=>{t.timeout=t.timeout||kR("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),dO+=Xw(t.data)):n&&(t.data.size?dO+=t.data.size:t.data instanceof FormData?dO+=Qw(t.data):dO+=Xw(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,pS.request(t).then((e=>{"string"==typeof e.data?hO+=Xw(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?hO+=e.data.byteLength:hO+=Xw(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{pS.isCancel(e)?o(new CC(tw.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new CC(tw.NETWORK_TIMEOUT,e.message)):e.response?o(new CC(tw.NETWORK_RESPONSE_ERROR,e.response.status)):o(new CC(tw.NETWORK_ERROR,e.message))}))}))}!function(){var e;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},o=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var r=e[n];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function s(e,t){if(t)e:{var n=o;e=e.split(".");for(var r=0;r<e.length-1;r++){var s=e[r];if(!(s in n))break e;n=n[s]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function a(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(s("Symbol",(function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+r++,i)}})),s("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var s=o[t[r]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&i(s.prototype,e,{configurable:!0,writable:!0,value:function(){return a(n(this))}})}return e})),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var u;e:{var l={};try{l.__proto__={a:!0},u=l.a;break e}catch(e){}u=!1}r=u?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var d=r;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function p(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function f(e,t){return e.h=3,{value:t}}function m(e){this.g=new h,this.G=e}function g(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var o=i.value}catch(t){return e.g.j=null,e.g.s(t),_(e)}return e.g.j=null,r.call(e.g,o),_(e)}function _(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function E(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){p(e.g);var n=e.g.j;return n?g(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),_(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function v(e,t){return t=new E(new m(t)),d&&e.prototype&&d(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},m.prototype.o=function(e){return p(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),_(this))},m.prototype.s=function(e){return p(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),_(this))},s("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var y=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},b=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},T=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},S=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},w="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,R=w.FormData,I=w.XMLHttpRequest&&w.XMLHttpRequest.prototype.send,C=w.Request&&w.fetch,A=w.navigator&&w.navigator.sendBeacon,O=w.Element&&w.Element.prototype,N=w.Symbol&&Symbol.toStringTag;N&&(Blob.prototype[N]||(Blob.prototype[N]="Blob"),"File"in w&&!File.prototype[N]&&(File.prototype[N]="File"));try{new File([],"")}catch(e){w.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),N&&Object.defineProperty(e,N,{value:"File"}),e}}var k=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},D=function(e){this.i=[];var t=this;e&&y(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];y(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?y(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?b(e.value):e.value,t.append(e.name,n))}))};if((e=D.prototype).append=function(e,t,n){S(arguments,2),this.i.push(T(e,t,n))},e.delete=function(e){S(arguments,1);var t=[];e=String(e),y(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},e.entries=function e(){var t,n=this;return v(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=f(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},e.forEach=function(e,t){S(arguments,1);for(var n=c(this),r=n.next();!r.done;r=n.next()){var i=c(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){S(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){S(arguments,1);var t=[];return e=String(e),y(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},e.has=function(e){S(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r,i=this;return v(e,(function(e){if(1==e.h&&(t=c(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,f(e,c(r).next().value));n=t.next(),e.h=2}))},e.set=function(e,t,n){S(arguments,2),e=String(e);var r=[],i=T(e,t,n),o=!0;y(this.i,(function(t){t[0]===e?o&&(o=!r.push(i)):r.push(t)})),o&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i,o=this;return v(e,(function(e){if(1==e.h&&(t=c(o),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=c(r)).next(),f(e,i.next().value));n=t.next(),e.h=2}))},D.prototype._asNative=function(){for(var e=new R,t=c(this),n=t.next();!n.done;n=t.next()){var r=c(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},D.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+k(b(r))+'"\r\n\r\n'+b(e)+"\r\n"):t.push(n+k(b(r))+'"; filename="'+k(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},D.prototype[Symbol.iterator]=function(){return this.entries()},D.prototype.toString=function(){return"[object FormData]"},O&&!O.matches&&(O.matches=O.matchesSelector||O.mozMatchesSelector||O.msMatchesSelector||O.oMatchesSelector||O.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),N&&(D.prototype[N]="FormData"),I){var P=w.XMLHttpRequest.prototype.setRequestHeader;w.XMLHttpRequest.prototype.setRequestHeader=function(e,t){P.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},w.XMLHttpRequest.prototype.send=function(e){e instanceof D?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),I.call(this,e)):I.call(this,e)}}C&&(w.fetch=function(e,t){return t&&t.body&&t.body instanceof D&&(t.body=t.body._blob()),C.call(this,e,t)}),A&&(w.navigator.sendBeacon=function(e,t){return t instanceof D&&(t=t._asNative()),A.call(this,e,t)}),w.FormData=D}}();const fO=()=>{const e=kR("AREAS");return 0===e.length&&e.push(XC.GLOBAL),Xr(e).call(e,((e,t,n)=>{const r=mO(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},mO=e=>e===XC.OVERSEA?"".concat(ZC.ASIA,",").concat(ZC.EUROPE,",").concat(ZC.AFRICA,",").concat(ZC.NORTH_AMERICA,",").concat(ZC.SOUTH_AMERICA,",").concat(ZC.OCEANIA):ZC[e],gO=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((e=>{const n=$C[e],r=Object.keys(n);r&&r.map((e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},_O={GLOBAL:{ASIA:[XC.CHINA,XC.JAPAN,XC.INDIA,XC.KOREA,XC.HKMC],EUROPE:[],NORTH_AMERICA:[XC.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},EO=Object.keys(_O[XC.GLOBAL]),vO=[XC.CHINA,XC.NORTH_AMERICA,XC.EUROPE,XC.ASIA,XC.JAPAN,XC.INDIA,XC.OCEANIA,XC.SOUTH_AMERICA,XC.AFRICA,XC.KOREA,XC.HKMC,XC.US],yO=function(e,t){let n=[];if(Dr(e).call(e,XC.GLOBAL)){const o=[XC.GLOBAL,XC.OVERSEA],s=Object.keys($C);if(t===XC.GLOBAL)throw new CC(tw.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===XC.CHINA)n=[XC.OVERSEA];else if(i=t,Dr(EO).call(EO,i)){const e=(r=t,_O[XC.GLOBAL][r]||[]),i=[...o,t,...e];n=s.filter((e=>!Dr(i).call(i,e)))}else if(function(e){let t=!1;return EO.forEach((n=>{var r;Dr(r=_O[XC.GLOBAL][n]).call(r,e)&&(t=!0)})),t}(t)){const e=function(e){let t;return EO.forEach((n=>{var r;Dr(r=_O[XC.GLOBAL][n]).call(r,e)&&(t=n)})),t}(t),r=[...o,e,t];n=s.filter((e=>!Dr(r).call(r,e)))}else n=e;n=function(e){const t=[];return vO.forEach((n=>{Dr(e).call(e,n)&&t.push(n)})),t.concat(e.filter((e=>!Dr(vO).call(vO,e))))}(n)}else n=e;var r,i;return n};function bO(e){var t,n;if(!e&&Dr(t=kR("AREAS")).call(t,XC.EXTENSIONS))return QR.debug("update area from ap : reset"),void TO(sI,!0);if(!Dr(n=kR("AREAS")).call(n,XC.GLOBAL)||!e)return;let r=$C.EXTENSIONS;r&&(r={CODE:mO(XC.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},QR.debug("update area from ap success: ".concat(e,",config is "),r),NR("AREAS",[XC.EXTENSIONS],!0),Object.keys(r).map((e=>{NR(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])})))}function TO(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=oI.reportApiInvoke(null,{name:Tw.SET_AREA,options:e,tag:Sw.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((e=>{if(!Dr(QC).call(QC,e))throw new CC(tw.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new CC(tw.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?yO(i,n):i}if(!t){if(DR.AREAS){const e=new CC(tw.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void QR.warning("setArea is prohibited because of config-distribute")}if(Dr(r).call(r,XC.GLOBAL)&&kR("AREAS")===XC.EXTENSIONS){const e=new CC(tw.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void QR.warning("setArea is prohibited because of ap extensions")}}NR("AREAS",r,t);const i=gO(r);Object.keys(i).map((e=>{NR(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])})),QR.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function SO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SO(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let RO=1;function IO(e,t,n,r,i){RO+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:RO,requestId:RO,version:wR,cname:n.cname},s={service_name:t,json_body:JSON.stringify(o)};let a,c,u=e[0];return gR((async()=>{a=Date.now();const e=await pO(u,{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-a,0!==e.code){const t=new CC(tw.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw QR.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new CC(tw.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw QR.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new CC(tw.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw QR.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(kR("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t)))),workerToken:e.workerToken,vid:e.vid}}(n,t);return kR("LIVE_STREAMING_ADDRESS")&&(i.addressList=kR("LIVE_STREAMING_ADDRESS")instanceof Array?kR("LIVE_STREAMING_ADDRESS"):[kR("LIVE_STREAMING_ADDRESS")]),wO(wO({},i),{},{responseTime:c})}),((r,i)=>(oI.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1)),((r,i)=>(oI.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(r.code!==tw.OPERATION_ABORTED&&r.code!==tw.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(u=e[(i+1)%e.length],!0))),i)}let CO=1;function AO(e,t,n,r){let{url:i,areaCode:o}=e;const{clientId:s,sid:a}=t,c=Date.now();let u;const[l,d]=PO(t,o,[BA.CHOOSE_SERVER]);let h=Fw.networkState;return gR((async()=>{h&&Fw.networkState===Dw.OFFLINE&&Fw.onlineWaiter&&await Gh.race([Fw.onlineWaiter,$w(r&&r.maxRetryTimeout||fR.maxRetryTimeout)]),h=Fw.networkState;const{data:e,headers:o}=await pO(i,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u="1"===o.http3?1:-1,oI.reportResourceTiming(i,a),NO(e,i,t,c,[BA.CHOOSE_SERVER],u);const s=JA(e,BA.CHOOSE_SERVER);return kO(s),HA(s,i)}),(e=>(e&&oI.joinChooseServer(a,{lts:c,succ:!0,csAddr:i,opid:d,serverList:e.gatewayAddrs.map((e=>e.address)),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[BA.CHOOSE_SERVER].toString(),isHttp3:u}),!1)),(e=>e.code!==tw.OPERATION_ABORTED&&(e.code===tw.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(oI.joinChooseServer(a,{lts:c,succ:!1,csAddr:i,serverList:null,opid:d,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[BA.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:u}),QR.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] Choose server network error, retry"),e),!0))),r)}function OO(e,t,n,r){let i,{url:o,areaCode:s,serviceIds:a}=e;const c=Date.now(),[u,l]=PO(t,s,a);let d;return gR((async()=>{d&&Fw.networkState===Dw.OFFLINE&&Fw.onlineWaiter&&await Gh.race([Fw.onlineWaiter,$w(r&&r.maxRetryTimeout||fR.maxRetryTimeout)]),d=Fw.networkState;const{data:e,headers:s}=await pO(o,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===s.http3?1:-1,oI.reportResourceTiming(o,t.sid),NO(e,o,t,c,a,i);const l=JA(e,BA.CHOOSE_SERVER),h=JA(e,"proxy5"===t.cloudProxyServer?BA.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?BA.CLOUD_PROXY:BA.CLOUD_PROXY_FALLBACK);return kO(l),{gatewayInfo:HA(l,o),proxyInfo:h,url:o}}),(e=>(e.gatewayInfo&&oI.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,opid:l,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:i}),e.proxyInfo&&oI.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((e=>e.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:a.toString()}),!1)),(e=>e.code!==tw.OPERATION_ABORTED&&(e.code===tw.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(oI.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:d})}),QR.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))),r)}const NO=(e,t,n,r,i,o)=>{const{sid:s,clientId:a,cloudProxyServer:c}=n,u=[],l=n=>{4096===n.flag?oI.joinChooseServer(s,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:n.error.message,csIp:n.error.data&&n.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o}):1048576!==n.flag&&4194304!==n.flag&&4194310!==n.flag||oI.joinWebProxyAP(s,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:n.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach((t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)QR.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new CC(tw.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};u.push(n),l(n)}if(0!==n){const r=SA(n),i={error:new CC(tw.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?QR.warning(i.error.toString()):u.push(i),l(i)}})),u.length)throw QR.warning("[".concat(a||"sid-".concat(s.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(u.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry))).join(" | "))),new CC(tw.CAN_NOT_GET_GATEWAY_SERVER,u.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!u.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(u.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})},kO=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new CC(tw.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(kR("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?bO(e.detail[23].toLowerCase()):bO()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let r=0;r<n.length;r++){var o;const t=Bp(o=n[r]).call(o);e.addresses[r]&&n&&(e.addresses[r].fingerprint=t)}}if(kR("GATEWAY_ADDRESS")&&kR("GATEWAY_ADDRESS").length>0){QR.debug("assign gateway address to",kR("GATEWAY_ADDRESS"));const t=kR("GATEWAY_ADDRESS").map((t=>{var n,r;const i=null!==(n=null===(r=e.addresses.find((e=>e.ip===t.ip&&e.port===t.port)))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=t}},DO=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=SA(t.buffer.code);throw new CC(tw.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw QR.debug("update ticket request received ap response without response body:",t),new CC(tw.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},PO=(e,t,n)=>{const r=Math.floor(Math.random()*10**12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:wO({6:e.stringUid,11:t,12:kR("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach((t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const o=new FormData;return o.append("request",JSON.stringify(i)),[o,r]},LO=(e,t)=>{const n=Math.floor(Math.random()*10**12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((e=>({ip:e.ip,port:e.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let MO=0;function xO(e){return Gh.all(e.map((e=>e.then((e=>{throw e}),(e=>e))))).then((e=>{throw e}),(e=>e))}const UO=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:o}=e,s=0;const a=t;let c,u=0;const l=async()=>{const e=(()=>{const e=s*a,t=e+a;return n.slice(e,t).map(r)})();o&&o.push(...e);try{c=await xO(e)}catch(e){if(u+=a,s++,!(u>=n.length))return void await l();i(e)}e.forEach((e=>e.cancel()))};return await l(),c},FO=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let o=0;const s=async()=>{const e=n(t.shift());try{return await e}catch(e){if(o++,o>=i||null!=r&&r(e))throw e;return s()}};return s()};async function jO(e,t,n,r){const i=async function(e,t,n,r){let i=null;const o=[],s=async()=>{const i=kR("WEBCS_DOMAIN").slice(0,kR("AJAX_REQUEST_CONCURRENT")).map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:fO()}))),s=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),a=await UO({fragementLength:kR("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(QR.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),AO(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),a},a=async()=>{if(await $w(1e3),null!==i)return i;const s=kR("WEBCS_DOMAIN_BACKUP_LIST").map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:fO()}))),a=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:s.map((e=>e.url))}),c=await UO({fragementLength:kR("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:r=>(QR.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),AO(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c};try{return i=await xO([s(),a()]),o.length&&o.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),i}catch(e){throw e[0]}}(e,t,n,r);return{gatewayInfo:await i}}async function VO(e,t,n,r,i){const o=e.cloudProxyServer;if("disabled"===o){if(!r)return;if(e.useLocalAccessPoint)return await jO(e,t,n,i);if(kR("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:r,proxyInfo:o}=await HO(e,t,n,i);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:r};const a=o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||aI.tcpport,udpport:e.udpport||aI.udpport,username:e.username||aI.username,password:e.password||aI.password,forceturn:!1,security:!0})));if(i.useP2P){var s;const t=null!==(s=e.uid)&&void 0!==s?s:r.uid,n="glb:".concat(t.toString()),i=await Ew(n),c=o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||aI.tcpport,udpport:e.udpport||aI.udpport,username:n,password:i,forceturn:!1,security:!0})));a.push(...c)}return e.turnServer={mode:"manual",servers:a},{gatewayInfo:r}}return await jO(e,t,n,i)}const{proxyInfo:a,gatewayInfo:c}=await HO(e,t,n,i),u={gatewayInfo:c},l=a.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:aI.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:aI.udpport,username:e.username||aI.username,password:e.password||aI.password,forceturn:"proxy4"!==o,security:"proxy5"===o})));if(i.useP2P){var d;const t=null!==(d=e.uid)&&void 0!==d?d:c.uid,n="glb:".concat(t.toString()),r=await Ew(n),i=a.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport||aI.tcpport,udpport:"proxy4"===o?void 0:e.udpport||aI.udpport,username:n,password:r,forceturn:"proxy4"!==o,security:"proxy5"===o})));l.push(...i)}return e.turnServer={mode:"manual",servers:l},QR.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),u}async function BO(e,t,n,r,i){const o=kR("ACCOUNT_REGISTER").slice(0,kR("AJAX_REQUEST_CONCURRENT"));let s=[];s=t.proxyServer?o.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):o.map((e=>"https://".concat(e,"/api/v1")));const a=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s});try{const o=await async function(e,t,n,r,i){const o=Date.now(),s={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let a=e[0];const c=await gR((()=>pO(a+"".concat(-1===a.indexOf("?")?"?":"&","action=stringuid"),{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw QR.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),oI.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:tw.INVALID_UINT_UID_FROM_STRING_UID,extend:s}),new CC(tw.INVALID_UINT_UID_FROM_STRING_UID);return oI.reqUserAccount(s.sid,{lts:o,success:!0,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:null,extend:s}),!1}const i=SA(n.code);return i.retry&&(a=e[(r+1)%e.length]),oI.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:i.desc,extend:s}),i.retry}),((t,n)=>t.code!==tw.OPERATION_ABORTED&&(oI.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:null,errorCode:t.code,extend:s}),a=e[(n+1)%e.length],!0)),i);if(0!==c.code){const e=SA(c.code);throw new CC(tw.UNEXPECTED_RESPONSE,e.desc)}return c}(s,e,t,n,r);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},a),o.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},a),e}}async function GO(e,t,n){const r=kR("ACCOUNT_REGISTER");let i=[];i=t.proxyServer?r.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):r.map((e=>"https://".concat(e,"/api/v1")));try{const r=await FO({referenceList:i,asyncMapHandler:r=>async function(e,t,n,r){const i=Date.now(),o={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{const t=await pO(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){const e=SA(t.code);throw new CC(tw.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new CC(tw.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:i,url:e,req:o,uid:t.uid,elapse:Date.now()-i}}catch(e){throw e}}(r,e,t,n),closeFn:e=>e.code===tw.OPERATION_ABORTED||e.code===tw.UNEXPECTED_RESPONSE&&!e.data.retry});return r}catch(e){throw e}}async function qO(e,t,n){const r=kR("CDS_AP").slice(0,kR("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config"))),i=r.map((r=>function(e,t,n,r){const i=wS(),o={flag:64,cipher_method:0,features:{device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:wR,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return gR((()=>pO(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(e=>e.code!==tw.OPERATION_ABORTED),r)}(r,e,t,n)));let o=null,s=null,a={};try{o=await xO(i)}catch(e){if(e.code===tw.OPERATION_ABORTED)throw e;s=e}if(i.forEach((e=>e.cancel())),oI.reportApiInvoke(e.sid,{name:Tw.REQUEST_CONFIG_DISTRIBUTE,options:{error:s,res:o}}).onSuccess(),o&&o.test_tags)try{a=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),r={};return n.forEach((e=>{var n;const i=Bp(n=e.slice(4)).call(n),o=JSON.parse(t[e])[1];r[i]=o})),r}(o)}catch(e){}return a}async function WO(e,t){const n=kR("WEBCS_DOMAIN").concat(kR("WEBCS_DOMAIN_BACKUP_LIST")).map((e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:fO(),serviceIds:[BA.CHOOSE_SERVER,BA.CLOUD_PROXY_FALLBACK]})));try{const r=await FO({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let r,{url:i,areaCode:o,serviceIds:s}=e;const a=Date.now(),[c,u]=PO(t,o,s);let l=Fw.networkState;try{l&&Fw.networkState===Dw.OFFLINE&&Fw.onlineWaiter&&await Gh.race([Fw.onlineWaiter,$w(fR.maxRetryTimeout)]),l=Fw.networkState;const{data:e,headers:t}=await pO(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===t.http3?1:-1;const o=e=>{const t=[];if(e.response_body.forEach((n=>{const r=n.buffer.code;if(23===n.uri&&0===r&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{const r={error:new CC(tw.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(r)}if(0!==r){const i=SA(r),o={error:new CC(tw.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?QR.warning(o.error.toString()):t.push(o)}})),t.length)throw new CC(tw.CAN_NOT_GET_GATEWAY_SERVER,t.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!t.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(t.map((e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc})).filter((e=>!!e)))]})};o(e);const s=JA(e,BA.CHOOSE_SERVER),d=JA(e,BA.CLOUD_PROXY_FALLBACK);return kO(s),{gatewayInfo:HA(s,i),proxyInfo:d,opid:u,requestTime:a,url:i,isHttp3:r,elapse:Date.now()-a}}catch(e){throw e}}(n,e,t),closeFn:e=>e.code===tw.OPERATION_ABORTED||e.code===tw.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry});return r}catch(e){throw e}}async function HO(e,t,n,r){const i=kR("PROXY_SERVER_TYPE3"),o=(e,t,n)=>{let r=n||i;return Array.isArray(r)&&(r=t%2==0?i[1]:i[0]),"https://".concat(r,"/ap/?url=").concat(e)};let s=null;const a=[],c=async()=>{const i=kR("WEBCS_DOMAIN").slice(0,kR("AJAX_REQUEST_CONCURRENT")).map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:fO(),serviceIds:[BA.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?BA.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?BA.CLOUD_PROXY:BA.CLOUD_PROXY_FALLBACK]}})),s=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),c=await UO({fragementLength:kR("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(QR.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),OO(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c},u=async()=>{if(await $w(1e3),null!==s)return s;const i=kR("WEBCS_DOMAIN_BACKUP_LIST").map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:fO(),serviceIds:[BA.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?BA.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?BA.CLOUD_PROXY:BA.CLOUD_PROXY_FALLBACK]}})),c=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),u=await UO({fragementLength:kR("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(QR.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),OO(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},c),u};let l,d,h;try{({gatewayInfo:l,proxyInfo:d,url:h}=await xO([c(),u()]))}catch(e){throw e[0]}if(a.length&&a.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),!l||!d)throw new CC(tw.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Dr(i).call(i,t)&&(e.proxyServer=t,QR.setProxyServer(t),oI.setProxyServer(t))}return s={gatewayInfo:l,proxyInfo:await XA(d,l.uid)},s}async function KO(e,t,n,r){const i=kR("UAP_AP").slice(0,kR("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")));return await IO(i,e,t,n,r)}async function zO(e,t,n){const r=kR("UAP_AP").slice(0,kR("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap"))),i=r.map((r=>function(e,t,n,r){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:wR,cname:t.cname,uid:t.uid.toString(),requestId:CO,seq:CO};CO+=1;const o={service_name:"tele_channel",json_body:JSON.stringify(i)};return gR((async()=>{const t=await pO(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new CC(tw.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw QR.error(e.toString()),e}const r=JSON.parse(t.json_body);if(200!==r.code){const e=new CC(tw.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw QR.error(e.toString()),e}if(!r.servers||0===r.servers.length){const e=new CC(tw.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw QR.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(kR("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(kR("WORKER_DOMAIN"),":").concat(e.wss)))}}),void 0,(e=>!!(e.code!==tw.OPERATION_ABORTED&&e.code!==tw.UNEXPECTED_RESPONSE||e.data&&e.data.retry)),r)}(r,e,t,n)));try{const e=await xO(i);return i.forEach((e=>e.cancel())),e}catch(e){throw e[0]}}async function YO(e,t,n){let r=null;const i=[],o=async o=>{const s=kR(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2")));return o&&(await $w(1e3),null!==r)?r:await UO({fragementLength:kR("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:r=>(QR.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),r),function(e,t,n,r){const[i]=LO(t,[BA.CHOOSE_SERVER]);let o=Fw.networkState;return gR((async()=>{o&&Fw.networkState===Dw.OFFLINE&&Fw.onlineWaiter&&await Gh.race([Fw.onlineWaiter,$w(r&&r.maxRetryTimeout||fR.maxRetryTimeout)]),o=Fw.networkState;const t=await pO(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return DO(t,e)}),(()=>!1),(e=>e.code!==tw.OPERATION_ABORTED&&(e.code===tw.UPDATE_TICKET_FAILED?e.data.retry:(QR.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await xO([o(!1),o(!0)]),i.length&&i.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),r}catch(e){throw e[0]}}function JO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function XO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JO(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class QO extends vw{get isSuccess(){return!!this.configs}constructor(){super(),ry(this,"configs",void 0),ry(this,"joinInfo",void 0),ry(this,"cancelToken",void 0),ry(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),ry(this,"interval",void 0),ry(this,"mutex",new hR("config-distribute")),ry(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),kR("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),kR("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,oI.reportApiInvoke(null,{options:void 0,name:Tw.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Sw.TRACER}).onSuccess(JSON.stringify(DR))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void QR.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await qO(this.joinInfo,this.cancelToken,this.retryConfig),QR.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(e){const t=new CC(tw.NETWORK_RESPONSE_ERROR,e);QR.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&void 0!==t.uplink.max_bitrate&&void 0!==t.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(eA.UPDATE_BITRATE_LIMIT,e):this.emit(eA.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&XO({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;const n=sm(t=Object.keys(e).filter((e=>/^webrtc_ng_global_parameter/.test(e)))).call(t);for(let i=0;i<n.length;i++)for(let t=n.length-1;t>i;t--){const r=n[t];if("number"==typeof e[r].__priority){const i=e[r].__priority,o=n[t-1];if("number"==typeof e[o].__priority){if(!(i>e[o].__priority))continue;{const e=r;n[t]=n[t-1],n[t-1]=e}}else{const e=r;n[t]=n[t-1],n[t-1]=e}}}const r={};n.forEach((t=>{const n=e[t],i=n.__expires;Object.keys(n).forEach((e=>{"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(r,e)||(r[e]=XO({value:n[e]},i&&{expires:i}))}))}));try{!function(e){try{const t=Date.now();Object.keys(e).forEach((n=>{switch(n){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(OR,n)){const{value:r,expires:i}=e[n];if(i&&i<=t)return;DR[n]=r,OR[n]=r,QR.debug("Update global parameters from config distribute",n,r)}}}))}catch(t){QR.error("Error update config immediately: ".concat(e),t.message)}}(r);const e=JSON.stringify(r),t=window.btoa(e);window.localStorage.setItem("websdk_ng_global_parameter",t),QR.debug("Caching global parameters ".concat(e))}catch(e){QR.error("Error caching global parameters:",e.message)}}}var ZO,$O=r(MI),eN=k,tN=l,nN=L,rN=i,iN=to,oN=Bi,sN=M,aN=Xe,cN=K,uN=Object.assign,lN=Object.defineProperty,dN=tN([].concat),hN=!uN||rN((function(){if(eN&&1!==uN({b:1},uN(lN({},"a",{enumerable:!0,get:function(){lN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=uN({},e)[n]||iN(uN({},t)).join("")!=r}))?function(e,t){for(var n=aN(e),r=arguments.length,i=1,o=oN.f,s=sN.f;r>i;)for(var a,c=cN(arguments[i++]),u=o?dN(iN(c),o(c)):iN(c),l=u.length,d=0;l>d;)a=u[d++],eN&&!nN(s,c,a)||(n[a]=c[a]);return n}:uN,pN=rn,fN=os,mN=Qt,gN=L,_N=Xe,EN=function(e,t,n,r){try{return r?t(pN(n)[0],n[1]):t(n)}catch(t){fN(e,"throw",t)}},vN=Go,yN=Bc,bN=Wn,TN=gf,SN=ts,wN=Yo,RN=Array,IN=l,CN=2147483647,AN=/[^\0-\u007E]/,ON=/[.\u3002\uFF0E\uFF61]/g,NN="Overflow: input needs wider integers to process",kN=RangeError,DN=IN(ON.exec),PN=Math.floor,LN=String.fromCharCode,MN=IN("".charCodeAt),xN=IN([].join),UN=IN([].push),FN=IN("".replace),jN=IN("".split),VN=IN("".toLowerCase),BN=function(e){return e+22+75*(e<26)},GN=function(e,t,n){var r=0;for(e=n?PN(e/700):e>>1,e+=PN(e/t);e>455;)e=PN(e/35),r+=36;return PN(r+36*e/(e+38))},qN=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=MN(e,n++);if(i>=55296&&i<=56319&&n<r){var o=MN(e,n++);56320==(64512&o)?UN(t,((1023&i)<<10)+(1023&o)+65536):(UN(t,i),n--)}else UN(t,i)}return t}(e);var n,r,i=e.length,o=128,s=0,a=72;for(n=0;n<e.length;n++)(r=e[n])<128&&UN(t,LN(r));var c=t.length,u=c;for(c&&UN(t,"-");u<i;){var l=CN;for(n=0;n<e.length;n++)(r=e[n])>=o&&r<l&&(l=r);var d=u+1;if(l-o>PN((CN-s)/d))throw kN(NN);for(s+=(l-o)*d,o=l,n=0;n<e.length;n++){if((r=e[n])<o&&++s>CN)throw kN(NN);if(r==o){for(var h=s,p=36;;){var f=p<=a?1:p>=a+26?26:p-a;if(h<f)break;var m=h-f,g=36-f;UN(t,LN(BN(f+m%g))),h=PN(m/g),p+=36}UN(t,LN(BN(h))),a=GN(s,d,u==c),s=0,u++}}s++,o++}return xN(t,"")},WN=Nn,HN=k,KN=sy,zN=p,YN=Qt,JN=l,XN=pa,QN=hc,ZN=vc,$N=$e,ek=hN,tk=function(e){var t=_N(e),n=yN(this),r=arguments.length,i=r>1?arguments[1]:void 0,o=void 0!==i;o&&(i=mN(i,r>2?arguments[2]:void 0));var s,a,c,u,l,d,h=wN(t),p=0;if(!h||this===RN&&vN(h))for(s=bN(t),a=n?new this(s):RN(s);s>p;p++)d=o?i(t[p],p):t[p],TN(a,p,d);else for(l=(u=SN(t,h)).next,a=n?new this:[];!(c=gN(l,u)).done;p++)d=o?EN(u,i,[c.value,p],!0):c.value,TN(a,p,d);return a.length=p,a},nk=Tf,rk=Th.codeAt,ik=function(e){var t,n,r=[],i=jN(FN(VN(e),ON,"."),".");for(t=0;t<i.length;t++)n=i[t],UN(r,DN(AN,n)?"xn--"+qN(n):n);return xN(r,".")},ok=_r,sk=Da,ak=Zc,ck=Tb,uk=oa,lk=uk.set,dk=uk.getterFor("URL"),hk=ck.URLSearchParams,pk=ck.getState,fk=zN.URL,mk=zN.TypeError,gk=zN.parseInt,_k=Math.floor,Ek=Math.pow,vk=JN("".charAt),yk=JN(/./.exec),bk=JN([].join),Tk=JN(1..toString),Sk=JN([].pop),wk=JN([].push),Rk=JN("".replace),Ik=JN([].shift),Ck=JN("".split),Ak=JN("".slice),Ok=JN("".toLowerCase),Nk=JN([].unshift),kk="Invalid scheme",Dk="Invalid host",Pk="Invalid port",Lk=/[a-z]/i,Mk=/[\d+-.a-z]/i,xk=/\d/,Uk=/^0x/i,Fk=/^[0-7]+$/,jk=/^\d+$/,Vk=/^[\da-f]+$/i,Bk=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Gk=/[\0\t\n\r #/:<>?@[\\\]^|]/,qk=/^[\u0000-\u0020]+/,Wk=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Hk=/[\t\n\r]/g,Kk=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)Nk(t,e%256),e=_k(e/256);return bk(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=Tk(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},zk={},Yk=ek({},zk,{" ":1,'"':1,"<":1,">":1,"`":1}),Jk=ek({},Yk,{"#":1,"?":1,"{":1,"}":1}),Xk=ek({},Jk,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Qk=function(e,t){var n=rk(e,0);return n>32&&n<127&&!$N(t,e)?e:encodeURIComponent(e)},Zk={ftp:21,file:null,http:80,https:443,ws:80,wss:443},$k=function(e,t){var n;return 2==e.length&&yk(Lk,vk(e,0))&&(":"==(n=vk(e,1))||!t&&"|"==n)},eD=function(e){var t;return e.length>1&&$k(Ak(e,0,2))&&(2==e.length||"/"===(t=vk(e,2))||"\\"===t||"?"===t||"#"===t)},tD=function(e){return"."===e||"%2e"===Ok(e)},nD={},rD={},iD={},oD={},sD={},aD={},cD={},uD={},lD={},dD={},hD={},pD={},fD={},mD={},gD={},_D={},ED={},vD={},yD={},bD={},TD={},SD=function(e,t,n){var r,i,o,s=ok(e);if(t){if(i=this.parse(s))throw mk(i);this.searchParams=null}else{if(void 0!==n&&(r=new SD(n,!0)),i=this.parse(s,null,r))throw mk(i);(o=pk(new hk)).bindURL(this),this.searchParams=o}};SD.prototype={type:"URL",parse:function(e,t,n){var r,i,o,s,a,c=this,u=t||nD,l=0,d="",h=!1,p=!1,f=!1;for(e=ok(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=Rk(e,qk,""),e=Rk(e,Wk,"$1")),e=Rk(e,Hk,""),r=tk(e);l<=r.length;){switch(i=r[l],u){case nD:if(!i||!yk(Lk,i)){if(t)return kk;u=iD;continue}d+=Ok(i),u=rD;break;case rD:if(i&&(yk(Mk,i)||"+"==i||"-"==i||"."==i))d+=Ok(i);else{if(":"!=i){if(t)return kk;d="",u=iD,l=0;continue}if(t&&(c.isSpecial()!=$N(Zk,d)||"file"==d&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=d,t)return void(c.isSpecial()&&Zk[c.scheme]==c.port&&(c.port=null));d="","file"==c.scheme?u=mD:c.isSpecial()&&n&&n.scheme==c.scheme?u=oD:c.isSpecial()?u=uD:"/"==r[l+1]?(u=sD,l++):(c.cannotBeABaseURL=!0,wk(c.path,""),u=yD)}break;case iD:if(!n||n.cannotBeABaseURL&&"#"!=i)return kk;if(n.cannotBeABaseURL&&"#"==i){c.scheme=n.scheme,c.path=nk(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,u=TD;break}u="file"==n.scheme?mD:aD;continue;case oD:if("/"!=i||"/"!=r[l+1]){u=aD;continue}u=lD,l++;break;case sD:if("/"==i){u=dD;break}u=vD;continue;case aD:if(c.scheme=n.scheme,i==ZO)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=nk(n.path),c.query=n.query;else if("/"==i||"\\"==i&&c.isSpecial())u=cD;else if("?"==i)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=nk(n.path),c.query="",u=bD;else{if("#"!=i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=nk(n.path),c.path.length--,u=vD;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=nk(n.path),c.query=n.query,c.fragment="",u=TD}break;case cD:if(!c.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,u=vD;continue}u=dD}else u=lD;break;case uD:if(u=lD,"/"!=i||"/"!=vk(d,l+1))continue;l++;break;case lD:if("/"!=i&&"\\"!=i){u=dD;continue}break;case dD:if("@"==i){h&&(d="%40"+d),h=!0,o=tk(d);for(var m=0;m<o.length;m++){var g=o[m];if(":"!=g||f){var _=Qk(g,Xk);f?c.password+=_:c.username+=_}else f=!0}d=""}else if(i==ZO||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(h&&""==d)return"Invalid authority";l-=tk(d).length+1,d="",u=hD}else d+=i;break;case hD:case pD:if(t&&"file"==c.scheme){u=_D;continue}if(":"!=i||p){if(i==ZO||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(c.isSpecial()&&""==d)return Dk;if(t&&""==d&&(c.includesCredentials()||null!==c.port))return;if(s=c.parseHost(d))return s;if(d="",u=ED,t)return;continue}"["==i?p=!0:"]"==i&&(p=!1),d+=i}else{if(""==d)return Dk;if(s=c.parseHost(d))return s;if(d="",u=fD,t==pD)return}break;case fD:if(!yk(xk,i)){if(i==ZO||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()||t){if(""!=d){var E=gk(d,10);if(E>65535)return Pk;c.port=c.isSpecial()&&E===Zk[c.scheme]?null:E,d=""}if(t)return;u=ED;continue}return Pk}d+=i;break;case mD:if(c.scheme="file","/"==i||"\\"==i)u=gD;else{if(!n||"file"!=n.scheme){u=vD;continue}if(i==ZO)c.host=n.host,c.path=nk(n.path),c.query=n.query;else if("?"==i)c.host=n.host,c.path=nk(n.path),c.query="",u=bD;else{if("#"!=i){eD(bk(nk(r,l),""))||(c.host=n.host,c.path=nk(n.path),c.shortenPath()),u=vD;continue}c.host=n.host,c.path=nk(n.path),c.query=n.query,c.fragment="",u=TD}}break;case gD:if("/"==i||"\\"==i){u=_D;break}n&&"file"==n.scheme&&!eD(bk(nk(r,l),""))&&($k(n.path[0],!0)?wk(c.path,n.path[0]):c.host=n.host),u=vD;continue;case _D:if(i==ZO||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&$k(d))u=vD;else if(""==d){if(c.host="",t)return;u=ED}else{if(s=c.parseHost(d))return s;if("localhost"==c.host&&(c.host=""),t)return;d="",u=ED}continue}d+=i;break;case ED:if(c.isSpecial()){if(u=vD,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=ZO&&(u=vD,"/"!=i))continue}else c.fragment="",u=TD;else c.query="",u=bD;break;case vD:if(i==ZO||"/"==i||"\\"==i&&c.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(a=Ok(a=d))||"%2e."===a||".%2e"===a||"%2e%2e"===a?(c.shortenPath(),"/"==i||"\\"==i&&c.isSpecial()||wk(c.path,"")):tD(d)?"/"==i||"\\"==i&&c.isSpecial()||wk(c.path,""):("file"==c.scheme&&!c.path.length&&$k(d)&&(c.host&&(c.host=""),d=vk(d,0)+":"),wk(c.path,d)),d="","file"==c.scheme&&(i==ZO||"?"==i||"#"==i))for(;c.path.length>1&&""===c.path[0];)Ik(c.path);"?"==i?(c.query="",u=bD):"#"==i&&(c.fragment="",u=TD)}else d+=Qk(i,Jk);break;case yD:"?"==i?(c.query="",u=bD):"#"==i?(c.fragment="",u=TD):i!=ZO&&(c.path[0]+=Qk(i,zk));break;case bD:t||"#"!=i?i!=ZO&&("'"==i&&c.isSpecial()?c.query+="%27":c.query+="#"==i?"%23":Qk(i,zk)):(c.fragment="",u=TD);break;case TD:i!=ZO&&(c.fragment+=Qk(i,Yk))}l++}},parseHost:function(e){var t,n,r;if("["==vk(e,0)){if("]"!=vk(e,e.length-1))return Dk;if(t=function(e){var t,n,r,i,o,s,a,c=[0,0,0,0,0,0,0,0],u=0,l=null,d=0,h=function(){return vk(e,d)};if(":"==h()){if(":"!=vk(e,1))return;d+=2,l=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=n=0;n<4&&yk(Vk,h());)t=16*t+gk(h(),16),d++,n++;if("."==h()){if(0==n)return;if(d-=n,u>6)return;for(r=0;h();){if(i=null,r>0){if(!("."==h()&&r<4))return;d++}if(!yk(xk,h()))return;for(;yk(xk,h());){if(o=gk(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;d++}c[u]=256*c[u]+i,2!=++r&&4!=r||u++}if(4!=r)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;c[u++]=t}else{if(null!==l)return;d++,l=++u}}if(null!==l)for(s=u-l,u=7;0!=u&&s>0;)a=c[u],c[u--]=c[l+s-1],c[l+--s]=a;else if(8!=u)return;return c}(Ak(e,1,-1)),!t)return Dk;this.host=t}else if(this.isSpecial()){if(e=ik(e),yk(Bk,e))return Dk;if(t=function(e){var t,n,r,i,o,s,a,c=Ck(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=c[r]))return e;if(o=10,i.length>1&&"0"==vk(i,0)&&(o=yk(Uk,i)?16:8,i=Ak(i,8==o?1:2)),""===i)s=0;else{if(!yk(10==o?jk:8==o?Fk:Vk,i))return e;s=gk(i,o)}wk(n,s)}for(r=0;r<t;r++)if(s=n[r],r==t-1){if(s>=Ek(256,5-t))return null}else if(s>255)return null;for(a=Sk(n),r=0;r<n.length;r++)a+=n[r]*Ek(256,3-r);return a}(e),null===t)return Dk;this.host=t}else{if(yk(Gk,e))return Dk;for(t="",n=tk(e),r=0;r<n.length;r++)t+=Qk(n[r],zk);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return $N(Zk,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&$k(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,s=e.path,a=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=n+(r?":"+r:"")+"@"),u+=Kk(i),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?s[0]:s.length?"/"+bk(s,"/"):"",null!==a&&(u+="?"+a),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw mk(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new wD(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+Kk(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ok(e)+":",nD)},getUsername:function(){return this.username},setUsername:function(e){var t=tk(ok(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Qk(t[n],Xk)}},getPassword:function(){return this.password},setPassword:function(e){var t=tk(ok(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Qk(t[n],Xk)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?Kk(e):Kk(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,hD)},getHostname:function(){var e=this.host;return null===e?"":Kk(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,pD)},getPort:function(){var e=this.port;return null===e?"":ok(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=ok(e))?this.port=null:this.parse(e,fD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+bk(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,ED))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=ok(e))?this.query=null:("?"==vk(e,0)&&(e=Ak(e,1)),this.query="",this.parse(e,bD)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=ok(e))?("#"==vk(e,0)&&(e=Ak(e,1)),this.fragment="",this.parse(e,TD)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var wD=function(e){var t=ZN(this,RD),n=ak(arguments.length,1)>1?arguments[1]:void 0,r=lk(t,new SD(e,!1,n));HN||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},RD=wD.prototype,ID=function(e,t){return{get:function(){return dk(this)[e]()},set:t&&function(e){return dk(this)[t](e)},configurable:!0,enumerable:!0}};if(HN&&(QN(RD,"href",ID("serialize","setHref")),QN(RD,"origin",ID("getOrigin")),QN(RD,"protocol",ID("getProtocol","setProtocol")),QN(RD,"username",ID("getUsername","setUsername")),QN(RD,"password",ID("getPassword","setPassword")),QN(RD,"host",ID("getHost","setHost")),QN(RD,"hostname",ID("getHostname","setHostname")),QN(RD,"port",ID("getPort","setPort")),QN(RD,"pathname",ID("getPathname","setPathname")),QN(RD,"search",ID("getSearch","setSearch")),QN(RD,"searchParams",ID("getSearchParams")),QN(RD,"hash",ID("getHash","setHash"))),XN(RD,"toJSON",(function(){return dk(this).serialize()}),{enumerable:!0}),XN(RD,"toString",(function(){return dk(this).serialize()}),{enumerable:!0}),fk){var CD=fk.createObjectURL,AD=fk.revokeObjectURL;CD&&XN(wD,"createObjectURL",YN(CD,fk)),AD&&XN(wD,"revokeObjectURL",YN(AD,fk))}sk(wD,"URL"),WN({global:!0,constructor:!0,forced:!KN,sham:!HN},{URL:wD});var OD=Nn,ND=i,kD=Zc,DD=_r,PD=sy,LD=ce("URL");OD({target:"URL",stat:!0,forced:!(PD&&ND((function(){LD.canParse()})))},{canParse:function(e){var t=kD(arguments.length,1),n=DD(e),r=t<2||void 0===arguments[1]?void 0:DD(arguments[1]);try{return!!new LD(n,r)}catch(e){return!1}}});var MD=r(re.URL),xD=d,UD=Fb,FD=RegExp.prototype,jD=function(e){return e===FD||xD(FD,e)?UD(e):e.flags},VD=r(jD);function BD(e){let t=e.length;for(;--t>=0;)e[t]=0}const GD=256,qD=286,WD=30,HD=15,KD=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),zD=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),YD=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),JD=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),XD=new Array(576);BD(XD);const QD=new Array(60);BD(QD);const ZD=new Array(512);BD(ZD);const $D=new Array(256);BD($D);const eP=new Array(29);BD(eP);const tP=new Array(WD);function nP(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let rP,iP,oP;function sP(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}BD(tP);const aP=e=>e<256?ZD[e]:ZD[256+(e>>>7)],cP=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},uP=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,cP(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},lP=(e,t,n)=>{uP(e,n[2*t],n[2*t+1])},dP=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},hP=(e,t,n)=>{const r=new Array(16);let i,o,s=0;for(i=1;i<=HD;i++)s=s+n[i-1]<<1,r[i]=s;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=dP(r[t]++,t))}},pP=e=>{let t;for(t=0;t<qD;t++)e.dyn_ltree[2*t]=0;for(t=0;t<WD;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},fP=e=>{e.bi_valid>8?cP(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},mP=(e,t,n,r)=>{const i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]},gP=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&mP(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!mP(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},_P=(e,t,n)=>{let r,i,o,s,a=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+a++],r+=(255&e.pending_buf[e.sym_buf+a++])<<8,i=e.pending_buf[e.sym_buf+a++],0===r?lP(e,i,t):(o=$D[i],lP(e,o+GD+1,t),s=KD[o],0!==s&&(i-=eP[o],uP(e,i,s)),r--,o=aP(r),lP(e,o,n),s=zD[o],0!==s&&(r-=tP[o],uP(e,r,s)))}while(a<e.sym_next);lP(e,256,t)},EP=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let s,a,c,u=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<o;s++)0!==n[2*s]?(e.heap[++e.heap_len]=u=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=u,s=e.heap_len>>1;s>=1;s--)gP(e,n,s);c=o;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],gP(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=a,n[2*c]=n[2*s]+n[2*a],e.depth[c]=(e.depth[s]>=e.depth[a]?e.depth[s]:e.depth[a])+1,n[2*s+1]=n[2*a+1]=c,e.heap[1]=c++,gP(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let u,l,d,h,p,f,m=0;for(h=0;h<=HD;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)l=e.heap[u],h=n[2*n[2*l+1]+1]+1,h>c&&(h=c,m++),n[2*l+1]=h,l>r||(e.bl_count[h]++,p=0,l>=a&&(p=s[l-a]),f=n[2*l],e.opt_len+=f*(h+p),o&&(e.static_len+=f*(i[2*l+1]+p)));if(0!==m){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,m-=2}while(m>0);for(h=c;0!==h;h--)for(l=e.bl_count[h];0!==l;)d=e.heap[--u],d>r||(n[2*d+1]!==h&&(e.opt_len+=(h-n[2*d+1])*n[2*d],n[2*d+1]=h),l--)}})(e,t),hP(n,u,e.bl_count)},vP=(e,t,n)=>{let r,i,o=-1,s=t[1],a=0,c=7,u=4;for(0===s&&(c=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++a<c&&i===s||(a<u?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=i,0===s?(c=138,u=3):i===s?(c=6,u=3):(c=7,u=4))},yP=(e,t,n)=>{let r,i,o=-1,s=t[1],a=0,c=7,u=4;for(0===s&&(c=138,u=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++a<c&&i===s)){if(a<u)do{lP(e,i,e.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(lP(e,i,e.bl_tree),a--),lP(e,16,e.bl_tree),uP(e,a-3,2)):a<=10?(lP(e,17,e.bl_tree),uP(e,a-3,3)):(lP(e,18,e.bl_tree),uP(e,a-11,7));a=0,o=i,0===s?(c=138,u=3):i===s?(c=6,u=3):(c=7,u=4)}};let bP=!1;const TP=(e,t,n,r)=>{uP(e,0+(r?1:0),3),fP(e),cP(e,n),cP(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var SP=e=>{bP||((()=>{let e,t,n,r,i;const o=new Array(16);for(n=0,r=0;r<28;r++)for(eP[r]=n,e=0;e<1<<KD[r];e++)$D[n++]=r;for($D[n-1]=r,i=0,r=0;r<16;r++)for(tP[r]=i,e=0;e<1<<zD[r];e++)ZD[i++]=r;for(i>>=7;r<WD;r++)for(tP[r]=i<<7,e=0;e<1<<zD[r]-7;e++)ZD[256+i++]=r;for(t=0;t<=HD;t++)o[t]=0;for(e=0;e<=143;)XD[2*e+1]=8,e++,o[8]++;for(;e<=255;)XD[2*e+1]=9,e++,o[9]++;for(;e<=279;)XD[2*e+1]=7,e++,o[7]++;for(;e<=287;)XD[2*e+1]=8,e++,o[8]++;for(hP(XD,287,o),e=0;e<WD;e++)QD[2*e+1]=5,QD[2*e]=dP(e,5);rP=new nP(XD,KD,257,qD,HD),iP=new nP(QD,zD,0,WD,HD),oP=new nP(new Array(0),YD,0,19,7)})(),bP=!0),e.l_desc=new sP(e.dyn_ltree,rP),e.d_desc=new sP(e.dyn_dtree,iP),e.bl_desc=new sP(e.bl_tree,oP),e.bi_buf=0,e.bi_valid=0,pP(e)},wP=(e,t,n,r)=>{let i,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<GD;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),EP(e,e.l_desc),EP(e,e.d_desc),s=(e=>{let t;for(vP(e,e.dyn_ltree,e.l_desc.max_code),vP(e,e.dyn_dtree,e.d_desc.max_code),EP(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*JD[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?TP(e,t,n,r):4===e.strategy||o===i?(uP(e,2+(r?1:0),3),_P(e,XD,QD)):(uP(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(uP(e,t-257,5),uP(e,n-1,5),uP(e,r-4,4),i=0;i<r;i++)uP(e,e.bl_tree[2*JD[i]+1],3);yP(e,e.dyn_ltree,t-1),yP(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),_P(e,e.dyn_ltree,e.dyn_dtree)),pP(e),r&&fP(e)},RP=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*($D[n]+GD+1)]++,e.dyn_dtree[2*aP(t)]++),e.sym_next===e.sym_end),IP=e=>{uP(e,2,3),lP(e,256,XD),(e=>{16===e.bi_valid?(cP(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},CP={_tr_init:SP,_tr_stored_block:TP,_tr_flush_block:wP,_tr_tally:RP,_tr_align:IP},AP=(e,t,n,r)=>{let i=65535&e,o=e>>>16&65535,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{i=i+t[r++]|0,o=o+i|0}while(--s);i%=65521,o%=65521}return i|o<<16};const OP=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var NP=(e,t,n,r)=>{const i=OP,o=r+n;e^=-1;for(let s=r;s<o;s++)e=e>>>8^i[255&(e^t[s])];return~e},kP={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},DP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:PP,_tr_stored_block:LP,_tr_flush_block:MP,_tr_tally:xP,_tr_align:UP}=CP,{Z_NO_FLUSH:FP,Z_PARTIAL_FLUSH:jP,Z_FULL_FLUSH:VP,Z_FINISH:BP,Z_BLOCK:GP,Z_OK:qP,Z_STREAM_END:WP,Z_STREAM_ERROR:HP,Z_DATA_ERROR:KP,Z_BUF_ERROR:zP,Z_DEFAULT_COMPRESSION:YP,Z_FILTERED:JP,Z_HUFFMAN_ONLY:XP,Z_RLE:QP,Z_FIXED:ZP,Z_DEFAULT_STRATEGY:$P,Z_UNKNOWN:eL,Z_DEFLATED:tL}=DP,nL=286,rL=30,iL=19,oL=2*nL+1,sL=15,aL=258,cL=262,uL=42,lL=113,dL=666,hL=(e,t)=>(e.msg=kP[t],t),pL=e=>2*e-(e>4?9:0),fL=e=>{let t=e.length;for(;--t>=0;)e[t]=0},mL=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let gL=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const _L=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},EL=(e,t)=>{MP(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_L(e.strm)},vL=(e,t)=>{e.pending_buf[e.pending++]=t},yL=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},bL=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=AP(e.adler,t,i,n):2===e.state.wrap&&(e.adler=NP(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},TL=(e,t)=>{let n,r,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-cL?e.strstart-(e.w_size-cL):0,u=e.window,l=e.w_mask,d=e.prev,h=e.strstart+aL;let p=u[o+s-1],f=u[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(n=t,u[n+s]===f&&u[n+s-1]===p&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<h);if(r=aL-(h-o),o=h-aL,r>s){if(e.match_start=t,s=r,r>=a)break;p=u[o+s-1],f=u[o+s]}}}while((t=d[t&l])>c&&0!=--i);return s<=e.lookahead?s:e.lookahead},SL=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-cL)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),mL(e),r+=t),0===e.strm.avail_in)break;if(n=bL(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=gL(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=gL(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<cL&&0!==e.strm.avail_in)},wL=(e,t)=>{let n,r,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,a=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<o&&(0===n&&t!==BP||t===FP||n!==r+e.strm.avail_in))break;s=t===BP&&n===r+e.strm.avail_in?1:0,LP(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,_L(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(bL(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===s);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==FP&&t!==BP&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(bL(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=o||(r||t===BP)&&t!==FP&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,s=t===BP&&0===e.strm.avail_in&&n===r?1:0,LP(e,e.block_start,n,s),e.block_start+=n,_L(e.strm)),s?3:1)},RL=(e,t)=>{let n,r;for(;;){if(e.lookahead<cL){if(SL(e),e.lookahead<cL&&t===FP)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=gL(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-cL&&(e.match_length=TL(e,n)),e.match_length>=3)if(r=xP(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=gL(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=gL(e,e.ins_h,e.window[e.strstart+1]);else r=xP(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(EL(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===BP?(EL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(EL(e,!1),0===e.strm.avail_out)?1:2},IL=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<cL){if(SL(e),e.lookahead<cL&&t===FP)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=gL(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-cL&&(e.match_length=TL(e,n),e.match_length<=5&&(e.strategy===JP||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=xP(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=gL(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(EL(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=xP(e,0,e.window[e.strstart-1]),r&&EL(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=xP(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===BP?(EL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(EL(e,!1),0===e.strm.avail_out)?1:2};function CL(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const AL=[new CL(0,0,0,0,wL),new CL(4,4,8,4,RL),new CL(4,5,16,8,RL),new CL(4,6,32,32,RL),new CL(4,4,16,16,IL),new CL(8,16,32,32,IL),new CL(8,16,128,128,IL),new CL(8,32,128,256,IL),new CL(32,128,258,1024,IL),new CL(32,258,258,4096,IL)];function OL(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=tL,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*oL),this.dyn_dtree=new Uint16Array(2*(2*rL+1)),this.bl_tree=new Uint16Array(2*(2*iL+1)),fL(this.dyn_ltree),fL(this.dyn_dtree),fL(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(sL+1),this.heap=new Uint16Array(2*nL+1),fL(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*nL+1),fL(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const NL=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==uL&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==lL&&t.status!==dL?1:0},kL=e=>{if(NL(e))return hL(e,HP);e.total_in=e.total_out=0,e.data_type=eL;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?uL:lL,e.adler=2===t.wrap?0:1,t.last_flush=-2,PP(t),qP},DL=e=>{const t=kL(e);return t===qP&&(e=>{e.window_size=2*e.w_size,fL(e.head),e.max_lazy_match=AL[e.level].max_lazy,e.good_match=AL[e.level].good_length,e.nice_match=AL[e.level].nice_length,e.max_chain_length=AL[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},PL=(e,t,n,r,i,o)=>{if(!e)return HP;let s=1;if(t===YP&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||n!==tL||r<8||r>15||t<0||t>9||o<0||o>ZP||8===r&&1!==s)return hL(e,HP);8===r&&(r=9);const a=new OL;return e.state=a,a.strm=e,a.status=uL,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=n,DL(e)};var LL=(e,t)=>{if(NL(e)||t>GP||t<0)return e?hL(e,HP):HP;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===dL&&t!==BP)return hL(e,0===e.avail_out?zP:HP);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(_L(e),0===e.avail_out)return n.last_flush=-1,qP}else if(0===e.avail_in&&pL(t)<=pL(r)&&t!==BP)return hL(e,zP);if(n.status===dL&&0!==e.avail_in)return hL(e,zP);if(n.status===uL&&0===n.wrap&&(n.status=lL),n.status===uL){let t=tL+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=XP||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,yL(n,t),0!==n.strstart&&(yL(n,e.adler>>>16),yL(n,65535&e.adler)),e.adler=1,n.status=lL,_L(e),0!==n.pending)return n.last_flush=-1,qP}if(57===n.status)if(e.adler=0,vL(n,31),vL(n,139),vL(n,8),n.gzhead)vL(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),vL(n,255&n.gzhead.time),vL(n,n.gzhead.time>>8&255),vL(n,n.gzhead.time>>16&255),vL(n,n.gzhead.time>>24&255),vL(n,9===n.level?2:n.strategy>=XP||n.level<2?4:0),vL(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(vL(n,255&n.gzhead.extra.length),vL(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=NP(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(vL(n,0),vL(n,0),vL(n,0),vL(n,0),vL(n,0),vL(n,9===n.level?2:n.strategy>=XP||n.level<2?4:0),vL(n,3),n.status=lL,_L(e),0!==n.pending)return n.last_flush=-1,qP;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=NP(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,_L(e),0!==n.pending)return n.last_flush=-1,qP;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=NP(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=NP(e.adler,n.pending_buf,n.pending-r,r)),_L(e),0!==n.pending)return n.last_flush=-1,qP;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,vL(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=NP(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=NP(e.adler,n.pending_buf,n.pending-r,r)),_L(e),0!==n.pending)return n.last_flush=-1,qP;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,vL(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=NP(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(_L(e),0!==n.pending))return n.last_flush=-1,qP;vL(n,255&e.adler),vL(n,e.adler>>8&255),e.adler=0}if(n.status=lL,_L(e),0!==n.pending)return n.last_flush=-1,qP}if(0!==e.avail_in||0!==n.lookahead||t!==FP&&n.status!==dL){let r=0===n.level?wL(n,t):n.strategy===XP?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(SL(e),0===e.lookahead)){if(t===FP)return 1;break}if(e.match_length=0,n=xP(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(EL(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===BP?(EL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(EL(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===QP?((e,t)=>{let n,r,i,o;const s=e.window;for(;;){if(e.lookahead<=aL){if(SL(e),e.lookahead<=aL&&t===FP)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){o=e.strstart+aL;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=aL-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=xP(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=xP(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(EL(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===BP?(EL(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(EL(e,!1),0===e.strm.avail_out)?1:2})(n,t):AL[n.level].func(n,t);if(3!==r&&4!==r||(n.status=dL),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),qP;if(2===r&&(t===jP?UP(n):t!==GP&&(LP(n,0,0,!1),t===VP&&(fL(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),_L(e),0===e.avail_out))return n.last_flush=-1,qP}return t!==BP?qP:n.wrap<=0?WP:(2===n.wrap?(vL(n,255&e.adler),vL(n,e.adler>>8&255),vL(n,e.adler>>16&255),vL(n,e.adler>>24&255),vL(n,255&e.total_in),vL(n,e.total_in>>8&255),vL(n,e.total_in>>16&255),vL(n,e.total_in>>24&255)):(yL(n,e.adler>>>16),yL(n,65535&e.adler)),_L(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?qP:WP)},ML=(e,t)=>{let n=t.length;if(NL(e))return HP;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==uL||r.lookahead)return HP;if(1===i&&(e.adler=AP(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(fL(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const o=e.avail_in,s=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,SL(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=gL(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,SL(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=a,e.avail_in=o,r.wrap=i,qP},xL={deflateInit:(e,t)=>PL(e,t,tL,15,8,$P),deflateInit2:PL,deflateReset:DL,deflateResetKeep:kL,deflateSetHeader:(e,t)=>NL(e)||2!==e.state.wrap?HP:(e.state.gzhead=t,qP),deflate:LL,deflateEnd:e=>{if(NL(e))return HP;const t=e.state.status;return e.state=null,t===lL?hL(e,KP):qP},deflateSetDictionary:ML,deflateInfo:"pako deflate (from Nodeca project)"};const UL=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var FL={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)UL(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,i=0,o=e.length;r<o;r++){let t=e[r];n.set(t,i),i+=t.length}return n}};let jL=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){jL=!1}const VL=new Uint8Array(256);for(let n=0;n<256;n++)VL[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;VL[254]=VL[254]=1;var BL={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,o,s=e.length,a=0;for(i=0;i<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),o=0,i=0;o<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const o=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){o[i++]=t;continue}let s=VL[t];if(s>4)o[i++]=65533,r+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&r<n;)t=t<<6|63&e[r++],s--;s>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&jL)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+VL[e[n]]>t?n:t}},GL=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const qL=Object.prototype.toString,{Z_NO_FLUSH:WL,Z_SYNC_FLUSH:HL,Z_FULL_FLUSH:KL,Z_FINISH:zL,Z_OK:YL,Z_STREAM_END:JL,Z_DEFAULT_COMPRESSION:XL,Z_DEFAULT_STRATEGY:QL,Z_DEFLATED:ZL}=DP;function $L(e){this.options=FL.assign({level:XL,method:ZL,chunkSize:16384,windowBits:15,memLevel:8,strategy:QL},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new GL,this.strm.avail_out=0;let n=xL.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==YL)throw new Error(kP[n]);if(t.header&&xL.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?BL.string2buf(t.dictionary):"[object ArrayBuffer]"===qL.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=xL.deflateSetDictionary(this.strm,e),n!==YL)throw new Error(kP[n]);this._dict_set=!0}}function eM(e,t){const n=new $L(t);if(n.push(e,!0),n.err)throw n.msg||kP[n.err];return n.result}$L.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?zL:WL,"string"==typeof e?n.input=BL.string2buf(e):"[object ArrayBuffer]"===qL.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(o===HL||o===KL)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=xL.deflate(n,o),i===JL)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=xL.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===YL;if(0!==n.avail_out){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},$L.prototype.onData=function(e){this.chunks.push(e)},$L.prototype.onEnd=function(e){e===YL&&(this.result=FL.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var tM={Deflate:$L,deflate:eM,deflateRaw:function(e,t){return(t=t||{}).raw=!0,eM(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,eM(e,t)},constants:DP};const nM=16209;var rM=function(e,t){let n,r,i,o,s,a,c,u,l,d,h,p,f,m,g,_,E,v,y,b,T,S,w,R;const I=e.state;n=e.next_in,w=e.input,r=n+(e.avail_in-5),i=e.next_out,R=e.output,o=i-(t-e.avail_out),s=i+(e.avail_out-257),a=I.dmax,c=I.wsize,u=I.whave,l=I.wnext,d=I.window,h=I.hold,p=I.bits,f=I.lencode,m=I.distcode,g=(1<<I.lenbits)-1,_=(1<<I.distbits)-1;e:do{p<15&&(h+=w[n++]<<p,p+=8,h+=w[n++]<<p,p+=8),E=f[h&g];t:for(;;){if(v=E>>>24,h>>>=v,p-=v,v=E>>>16&255,0===v)R[i++]=65535&E;else{if(!(16&v)){if(0==(64&v)){E=f[(65535&E)+(h&(1<<v)-1)];continue t}if(32&v){I.mode=16191;break e}e.msg="invalid literal/length code",I.mode=nM;break e}y=65535&E,v&=15,v&&(p<v&&(h+=w[n++]<<p,p+=8),y+=h&(1<<v)-1,h>>>=v,p-=v),p<15&&(h+=w[n++]<<p,p+=8,h+=w[n++]<<p,p+=8),E=m[h&_];n:for(;;){if(v=E>>>24,h>>>=v,p-=v,v=E>>>16&255,!(16&v)){if(0==(64&v)){E=m[(65535&E)+(h&(1<<v)-1)];continue n}e.msg="invalid distance code",I.mode=nM;break e}if(b=65535&E,v&=15,p<v&&(h+=w[n++]<<p,p+=8,p<v&&(h+=w[n++]<<p,p+=8)),b+=h&(1<<v)-1,b>a){e.msg="invalid distance too far back",I.mode=nM;break e}if(h>>>=v,p-=v,v=i-o,b>v){if(v=b-v,v>u&&I.sane){e.msg="invalid distance too far back",I.mode=nM;break e}if(T=0,S=d,0===l){if(T+=c-v,v<y){y-=v;do{R[i++]=d[T++]}while(--v);T=i-b,S=R}}else if(l<v){if(T+=c+l-v,v-=l,v<y){y-=v;do{R[i++]=d[T++]}while(--v);if(T=0,l<y){v=l,y-=v;do{R[i++]=d[T++]}while(--v);T=i-b,S=R}}}else if(T+=l-v,v<y){y-=v;do{R[i++]=d[T++]}while(--v);T=i-b,S=R}for(;y>2;)R[i++]=S[T++],R[i++]=S[T++],R[i++]=S[T++],y-=3;y&&(R[i++]=S[T++],y>1&&(R[i++]=S[T++]))}else{T=i-b;do{R[i++]=R[T++],R[i++]=R[T++],R[i++]=R[T++],y-=3}while(y>2);y&&(R[i++]=R[T++],y>1&&(R[i++]=R[T++]))}break}}break}}while(n<r&&i<s);y=p>>3,n-=y,p-=y<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<s?s-i+257:257-(i-s),I.hold=h,I.bits=p};const iM=15,oM=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),sM=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),aM=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),cM=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var uM=(e,t,n,r,i,o,s,a)=>{const c=a.bits;let u,l,d,h,p,f,m=0,g=0,_=0,E=0,v=0,y=0,b=0,T=0,S=0,w=0,R=null;const I=new Uint16Array(16),C=new Uint16Array(16);let A,O,N,k=null;for(m=0;m<=iM;m++)I[m]=0;for(g=0;g<r;g++)I[t[n+g]]++;for(v=c,E=iM;E>=1&&0===I[E];E--);if(v>E&&(v=E),0===E)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(_=1;_<E&&0===I[_];_++);for(v<_&&(v=_),T=1,m=1;m<=iM;m++)if(T<<=1,T-=I[m],T<0)return-1;if(T>0&&(0===e||1!==E))return-1;for(C[1]=0,m=1;m<iM;m++)C[m+1]=C[m]+I[m];for(g=0;g<r;g++)0!==t[n+g]&&(s[C[t[n+g]]++]=g);if(0===e?(R=k=s,f=20):1===e?(R=oM,k=sM,f=257):(R=aM,k=cM,f=0),w=0,g=0,m=_,p=o,y=v,b=0,d=-1,S=1<<v,h=S-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){A=m-b,s[g]+1<f?(O=0,N=s[g]):s[g]>=f?(O=k[s[g]-f],N=R[s[g]-f]):(O=96,N=0),u=1<<m-b,l=1<<y,_=l;do{l-=u,i[p+(w>>b)+l]=A<<24|O<<16|N}while(0!==l);for(u=1<<m-1;w&u;)u>>=1;if(0!==u?(w&=u-1,w+=u):w=0,g++,0==--I[m]){if(m===E)break;m=t[n+s[g]]}if(m>v&&(w&h)!==d){for(0===b&&(b=v),p+=_,y=m-b,T=1<<y;y+b<E&&(T-=I[y+b],!(T<=0));)y++,T<<=1;if(S+=1<<y,1===e&&S>852||2===e&&S>592)return 1;d=w&h,i[d]=v<<24|y<<16|p-o}}return 0!==w&&(i[p+w]=m-b<<24|64<<16),a.bits=v,0};const{Z_FINISH:lM,Z_BLOCK:dM,Z_TREES:hM,Z_OK:pM,Z_STREAM_END:fM,Z_NEED_DICT:mM,Z_STREAM_ERROR:gM,Z_DATA_ERROR:_M,Z_MEM_ERROR:EM,Z_BUF_ERROR:vM,Z_DEFLATED:yM}=DP,bM=16180,TM=16190,SM=16191,wM=16192,RM=16194,IM=16199,CM=16200,AM=16206,OM=16209,NM=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function kM(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const DM=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<bM||t.mode>16211?1:0},PM=e=>{if(DM(e))return gM;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=bM,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,pM},LM=e=>{if(DM(e))return gM;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,PM(e)},MM=(e,t)=>{let n;if(DM(e))return gM;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?gM:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,LM(e))},xM=(e,t)=>{if(!e)return gM;const n=new kM;e.state=n,n.strm=e,n.window=null,n.mode=bM;const r=MM(e,t);return r!==pM&&(e.state=null),r};let UM,FM,jM=!0;const VM=e=>{if(jM){UM=new Int32Array(512),FM=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(uM(1,e.lens,0,288,UM,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;uM(2,e.lens,0,32,FM,0,e.work,{bits:5}),jM=!1}e.lencode=UM,e.lenbits=9,e.distcode=FM,e.distbits=5},BM=(e,t,n,r)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),o.window.set(t.subarray(n-r,n-r+i),o.wnext),(r-=i)?(o.window.set(t.subarray(n-r,n),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var GM=(e,t)=>{let n,r,i,o,s,a,c,u,l,d,h,p,f,m,g,_,E,v,y,b,T,S,w=0;const R=new Uint8Array(4);let I,C;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(DM(e)||!e.output||!e.input&&0!==e.avail_in)return gM;n=e.state,n.mode===SM&&(n.mode=wM),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,u=n.hold,l=n.bits,d=a,h=c,S=pM;e:for(;;)switch(n.mode){case bM:if(0===n.wrap){n.mode=wM;break}for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if(2&n.wrap&&35615===u){0===n.wbits&&(n.wbits=15),n.check=0,R[0]=255&u,R[1]=u>>>8&255,n.check=NP(n.check,R,2,0),u=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=OM;break}if((15&u)!==yM){e.msg="unknown compression method",n.mode=OM;break}if(u>>>=4,l-=4,T=8+(15&u),0===n.wbits&&(n.wbits=T),T>15||T>n.wbits){e.msg="invalid window size",n.mode=OM;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:SM,u=0,l=0;break;case 16181:for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if(n.flags=u,(255&VD(n))!==yM){e.msg="unknown compression method",n.mode=OM;break}if(57344&VD(n)){e.msg="unknown header flags set",n.mode=OM;break}n.head&&(n.head.text=u>>8&1),512&VD(n)&&4&n.wrap&&(R[0]=255&u,R[1]=u>>>8&255,n.check=NP(n.check,R,2,0)),u=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}n.head&&(n.head.time=u),512&VD(n)&&4&n.wrap&&(R[0]=255&u,R[1]=u>>>8&255,R[2]=u>>>16&255,R[3]=u>>>24&255,n.check=NP(n.check,R,4,0)),u=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&VD(n)&&4&n.wrap&&(R[0]=255&u,R[1]=u>>>8&255,n.check=NP(n.check,R,2,0)),u=0,l=0,n.mode=16184;case 16184:if(1024&VD(n)){for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&VD(n)&&4&n.wrap&&(R[0]=255&u,R[1]=u>>>8&255,n.check=NP(n.check,R,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&VD(n)&&(p=n.length,p>a&&(p=a),p&&(n.head&&(T=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(o,o+p),T)),512&VD(n)&&4&n.wrap&&(n.check=NP(n.check,r,p,o)),a-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&VD(n)){if(0===a)break e;p=0;do{T=r[o+p++],n.head&&T&&n.length<65536&&(n.head.name+=String.fromCharCode(T))}while(T&&p<a);if(512&VD(n)&&4&n.wrap&&(n.check=NP(n.check,r,p,o)),a-=p,o+=p,T)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&VD(n)){if(0===a)break e;p=0;do{T=r[o+p++],n.head&&T&&n.length<65536&&(n.head.comment+=String.fromCharCode(T))}while(T&&p<a);if(512&VD(n)&&4&n.wrap&&(n.check=NP(n.check,r,p,o)),a-=p,o+=p,T)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&VD(n)){for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=OM;break}u=0,l=0}n.head&&(n.head.hcrc=VD(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=SM;break;case 16189:for(;l<32;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}e.adler=n.check=NM(u),u=0,l=0,n.mode=TM;case TM:if(0===n.havedict)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=u,n.bits=l,mM;e.adler=n.check=1,n.mode=SM;case SM:if(t===dM||t===hM)break e;case wM:if(n.last){u>>>=7&l,l-=7&l,n.mode=AM;break}for(;l<3;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}switch(n.last=1&u,u>>>=1,l-=1,3&u){case 0:n.mode=16193;break;case 1:if(VM(n),n.mode=IM,t===hM){u>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=OM}u>>>=2,l-=2;break;case 16193:for(u>>>=7&l,l-=7&l;l<32;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=OM;break}if(n.length=65535&u,u=0,l=0,n.mode=RM,t===hM)break e;case RM:n.mode=16195;case 16195:if(p=n.length,p){if(p>a&&(p=a),p>c&&(p=c),0===p)break e;i.set(r.subarray(o,o+p),s),a-=p,o+=p,c-=p,s+=p,n.length-=p;break}n.mode=SM;break;case 16196:for(;l<14;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=OM;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}n.lens[A[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[A[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,I={bits:n.lenbits},S=uM(0,n.lens,0,19,n.lencode,0,n.work,I),n.lenbits=I.bits,S){e.msg="invalid code lengths set",n.mode=OM;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;w=n.lencode[u&(1<<n.lenbits)-1],g=w>>>24,_=w>>>16&255,E=65535&w,!(g<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if(E<16)u>>>=g,l-=g,n.lens[n.have++]=E;else{if(16===E){for(C=g+2;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if(u>>>=g,l-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=OM;break}T=n.lens[n.have-1],p=3+(3&u),u>>>=2,l-=2}else if(17===E){for(C=g+3;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}u>>>=g,l-=g,T=0,p=3+(7&u),u>>>=3,l-=3}else{for(C=g+7;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}u>>>=g,l-=g,T=0,p=11+(127&u),u>>>=7,l-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=OM;break}for(;p--;)n.lens[n.have++]=T}}if(n.mode===OM)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=OM;break}if(n.lenbits=9,I={bits:n.lenbits},S=uM(1,n.lens,0,n.nlen,n.lencode,0,n.work,I),n.lenbits=I.bits,S){e.msg="invalid literal/lengths set",n.mode=OM;break}if(n.distbits=6,n.distcode=n.distdyn,I={bits:n.distbits},S=uM(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,I),n.distbits=I.bits,S){e.msg="invalid distances set",n.mode=OM;break}if(n.mode=IM,t===hM)break e;case IM:n.mode=CM;case CM:if(a>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=u,n.bits=l,rM(e,h),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,u=n.hold,l=n.bits,n.mode===SM&&(n.back=-1);break}for(n.back=0;w=n.lencode[u&(1<<n.lenbits)-1],g=w>>>24,_=w>>>16&255,E=65535&w,!(g<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if(_&&0==(240&_)){for(v=g,y=_,b=E;w=n.lencode[b+((u&(1<<v+y)-1)>>v)],g=w>>>24,_=w>>>16&255,E=65535&w,!(v+g<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}u>>>=v,l-=v,n.back+=v}if(u>>>=g,l-=g,n.back+=g,n.length=E,0===_){n.mode=16205;break}if(32&_){n.back=-1,n.mode=SM;break}if(64&_){e.msg="invalid literal/length code",n.mode=OM;break}n.extra=15&_,n.mode=16201;case 16201:if(n.extra){for(C=n.extra;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;w=n.distcode[u&(1<<n.distbits)-1],g=w>>>24,_=w>>>16&255,E=65535&w,!(g<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if(0==(240&_)){for(v=g,y=_,b=E;w=n.distcode[b+((u&(1<<v+y)-1)>>v)],g=w>>>24,_=w>>>16&255,E=65535&w,!(v+g<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}u>>>=v,l-=v,n.back+=v}if(u>>>=g,l-=g,n.back+=g,64&_){e.msg="invalid distance code",n.mode=OM;break}n.offset=E,n.extra=15&_,n.mode=16203;case 16203:if(n.extra){for(C=n.extra;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=OM;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=OM;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=i,f=s-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{i[s++]=m[f++]}while(--p);0===n.length&&(n.mode=CM);break;case 16205:if(0===c)break e;i[s++]=n.length,c--,n.mode=CM;break;case AM:if(n.wrap){for(;l<32;){if(0===a)break e;a--,u|=r[o++]<<l,l+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=VD(n)?NP(n.check,i,h,s-h):AP(n.check,i,h,s-h)),h=c,4&n.wrap&&(VD(n)?u:NM(u))!==n.check){e.msg="incorrect data check",n.mode=OM;break}u=0,l=0}n.mode=16207;case 16207:if(n.wrap&&VD(n)){for(;l<32;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=OM;break}u=0,l=0}n.mode=16208;case 16208:S=fM;break e;case OM:S=_M;break e;case 16210:return EM;default:return gM}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=u,n.bits=l,(n.wsize||h!==e.avail_out&&n.mode<OM&&(n.mode<AM||t!==lM))&&BM(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=VD(n)?NP(n.check,i,h,e.next_out-h):AP(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===SM?128:0)+(n.mode===IM||n.mode===RM?256:0),(0===d&&0===h||t===lM)&&S===pM&&(S=vM),S},qM={inflateReset:LM,inflateReset2:MM,inflateResetKeep:PM,inflateInit:e=>xM(e,15),inflateInit2:xM,inflate:GM,inflateEnd:e=>{if(DM(e))return gM;let t=e.state;return t.window&&(t.window=null),e.state=null,pM},inflateGetHeader:(e,t)=>{if(DM(e))return gM;const n=e.state;return 0==(2&n.wrap)?gM:(n.head=t,t.done=!1,pM)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,o;return DM(e)?gM:(r=e.state,0!==r.wrap&&r.mode!==TM?gM:r.mode===TM&&(i=1,i=AP(i,t,n,0),i!==r.check)?_M:(o=BM(e,t,n,n),o?(r.mode=16210,EM):(r.havedict=1,pM)))},inflateInfo:"pako inflate (from Nodeca project)"},WM=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const HM=Object.prototype.toString,{Z_NO_FLUSH:KM,Z_FINISH:zM,Z_OK:YM,Z_STREAM_END:JM,Z_NEED_DICT:XM,Z_STREAM_ERROR:QM,Z_DATA_ERROR:ZM,Z_MEM_ERROR:$M}=DP;function ex(e){this.options=FL.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new GL,this.strm.avail_out=0;let n=qM.inflateInit2(this.strm,t.windowBits);if(n!==YM)throw new Error(kP[n]);if(this.header=new WM,qM.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=BL.string2buf(t.dictionary):"[object ArrayBuffer]"===HM.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=qM.inflateSetDictionary(this.strm,t.dictionary),n!==YM)))throw new Error(kP[n])}function tx(e,t){const n=new ex(t);if(n.push(e),n.err)throw n.msg||kP[n.err];return n.result}ex.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let o,s,a;if(this.ended)return!1;for(s=t===~~t?t:!0===t?zM:KM,"[object ArrayBuffer]"===HM.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),o=qM.inflate(n,s),o===XM&&i&&(o=qM.inflateSetDictionary(n,i),o===YM?o=qM.inflate(n,s):o===ZM&&(o=XM));n.avail_in>0&&o===JM&&n.state.wrap>0&&0!==e[n.next_in];)qM.inflateReset(n),o=qM.inflate(n,s);switch(o){case QM:case ZM:case XM:case $M:return this.onEnd(o),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||o===JM))if("string"===this.options.to){let e=BL.utf8border(n.output,n.next_out),t=n.next_out-e,i=BL.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==YM||0!==a){if(o===JM)return o=qM.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},ex.prototype.onData=function(e){this.chunks.push(e)},ex.prototype.onEnd=function(e){e===YM&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=FL.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var nx={Inflate:ex,inflate:tx,inflateRaw:function(e,t){return(t=t||{}).raw=!0,tx(e,t)},ungzip:tx,constants:DP};const{Deflate:rx,deflate:ix,deflateRaw:ox,gzip:sx}=tM,{Inflate:ax,inflate:cx,inflateRaw:ux,ungzip:lx}=nx;var dx=ix,hx=cx;const px={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function fx(){return px}function mx(){return"setSinkId"in HTMLAudioElement.prototype&&(!kR("RESTRICTION_SET_PLAYBACK_DEVICE")||(OS()||kS())&&!YS())}let gx=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function _x(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Ex(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function vx(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function yx(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const bx={"90p":Ex(160,90),"90p_1":Ex(160,90),"120p":Ex(160,120,15,30,65),"120p_1":Ex(160,120,15,30,65),"120p_3":Ex(120,120,15,30,50),"120p_4":Ex(212,120),"180p":Ex(320,180,15,30,140),"180p_1":Ex(320,180,15,30,140),"180p_3":Ex(180,180,15,30,100),"180p_4":Ex(240,180,15,30,120),"240p":Ex(320,240,15,40,200),"240p_1":Ex(320,240,15,40,200),"240p_3":Ex(240,240,15,40,140),"240p_4":Ex(424,240,15,40,220),"360p":Ex(640,360,15,80,400),"360p_1":Ex(640,360,15,80,400),"360p_3":Ex(360,360,15,80,260),"360p_4":Ex(640,360,30,80,600),"360p_6":Ex(360,360,30,80,400),"360p_7":Ex(480,360,15,80,320),"360p_8":Ex(480,360,30,80,490),"360p_9":Ex(640,360,15,80,800),"360p_10":Ex(640,360,24,80,800),"360p_11":Ex(640,360,24,80,1e3),"480p":Ex(640,480,15,100,500),"480p_1":Ex(640,480,15,100,500),"480p_2":Ex(640,480,30,100,1e3),"480p_3":Ex(480,480,15,100,400),"480p_4":Ex(640,480,30,100,750),"480p_6":Ex(480,480,30,100,600),"480p_8":Ex(848,480,15,100,610),"480p_9":Ex(848,480,30,100,930),"480p_10":Ex(640,480,10,100,400),"720p":Ex(1280,720,15,120,1130),"720p_auto":Ex(1280,720,30,900,3e3),"720p_1":Ex(1280,720,15,120,1130),"720p_2":Ex(1280,720,30,120,2e3),"720p_3":Ex(1280,720,30,120,1710),"720p_5":Ex(960,720,15,120,910),"720p_6":Ex(960,720,30,120,1380),"1080p":Ex(1920,1080,15,120,2080),"1080p_1":Ex(1920,1080,15,120,2080),"1080p_2":Ex(1920,1080,30,120,3e3),"1080p_3":Ex(1920,1080,30,120,3150),"1080p_5":Ex(1920,1080,60,120,4780),"1440p":Ex(2560,1440,30,120,4850),"1440p_1":Ex(2560,1440,30,120,4850),"1440p_2":Ex(2560,1440,60,120,7350),"4k":Ex(3840,2160,30,120,8910),"4k_1":Ex(3840,2160,30,120,8910),"4k_3":Ex(3840,2160,60,120,13500)},Tx=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],Sx={"480p":vx(640,480,5),"480p_1":vx(640,480,5),"480p_2":vx(640,480,30),"480p_3":vx(640,480,15),"720p":vx(1280,720,5),"720p_auto":Ex(1280,720,30,900,3e3),"720p_1":vx(1280,720,5),"720p_2":vx(1280,720,30),"720p_3":vx(1280,720,15),"1080p":vx(1920,1080,5),"1080p_1":vx(1920,1080,5),"1080p_2":vx(1920,1080,30),"1080p_3":vx(1920,1080,15)},wx={"1SL1TL":yx(1,1),"3SL3TL":yx(3,3),"2SL3TL":yx(2,3)};function Rx(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},bx[e]):e}function Ix(e){return"string"==typeof e?Object.assign({},Sx[e]):e}function Cx(e){return"string"==typeof e?Object.assign({},wx[e]):e}const Ax={speech_low_quality:_x(16e3,!1),speech_standard:_x(32e3,!1,18),music_standard:_x(48e3,!1),standard_stereo:_x(48e3,!0,56),high_quality:_x(48e3,!1,128),high_quality_stereo:_x(48e3,!0,192)};function Ox(e){return"string"==typeof e?Object.assign({},Ax[e]):e}const Nx=[];function kx(e){return iw(e,"mediaSource",["screen","window","application"]),!0}let Dx=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Px=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),Lx=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Mx=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),xx=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),Ux=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Fx=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),jx=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Vx=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const Bx={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Gx={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},qx={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Wx={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Hx={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Kx=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),zx=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Yx=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Jx=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Xx=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Qx=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const Zx={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let $x=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function eU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eU(Object(n),!0).forEach((function(t){nU(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eU(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nU(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rU(e,t,n,r,i){var o,s,a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=Xr(o=$O(s=n.slice()).call(s)).call(o,(function(n,r){return r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}class iU extends vw{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Ux.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),nU(this,"trackMediaType",void 0),nU(this,"_ID",void 0),nU(this,"_rtpTransceiver",void 0),nU(this,"_lowRtpTransceiver",void 0),nU(this,"_hints",[]),nU(this,"_isClosed",!1),nU(this,"_originMediaStreamTrack",void 0),nU(this,"mediaStreamTrack",void 0),nU(this,"_external",{}),this._ID=t||eR(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){Dr(Nx).call(Nx,e)||Nx.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Hw((()=>{var e;oI.reportApiInvoke(null,{name:Tw.GET_MEDIA_STREAM_TRACK,options:[],tag:Sw.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Lx.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=Nx.indexOf(e);-1!==t&&Nx.splice(t,1)}(this),this.emit(Fx.CLOSED),this.removeAllListeners(Ux.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===Lx.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Ux.TRANSCEIVER_UPDATED,e,t)}}class oU extends iU{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),nU(this,"_enabled",!0),nU(this,"_muted",!1),nU(this,"_isExternalTrack",!1),nU(this,"_isClosed",!1),nU(this,"_enabledMutex",void 0),nU(this,"processor",void 0),nU(this,"_processorContext",void 0),nU(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new hR("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,QR.debug("[".concat(this.getTrackId(),"] close")),this.emit(Dx.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Mw(this,Dx.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){QR.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Fx.TRACK_ENDED)}stateCheck(e,t){if(QR.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),rw(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new nw(tw.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",QR);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new nw(tw.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",QR)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Gh.resolve([])}}const sU=window.AudioContext||window.webkitAudioContext;let aU=null;const cU=new class extends vw{constructor(){super(...arguments),nU(this,"prevState",void 0),nU(this,"curState",void 0),nU(this,"currentTime",void 0),nU(this,"currentTimeStuckAt",void 0),nU(this,"interruptDetectorTrack",void 0),nU(this,"onLocalAudioTrackMute",(()=>{QR.info("ios15-interruption-start"),this.emit(gx.IOS_15_16_INTERRUPTION_START)})),nU(this,"onLocalAudioTrackUnmute",(async()=>{QR.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?QR.info("ios15-interruption-end-canceled"):(aU&&await aU.suspend(),this.emit(gx.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){QR.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){QR.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function uU(){if(!aU){if(function(){if(!sU)return void QR.error("your browser is not support web audio");QR.info("create audio context");const e=tU({},kR("WEBAUDIO_INIT_OPTIONS"));QR.debug("audio context init option:",JSON.stringify(e)),aU=new sU(e),cU.curState=aU.state,aU.onstatechange=()=>{cU.prevState=cU.curState,cU.curState=aU?aU.state:void 0;const{prevState:e,curState:t}=cU,n="running"===t,r="interrupted"===t,i="running"===e,o="suspended"===e,s="interrupted"===e,a=wS().osVersion;(PS()||HS())&&i&&r&&(QR.info("ios".concat(a,"-interruption-start")),cU.emit(gx.IOS_INTERRUPTION_START)),(PS()||HS())&&(o||s)&&n&&(QR.info("ios".concat(a,"-interruption-end")),cU.emit(gx.IOS_INTERRUPTION_END)),e!==t&&cU.emit(gx.STATE_CHANGE,t,e)},setInterval((()=>{var e;const t=null===(e=aU)||void 0===e?void 0:e.currentTime;cU.currentTime!==t?(cU.currentTimeStuckAt&&(QR.debug("AudioContext current time resume at ".concat(t)),cU.currentTimeStuckAt=void 0),cU.currentTime=t):(t!==cU.currentTimeStuckAt&&(oI.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:Sw.TRACER}).onSuccess(),QR.warning("AudioContext current time stuck at ".concat(t))),cU.currentTimeStuckAt=t)}),5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,r=!1,i=!1,o=!1;function s(t){"running"===e.state?a(!1):PS()||HS()?"suspended"===e.state&&(a(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(a(!0),t&&e.resume().then(c,c))}function a(e){if(r!==e){r=e;for(let n=0,r=t;n<r.length;n+=1){const t=r[n];e?window.addEventListener(t,u,{capture:!0,passive:!0}):window.removeEventListener(t,u,{capture:!0,passive:!0})}}}function c(){s(!1)}function u(){s(!0)}function l(e){if(!o)if(n.paused)if(e){let t;d(!1),o=!0;try{t=n.play(),t?t.then(h,h):(n.addEventListener("playing",h),n.addEventListener("abort",h),n.addEventListener("error",h))}catch(e){h()}}else d(!0);else d(!1)}function d(e){if(i!==e){i=e;for(let n=0,r=t;n<r.length;n++){const t=r[n];e?window.addEventListener(t,p,{capture:!0,passive:!0}):window.removeEventListener(t,p,{capture:!0,passive:!0})}}}function h(){n.removeEventListener("playing",h),n.removeEventListener("abort",h),n.removeEventListener("error",h),o=!1,l(!1)}function p(){l(!0)}if(PS()){const t=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=r.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,l(!0)}cU.on(gx.STATE_CHANGE,(function(){s(!0)})),s(!1)}(aU)}(),!aU)throw new nw(tw.NOT_SUPPORTED,"can not create audio context");return aU}return aU}function lU(e){if(function(){if(null!==dU)return dU;const e=uU(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),dU=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var o;return e._inputNodes||(e._inputNodes=[]),Dr(o=e._inputNodes).call(o,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,o)=>{n.call(e),r?jw(e._inputNodes,r):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let dU=null;function hU(e,t){let n=!1;const r=1/t;if(kR("DISABLE_WEBAUDIO")){const t=window.setInterval((()=>{n?window.clearInterval(t):e(performance.now()/1e3)}),1e3*r)}else{const t=uU();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const o=()=>{if(n)return void(i=null);const s=t.createOscillator();s.onended=o,s.connect(i),s.start(0),s.stop(t.currentTime+r),e(t.currentTime)};o()}return()=>{n=!0}}class pU{constructor(){nU(this,"context",void 0),nU(this,"analyserNode",void 0),nU(this,"sourceNode",void 0),this.context=uU(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||PS()||HS()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=Xr(e).call(e,((e,t)=>e+t*t),0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){QR.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class fU extends vw{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),nU(this,"outputNode",void 0),nU(this,"outputTrack",void 0),nU(this,"isPlayed",!1),nU(this,"sourceNode",void 0),nU(this,"context",void 0),nU(this,"audioBufferNode",void 0),nU(this,"destNode",void 0),nU(this,"audioOutputLevel",0),nU(this,"volumeLevelAnalyser",void 0),nU(this,"_processedNode",void 0),nU(this,"playNode",void 0),nU(this,"isDestroyed",!1),nU(this,"onNoAudioInput",void 0),nU(this,"isNoAudioInput",!1),nU(this,"_noAudioInputCount",0),this.context=uU(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),lU(this.outputNode),this.volumeLevelAnalyser=new pU}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(Vx.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!fx().webAudioMediaStreamDest)throw new nw(tw.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&Bw((()=>{cU.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;PS()||HS()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let r=!1;for(let i=0;i<n.length;i++)0!==n[i]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await $w(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class mU extends fU{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),nU(this,"sourceNode",void 0),nU(this,"track",void 0),nU(this,"clonedTrack",void 0),nU(this,"audioElement",void 0),nU(this,"isCurrentTrackCloned",!1),nU(this,"isRemoteTrack",!1),nU(this,"originVolumeLevelAnalyser",void 0),nU(this,"rebuildWebAudio",(async()=>{if(QR.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void QR.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>QR.info("resume success"))),QR.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),lU(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),lU(this.outputNode),this.emit(Vx.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==e.kind)throw new nw(tw.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),lU(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,QR.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));lU(t),this.originVolumeLevelAnalyser=new pU,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const o=wS();t&&o.os===vS.IOS&&Number(null===(r=o.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(cU.on(gx.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),lU(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Vx.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),cU.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),QR.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));lU(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function gU(e,t,n){const r=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function _U(e,t){const n=await EU(e.mediaSource),{sourceId:r,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Gh(((n,r)=>{const i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const s=document.createElement("div");s.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",s.setAttribute("style","height: 12%;");const a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const u=document.createElement("button");u.innerHTML="cancel",u.setAttribute("style","width: 85px;"),u.onclick=()=>{document.body.removeChild(h);const e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};let l=t;const d=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=l,e.onchange=()=>{l=e.checked},d.appendChild(e),d.appendChild(t)}c.appendChild(d),c.appendChild(u),o.appendChild(s),o.appendChild(a),o.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(i),h.appendChild(o),document.body.appendChild(h),e.map((e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;try{const{width:e}=r.getSize();e>1920&&(r=r.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",t.onclick=()=>{document.body.removeChild(h),n({sourceId:e.id,audio:l})},a.appendChild(t)}}))}))}(n,t);return await gU(r,e,i)}async function EU(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=bw();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new nw(tw.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){r=null}r&&r.then||(r=new Gh(((e,r)=>{n.desktopCapturer.getSources({types:t},((t,n)=>{t?r(t):e(n)}))})));try{return await r}catch(e){throw new nw(tw.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}const vU=new hR("safari");let yU=!1,bU=!1;async function TU(e,t){let n=0,r=null;for(;n<2;)try{r=await SU(e,t,n>0);break}catch(e){if(e instanceof nw)throw QR.error("[".concat(t,"] ").concat(e.toString())),e;const r=wU(e.name||e.code||e,e.message);if(r.code===tw.MEDIA_OPTION_INVALID){QR.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await $w(500);continue}throw QR.error("[".concat(t,"] ").concat(r.toString())),r}if(!r)throw new nw(tw.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function SU(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new nw(tw.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=fx(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return QR.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(bw())e.screen.sourceId?RU(i,await gU(e.screen.sourceId,e.screen,e.screenAudio)):RU(i,await _U(e.screen,e.screenAudio));else if(OS()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new nw(tw.NOT_SUPPORTED,"This browser does not support screen sharing");QR.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(s=e.screen.extensionId,a=t,new Gh(((e,t)=>{try{chrome.runtime.sendMessage(s,{getStream:!0},(n=>{if(!n||!n.streamId)return QR.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new nw(tw.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){QR.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(s,")"),e.toString()),t(new nw(tw.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=n,RU(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var o;e.screen.mediaSource&&kx(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(o=e.screen.displaySurface)&&void 0!==o?o:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:s,systemAudio:a}=e.screen,c={selfBrowserSurface:r,surfaceSwitching:s,systemAudio:a};!r&&delete c.selfBrowserSurface,!s&&delete c.surfaceSwitching,!a&&delete c.systemAudio,QR.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:!!e.screenAudio,controls:c})),RU(i,await navigator.mediaDevices.getDisplayMedia(tU({video:n,audio:!!e.screenAudio},c)))}else{if(!DS())throw QR.error("[".concat(t,"] This browser does not support screenSharing")),new nw(tw.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&kx(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};QR.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),RU(i,await navigator.mediaDevices.getUserMedia(n))}}var s,a;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},u=kR("MEDIA_DEVICE_CONSTRAINTS");if(u)try{"string"==typeof u&&(u=JSON.parse(u)),c=sR(c,u)}catch(e){}QR.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),wS();let l,d=null;(NS()||PS()||AS())&&(d=await vU.lock());try{l=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw d&&d(),e}return c.audio&&(yU=!0),c.video&&(bU=!0),RU(i,l),d&&d(),i}function wU(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new nw(tw.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new nw(tw.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new nw(tw.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new nw(tw.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new nw(tw.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new nw(tw.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return QR.error("getUserMedia unexpected error",e),new nw(tw.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function RU(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const IU=new class extends vw{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Jx.STATE_CHANGE,e),this._state=e)}constructor(){super(),nU(this,"_state",Yx.IDLE),nU(this,"isAccessMicrophonePermission",!1),nU(this,"isAccessCameraPermission",!1),nU(this,"lastAccessMicrophonePermission",!1),nU(this,"lastAccessCameraPermission",!1),nU(this,"checkdeviceMatched",!1),nU(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(kR("ENUMERATE_DEVICES_INTERVAL")||(XS()||IS()===vS.HARMONY_OS)&&JS())&&this.updateDevicesInfo()}),kR("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>QR.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new nw(tw.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let o=!this.isAccessMicrophonePermission&&e,s=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(s=!1);let a=null,c=null,u=null;if(!n&&(o||s)){if(vU.isLocked&&(QR.debug("[device manager] wait GUM lock"),(await vU.lock())(),QR.debug("[device manager] GUM unlock")),yU&&(o=!1,this.isAccessMicrophonePermission=!0),bU&&(s=!1,this.isAccessCameraPermission=!0),QR.debug("[device manager] check media device permissions",e,t,o,s),o&&s){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=wU(e.name||e.code||e,e.message);if(t.code===tw.PERMISSION_DENIED)throw t;QR.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{a=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=wU(e.name||e.code||e,e.message);if(t.code===tw.PERMISSION_DENIED)throw t;QR.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=wU(e.name||e.code||e,e.message);if(t.code===tw.PERMISSION_DENIED)throw t;QR.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}QR.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return a&&a.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),u&&u.getTracks().forEach((e=>e.stop())),a=null,c=null,u=null,e}catch(e){return a&&a.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),u&&u.getTracks().forEach((e=>e.stop())),a=null,c=null,u=null,new nw(tw.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audioinput"===e.kind))}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((e=>"videoinput"===e.kind))}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audiooutput"===e.kind))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((t=>t.deviceId===e));if(!t)throw new nw(tw.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Yx.INITING;try{await this.updateDevicesInfo(),this.state=Yx.INITEND}catch(e){throw QR.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Yx.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new nw(tw.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find((e=>"audioinput"===e.kind&&"default"===e.deviceId)),n=e.find((e=>"audiooutput"===e.kind&&"default"===e.deviceId));t&&n?n.groupId===t.groupId?QR.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):QR.warning("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):QR.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((e=>{if(!e.deviceId)return;const r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){const r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)})),this.deviceInfoMap.forEach(((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))})),this.state!==Yx.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Jx.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Jx.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Jx.PLAYOUT_DEVICE_CHANGED,e)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"videoinput"===e.kind)),r={audio:!1,video:!1};for(const i of t)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let CU=!1;const AU=new class extends vw{constructor(){super(...arguments),nU(this,"onAutoplayFailed",void 0),nU(this,"onAudioAutoplayFailed",void 0)}};function OU(){if(wS(),!CU){const e=t=>{t.preventDefault(),CU=!1,QS()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};CU=!0,QS()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),QR.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),AU.onAutoplayFailed?AU.onAutoplayFailed():AU.onAudioAutoplayFailed?QR.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):QR.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),AU.emit("autoplay-failed")}}function NU(e,t,n,r){if(!e)return;const i=oI.getBaseInfoBySessionId(e);if(!i)return;const o=i.info,s=Date.now(),a=tU(tU({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:s,elapse:s-i.startTime,cbRegistered:AU.onAutoplayFailed||AU.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});oI.send({type:nI.AUTOPLAY_FAILED,data:a},!0)}const kU=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],DU=new class{constructor(){nU(this,"onAutoplayFailed",void 0),nU(this,"elementMap",new Map),nU(this,"elementStateMap",new Map),nU(this,"elementsNeedToResume",[]),nU(this,"sinkIdMap",new Map),nU(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[n,r]=t;const i=this.elementStateMap.get(n),o=r.srcObject.getAudioTracks()[0],s=o&&o.readyState;if(QR.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(s," ").concat(e)),"live"===s){if(e)return r.pause(),void r.play();if("running"===cU.curState)return GS()?(r.pause(),void r.play()):void(i&&"paused"===i&&r.play())}}))})),nU(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(QR.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),cU.on(gx.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),cU.on(gx.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),cU.on(gx.STATE_CHANGE,(()=>{PS()&&"suspended"===cU.prevState&&"running"===cU.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new nw(tw.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Xx.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch((e=>{QR.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){QR.warning("[".concat(t,"] set sink id failed"),e.toString())}const s=i.play();s&&s.then&&s.catch((e=>{r&&NU(r,"audio",e.message,t),QR.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(QR.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),Bw((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),OU()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){kU.forEach((n=>{t.addEventListener(n,(n=>{const r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(QR.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&QR.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((e=>{e.play().then((e=>{QR.debug("Auto resume audio element success")})).catch((e=>{QR.warning("Auto resume audio element failed!",e)}))})),this.elementsNeedToResume=[]};new Gh((e=>{document.body?e():window.addEventListener("load",(()=>e()))})).then((()=>{QS()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function PU(){return function(e,t,n){const r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new nw(tw.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",QR);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=r.apply(this,t);return i instanceof Gh?new Gh(((e,t)=>{i.then(e).catch(t)})):i}),n}}class LU extends vw{constructor(e){super(),nU(this,"name","VideoProcessorDestination"),nU(this,"ID","0"),nU(this,"_source",void 0),nU(this,"videoContext",void 0),nU(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new nw(tw.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new nw(tw.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Kx.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Kx.ON_TRACK,void 0)}}class MU extends vw{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),nU(this,"constraintsMap",new Map),nU(this,"statsRegistry",[]),nU(this,"usageRegistry",[]),nU(this,"trackId",void 0),nU(this,"direction",void 0),nU(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await Lw(this,zx.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return QR.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),Mw(this,zx.REQUEST_UPDATE_CONSTRAINTS,Array.from(hC(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return QR.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Mw(this,zx.REQUEST_UPDATE_CONSTRAINTS,Array.from(hC(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){QR.error(new nw(tw.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof Gh&&(n=await n),e.push(tU(tU({},n),{},{direction:this.direction}))}catch(e){QR.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class xU extends vw{constructor(e){super(),nU(this,"name","AudioProcessorDestination"),nU(this,"ID","0"),nU(this,"inputTrack",void 0),nU(this,"inputNode",void 0),nU(this,"audioProcessorContext",void 0),nU(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new nw(tw.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new nw(tw.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Kx.ON_TRACK,void 0),this.emit(Kx.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Kx.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Kx.ON_NODE,this.inputNode))}}class UU extends vw{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),nU(this,"constraintsMap",new Map),nU(this,"statsRegistry",[]),nU(this,"audioContext",void 0),nU(this,"trackId",void 0),nU(this,"direction",void 0),nU(this,"usageRegistry",[]),nU(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return Lw(this,zx.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return QR.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),Mw(this,zx.REQUEST_UPDATE_CONSTRAINTS,Array.from(hC(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Mw(this,zx.REQUEST_UPDATE_CONSTRAINTS,Array.from(hC(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){QR.error(new nw(tw.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof Gh&&(n=await n),e.push(tU(tU({},n),{},{direction:this.direction}))}catch(e){QR.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class FU extends vw{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),nU(this,"context",void 0),nU(this,"processSourceNode",void 0),nU(this,"outputTrack",void 0),nU(this,"processedNode",void 0),nU(this,"clonedTrack",void 0),nU(this,"outputNode",void 0),this.outputNode=new jU}setVolume(){}createOutputTrack(){throw new nw(tw.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class jU{disconnect(){}connect(){}}function VU(e){return new Gh(((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const o=PS()?"canplay":"playing";i.addEventListener(o,(()=>{const e=i.videoWidth,n=i.videoHeight;!e&&DS()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(nR),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function BU(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Rx(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!zS()&&n.frameRate&&(t.frameRate=n.frameRate),kS()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),DS()&&(t.frameRate={ideal:30,max:30}),t}function GU(e){const t={};if(zS()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,OS()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=Ox(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),XS()&&(t.sampleRate=void 0),t}const qU=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:o=n,width:s=r,height:a=i}=t;if(!o||!s||!a)return;s=cR(s),a=cR(a),o=cR(o);const{max:c,min:u}=function(e,t,n){const r=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(r),max:Math.floor(4*r)}}(s,a,o),{bitrateMax:l,bitrateMin:d}=t||{};l||QR.debug("calculate bitrate: [w: ".concat(s,", h: ").concat(a,", fps: ").concat(o,"] => [brMax: ").concat(l,", brMin: ").concat(d,"]"));const{maxFramerate:h}=kR("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:l||c,bitrateMin:d||u,scaleResolutionDownBy:1,scale:0}},WU=async(e,t,n)=>await(async(e,t,n)=>{const r=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(uR(""+t+n)).slice(0,16),i=r.slice(0,12),o=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,e))})(e.buffer,t,n),HU=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Gh(((n,r)=>{t.toBlob((async e=>{if(t.remove(),e){const r=await KU(e);n({buffer:r,width:t.width,height:t.height})}else r(new nw(tw.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},KU=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var zU,YU,JU,XU,QU,ZU,$U,eF,tF,nF,rF,iF,oF,sF,aF,cF,uF,lF,dF,hF,pF,fF,mF,gF,_F,EF,vF,yF,bF,TF,SF,wF,RF,IF,CF,AF,OF,NF,kF,DF;let PF=(zU=iI({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),YU=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),JU=PU(),XU=pR("LocalAudioTrack","_enabledMutex"),QU=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),ZU=PU(),$U=pR("LocalAudioTrack","_enabledMutex"),eF=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),tF=PU(),nF=PU(),rF=PU(),iF=iI({argsMap:e=>[e.getTrackId()]}),oF=PU(),sF=iI({argsMap:e=>[e.getTrackId()]}),aF=PU(),cF=iI({argsMap:e=>[e.getTrackId()]}),uF=iI({argsMap:(e,t)=>[e.getTrackId(),t.name]}),lF=iI({argsMap:e=>[e.getTrackId()]}),rU((dF=class extends oU{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?DU.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),nU(this,"trackMediaType","audio"),nU(this,"_encoderConfig",void 0),nU(this,"_trackSource",void 0),nU(this,"_enabled",!0),nU(this,"_volume",100),nU(this,"_useAudioElement",!0),nU(this,"_bypassWebAudio",!1),nU(this,"processor",void 0),nU(this,"_processorContext",void 0),nU(this,"_processorDestination",void 0),nU(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new FU,kR("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),kR("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),NS()&&!aU?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){ow(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&DU.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void QR.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Mw(this,Dx.NEED_REPLACE_TRACK,this).then((()=>{QR.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((e=>{QR.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!mx())throw new nw(tw.NOT_SUPPORTED,"your browser does not support setting the audio output device");await DU.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(QR.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Mw(this,Dx.NEED_ENABLE_TRACK,this),QR.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),QR.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Mw(this,Dx.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),QR.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,QR.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Mw(this,Dx.NEED_MUTE_TRACK,this):await Mw(this,Dx.NEED_UNMUTE_TRACK,this))}getStats(){return Hw((()=>{QR.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),xw(this,Dx.GET_STATS)||tU({},Bx)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Vx.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Vx.ON_AUDIO_BUFFER),this._source.on(Vx.ON_AUDIO_BUFFER,(t=>e(t)))}play(){QR.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(QR.debug("[".concat(this.getTrackId(),"] start audio playback in element")),DU.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){QR.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?DU.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];QR.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&DU.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Mw(this,Dx.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Gh.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new nw(tw.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new nw(tw.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Kx.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Mw(this,Dx.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Mw(this,Dx.NEED_REPLACE_TRACK,this))})),e.on(Kx.ON_NODE,(e=>{this._source.processedNode=e}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(Kx.ON_TRACK),e.removeAllListeners(Kx.ON_NODE)}bindProcessorContextEvents(e){e.on(zx.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(zx.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof FU&&(this._trackSource=new mU(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new UU(this._source.context,this.getTrackId(),"local"),t=new xU(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Vx.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(DU.stop(this.getTrackId()),this._source.play()),Mw(this,Dx.NEED_REPLACE_MIXING_TRACK,this).then((()=>{QR.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((e=>{QR.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[zU],Object.getOwnPropertyDescriptor(dF.prototype,"setVolume"),dF.prototype),rU(dF.prototype,"setPlaybackDevice",[YU,JU],Object.getOwnPropertyDescriptor(dF.prototype,"setPlaybackDevice"),dF.prototype),rU(dF.prototype,"setEnabled",[XU,QU,ZU],Object.getOwnPropertyDescriptor(dF.prototype,"setEnabled"),dF.prototype),rU(dF.prototype,"setMuted",[$U,eF,tF],Object.getOwnPropertyDescriptor(dF.prototype,"setMuted"),dF.prototype),rU(dF.prototype,"getStats",[nF],Object.getOwnPropertyDescriptor(dF.prototype,"getStats"),dF.prototype),rU(dF.prototype,"setAudioFrameCallback",[rF],Object.getOwnPropertyDescriptor(dF.prototype,"setAudioFrameCallback"),dF.prototype),rU(dF.prototype,"play",[iF,oF],Object.getOwnPropertyDescriptor(dF.prototype,"play"),dF.prototype),rU(dF.prototype,"stop",[sF,aF],Object.getOwnPropertyDescriptor(dF.prototype,"stop"),dF.prototype),rU(dF.prototype,"close",[cF],Object.getOwnPropertyDescriptor(dF.prototype,"close"),dF.prototype),rU(dF.prototype,"pipe",[uF],Object.getOwnPropertyDescriptor(dF.prototype,"pipe"),dF.prototype),rU(dF.prototype,"unpipe",[lF],Object.getOwnPropertyDescriptor(dF.prototype,"unpipe"),dF.prototype),dF),LF=(hF=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),pF=PU(),fF=pR("MicrophoneAudioTrack","_enabledMutex"),mF=iI({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),gF=PU(),_F=iI({argsMap:e=>[e.getTrackId()]}),rU((EF=class extends PF{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Ox(t.encoderConfig):{},r,kR("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),nU(this,"_config",void 0),nU(this,"_deviceName","default"),nU(this,"_constraints",void 0),nU(this,"_originalConstraints",void 0),nU(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(GS()||qS())&&cU.bindInterruptDetectorTrack(this)}async setDevice(e){if(QR.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await IU.getDeviceById(e),n={};n.audio=tU({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await TU(n,this.getTrackId())}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await TU({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await IU.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}QR.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return QR.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(QR.info("[".concat(this.getTrackId(),"] start setEnabled"),e),kR("AUTO_RESET_AUDIO_ROUTE")&&(PS()||HS())){const t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await Mw(this,Dx.NEED_DISABLE_TRACK,this)}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=tU({},this._constraints),o=IU.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{n||(this._enabled=!0);const e=await TU({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await Mw(this,Dx.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),QR.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}QR.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(GS()||qS())&&cU.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((PS()||HS())&&this._enabled&&!this._isClosed&&cU.duringInterruption){const e=async()=>{cU.off(gx.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(QR.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};cU.on(gx.IOS_INTERRUPTION_END,e)}else QR.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Fx.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=IU.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await TU({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(zx.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(zx.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[hF,pF],Object.getOwnPropertyDescriptor(EF.prototype,"setDevice"),EF.prototype),rU(EF.prototype,"setEnabled",[fF,mF,gF],Object.getOwnPropertyDescriptor(EF.prototype,"setEnabled"),EF.prototype),rU(EF.prototype,"close",[_F],Object.getOwnPropertyDescriptor(EF.prototype,"close"),EF.prototype),EF),MF=(vF=iI({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),yF=PU(),bF=iI({argsMap:e=>[e.getTrackId()]}),TF=PU(),SF=iI({argsMap:e=>[e.getTrackId()]}),wF=PU(),RF=iI({argsMap:e=>[e.getTrackId()]}),IF=PU(),CF=iI({argsMap:e=>[e.getTrackId()]}),AF=PU(),OF=iI({argsMap:e=>[e.getTrackId()]}),NF=iI({argsMap:e=>[e.getTrackId()]}),kF=PU(),rU((DF=class extends PF{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),nU(this,"source",void 0),nU(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Vx.AUDIO_SOURCE_STATE_CHANGE,(e=>{this.safeEmit(Fx.SOURCE_STATE_CHANGE,e)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){ow(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[vF,yF],Object.getOwnPropertyDescriptor(DF.prototype,"startProcessAudioBuffer"),DF.prototype),rU(DF.prototype,"pauseProcessAudioBuffer",[bF,TF],Object.getOwnPropertyDescriptor(DF.prototype,"pauseProcessAudioBuffer"),DF.prototype),rU(DF.prototype,"seekAudioBuffer",[SF,wF],Object.getOwnPropertyDescriptor(DF.prototype,"seekAudioBuffer"),DF.prototype),rU(DF.prototype,"resumeProcessAudioBuffer",[RF,IF],Object.getOwnPropertyDescriptor(DF.prototype,"resumeProcessAudioBuffer"),DF.prototype),rU(DF.prototype,"stopProcessAudioBuffer",[CF,AF],Object.getOwnPropertyDescriptor(DF.prototype,"stopProcessAudioBuffer"),DF.prototype),rU(DF.prototype,"close",[OF],Object.getOwnPropertyDescriptor(DF.prototype,"close"),DF.prototype),rU(DF.prototype,"setAudioBufferPlaybackSpeed",[NF,kF],Object.getOwnPropertyDescriptor(DF.prototype,"setAudioBufferPlaybackSpeed"),DF.prototype),DF);class xF extends PF{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=uU().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,eR(8,"track-mix-")),nU(this,"trackList",void 0),nU(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(QR.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):QR.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){QR.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}jw(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach((t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((t=>{t instanceof xF?t.emit(Ux.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)})))}}class UF extends fU{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(Vx.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),nU(this,"audioBuffer",void 0),nU(this,"sourceNode",void 0),nU(this,"startPlayTime",0),nU(this,"startPlayOffset",0),nU(this,"pausePlayTime",0),nU(this,"options",void 0),nU(this,"currentLoopCount",0),nU(this,"currentPlaybackSpeed",100),nU(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):QR.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const FF=new Map;class jF{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,t=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,t}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(QR.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){nU(this,"trackId",void 0),nU(this,"config",void 0),nU(this,"onFirstVideoFrameDecoded",void 0),nU(this,"onVideoStateChanged",void 0),nU(this,"freezeTimeCounterList",[]),nU(this,"renderFreezeAccTime",0),nU(this,"isKeepLastFrame",!1),nU(this,"timeUpdatedCount",0),nU(this,"freezeTime",0),nU(this,"playbackTime",0),nU(this,"lastTimeUpdatedTime",0),nU(this,"autoplayFailed",!1),nU(this,"videoTrack",void 0),nU(this,"videoElement",void 0),nU(this,"cacheVideoElement",void 0),nU(this,"renderStats",void 0),nU(this,"_videoState",Qx.VideoStateStopped),nU(this,"videoElementCheckInterval",void 0),nU(this,"videoElementFreezeTimeout",void 0),nU(this,"_videoElementStatus",Xx.NONE),nU(this,"isGettingVideoDimensions",!1),nU(this,"startGetVideoDimensions",(()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return QR.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()})),nU(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===cU.curState&&(QR.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(CS())),WS()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),nU(this,"handleVideoEvents",(e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Xx.PLAYING;break;case"loadeddata":if(this.videoState=Qx.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Xx.CANPLAY;break;case"stalled":this.videoElementStatus=Xx.STALLED;break;case"suspend":this.videoElementStatus=Xx.SUSPEND;break;case"pause":this.videoElementStatus=Xx.PAUSED,PS()||HS()||NS()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(QR.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Xx.WAITING;break;case"abort":this.videoElementStatus=Xx.ABORT;break;case"ended":this.videoElementStatus=Xx.ENDED;break;case"emptied":this.videoElementStatus=Xx.EMPTIED;break;case"error":{const e=this.videoElement.error;e?(this.videoElementStatus=Xx.ERROR,QR.error("[".concat(this.trackId,"] media error: ").concat(e.message," (").concat(e.code,")"))):QR.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,Bj.lastVisibleTime<Bj.lastHiddenTime||n<Bj.lastHiddenTime||n<Bj.lastVisibleTime)return;for(t>kR("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),nU(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(QR.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(CS())),WS()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),cU.on(gx.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),cU.on(gx.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch((t=>{e&&NU(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(QR.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):QR.warning("[".concat(this.trackId,"] play warning: "),t)}));const n=wS();if(("Safari"===n.name&&15===Number(n.version)||GS())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return QR.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new Gh(((r,i)=>{n.toBlob((async e=>{if(n.remove(),e){const t=await KU(e);r({buffer:t,width:n.width,height:n.height})}else i(new nw(tw.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,t<0?.1:t>1?1:t)}))):await HU(e)}destroy(){this.renderStats=void 0,cU.off(gx.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),cU.off(gx.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Qx.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Xx.INIT,!this.videoElementCheckInterval&&(VF.forEach((e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{(function(e){return e!==document.body&&document.body.contains(e)})(this.videoElement)||(this.videoElementStatus=Xx.DESTROYED)}),1e3),kR("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const r=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",r),this.videoElementFreezeTimeout=window.setTimeout(i,kR("VIDEO_FREEZE_DURATION")))},i=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Qx.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=Qx.VideoStateFrozen:document.addEventListener("visibilitychange",r))},o=(e,t)=>{if(this.videoElementStatus===Xx.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=t.mediaTime):this.renderStats={lastTs:t.mediaTime,curTs:t.mediaTime,lastRenderNum:0,renderNum:0},n){const e=t.presentationTime-n.presentationTime;this.videoState===Qx.VideoStateStarting&&(this.videoState=Qx.VideoStateDecoding),this.videoState===Qx.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(i,kR("VIDEO_FREEZE_DURATION"))),e<kR("VIDEO_FREEZE_DURATION")&&this.videoState===Qx.VideoStateFrozen&&(this.videoState=Qx.VideoStateDecoding),e>kR("VIDEO_FREEZE_DURATION")&&Bj.lastVisibleTime>=Bj.lastHiddenTime&&n.timestamp>Bj.lastVisibleTime&&n.timestamp>Bj.lastHiddenTime&&(this.renderFreezeAccTime+=e)}n=tU(tU({},t),{},{timestamp:e})}var r,s;kR("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(r=(s=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(s,o))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,o)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),XS()&&!kR("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=wS();"Safari"===n.name&&15===Number(n.version)||GS()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,DS()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,DS()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch((e=>{QR.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())}))}resetVideoElement(){VF.forEach((e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Xx.NONE}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then((()=>{QR.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((e=>{QR.error(e)})),this.autoplayFailed=!1,QS()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};QS()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),OU()}}const VF=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class BF extends jF{constructor(e){super(e),nU(this,"container",void 0),nU(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await HU(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",kR("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var GF,qF,WF,HF,KF,zF,YF,JF,XF,QF,ZF,$F,ej,tj,nj,rj,ij,oj,sj,aj,cj,uj,lj,dj,hj,pj,fj,mj,gj,_j,Ej,vj,yj,bj,Tj;let Sj=(GF=iI({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),qF=PU(),WF=iI({argsMap:e=>[e.getTrackId()]}),HF=pR("LocalVideoTrack","_enabledMutex"),KF=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),zF=PU(),YF=pR("LocalVideoTrack","_enabledMutex"),JF=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),XF=PU(),QF=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),ZF=PU(),$F=PU(),ej=iI({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),tj=PU(),nj=PU(),rj=PU(),ij=PU(),oj=PU(),sj=PU(),aj=PU(),cj=iI({argsMap:(e,t)=>[e.getTrackId(),t.name]}),uj=iI({argsMap:e=>[e.getTrackId()]}),lj=iI({argsMap:e=>[e.getTrackId()]}),dj=iI({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),hj=iI(),pj=class e extends oU{get videoHeight(){if(NS()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(NS()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Xx.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,o){if(super(e,i),nU(this,"trackMediaType","video"),nU(this,"_player",void 0),nU(this,"isUseScaleResolutionDownBy",!1),nU(this,"_videoVisibleTimer",null),nU(this,"_statsTimer",null),nU(this,"_previousVideoVisibleStatus",void 0),nU(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),nU(this,"_encoderConfig",void 0),nU(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),nU(this,"_optimizationMode",void 0),nU(this,"_videoHeight",void 0),nU(this,"_videoWidth",void 0),nU(this,"_forceBitrateLimit",void 0),nU(this,"_enabled",!0),nU(this,"_processorDestination",void 0),nU(this,"_processorContext",void 0),NS()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=n,this._optimizationMode=r,this._hints=o||[],-1===this._hints.indexOf(Px.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(e,t,n){const r=wS();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}(yS.CHROME,115)&&-1!==IS().indexOf("Windows")){const t=function(e,t){if("VideoFrame"in window&&"TransformStream"in window&&fx().supportWebRTCInsertableStream){const n=new MediaStreamTrackProcessor(e),r=new MediaStreamTrackGenerator({kind:"video"});let i,o,s=Date.now();const a=()=>{c&&(clearInterval(c),c=void 0),i&&(i.close(),i=void 0),e.stop(),o=void 0,r.removeEventListener("ended",a)};let c=window.setInterval((()=>{if(o&&i&&Date.now()-s>(null!=t?t:1e3))try{"live"===r.readyState?o.enqueue(i.clone()):a()}catch(e){a()}}),null!=t?t:1e3);const u=new TransformStream({transform:(e,t)=>{"live"===r.readyState?(o=t,s=Date.now(),void 0===i?(i=e,t.enqueue(e.clone())):(t.enqueue(i),i=e)):e.close()}});return r.addEventListener("ended",a),n.readable.pipeThrough(u).pipeTo(r.writable),r}}(e);t&&(QR.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(Px.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new MU(this.getTrackId(),"local"),this._processorDestination=new LU(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(QR.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}QR.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=tU(tU(tU({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new jF(n):this._player=new BF(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(Fx.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),kR("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,QR.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(QR.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Mw(this,Dx.NEED_DISABLE_TRACK,this)}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void QR.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Mw(this,Dx.NEED_ENABLE_TRACK,this)}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}QR.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,QR.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Mw(this,Dx.NEED_MUTE_TRACK,this):await Mw(this,Dx.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new nw(tw.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if("720p_auto"===e?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=Rx(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=BU({encoderConfig:e});(NS()||PS()||HS())&&(t.deviceId=void 0),QR.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new nw(tw.UNEXPECTED_ERROR,e.toString());throw QR.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(Px.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await Mw(this,Dx.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(QR)}}getStats(){return Hw((()=>{QR.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),xw(this,Dx.GET_STATS)||tU({},Gx)}async setBeautyEffect(e){QR.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await HU(e)}async setBitrateLimit(e){if(QR.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await Mw(this,Dx.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(QR)}}}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void QR.error(tw.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await Mw(this,Dx.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,QR.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}QR.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return QR.error(tw.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,QR.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){VU(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(nR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new nw(tw.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");QR.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=Rx(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(Px.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await Mw(this,Dx.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(QR)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const{bitrateMax:r,bitrateMin:i}=this._encoderConfig;if(null==i||null==r){const{max:o,min:s}=function(e,t,n,r,i){const o=kR("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===o)return{min:r,max:i};if(void 0===i){var s;const a=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===o?4*a:2*a,r=null!==(s=r)&&void 0!==s?s:a}else{var a;r=null!==(a=r)&&void 0!==a?a:Math.floor(i/10)}return{min:r,max:i}}(e,t,n,i,r);this._encoderConfig.bitrateMin=s,this._encoderConfig.bitrateMax=o,QR.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(o,", brMin: ").concat(s,"]"))}}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=mw.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new nw(tw.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new nw(tw.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=tU(tU({},r),Rx(t))),r=qw(r);const i=eR(8,"track-video-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,qw(this._scalabilityMode),this._optimizationMode,i,qw(this._hints));return t&&r&&o.setEncoderConfiguration(r),QR.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new nw(tw.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new nw(tw.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!NS()&&!PS())return;this._statsTimer&&window.clearInterval(this._statsTimer);let e=2,t=Tx[e],n=-1,r=Date.now();const i=e=>{e>2||e<0||(r=Date.now(),t=Tx[e],this.setSenderConfiguration(t))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval((()=>{const o=this.getStats(),s=xw(this,Dx.GET_RTC_STATS);if(o.sendPackets>0&&s){-1===n&&(n=Date.now());const a=Date.now();if(a-n<1e3||a-r<kR("PROFILE_SWITCH_INTERVAL"))return;const c=o.sendFrameRate,u=.6*t.frameRate,l=.9*t.frameRate;"number"==typeof c&&c>0&&c<u?e>0&&(e--,i(e),QR.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(c,", switchProfile to ").concat(e))):s.OutgoingAvailableBandwidth<t.bitrateMin?e>0&&(e--,i(e),QR.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(s.OutgoingAvailableBandwidth,", bitrateMin ").concat(t.bitrateMin,", switchProfile to ").concat(e))):"number"==typeof c&&c>l&&e<Tx.length-1&&s.OutgoingAvailableBandwidth>1.2*Tx[e+1].bitrateMin&&(e++,i(e),QR.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(c,", OutgoingAvailableBandwidth ").concat(s.OutgoingAvailableBandwidth,", switchProfile to ").concat(e)))}}),kR("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(e){if(Hw((()=>{oI.reportApiInvoke(null,{name:Tw.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Sw.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!kR("ENABLE_VIDEO_SEI")||!kR("ENABLE_ENCODED_TRANSFORM"))return void QR.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new nw(tw.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void QR.warning("Video track is not published, SEI can not be send");const n=t.sender.getParameters();if(0===n.codecs.length)return;const r=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r?this.safeEmit("sei-to-send",e):QR.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Kx.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Mw(this,Dx.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Mw(this,Dx.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Kx.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(zx.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(zx.REQUEST_CONSTRAINTS)}},rU(pj.prototype,"play",[GF,qF],Object.getOwnPropertyDescriptor(pj.prototype,"play"),pj.prototype),rU(pj.prototype,"stop",[WF],Object.getOwnPropertyDescriptor(pj.prototype,"stop"),pj.prototype),rU(pj.prototype,"setEnabled",[HF,KF,zF],Object.getOwnPropertyDescriptor(pj.prototype,"setEnabled"),pj.prototype),rU(pj.prototype,"setMuted",[YF,JF,XF],Object.getOwnPropertyDescriptor(pj.prototype,"setMuted"),pj.prototype),rU(pj.prototype,"setEncoderConfiguration",[QF,ZF],Object.getOwnPropertyDescriptor(pj.prototype,"setEncoderConfiguration"),pj.prototype),rU(pj.prototype,"getStats",[$F],Object.getOwnPropertyDescriptor(pj.prototype,"getStats"),pj.prototype),rU(pj.prototype,"setBeautyEffect",[ej,tj],Object.getOwnPropertyDescriptor(pj.prototype,"setBeautyEffect"),pj.prototype),rU(pj.prototype,"getCurrentFrameData",[nj],Object.getOwnPropertyDescriptor(pj.prototype,"getCurrentFrameData"),pj.prototype),rU(pj.prototype,"getCurrentFrameImage",[rj],Object.getOwnPropertyDescriptor(pj.prototype,"getCurrentFrameImage"),pj.prototype),rU(pj.prototype,"setBitrateLimit",[ij],Object.getOwnPropertyDescriptor(pj.prototype,"setBitrateLimit"),pj.prototype),rU(pj.prototype,"setOptimizationMode",[oj],Object.getOwnPropertyDescriptor(pj.prototype,"setOptimizationMode"),pj.prototype),rU(pj.prototype,"setScalabiltyMode",[sj],Object.getOwnPropertyDescriptor(pj.prototype,"setScalabiltyMode"),pj.prototype),rU(pj.prototype,"updateMediaStreamTrackResolution",[aj],Object.getOwnPropertyDescriptor(pj.prototype,"updateMediaStreamTrackResolution"),pj.prototype),rU(pj.prototype,"pipe",[cj],Object.getOwnPropertyDescriptor(pj.prototype,"pipe"),pj.prototype),rU(pj.prototype,"unpipe",[uj],Object.getOwnPropertyDescriptor(pj.prototype,"unpipe"),pj.prototype),rU(pj.prototype,"close",[lj],Object.getOwnPropertyDescriptor(pj.prototype,"close"),pj.prototype),rU(pj.prototype,"replaceTrack",[dj],Object.getOwnPropertyDescriptor(pj.prototype,"replaceTrack"),pj.prototype),rU(pj.prototype,"startMonitorStats",[hj],Object.getOwnPropertyDescriptor(pj.prototype,"startMonitorStats"),pj.prototype),pj),wj=(fj=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),mj=PU(),gj=pR("CameraVideoTrack","_enabledMutex"),_j=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),Ej=PU(),vj=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),yj=PU(),bj=iI({argsMap:e=>[e.getTrackId()]}),Tj=class e extends Sj{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,o){super(e,Rx(t.encoderConfig),r,i,o),nU(this,"_config",void 0),nU(this,"_originalConstraints",void 0),nU(this,"_constraints",void 0),nU(this,"_enabled",!0),nU(this,"_deviceName","default"),nU(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(GS()||qS())&&!function(){const e=wS();if(e.os!==vS.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&KS()&&this._enabled&&!this._isClosed&&(QR.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=Rx(this._config.encoderConfig),cU.on(gx.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),cU.on(gx.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(QR.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await IU.getDeviceById(e),n={};n.video=tU({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await TU(n,this.getTrackId())}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await TU({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await IU.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}QR.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){QR.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:tU(tU({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await TU(t,this.getTrackId())}catch(t){throw QR.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await TU({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=tU({},t.video),QR.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(QR.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await TU({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await Mw(this,Dx.NEED_ENABLE_TRACK,this)}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),QR.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await Mw(this,Dx.NEED_DISABLE_TRACK,this)}catch(e){throw QR.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}QR.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new nw(tw.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");"720p_auto"===e?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),e=Rx(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const n=Gw(this._config);n.encoderConfig=e;const r=BU(n);(NS()||PS()||HS())&&(r.deviceId=void 0),QR.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(e){const t=new nw(tw.UNEXPECTED_ERROR,e.toString());throw QR.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(Px.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await Mw(this,Dx.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(QR)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((PS()||HS())&&this._enabled&&!this._isClosed&&cU.duringInterruption){const e=async()=>{cU.off(gx.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(QR.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};cU.on(gx.IOS_INTERRUPTION_END,e)}else QR.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Fx.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=IU.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await TU({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),cU.off(gx.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),cU.off(gx.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=tU(tU({},r),Rx(t))),r=qw(r);const i=eR(8,"track-cam-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,qw(tU(tU({},this._config),{},{encoderConfig:r})),qw(this._constraints),qw(this._scalabilityMode),this._optimizationMode,i);return t&&r&&o.setEncoderConfiguration(r),QR.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(zx.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on(zx.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}},rU(Tj.prototype,"setDevice",[fj,mj],Object.getOwnPropertyDescriptor(Tj.prototype,"setDevice"),Tj.prototype),rU(Tj.prototype,"setEnabled",[gj,_j,Ej],Object.getOwnPropertyDescriptor(Tj.prototype,"setEnabled"),Tj.prototype),rU(Tj.prototype,"setEncoderConfiguration",[vj,yj],Object.getOwnPropertyDescriptor(Tj.prototype,"setEncoderConfiguration"),Tj.prototype),rU(Tj.prototype,"close",[bj],Object.getOwnPropertyDescriptor(Tj.prototype,"close"),Tj.prototype),Tj);function Rj(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=tU(tU({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?QR.debug("[".concat(e,"] set content hint to"),n.optimizationMode):QR.debug("[".concat(e,"] set content hint failed")))):QR.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Ij,Cj,Aj,Oj,Nj,kj,Dj,Pj,Lj,Mj,xj,Uj;class Fj extends iU{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(eR(5,""))),nU(this,"_userId",void 0),nU(this,"_uintId",void 0),nU(this,"_isDestroyed",!1),nU(this,"store",void 0),nU(this,"processor",void 0),nU(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,QR.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let jj=(Ij=iI({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Cj=iI({argsMap:e=>[e.getTrackId()]}),Aj=iI({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Oj=iI({argsMap:e=>[e.getTrackId()]}),rU((Nj=class extends Fj{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Xx.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),nU(this,"_videoVisibleTimer",null),nU(this,"_previousVideoVisibleStatus",void 0),nU(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),nU(this,"trackMediaType","video"),nU(this,"_videoWidth",void 0),nU(this,"_videoHeight",void 0),nU(this,"_player",void 0),nU(this,"processorDestination",void 0),nU(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new MU(this.getTrackId(),"remote"),this.processorDestination=new LU(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Hw((()=>{QR.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),xw(this,Dx.GET_STATS)||tU({},Hx)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(QR.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}QR.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=tU(tU({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new jF(n):this._player=new BF(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(jx.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=e=>{this.safeEmit(jx.VIDEO_STATE_CHANGED,e)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(jx.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),kR("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,QR.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){VU(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(nR)}_updatePlayerSource(){QR.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=mw.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new nw(tw.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new nw(tw.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Kx.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Kx.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Ux.SEI_RECEIVED,e)}}).prototype,"play",[Ij],Object.getOwnPropertyDescriptor(Nj.prototype,"play"),Nj.prototype),rU(Nj.prototype,"stop",[Cj],Object.getOwnPropertyDescriptor(Nj.prototype,"stop"),Nj.prototype),rU(Nj.prototype,"pipe",[Aj],Object.getOwnPropertyDescriptor(Nj.prototype,"pipe"),Nj.prototype),rU(Nj.prototype,"unpipe",[Oj],Object.getOwnPropertyDescriptor(Nj.prototype,"unpipe"),Nj.prototype),Nj),Vj=(kj=iI({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Dj=iI({argsMap:(e,t)=>[e.getTrackId(),t]}),Pj=iI({argsMap:e=>[e.getTrackId()]}),Lj=iI({argsMap:e=>[e.getTrackId()]}),Mj=iI({argsMap:(e,t)=>[e.getTrackId(),t.name]}),xj=iI({argsMap:e=>[e.getTrackId()]}),rU((Uj=class extends Fj{get isPlaying(){return this._useAudioElement?DU.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),nU(this,"trackMediaType","audio"),nU(this,"_source",void 0),nU(this,"_useAudioElement",!0),nU(this,"_volume",100),nU(this,"processorContext",void 0),nU(this,"processorDestination",void 0),nU(this,"_played",!1),nU(this,"_bypassWebAudio",!1),kR("DISABLE_WEBAUDIO")?(this._source=new FU,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new mU(e,!0),kR("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Vx.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(jx.FIRST_FRAME_DECODED)})),this.processorContext=new UU(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new xU(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Vx.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Vx.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Vx.ON_AUDIO_BUFFER),this._source.on(Vx.ON_AUDIO_BUFFER,(t=>e(t)))}setVolume(e){this._volume=e,this._useAudioElement?DU.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!mx())throw new nw(tw.NOT_SUPPORTED,"your browser does not support setting the audio output device");await DU.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Hw((()=>{QR.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),xw(this,Dx.GET_STATS)||tU({},qx)}play(){QR.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(QR.debug("[".concat(this.getTrackId(),"] use audio element to play")),DU.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){QR.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?DU.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];QR.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&DU.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new nw(tw.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new nw(tw.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new nw(tw.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Kx.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(Kx.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Kx.ON_TRACK),this.processorDestination.removeAllListeners(Kx.ON_NODE)}}).prototype,"setVolume",[kj],Object.getOwnPropertyDescriptor(Uj.prototype,"setVolume"),Uj.prototype),rU(Uj.prototype,"setPlaybackDevice",[Dj],Object.getOwnPropertyDescriptor(Uj.prototype,"setPlaybackDevice"),Uj.prototype),rU(Uj.prototype,"play",[Pj],Object.getOwnPropertyDescriptor(Uj.prototype,"play"),Uj.prototype),rU(Uj.prototype,"stop",[Lj],Object.getOwnPropertyDescriptor(Uj.prototype,"stop"),Uj.prototype),rU(Uj.prototype,"pipe",[Mj],Object.getOwnPropertyDescriptor(Uj.prototype,"pipe"),Uj.prototype),rU(Uj.prototype,"unpipe",[xj],Object.getOwnPropertyDescriptor(Uj.prototype,"unpipe"),Uj.prototype),Uj);const Bj=new class extends vw{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),nU(this,"_lastHiddenTime",0),nU(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),QR.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};var Gj=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(Gj||{});class qj{constructor(){nU(this,"_sequence",0),nU(this,"_startTime",Date.now()),nU(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const r={id:0,length:4,data:n.buffer},i={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[r]};t.commonPacketHeader.extension=1,t.extension=i,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;kR("SHOW_DATASTREAM2_LOG")&&QR.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const n=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(n),i=new DataView(n);let o=0;if(i.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,i.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,i.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){const e=this.serializeExtension(t.extension);r.set(new Uint8Array(e),o),o+=e.byteLength}if(r.set(new Uint8Array(t.payload),o),o+=t.payload.byteLength,o!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let n=0;const r=t.getUint16(n,!0);n+=2;const i={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};let o,s;if(n+=4,kR("SHOW_DATASTREAM2_LOG")&&QR.debug("receive data header: ".concat(JSON.stringify(i))),t.getUint16(n,!0),n+=2,i.extension){s=this.deserializeExtension(e.slice(n)),n+=2+s.length,o=e.slice(n);let t=!1;if(s.datas.length>0){const e=s.datas.find((e=>0===e.id));e&&(t=1==(1&new DataView(e.data).getUint32(0,!0)))}o=t?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){const{profile:t,length:n,datas:r}=e,i=new ArrayBuffer(n+2),o=new Uint8Array(i),s=new DataView(i);let a=0;if(s.setUint8(a++,t),s.setUint8(a++,n),r.forEach((e=>{t?(s.setUint8(a++,e.id),s.setUint8(a++,e.length),o.set(new Uint8Array(e.data),a),a+=e.data.byteLength):(s.setUint8(a++,e.id|e.length<<4),o.set(new Uint8Array(e.data),a),a+=e.data.byteLength)})),a!==n+2)throw Error("serialize extension error, is ".concat(a,"!==").concat(n+2));return i}deserializeExtension(e){const t=new DataView(e);let n=0;const r=t.getUint8(n);n++;const i=t.getUint8(n);n++;const o=r===Gj.TWO_BYTE,s=[],a=new DataView(e,2);let c=0;for(;c<i;){let e=0,t=0,n=new ArrayBuffer(0);o?(e=a.getUint8(c),c++,t=a.getUint8(c),c++):(e=15&a.getUint8(c),t=a.getUint8(c)>>4,c++),t>0&&(n=a.buffer.slice(c+2,c+2+t),c+=n.byteLength),s.push({id:e,length:t,data:n})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:s}}decompress(e){return hx(new Uint8Array(e))}compress(e){return dx(new Uint8Array(e))}}class Wj extends vw{constructor(e,t){super(),nU(this,"_version",1),nU(this,"_type",3),nU(this,"_config",void 0),nU(this,"_originDataChannel",void 0),nU(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),nU(this,"_dataStreamPacketHandler",void 0),nU(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader(),this._dataStreamPacketHandler=new qj}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return kR("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Gh(((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const n=setTimeout((()=>{var e;t(new nw(tw.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new nw(tw.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new nw(tw.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[$x.OPEN,$x.CLOSE,$x.ERROR].forEach((t=>{const n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)}))}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach((t=>{let[n,r]=t;e.removeEventListener(n,r)})),this._datachannelEventMap.clear()}}class Hj extends Wj{constructor(e){super(e),nU(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void(kR("SHOW_DATASTREAM2_LOG")&&QR.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let r=e.data.slice(this._dataStreamPacketHeader.byteLength);r=this._dataStreamPacketHandler.deserialize(r),this.emit($x.MESSAGE,r)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Kj extends Wj{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function zj(){const e=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout((()=>MD.revokeObjectURL(e)),0),new Worker(MD.createObjectURL(e))}const Yj=new Map,Jj=new Map,Xj=new Map;async function Qj(e,t){if(!fx().supportWebRTCEncodedTransform)return void QR.warning("browser not support video encoded transform");if(Xj.has(e))return;if(!e.track)return;const n={track:e.track};if(OS()){if(!e.createEncodedStreams)return void QR.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void QR.error("create video-encoded-streams error",e&&e.message)}let o=[];t.on("sei-to-send",(e=>{o.push(e)}));const s=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(QR.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const s=o.shift();s&&(t.data=function(e,t){const n=function(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&0===e[r]&&0===e[r+1]&&(0===e[r+2]||1===e[r+2]||2===e[r+2]||3===e[r+2])?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}(t),r=n.length,i=Math.floor(r/255),o=r%255,s=new Uint8Array(6+i+1+r+e.byteLength);s[0]=0,s[1]=0,s[2]=0,s[3]=1,s[4]=6,s[5]=101;let a=0;for(;a<i;)s[6+a]=255,a++;return s[6+a]=o,a++,s.set(n,6+a),s.set(new Uint8Array(e),6+a+r),s.buffer}(t.data,s)),i.enqueue(t)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(!NS())return;{if("undefined"==typeof RTCRtpScriptTransform)return void QR.warning("browser not support RTCRtpScriptTransform");const i=zj(),o=new MessageChannel;await new Gh((e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)}));const s=new RTCRtpScriptTransform(i,{name:"tx",port:o.port2},[o.port2]);e.transform=s,await new Gh((e=>i.onmessage=t=>{"started"===t.data&&e(void 0)})),t.on("sei-to-send",(e=>{o.port1.postMessage({sei:e})})),o.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id&&(QR.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=Xj.get(e);if(t){Xj.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){QR.warning(e&&e.message)}}}Xj.set(e,n),e.track.addEventListener("ended",r)}const Zj=new Map;async function $j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!fx().supportWebRTCEncodedTransform)return void QR.warning("browser not support video encoded transform");if(!e.track)return;if(Zj.has(e)){const n=Zj.get(e);return void(n&&(n.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(OS()){if(!e.createEncodedStreams)return void QR.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void QR.error("create video-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(QR.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const o=function(e){const t=new DataView(e.data);if(0===t.getUint8(0)&&0===t.getUint8(1)&&0===t.getUint8(2)&&1===t.getUint8(3)&&6===t.getUint8(4)){let n=6,r=0,i=0;for(;255===(i=t.getUint8(n++));)r+=255;r+=i;const o=function(e,t,n){let r=new Uint8Array(e,t,n),i=[],o=0;for(;o<n;)o+3<n&&0===r[o]&&0===r[o+1]&&3===r[o+2]&&(0===r[o+3]||1===r[o+3]||2===r[o+3]||3===r[o+3])?(i.push(r[o],r[o+1],r[o+3]),o+=4):(i.push(r[o]),o++);return new Uint8Array(i)}(e.data,n,r);return new Uint8Array(o)}return null}(t);o&&n.onSei&&n.onSei(o),i.enqueue(t)}});t.readable.pipeThrough(i).pipeTo(t.writable)}else if(NS()){if("undefined"==typeof RTCRtpScriptTransform)return void QR.warning("browser not support RTCRtpScriptTransform");const t=zj(),i=new MessageChannel;await new Gh((e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)}));const o=new RTCRtpScriptTransform(t,{name:"rx",port:i.port2},[i.port2]);e.transform=o,await new Gh((e=>t.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(QR.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}!function(e){const t=Zj.get(e);if(t){Zj.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){QR.warning(e&&e.message)}}}(e)}Zj.set(e,n),e.track.addEventListener("ended",r)}!function(){const e=wS();px.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),px.getStreamFromExtension=e.name===yS.CHROME&&Number(e.version)>34,px.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),px.supportMinBitrate=e.name===yS.CHROME||e.name===yS.EDGE,px.supportSetRtpSenderParameters=function(){const e=wS();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!JS()||!(!NS()&&!AS())||e.name===yS.FIREFOX&&Number(e.version)>=64)}(),e.name===yS.SAFARI&&(Number(e.version)>=14?px.supportDualStream=!0:px.supportDualStream=!1),px.webAudioMediaStreamDest=function(){const e=wS();return!(e.name===yS.SAFARI&&Number(e.version)<12)}(),px.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,px.supportWebGL="undefined"!=typeof WebGLRenderingContext,px.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,JS()||(px.webAudioWithAEC=!0),px.supportShareAudio=function(){const e=wS();return(e.os===vS.WIN_10||e.os===vS.WIN_81||e.os===vS.WIN_7||e.os===vS.LINUX||e.os===vS.MAC_OS||e.os===vS.CHROMIUM_OS)&&e.name===yS.CHROME&&Number(e.version)>=74}(),px.supportDataChannel=!!(LS(76)||function(e){const t=wS();return!(t.name!==yS.FIREFOX||!t.osVersion)&&Number(t.version)>=e}(68)||xS(14)),px.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!DS()&&!!e&&e.prototype.setConfiguration instanceof Function}(),px.supportWebRTCEncodedTransform=function(){const e=wS();return"Chrome"===e.name&&Number(e.version)>=86||"Safari"===e.name&&Number(e.version)>=15}(),px.supportWebRTCInsertableStream=function(){const e=wS();return(e.name===yS.CHROME||e.name===yS.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),px.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,px.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,Bw((()=>{px.supportDualStreamEncoding=function(){const e=wS();return!!kR("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&kR("CHROME_DUAL_STREAM_USE_ENCODING"))}(),QR.info("browser compatibility",JSON.stringify(px),JSON.stringify(e))}))}();class eV extends vw{constructor(){super(...arguments),ry(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(kR("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i;const n=Dr(i=r.result).call(i,!0);r.isPrevNormal&&!n&&this.emit("exception",tV[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",tV[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof xF&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=KA(t._encoderConfig.frameRate));const r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof xF&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const tV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},nV=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function rV(e,t){this.v=e,this.k=t}function iV(e){return new rV(e,0)}var oV=Bh,sV=vl;Nn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=sV.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var aV=vl,cV=el;Nn({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=aV.f(this),n=cV(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var uV=r(oV),lV=n_.f("asyncIterator"),dV=r(lV);function hV(e){var t,n;function r(t,n){try{var o=e[t](n),s=o.value,a=s instanceof rV;uV.resolve(a?s.v:s).then((function(n){if(a){var c="return"===t?"return":"next";if(!s.k||n.done)return r(c,n);n=e[c](n).value}i(o.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new uV((function(o,s){var a={key:e,arg:i,resolve:o,reject:s,next:null};n?n=n.next=a:(t=n=a,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function pV(e){return function(){return new hV(e.apply(this,arguments))}}hV.prototype["function"==typeof Zv&&dV||"@@asyncIterator"]=function(){return this},hV.prototype.next=function(e){return this._invoke("next",e)},hV.prototype.throw=function(e){return this._invoke("throw",e)},hV.prototype.return=function(e){return this._invoke("return",e)};var fV=r(re.Object.getOwnPropertySymbols),mV=Nn,gV=Jn.indexOf,_V=Br,EV=R([].indexOf),vV=!!EV&&1/EV([1],1,-0)<0;mV({target:"Array",proto:!0,forced:vV||!_V("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return vV?EV(this,e,t)||0:gV(this,e,t)}});var yV=Zn("Array").indexOf,bV=d,TV=yV,SV=Array.prototype,wV=function(e){var t=e.indexOf;return e===SV||bV(SV,e)&&t===SV.indexOf?TV:t},RV=r(wV);function IV(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=wI(e);for(r=0;r<o.length;r++)n=o[r],RV(t).call(t,n)>=0||(i[n]=e[n]);return i}(e,t);if(fV){var o=fV(e);for(r=0;r<o.length;r++)n=o[r],RV(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var CV={exports:{}};!function(e,t){e.exports=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>T,Printer:()=>C,parse:()=>k,print:()=>D});const r="\n",i="".concat("\r").concat(r),o=" ";let s;function a(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function u(e){return c(e)||e>="\x80"&&e<="\xff"}function l(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function d(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function f(e){return e>"\x01"&&e<"\t"||e>"\v"&&e<"\f"||e>"\x0e"&&e<"\xff"}function m(e){return h(e)||a(e)||"+"===e||"/"===e}function g(e){return a(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function _(e){return h(e)||a(e)||"+"===e||"/"===e}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(s||(s={}));class b{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===r)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,o)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===o)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let r=0;r<4;r++)if(n=this.consumeDecimalUChar(e,n),3!==r){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let i=0;i<3&&a(e[n]);i++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;a(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,u)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let o=0;o<3;o++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!d(e[t]))throw new Error("Invalid integer.");for(t+=1;a(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!d(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&a(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,l)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(d(e[n])&&(n+=1);a(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,o)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,a),p(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!d(e[t]))throw new Error("Invalid repeat interval");for(t+=1;a(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,a)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class T extends b{constructor(){super(),y(this,"records",[]),y(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!Bp(e).call(e))).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),o=this.parseInformation(),s=this.parseUri(),a=this.parseEmail(),c=this.parsePhone(),u=this.parseConnection(),l=this.parseBandWidth(),d=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:o,uri:s,emails:a,phones:c,connection:u,bandwidths:l,timeFields:d,key:h,attributes:p,mediaDescriptions:f}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===r)return"\r"===e[t-1]?i:r;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new w;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==s.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,(e=>l(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,f)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new R(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==s.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,(e=>l(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,f)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===s.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===s.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==s.BANDWIDTH)break;{const n=this.extractOneOrMore(t,l);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const r=this.extractOneOrMore(t,a);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==s.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,a));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==s.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const o=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:o,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===s.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==s.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===s.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===s.CONNECTION){const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===s.TIME;){const t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===s.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),o=this.parseKey(),s=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:o,attributes:s})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===s.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.value,e.cur,...r),s=e.value.slice(e.cur,o);return e.cur=o,s}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==o)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class S extends b{constructor(){super(...arguments),y(this,"attributes",void 0),y(this,"digested",!1)}extractOneOrMore(e,t,n){const r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[o,s]=n||[];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof s&&i.length>s)throw new Error("error in length, should be less or equal than ".concat(s," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==o)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.attValue,e._cur,...r),s=e.attValue.slice(e._cur,o);return e._cur=o,s}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,m,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,m,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,m));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,a);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,o),i=v(v({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:r});this.peekChar(e)===o&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class w extends S{constructor(){super(...arguments),y(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,_),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const r=this.extractOneOrMore(e,(e=>e!==o&&f(e)));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===o&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,o);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class R extends S{constructor(e){super(),y(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,m,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,a,[1,10]);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const u=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const l={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:s,port:u,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),l.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),l.relPort=this.extract(e,this.consumePort));this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),l.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(l)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const r={encodingName:n,clockRate:this.extractOneOrMore(e,a)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,a);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let r;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[n]=r:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:r}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((e=>{let[t,n]=e.split("=");t=Bp(t).call(t);const i="string"==typeof n?Bp(n).call(n):null;"string"==typeof t&&t.length>0&&(r[t]=i)}));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,o),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,o);let r;if("trr-int"===n)r={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===o&&(t.additional=this.extract(e,this.consumeTill))),r=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(r);else{const e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(r):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[r]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,l,[1,64])};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,l,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,(e=>h(e)||a(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===o){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===o&&this.extract(e,this.consume,o)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{const r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,a,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,a,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class C{constructor(){I(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new O(this.eol).print(e)}printMediaAttributes(e){return new N(this.eol).print(e)}}class A{constructor(e){I(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(o)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(o).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(o).concat(e.extensionName).concat(e.extensionAttributes?"".concat(o).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class O extends A{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(o).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(o).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(o,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(o).concat(e)))),t+this.eol}}class N extends A{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(o).concat(e.componentId).concat(o).concat(e.transport).concat(o).concat(e.priority).concat(o).concat(e.connectionAddress).concat(o).concat(e.port).concat(o,"typ").concat(o).concat(e.type).concat(e.relAddr?"".concat(o,"raddr").concat(o).concat(e.relAddr):"").concat(e.relPort?"".concat(o,"rport").concat(o).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(o).concat(t).concat(o).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(o)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(const r of t)n+=this.printRtpMap(r.payloadType,r.rtpMap),n+=this.printFmtp(r.payloadType,r.fmtp),n+=r.rtcpFeedbacks.map((e=>this.printRTCPFeedback(r.payloadType,e))).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(o).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(o).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(o).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(o),r=t;return"trr-int"===r.type?n+="ttr-int".concat(o).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(o).concat(r.parameter),r.additional&&(n+="".concat(o).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(o).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(o).concat(e.netType)),e.addressType&&(t+="".concat(o).concat(e.addressType)),e.address&&(t+="".concat(o).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(o).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(o).concat(e.direction);return e.payloads&&(t+="".concat(o,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(o).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(o).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function k(e){return(new T).parse(e)}function D(e,t){return(new C).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})()}(CV);var AV=CV.exports;function OV(e){if(Array.isArray(e))return e.map((e=>e));if(!NV(e))return e;const t={};for(const n in e){const r=e[n];NV(r)||Array.isArray(r)?t[n]=OV(r):t[n]=r}return t}function NV(e){return!("object"!=typeof e||Array.isArray(e)||!e)}class kV{constructor(e){ry(this,"input",[]),ry(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const DV={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},PV={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:DV,remoteCandidate:DV}},LV={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},MV={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},xV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},UV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function FV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?FV(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class VV{constructor(e,t){ry(this,"onFirstVideoReceived",void 0),ry(this,"onFirstVideoDecoded",void 0),ry(this,"onFirstAudioReceived",void 0),ry(this,"onFirstVideoDecodedTimeout",void 0),ry(this,"onFirstAudioDecoded",void 0),ry(this,"onSelectedLocalCandidateChanged",void 0),ry(this,"onSelectedRemoteCandidateChanged",void 0),ry(this,"videoIsReady",!1),ry(this,"videoIsReady2",{}),ry(this,"pc",void 0),ry(this,"options",void 0),ry(this,"intervalTimer",void 0),ry(this,"stats",OV(PV)),ry(this,"isFirstVideoReceived",{}),ry(this,"isFirstVideoDecoded",{}),ry(this,"isFirstAudioReceived",{}),ry(this,"isFirstAudioDecoded",{}),ry(this,"isFirstVideoDecodedTimeout",{}),ry(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Gh((e=>{e({local:jV({},DV),remote:jV({},DV)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,o=0,s=0;for(const a of n)e[a].forEach(((e,n)=>{if(!this.lossRateWindowStats[t-1][a][n]||!this.lossRateWindowStats[0][a][n])return;const c=this.lossRateWindowStats[t-1][a][n].packets-this.lossRateWindowStats[0][a][n].packets,u=this.lossRateWindowStats[t-1][a][n].packetsLost-this.lossRateWindowStats[0][a][n].packetsLost;"videoSend"===a||"audioSend"===a?(r+=c,o+=u):(i+=c,s+=u),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||u<=0?0:u/(c+u)}));e.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),e.recvPacketLossRate=i<=0||s<=0?0:s/(i+s)}}function BV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BV(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class qV extends VV{constructor(){super(...arguments),ry(this,"_stats",PV),ry(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=OV(PV);const n=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(n);const r=t.find((e=>"VideoBwe"===e.type));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{var t;const n=Dr(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const t=OV(MV);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=OV(LV),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:GV({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=OV(UV);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=OV(xV);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new Gh(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t.push(n)})),t}}function WV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?WV(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class KV extends VV{constructor(){super(...arguments),ry(this,"_stats",PV),ry(this,"report",void 0),ry(this,"lastDecodeVideoReceiverStats",new Map),ry(this,"lastVideoFramesRecv",new Map),ry(this,"lastVideoFramesSent",new Map),ry(this,"lastVideoFramesDecode",new Map),ry(this,"lastVideoFramesOutput",new Map),ry(this,"lastVideoJBDelay",new Map),ry(this,"lastAudioJBDelay",new Map),ry(this,"mediaBytesSent",new Map),ry(this,"mediaBytesRetransmit",new Map),ry(this,"mediaBytesTargetEncode",new Map),ry(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=OV(PV),this.report.forEach((e=>{switch(e.type){case fC.OUTBOUND:case fC.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===fC.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===fC.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case fC.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case fC.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:HV({},DV),remote:HV({},DV)};return e.forEach((n=>{let r;if(n.type===fC.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===fC.CANDIDATE_PAIR&&n.selected&&(r=n),r){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){const i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){const i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===fC.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===fC.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===fC.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(HV({},t),HV({},this.stats.selectedCandidatePair.localCandidate)),e.type===fC.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(HV({},t),HV({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=OV(UV),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=OV(LV),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const r=n.stats,i=o-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}r&&o-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((o-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&o-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:HV({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=OV(MV),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new kV(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new kV(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new kV(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,fC.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=OV(xV),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,fC.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(hC(n=this.report).call(n)).find((n=>n.type===t&&n.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,o,s;const a=t?this.report.get(t):void 0,c=null!==(r=null==a?void 0:a.framesSent)&&void 0!==r?r:e.framesSent;if("number"!=typeof c)return;let u=null!==(i=null==a?void 0:a.frameWidth)&&void 0!==i?i:e.frameWidth,l=null!==(o=null==a?void 0:a.frameHeight)&&void 0!==o?o:e.frameHeight,d=null!==(s=null==a?void 0:a.framesPerSecond)&&void 0!==s?s:e.framesPerSecond;if("number"==typeof u&&"number"==typeof l||(u=0,l=0),null==d){const e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(d=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:d})):t?d=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:u,height:l,frameRate:Math.max(0,d)}}processVideoTrackReceiverStats(e,t,n){var r,i,o,s,a;const c=t?this.report.get(t):void 0,u=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,l=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,h=null!==(s=null==c?void 0:c.jitterBufferDelay)&&void 0!==s?s:e.jitterBufferDelay,p=null!==(a=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount;if("number"==typeof u){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=u;let r=0;e&&t-e.lts>=800?(r=Math.round((u-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:t,rate:0}),n.receivedFrame={width:l||0,height:d||0,frameRate:r||0},n.decodedFrame={width:l||0,height:d||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:l||0,height:d||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(h&&p){const e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=p-e.jitterBufferEmittedCount;r>0&&(t=1e3*(h-e.jitterBufferDelay)/r),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,o,s;const a=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==a?void 0:a.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,u=null!==(o=null!==(s=null==a?void 0:a.echoReturnLossEnhancement)&&void 0!==s?s:e.echoReturnLossEnhancement)&&void 0!==o?o:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=u}processAudioTrackReceiverStats(e,t,n){var r,i,o,s,a,c,u;const l=t?this.report.get(t):void 0,d=null!==(r=null==l?void 0:l.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,h=null!==(i=null==l?void 0:l.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,p=null!==(o=null==l?void 0:l.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,f=null!==(s=null==l?void 0:l.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount,m=null!==(a=null==l?void 0:l.audioLevel)&&void 0!==a?a:null==e?void 0:e.audioLevel,g=null!==(c=null==l?void 0:l.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,_=null!==(u=null==l?void 0:l.concealedSamples)&&void 0!==u?u:e.concealedSamples;if(d&&h&&(n.accelerateRate=d/h),p&&f){const e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=f-e.jitterBufferEmittedCount;r>0&&(t=1e3*(p-e.jitterBufferDelay)/r),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:f,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=m;let E=1920;g&&h&&(E=h/g/50,n.receivedFrames=Math.round(h/E)),_&&(n.droppedFrames=Math.round(_/E))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{n=null===n?e.diffMean():n+e.diffMean()}));const r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}class zV extends VV{updateStats(){return Gh.resolve()}}function YV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const o=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return o?o<76?new qV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new KV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){return!!window.RTCStatsReport&&e.getStats()instanceof Gh}(e)?new KV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new zV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}function JV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function XV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?JV(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JV(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function QV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:o,filterAudioFec:s,filterAudioCodec:a,filterVideoCodec:c}=t,{useXR:u}=n;let l=[],d=[],h=[],p=[],f=!1,m=!1;if(AV.parse(e).mediaDescriptions.forEach((e=>{r&&r!==e.attributes.direction||("video"!==e.media.mediaType||f||(d=e.attributes.payloads,p=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||m||(l=e.attributes.payloads,h=e.attributes.extmaps,m=!0))})),!p||0===d.length)throw new Error("Cannot get video capabilities from SDP.");if(!h||0===l.length)throw new Error("Cannot get audio capabilities from SDP.");if(d.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})})),l.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})})),i&&(l=l.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),d=d.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),o&&(d=d.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),s&&(l=l.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),a&&(null==a?void 0:a.length)>0&&(l=l.filter((e=>{var t;return Dr(a).call(a,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),c&&(null==c?void 0:c.length)>0){const e=d.filter((e=>{var t;return Dr(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}));d=e.concat(i?[]:mB(e,d))}const g=kR("UNSUPPORTED_VIDEO_CODEC");return g&&g.length>0&&(d=d.filter((e=>!(e.rtpMap&&Dr(g).call(g,e.rtpMap.encodingName.toLowerCase()))))),{audioCodecs:l,videoCodecs:d,audioExtensions:h,videoExtensions:p}}function ZV(e){const t=AV.parse(e);let n,r;for(const i of t.mediaDescriptions){if(!n){const e=i.attributes.iceUfrag,t=i.attributes.icePwd;if(!e||!t)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:e,icePwd:t}}if(!r){const e=i.attributes.fingerprints;e.length>0&&(r={fingerprints:e})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function $V(e,t){const n=[],r=e.attributes.ssrcGroups.filter((e=>"FID"===e.semantic)),i=e.attributes.ssrcGroups.find((e=>"SIM"===e.semantic)),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((e=>{var i;const o=null===(i=r.find((t=>t.ssrcIds[0]===e)))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?o:void 0})}));else if(r.length>0){const e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function eB(e,t){const{cname:n}=e;let r;t&&t.ip&&"number"==typeof t.port?(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],QR.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),QR.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):r=e.iceParameters.candidates.map((e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})));const i={fingerprints:e.dtlsParameters.fingerprints.map((e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint})))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let s;switch(e.dtlsParameters.role){case"server":s="passive";break;case"client":s="active";break;case"auto":s="actpass"}return{dtlsParameters:i,iceParameters:o,candidates:r,rtpCapabilities:dB(e.rtpCapabilities),setup:s,cname:n}}function tB(e,t,n){const r=[],i=[];return e.forEach((e=>{let{ssrcId:o,rtx:s}=e;const a=eR(8,"track-"),c={ssrcId:o,attributes:XV({label:a,mslabel:n=n||eR(10,""),msid:"".concat(n," ").concat(a)},t&&{cname:t})};if(r.push(c),void 0!==s){const e={ssrcId:s,attributes:XV({label:a,mslabel:n,msid:"".concat(n," ").concat(a)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[o,s]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((e=>{let{ssrcId:t}=e;return t}))}),{ssrcs:r,ssrcGroups:i}}function nB(e,t){t instanceof PF&&e.attributes.payloads.forEach((e=>{var n;const r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!DS()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))}))}function rB(e){const t=e.attributes.unrecognized.findIndex((e=>"x-google-flag"===e.attField&&"conference"===e.attValue));-1!==t&&e.attributes.unrecognized.splice(t,1)}function iB(e,t){var n;if(!(t instanceof Sj&&t._encoderConfig&&-1===t._hints.indexOf(Px.SCREEN_TRACK)))return;const r=t._encoderConfig;fx().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach((e=>{var t,n;Dr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))})),fx().supportMinBitrate&&!Dr(n=t._hints).call(n,Px.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach((e=>{var t,n;Dr(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(kR("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))}))}function oB(e){if("video"!==e.media.mediaType)return;const t=wS();if(t.name!==yS.SAFARI&&t.os!==vS.IOS)return;const n=e.attributes.extmaps.findIndex((e=>/video-orientation/g.test(e.extensionName)));-1!==n&&e.attributes.extmaps.splice(n,1)}function sB(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=r.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));if(t){e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"});const n=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))))))}(i,e.attributes.payloads);n.forEach((e=>{e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))||e.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){const t=r.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));if(t){e.attributes.extmaps.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"});const n=function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))))))}(i,e.attributes.payloads);n.forEach((e=>{e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))||e.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"goog-remb"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}function aB(e,t,n){if(DS())return;if("video"!==e.media.mediaType)return;if(!(t instanceof Sj))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!kR("SIMULCAST"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find((e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId)),s={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let a=1;a<r;a++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+a,attributes:Gw(i.attributes)}),s.ssrcIds.push(i.ssrcId+a),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+a,attributes:Gw(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+a,o.ssrcIds[1]+a]}));e.attributes.ssrcGroups.unshift(s)}async function cB(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:o,sendrecv:s}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=QV(n,e,t,"sendonly"),i=QV(n,e,t,"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(lB(r,i,"videoExtensions",o,s,a),lB(r,i,"videoCodecs",o,s,a),lB(r,i,"audioExtensions",o,s,a),lB(r,i,"audioCodecs",o,s,a),kR("RAISE_H264_BASELINE_PRIORITY")){const e=a.videoCodecs.findIndex((e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])}));if(-1!==e){const t=a.videoCodecs.findIndex((e=>{var t;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())}));if(t<e){QR.debug("raising H264 baseline profile priority");const n=a.videoCodecs[e];a.videoCodecs.splice(e,1),a.videoCodecs.splice(t,0,n)}-1!==t&&(s.videoCodecs=s.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))),-1!==t&&kR("FILTER_SEND_H264_BASELINE")&&(o.videoCodecs=o.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})))}}return{send:o,recv:s,sendrecv:a}}(e,t,r);try{n.close()}catch(e){}return{send:i,recv:o,sendrecv:s}}function uB(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=QV(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(lB(e,t,"videoExtensions",n,r,i),lB(e,t,"videoCodecs",n,r,i),lB(e,t,"audioExtensions",n,r,i),lB(e,t,"audioCodecs",n,r,i),kR("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){const t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){QR.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&(r.videoCodecs=r.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}function lB(e,t,n,r,i,o){if("videoExtensions"===n||"audioExtensions"===n){const s=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return s.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===s.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){const s=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return s.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===s.indexOf(t)&&i[n].push(e)}))}}function dB(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,o;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...r.audioCodecs],o.videoCodecs=[...n.videoCodecs,...r.videoCodecs],o.audioExtensions=[...n.audioExtensions,...r.audioExtensions],o.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):o=r,{send:i,recv:o}}function hB(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function pB(e){e.mediaDescriptions.forEach((e=>{"video"!==e.media.mediaType&&"audio"!==e.media.mediaType||e.attributes.payloads.forEach((e=>{-1===e.rtcpFeedbacks.findIndex((e=>"rrtr"===e.type))&&e.rtcpFeedbacks.push({type:"rrtr"})}))}))}function fB(e,t,n,r){let i=[];if(e===rA.VIDEO){if(kR("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter((e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===kR("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(i)||0===i.length){let e=[];const o=[],s=[],a=[];if(n.videoCodecs.forEach((t=>{const n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";Dr(n).call(n,r)?e.push(t):Dr(n).call(n,"vp9")?o.push(t):Dr(n).call(n,"vp8")?s.push(t):Dr(n).call(n,"h264")&&a.push(t)})),0===e.length){let t="";0!==o.length?(e=o,t="vp9"):0!==s.length?(e=s,t="vp8"):0!==a.length&&(e=a,t="h264"),QR.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(i=t.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(0===i.length&&(QR.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),kR("USE_PUB_RTX")||kR("USE_SUB_RTX")){const e=mB(i,t.videoCodecs);i=[...i,...e]}}else i=t.audioCodecs.filter((e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)})),0===i.length&&(QR.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter((e=>{var t;return Dr(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")})));return i}function mB(e,t){const n=e.map((e=>e.payloadType.toString()));return t.filter((e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Dr(n).call(n,e.fmtp&&e.fmtp.parameters.apt)))}let gB=class{get localCapabilities(){return Gw(this._localCapabilities)}get rtpCapabilities(){return Gw(this._rtpCapabilities)}get candidates(){return Gw(this._candidates)}get iceParameters(){return Gw(this._iceParameters)}get dtlsParameters(){return Gw(this._dtlsParameters)}constructor(e){ry(this,"sessionDesc",void 0),ry(this,"_localCapabilities",void 0),ry(this,"_rtpCapabilities",void 0),ry(this,"_candidates",void 0),ry(this,"_iceParameters",void 0),ry(this,"_dtlsParameters",void 0),ry(this,"setup",void 0),ry(this,"currentMidIndex",void 0),ry(this,"cname","o/i14u9pJrxRKAsu"),ry(this,"firefoxSsrcMidMap",new Map),e=Gw(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:o,direction:s,setup:a,videoCodec:c,audioCodec:u}=e;let l;this.setup=a,l=s===RC.RECEIVE_ONLY?AV.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"):AV.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=o;const d=s===RC.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=s===RC.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=s===RC.RECEIVE_ONLY?i.send.videoCodecs:fB(rA.VIDEO,d,h,c),f=s===RC.RECEIVE_ONLY?i.send.audioCodecs:fB(rA.AUDIO,d,h,u);for(const m of l.mediaDescriptions)m.attributes.iceUfrag=t.iceUfrag,m.attributes.icePwd=t.icePwd,m.attributes.fingerprints=n.fingerprints,m.attributes.candidates=r,m.attributes.setup=this.setup,"application"===m.media.mediaType&&(m.attributes.sctpPort="5000"),"video"===m.media.mediaType&&(m.media.fmts=p.map((e=>e.payloadType.toString(10))),m.attributes.payloads=p,m.attributes.extmaps=d.videoExtensions),"audio"===m.media.mediaType&&(m.media.fmts=f.map((e=>e.payloadType.toString(10))),m.attributes.payloads=f,m.attributes.extmaps=d.audioExtensions,hB(m));this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return AV.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((e=>this.hasMid(e))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:s}=tB(t,this.cname,kR("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(o);if(a){if(DS()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,o,r);let n;return-1===t?(n=this.createOrRecycleSendMedia(e,o,s,"sendonly",r,i),this.updateBundleMids()):(n=Gw(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=o,n.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,i)),DS()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,n.attributes.mid),{needExchangeSDP:!0,mid:n.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{e.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach((e=>{const i=e._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(i);let s,a=!1;-1===o?(a=!0,s=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(s=Gw(this.sessionDesc.mediaDescriptions[o]),s.attributes.direction="recvonly"),r.push({mid:s.attributes.mid,needCreateTransceiver:a})})),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:o,relatedAddress:s,relatedPort:a,priority:c}=new RTCIceCandidate(e),u={foundation:null!=t?t:"",componentId:"1",transport:null!=n?n:"",priority:c?c+"":"",connectionAddress:null!=r?r:"",port:i?i+"":"",type:o?o+"":"",relAddr:null!=s?s:"",relPort:a?a+"":"",extension:{}};this.candidates.some((e=>e.priority===u.priority&&e.connectionAddress===u.connectionAddress&&e.port===u.port))||(this._candidates.push(u),this.sessionDesc.mediaDescriptions.forEach((e=>{e.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const o=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,a=fB(o,s,this.localCapabilities.send,o===rA.AUDIO?i:r),c=o===rA.VIDEO?s.videoExtensions:s.audioExtensions,u="".concat(++this.currentMidIndex);let l={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};l=this.mungRecvMediaDsec(l,e);const d=this.findFirstClosedMedia(o);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex((r=>{const i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(DS()){if(i){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const n=t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction);return"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&n}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Gw(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,n,r,i,o){const s=this.rtpCapabilities.send,a=e===rA.VIDEO?s.videoCodecs:s.audioCodecs,c=e===rA.VIDEO?s.videoExtensions:s.audioExtensions;DS()&&(i="".concat(++this.currentMidIndex));let u={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};u=this.mungSendMediaDesc(u,o);const l=this.findFirstClosedMedia(e);if(l){const e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}mungRecvMediaDsec(e,t,n){const r=Gw(e);return rB(r),nB(r,t),iB(r,t),oB(r),sB(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Gw(e);return sB(n,t,this.localCapabilities.recv),hB(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>DS()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}};const _B=["sdp"];var EB;function vB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vB(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vB(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let bB=(EB=class e extends tA{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),ry(this,"direction",void 0),ry(this,"name",void 0),ry(this,"store",void 0),ry(this,"spec",void 0),ry(this,"peerConnection",void 0),ry(this,"initialOffer",void 0),ry(this,"transport",void 0),ry(this,"statsFilter",void 0),ry(this,"localCandidateCount",0),ry(this,"_isInRestartIce",!1),ry(this,"mutex",new hR("P2PConnection-mutex")),ry(this,"onLocalCandidate",void 0),ry(this,"remoteSDP",void 0),ry(this,"pendingCandidates",[]),ry(this,"localCapabilities",void 0),ry(this,"isReady",!1),ry(this,"restartCnt",0),ry(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=r?r:RC.SEND_ONLY,this.name=this.direction===RC.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=YV(this.peerConnection,kR("STATS_UPDATE_INTERVAL"),void 0,DS()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await cB();if(this.localCapabilities=dB(t),e){const{sdp:t}=e,n=IV(e,_B),r=function(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=QV(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(lB(t,e,"videoExtensions",n,r,i),lB(t,e,"videoCodecs",n,r,i),lB(t,e,"audioExtensions",n,r,i),lB(t,e,"audioCodecs",n,r,i),kR("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]));if(-1!==e){const t=i.videoCodecs.findIndex((e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()));if(t<e){QR.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&kR("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter((e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"]))))}}return{send:n,recv:r,sendrecv:i}}({},{},t);this.remoteSDP=new gB({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:r,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const o=ZV(i.sdp);await this.peerConnection.setLocalDescription(i);const s=await uB({},{},i.sdp);this.localCapabilities=dB(s);const a=this.peerConnection.getTransceivers()[0];return null!=a&&a.receiver&&a.receiver.transport&&this.tryBindTransportEvents(a.receiver.transport),yB(yB({},o),{},{sdp:i.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ZV(e.sdp);return this.initialOffer=e,yB(yB({},t),{},{sdp:e.sdp})}}catch(e){throw new nw(tw.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:n,dtlsParameters:r}=e,i=await uB({},{},t);this.remoteSDP=new gB({remoteIceParameters:n,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];null!=o&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((e=>{this.peerConnection.addIceCandidate(e)})),this.pendingCandidates=[])}catch(e){throw new nw(tw.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return pV((function*(){const i=yield iV(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=[],o=r.remoteSDP.receive(e,t,n);e.forEach(((e,t)=>{if(o[t].needCreateTransceiver){const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)}else{const n=r.peerConnection.getTransceivers().find((e=>e.mid===o[t].mid));if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(o[t].mid));i.push(n),e._updateRtpTransceiver(n)}})),DS()&&!0===kR("SIMULCAST")&&(yield iV(r.applySimulcastForFirefox(i,e)));const s=o.map((e=>e.mid)),a=yield iV(r.peerConnection.createOffer()),c=r.mungSendOfferSDP(a.sdp,e,s),u=AV.parse(c),l=s.map((e=>{const t=u.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return $V(t,kR("USE_PUB_RTX"))})),d=i.map(((e,t)=>{const n=s[t];return{localSSRC:l[t],id:n}}));yield iV(r.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield d}catch(e){const n=r.remoteSDP.toString();throw yield iV(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield iV(r.peerConnection.setRemoteDescription({type:"answer",sdp:n})),yield iV(r.stopSending(s,!0)),e}yield iV(r.applySimulcastEncodings(i,e)),yield iV(r.applySendEncodings(i,e));const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return null==p||p(h),yield iV(r.setRemoteDescription({type:"answer",sdp:h})),i.map(((e,t)=>{const n=s[t];return{localSSRC:l[t],id:n}}))}catch(e){throw e instanceof nw?e:new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),QR.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else QR.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const s=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!s||null===s.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,mid:s.mid,transceiver:s}}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),QR.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else QR.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===IR.Auto&&(this.store.p2pTransport=IR.SdRtn,fx().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,fx().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:t}=ZV(e.sdp);return this.store.descriptionStart(),this.direction===RC.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===RC.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:t}=ZV(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?DS()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:yB(yB({},DV),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:yB(yB({},DV),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Dr(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):QR.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i={iceServers:[]};var o;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Cw(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,r)),kR("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Dr(o=[IR.Relay,IR.SdRtn]).call(o,n)&&(i.iceTransportPolicy="relay"),kR("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(i.iceTransportPolicy="relay")})))),kR("ENABLE_ENCODED_TRANSFORM")&&fx().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),QR.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=[],i=e.filter((e=>e.tcpport));QR.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));const o=i.length>n?i[n]:i[0];switch(t){case IR.SdRtn:const t=e.filter((e=>{var t;return Dr(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL})),i=t.length>n?t[n]:t[0];i&&(r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(WA(i.turnServerURL),":").concat(i.tcpport,"?transport=udp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(WA(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;case IR.Relay:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(WA(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(WA(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:e,remote:n}=t.getSelectedCandidatePair();QR.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>t.track===e._mediaStreamTrack))),!t)return QR.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return QR.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!fx().supportSetRtpSenderParameters)return QR.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var o;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),Dr(o=e._hints).call(o,Px.LOW_STREAM)&&(n&&(i.maxFramerate=KA(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if(kR("DSCP_TYPE")&&JS()){var s;const e=kR("DSCP_TYPE");Dr(s=["very-low","low","medium","high"]).call(s,e)&&(i.networkPriority=e)}const a=t.getParameters(),c=null===(n=a.encodings)||void 0===n?void 0:n[0];DS()&&!c&&(r.encodings=[i]),c&&Object.assign(c,i),Object.assign(a,r),QR.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!fx().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof Sj&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){QR.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=AV.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(nB(o,e),aB(o,e,this.store.codec))})),AV.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o,s;const c=e[a],u=t[a];if(u instanceof Sj&&!Dr(n=u._hints).call(n,Px.LOW_STREAM)&&null!==(r=u._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=u._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=u._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=u._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!DS()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof Sj&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof Sj&&kR("SIMULCAST")&&"vp8"===this.store.codec&&!Dr(t=e._hints).call(t,Px.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(kR("SDP_LOGGING"))return QR.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async e=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var n,r;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentRemoteDescription)||void 0===r?void 0:r.sdp){var i;const n=null===(i=AV.parse(t).mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===i?void 0:i.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Dr(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){const r=AV.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===rA.AUDIO&&"audio"===i.media.mediaType&&hB(i),AV.print(r)}},rC(EB.prototype,"establish",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"establish"),EB.prototype),rC(EB.prototype,"connect",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"connect"),EB.prototype),rC(EB.prototype,"receive",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"receive"),EB.prototype),rC(EB.prototype,"mockReceive",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"mockReceive"),EB.prototype),rC(EB.prototype,"stopReceiving",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"stopReceiving"),EB.prototype),rC(EB.prototype,"restartICE",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"restartICE"),EB.prototype),rC(EB.prototype,"close",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"close"),EB.prototype),rC(EB.prototype,"updateEncoderConfig",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"updateEncoderConfig"),EB.prototype),rC(EB.prototype,"updateSendParameters",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"updateSendParameters"),EB.prototype),rC(EB.prototype,"replaceTrack",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"replaceTrack"),EB.prototype),rC(EB.prototype,"muteLocal",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"muteLocal"),EB.prototype),rC(EB.prototype,"unmuteLocal",[TB],Object.getOwnPropertyDescriptor(EB.prototype,"unmuteLocal"),EB.prototype),EB);function TB(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function SB(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=KA(t.width),r.height=KA(t.height);const i=KA(t.framerate||15);document.body.append(n),document.body.append(r);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const s=r.getContext("2d");if(!s)throw new CC(tw.UNEXPECTED_ERROR,"can not get canvas context");const a=fx(),c=r.captureStream(a.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(QR.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}s.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))},r.stopCapture=hU((()=>r.startCapture&&r.startCapture()),i);const u=c.stop;return c.stop=()=>{u.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),QR.debug("clean low stream renderer")},c}var wB=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(wB||{}),RB=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(RB||{}),IB=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(IB||{}),CB=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(CB||{}),AB=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(AB||{}),OB=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(OB||{}),NB=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(NB||{}),kB=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(kB||{}),DB=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(DB||{}),PB=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(PB||{});const LB=1e3,MB=3;function xB(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function UB(e){const t={[PB.CONN_TYPE]:0,[PB.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[PB.CONN_TYPE]=1),"tcp"===n&&(t[PB.CONN_TYPE]=3),"tls"===n&&(t[PB.CONN_TYPE]=4);break}case"srflx":t[PB.CONN_TYPE]=2}return t}function FB(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class jB extends vw{constructor(e){super(),ry(this,"store",void 0),ry(this,"uploadWRTCStatsTimer",void 0),ry(this,"uploadOutboundDenoiserStatsTimer",void 0),ry(this,"uploadExtStatsTimer",void 0),ry(this,"uploadExtUsageStatsTimer",void 0),ry(this,"uploadInboundExtStatsTimer",void 0),ry(this,"requestStats",void 0),ry(this,"requestTransportStats",void 0),ry(this,"requestLocalMedia",void 0),ry(this,"requestRemoteMedia",void 0),ry(this,"requestAllTracks",void 0),ry(this,"requestVideoIsReady",void 0),ry(this,"requestUploadStats",void 0),ry(this,"requestUpload",void 0),ry(this,"uploadOutboundStarted",!1),ry(this,"uploadInboundStarted",!1),ry(this,"uploadTransportStarted",!1),ry(this,"uploadExtensionUsageStarted",!1),ry(this,"lastRecvStats",void 0),ry(this,"lastSendStats",void 0),ry(this,"lastFullRecvStats",void 0),ry(this,"lastFullSendStats",void 0),ry(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t,n;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(n=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!n&&this.uploadInboundStarted&&(n=this.requestStats(!0)),t||n){const r={};if(this.uploadTransportStarted&&t){const i=this.getTransportStats(t,n,e);i&&(r.misc=[i])}if(this.uploadOutboundStarted&&t){const n=this.getOutboundStats(t,e?this.lastSendStats:this.lastFullSendStats,e);n&&(r.outbound=[n])}if(this.uploadInboundStarted&&n){const t=this.getInboundStats(n,e?this.lastRecvStats:this.lastFullRecvStats,e);t&&(r.inbound=t)}this.requestUploadStats(r)}this.lastRecvStats=n,this.lastSendStats=t,e||(this.lastFullRecvStats=n,this.lastFullSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==MB),++e===MB+1&&(e=1)}),LB)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,n){if(!this.requestStats)return;if(n)return null==e.rtt?void 0:{addition:{[PB.RTT]:e.rtt,[PB.CONN_TYPE]:void 0}};const r=UB(e);if(this.store.useP2P){if(t){const e=UB(t);r[PB.CONN_TYPE]+=e[PB.CONN_TYPE]<<3}r[PB.CONN_TYPE]+=110}else r[PB.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,n){if(!this.requestUploadStats||!this.requestLocalMedia)return;const r=this.requestLocalMedia();if(!r||0===r.length)return;let i,o,s;return r.forEach((r=>{let[a,{track:c,ssrcs:u}]=r;switch(a){case sA.LocalVideoLowTrack:case sA.LocalVideoTrack:if(a===sA.LocalVideoTrack){const r=function(e,t,n,r,i){const o=t.videoSend.find((t=>t.ssrc===e));if(!o)return;const s={},{sentFrame:a,inputFrame:c}=o;if(c&&a){const e=c.frameRate,t=a.frameRate;s[RB.FREEZE]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(e,t)?1:0}if(xB(s,RB.QP_SUM,o.qpSumPerFrame),i)return s;switch(a&&(xB(s,RB.HEIGHT,a.height),xB(s,RB.WIDTH,a.width),xB(s,RB.FRAME_RATE,a.frameRate)),s[RB.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0,o.adaptionChangeReason){case"none":s[RB.ADAPTATION]=0;break;case"cpu":s[RB.ADAPTATION]=1;break;case"bandwidth":s[RB.ADAPTATION]=2;break;case"other":s[RB.ADAPTATION]=3}let u=0;o.adaptionChangeReason&&(u+=FB(o.adaptionChangeReason)),t.qualityLimitationReason&&(u+=FB(t.qualityLimitationReason)<<3),s[RB.ADAPTATION]=u,s[RB.PLAYER_STATUS]=Zx[r._player?r._player.videoElementStatus:"uninit"],xB(s,RB.NACKS,o.nacksCount),xB(s,RB.PLIS,o.plisCount),xB(s,RB.FIRS,o.firsCount),xB(s,RB.AVG_ENCODE,o.avgEncodeMs);const l=n&&n.videoSend.find((t=>t.ssrc===e));if(l){let e=i?LB:LB*MB;l.timestamp&&o.timestamp&&(e=o.timestamp-l.timestamp),null!=l.packets&&null!=o.packets&&xB(s,RB.PACKAGE_RATE,1e3*(o.packets-l.packets)/e),null!=o.packetsLost&&null!=l.packetsLost&&xB(s,RB.PACKAGE_LOST,o.packetsLost-l.packetsLost),null!=l.bytes&&null!=o.bytes&&xB(s,RB.BITRATE,8*(o.bytes-l.bytes)/e)}return s}(u[0].ssrcId,e,t,c,n),i=n?null:function(e,t,n){const r=t.videoSend.find((t=>t.ssrc===e));if(!r)return null;const i={},o=r.inputFrame,s=o&&o.height||n&&n.videoHeight||0,a=o&&o.width||n&&n.videoWidth||0,c=o&&o.frameRate||0;return xB(i,wB.HEIGHT,s),xB(i,wB.WIDTH,a),xB(i,wB.FRAME_RATE,c),i}(u[0].ssrcId,e,c),s=n?null:function(e){const t={};return xB(t,RB.RETRANSMIT,e.bitrate.retransmit),xB(t,RB.TARGET_ENCODED,e.bitrate.targetEncoded),xB(t,RB.ACTUAL_ENCODED,e.bitrate.actualEncoded),xB(t,RB.TRANSMIT,e.bitrate.transmit),xB(t,RB.BANDWIDTH,e.sendBandwidth),t}(e);o=Object.assign({},r,i,s)}else s=n?void 0:function(e,t,n){const r=t.videoSend.find((t=>t.ssrc===e));if(!r)return;const i={},o=r.sentFrame;if(o&&(xB(i,IB.HEIGHT,o.height),xB(i,IB.WIDTH,o.width),xB(i,IB.FRAME_RATE,o.frameRate)),n){const t=n.videoSend.find((t=>t.ssrc===e));if(t){let e=LB*MB;t.timestamp&&r.timestamp&&(e=r.timestamp-t.timestamp),null!=t.packets&&null!=r.packets&&xB(i,IB.PACKAGE_RATE,1e3*(r.packets-t.packets)/e),null!=r.packetsLost&&null!=t.packetsLost&&xB(i,IB.PACKAGE_LOST,r.packetsLost-t.packetsLost),null!=t.bytes&&null!=r.bytes&&xB(i,IB.BITRATE,8*(r.bytes-t.bytes)/e)}}return i}(u[0].ssrcId,e,t);break;case sA.LocalAudioTrack:i=n?void 0:function(e,t,n,r){const i=t.audioSend.find((t=>t.ssrc===e));if(!i)return;const o={};o[NB.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0;const s=100*r._source.getAccurateVolumeLevel(),a=i.inputLevel;if(null!=a){const e=Math.ceil(50*Math.log10(100*a+1));xB(o,NB.LEVEL,e)}xB(o,OB.PCM_LEVEL,s),xB(o,NB.AEC_RETURN_LOSS,i.aecReturnLoss),xB(o,NB.AEC_RETURN_LOSS_ENH,i.aecReturnLossEnhancement),o[NB.FREEZE]=0;const c=n&&n.audioSend.find((t=>t.ssrc===e));if(c){let e=LB*MB;c.timestamp&&i.timestamp&&(e=i.timestamp-c.timestamp),null!=c.bytes&&null!=i.bytes&&xB(o,NB.BITRATE,8*(i.bytes-c.bytes)/e),null!=c.packets&&null!=i.packets&&xB(o,NB.PACKAGE_RATE,1e3*(i.packets-c.packets)/e)}return o}(u[0].ssrcId,e,t,c)}})),{high:o,low:s,audio:i}}getInboundStats(e,t,n){if(!this.requestRemoteMedia)return;const r=this.requestRemoteMedia()||[],i=[];return r.forEach((r=>{let[o,s]=r;const a={peer:o.uid};if(s.has(rA.VIDEO)&&o.videoTrack){const r=o._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(o._videoSSRC)||!1,i=o.videoTrack?function(e,t,n,r,i,o,s){var a;const c=t.videoRecv.find((t=>t.ssrc===e));if(!c)return;const u={},{receivedFrame:l,outputFrame:d,decodeFrameRate:h}=c,p=n&&n.videoRecv.find((t=>t.ssrc===e));if(u[CB.FREEZE]=i&&uG.isRemoteVideoFreeze(r,c,p)?1:0,xB(u,AB.FRAME_RATE_DECODE,h),xB(u,CB.QP_SUM,c.qpSumPerFrame),c.framesRateFirefox&&xB(u,CB.FRAME_RATE,c.framesRateFirefox),l&&xB(u,CB.FRAME_RATE,l.frameRate),p){const e=t.timestamp-n.timestamp||(s?LB:MB*LB);null!=c.packetsLost&&null!=p.packetsLost&&xB(u,CB.PACKAGE_LOST,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&xB(u,CB.BITRATE,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&xB(u,CB.PACKAGE_RATE,1e3*(c.packets-p.packets)/e)}if(s)return u;l?(xB(u,CB.HEIGHT,l.height),xB(u,CB.WIDTH,l.width)):r&&(xB(u,CB.HEIGHT,r._videoHeight||0),xB(u,CB.WIDTH,r._videoWidth||0)),d&&xB(u,AB.FRAME_RATE_OUTPUT,d.frameRate);const f=null===(a=r._player)||void 0===a?void 0:a.rendFrameRate.toFixed(0);if(f&&xB(u,AB.FRAME_RATE_RENDER,+f),xB(u,CB.JITTER_BUFFER,c.jitterBufferMs),xB(u,CB.CURRENT_DELAY,c.currentDelayMs),xB(u,CB.FIRS,c.firsCount),xB(u,CB.NACKS,c.nacksCount),xB(u,CB.PLIS,c.plisCount),r){u[CB.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1;const e=r._player;if(e){const{freezeTimeCounterList:t,renderFreezeAccTime:n,videoElementStatus:r}=e;if(t&&t.length>0&&xB(u,AB.FREEZE_TIME,t.splice(0,1)[0]),o&&"visible"===Bj.visibility&&r===Xx.PLAYING&&fx().supportRequestVideoFrameCallback){const t=Math.min(6e3,n);e.renderFreezeAccTime=Math.max(0,n-t),xB(u,AB.FREEZE_TIME_RENDER,t)}if("number"==typeof c.totalFreezesDuration){const e=p&&p.totalFreezesDuration?c.totalFreezesDuration-p.totalFreezesDuration:c.totalFreezesDuration;xB(u,AB.FREEZE_DURATION,1e3*e)}}}if(u[CB.PLAYER_STATUS]=Zx[r._player?r._player.videoElementStatus:"uninit"],p&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==p.totalInterFrameDelay&&void 0!==p.totalSquaredInterFrameDelay){const e=c.totalInterFrameDelay-p.totalInterFrameDelay,t=c.totalSquaredInterFrameDelay-p.totalSquaredInterFrameDelay,n=c.framesDecodeCount-p.framesDecodeCount,r=e/n*1e3,i=Math.round(1e3*Math.sqrt((t-Math.pow(e,2)/n)/n));!isNaN(i)&&r+i>Math.max(3*r,r+150)&&(u[CB.I_FRAME_DELAY]=i)}return u}(o._videoSSRC,e,t,o.videoTrack,!0===r,this.needUploadRenderFreezeTime,n):void 0;i&&(a.video=i)}if(s.has(rA.AUDIO)&&o.audioTrack){const r=o.audioTrack?function(e,t,n,r,i){const o=t.audioRecv.find((t=>t.ssrc===e));if(!o)return;const s={},a=n&&n.audioRecv.find((t=>t.ssrc===e)),{receivedFrames:c,droppedFrames:u}=o;var l;if(xB(s,kB.JITTER,o.jitterMs),null!=c&&null!=u&&(s[kB.FREEZE]=0===(l=c)||100*u/l>20?1:0),a){const e=t.timestamp-n.timestamp||(i?LB:LB*MB);null!=o.packets&&null!=a.packets&&xB(s,kB.PACKAGE_RATE,1e3*(o.packets-a.packets)/e),null!=a.bytes&&null!=o.bytes&&xB(s,kB.BITRATE,8*(o.bytes-a.bytes)/e),null!=o.packetsLost&&null!=a.packetsLost&&xB(s,kB.PACKAGE_LOST,o.packetsLost-a.packetsLost)}if(i)return s;const d=100*r._source.getAccurateVolumeLevel(),h=o.outputLevel;if(null!=h){const e=Math.ceil(50*Math.log10(100*h+1));xB(s,DB.LEVEL,e)}if(xB(s,kB.PCM_LEVEL,d),r&&(s[kB.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1),xB(s,kB.JITTER_BUFFER,o.jitterBufferMs),xB(s,kB.CURRENT_DELAY,o.jitterBufferMs),s[kB.PLAYER_STATUS]=Zx[DU.getPlayerState(r.getTrackId())],a){const e=o.concealedSamples-a.concealedSamples;e>0&&xB(s,kB.CONCEALED_SAMPLES,e)}return s}(o._audioSSRC,e,t,o.audioTrack,n):void 0;r&&(a.audio=r)}(a.video||a.audio)&&i.push(a)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,i}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find((e=>e instanceof LF));if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(SC.DENOISER_STATS,t)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach((e=>{e.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach((e=>{let[t,n]=e;n.has(rA.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})),n.has(rA.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach((e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const t=Date.now(),n={connectionInterval:kR("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let r=[];const i=this.requestAllTracks&&this.requestAllTracks()||[];for(const e of i)!e.muted&&e.enabled&&(r=r.concat(await e.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[e,c]of o)c.has(rA.VIDEO)&&e.videoTrack&&(r=r.concat(await e.videoTrack.getProcessorUsage())),c.has(rA.AUDIO)&&e.audioTrack&&(r=r.concat(await e.audioTrack.getProcessorUsage()));if(0===r.length)return;n.details=function(e,t){const n={};for(const{id:s,value:a,level:c,direction:u}of e){var r;const e=null!==(r=t.get(s))&&void 0!==r?r:0,l=2===a?e+kR("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,o;t.set(s,l),n[s]?(2===a&&(n[s].value=a),c>n[s].level&&(n[s].level=c),"remote"===u&&(n[s].remoteUidCount+=1),n[s].totalTs=null!==(i=t.get(s))&&void 0!==i?i:0):n[s]={value:a,level:c,remoteUidCount:"local"===u?0:1,totalTs:null!==(o=t.get(s))&&void 0!==o?o:0}}return Object.keys(n).map((e=>{const{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}}))}(r,e);const s=Date.now(),a=s>t?s:t+1;this.requestUpload&&this.requestUpload(SC.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:a})}),kR("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class VB{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){ry(this,"uid",void 0),ry(this,"_uintid",void 0),ry(this,"_trust_in_room_",!0),ry(this,"_trust_audio_enabled_state_",!0),ry(this,"_trust_video_enabled_state_",!0),ry(this,"_trust_audio_mute_state_",!0),ry(this,"_trust_video_mute_state_",!0),ry(this,"_audio_muted_",!1),ry(this,"_video_muted_",!1),ry(this,"_audio_enabled_",!0),ry(this,"_video_enabled_",!0),ry(this,"_audio_added_",!1),ry(this,"_video_added_",!1),ry(this,"_is_pre_created",!1),ry(this,"_video_pre_subscribed",!1),ry(this,"_audio_pre_subscribed",!1),ry(this,"_trust_video_stream_added_state_",!0),ry(this,"_trust_audio_stream_added_state_",!0),ry(this,"_audioTrack",void 0),ry(this,"_videoTrack",void 0),ry(this,"_dataChannels",[]),ry(this,"_audioSSRC",void 0),ry(this,"_videoSSRC",void 0),ry(this,"_audioOrtc",void 0),ry(this,"_videoOrtc",void 0),ry(this,"_cname",void 0),ry(this,"_rtxSsrcId",void 0),ry(this,"_videoMid",void 0),ry(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}let BB=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function GB(e,t){var n;let r;switch(t){case sA.LocalAudioTrack:r=HC.Audio;break;case sA.LocalVideoTrack:r=Dr(n=e._hints).call(n,Px.SCREEN_TRACK)?HC.Screen:HC.High;break;case sA.LocalVideoLowTrack:r=HC.Low}return r}function qB(e){const t=fx();if(e.some((e=>e._bypassWebAudio)))throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function WB(e,t){qB(e);const n=t||new xF;return e.forEach((e=>n.addAudioTrack(e))),n}var HB,KB,zB,YB,JB,XB,QB,ZB,$B,eG,tG,nG;function rG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function iG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let oG=(HB=sG(BB.SEND_ONLY),KB=sG(BB.SEND_ONLY),zB=sG(),YB=sG(BB.RECEIVE_ONLY),JB=sG(BB.RECEIVE_ONLY),XB=sG(BB.RECEIVE_ONLY),QB=sG(BB.RECEIVE_ONLY),ZB=sG(BB.RECEIVE_ONLY),$B=sG(BB.RECEIVE_ONLY),eG=sG(),tG=sG(BB.RECEIVE_ONLY),nG=class extends vw{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(cA.StateChange,t,this._state)}constructor(e,t){super(),ry(this,"store",void 0),ry(this,"statsUploader",void 0),ry(this,"sendConnection",void 0),ry(this,"recvConnection",void 0),ry(this,"localTrackMap",new Map),ry(this,"remoteUserMap",new Map),ry(this,"localDataChannels",[]),ry(this,"pendingLocalTracks",[]),ry(this,"pendingRemoteTracks",[]),ry(this,"statsCollector",void 0),ry(this,"dtlsFailedCount",0),ry(this,"sendMutex",new hR("P2PChannel2-send-mutex")),ry(this,"recvMutex",new hR("P2PChannel2-recv-mutex")),ry(this,"_state",aA.Disconnected),ry(this,"_restartStates",["disconnected","failed"]),ry(this,"reconnectInterval",void 0),ry(this,"uploadUnplinkStarted",!1),ry(this,"uploadDownlinkStarted",!1),ry(this,"uplinkStateUploadInterval",void 0),ry(this,"downlinkStatsUploadInterval",void 0),ry(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==aA.Connected)return void n(new nw(tw.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const s=r.find((e=>"videoLowTrack"===e[0]));s&&s[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));let a=!1;var i,o;a="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get(sA.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(o=this.localTrackMap.get(sA.LocalVideoTrack))||void 0===o?void 0:o.id);const c=this.createMuteMessage(r);await Mw(this,cA.RequestMuteLocal,c);const u="video"===e.trackMediaType?yA.MUTE_LOCAL_VIDEO:yA.MUTE_LOCAL_AUDIO;await Mw(this,cA.RequestP2PMuteLocal,{action:u,message:c,isMuteAll:a}),t()}catch(e){n(e)}finally{r()}})),ry(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==aA.Connected)return void n(new nw(tw.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();await this.sendConnection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const i=this.createUnmuteMessage(r),o="video"===e.trackMediaType?yA.UNMUTE_LOCAL_VIDEO:yA.UNMUTE_LOCAL_AUDIO;await Mw(this,cA.RequestP2PMuteLocal,{action:o,message:i}),t()}catch(e){n(e)}finally{r()}})),ry(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const n=this.localTrackMap.get(sA.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==aA.Connected)return void t();const{id:r,track:i}=n;r&&(await this.sendConnection.updateSendParameters(r,i),await this.sendConnection.updateEncoderConfig(r,i),this.emit(cA.UpdateVideoEncoder,i)),t()}catch(e){n(e)}finally{r()}})),ry(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(sA.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==aA.Connected)return void t();const{id:r,track:i}=n;r&&await this.sendConnection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),ry(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;QR.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.sendConnection||!n||void 0===n[1].id||this.state!==aA.Connected)return void t();if(await(null===(o=this.sendConnection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),n[0]===sA.LocalVideoTrack&&fx().supportDualStreamEncoding){const t=this.localTrackMap.get(sA.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new Gh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var s;null===(s=i)||void 0===s||s()}})),ry(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),ry(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),ry(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),ry(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new jB(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))}))}),kR("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new nw(tw.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,n,r,i,o){throw new nw(tw.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(QR.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new bB(e,this.store,RC.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=aA.New,this.sendConnection&&(QR.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new bB(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new nw(tw.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=aA.Connected}async addRemoteCandidate(e,t){if(t===RC.RECEIVE_ONLY){if(!this.sendConnection)throw new nw(tw.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new nw(tw.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return pV((function*(){const i=yield iV(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==aA.Connected){r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,nV.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield iV(r.tryToUnmuteAudio(e)));i.forEach((e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===sA.LocalAudioTrack?"audio":"video",i)})),r.bindLocalTrackEvents(i);const o=yield iV(r.sendConnection.send(i.map((e=>{let{track:t}=e;return t})),r.store.codec,r.store.audioCodec)),s=(yield iV(o.next())).value,a=r.createGatewayPublishMessage(i,s);try{yield a}catch(e){throw o.throw(e),(null==e?void 0:e.code)===tw.WS_ABORT&&i.forEach((e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)})),r.unbindLocalTrackEvents(i),e}yield iV(o.next()),i.forEach((e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)})),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(i,s),i.forEach((e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===sA.LocalAudioTrack?"audio":"video",void 0,i)})),r.startUploadUplinkState()}finally{i()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==aA.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((t=>!Dr(e).call(e,t))));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===aA.Connected)return n&&n[1].track.close(),r;e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const e=[],t=[];Array.from(this.localTrackMap.entries()).forEach((n=>{let[r,{track:i,ssrcs:o}]=n;const s={stream_type:GB(i,r),ssrcs:o};i._muted||!i._enabled?e.push(s):t.push(s)})),e.length>0&&e.forEach((e=>{Mw(this,cA.RequestMuteLocal,[e])})),t.length>0&&t.forEach((e=>{Mw(this,cA.RequestUnmuteLocal,[e])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return pV((function*(){throw new nw(tw.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(QR.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Lw(this,cA.RequestRePublish,this.pendingLocalTracks),this.emit(cA.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new nw(tw.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new nw(tw.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;const{track:o,mid:s,transceiver:a}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===rA.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new Vj(o,e.uid,e._uintid,this.store),QR.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),a&&e._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new jj(o,e.uid,e._uintid,this.store),QR.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),a&&e._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const u=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==u&&(this.pendingRemoteTracks.splice(u,1),this.emit(cA.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new nw(tw.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.recvConnection||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===rA.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===rA.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);0!==i.length&&(await this.recvConnection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===rA.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===rA.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===rA.AUDIO){var s;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(s=t._audioTrack)||void 0===s||s._destroy(),t._audioTrack=void 0)}})),i.forEach((e=>{let[,{kind:t}]=e;Mw(this,cA.RequestP2PMuteRemote,t)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((e=>{let[,t]=e;[rA.VIDEO,rA.AUDIO].forEach((e=>{t.has(e)?Mw(this,cA.RequestP2PUnmuteRemote,e):Mw(this,cA.RequestP2PMuteRemote,e)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new nw(tw.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new nw(tw.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new nw(tw.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new nw(tw.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void QR.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void QR.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===rA.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||QR.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):QR.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(sA.LocalAudioTrack);if((null==t?void 0:t.track)instanceof xF){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==sA.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===sA.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===sA.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(sA.LocalAudioTrack),o=r?this.localTrackMap.get(sA.LocalVideoLowTrack):this.localTrackMap.get(sA.LocalVideoTrack);oI.publish(this.store.sessionId,{eventElapse:nV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(Px.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const s=n.find((e=>e instanceof PF)),a=r?null===(o=this.localTrackMap.get(sA.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof Sj));oI.publish(this.store.sessionId,{eventElapse:nV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==s?void 0:s.getTrackLabel(),videoName:null==a?void 0:a.getTrackLabel(),screenshare:-1!==(null==a?void 0:a._hints.indexOf(Px.SCREEN_TRACK)),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===rA.VIDEO?n._videoSSRC:n._audioSSRC;i&&oI.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===rA.VIDEO,audio:r===rA.AUDIO,peerid:n.uid,subscribeRequestid:r===rA.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:nV.measureFromSubscribeStart(this.store.clientId,i)})}reset(){QR.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new hR("P2PChannel2-send-mutex"),this.sendMutex=new hR("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(sA.LocalAudioTrack);if((null==e?void 0:e.track)instanceof xF){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=aA.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(sA.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(sA.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Sj||t&&t.track instanceof PF?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(lf(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(sA.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=sm(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(QR.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=aA.Reconnecting,kR("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case sA.LocalVideoTrack:Dr(t=r._hints).call(t,Px.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case sA.LocalAudioTrack:r instanceof xF?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case sA.LocalVideoLowTrack:}})),this.emit(cA.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(lf(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(cA.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),QR.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof VB?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===RC.SEND_ONLY){if(!this.sendConnection)throw new nw(tw.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new nw(tw.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const e=await r.restartICE(t);return r.isInRestartIce=!1,e}{const e=await r.restartICE();if(e){const t=await Lw(this,cA.RequestP2PRestartICE,{direction:RC.RECEIVE_ONLY,iceParameter:e});await r.restartICE(t),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(sA.LocalVideoTrack),n=this.localTrackMap.get(sA.LocalAudioTrack),r=e.videoSend.find((e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),i=e.audioSend.find((e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)}));if(!r||!i)return 1;const o=xw(this,cA.NeedSignalRTT),s=r?r.rttMs:void 0,a=i?i.rttMs:void 0,c=s&&a?(s+a)/2:s||a,u=(c&&o?(c+o)/2:c||o)||0,l=100*e.sendPacketLossRate*.7/50+.3*u/1500,d=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(Px.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return cI[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,s=e.audioRecv.find((e=>e.ssrc===i)),a=e.videoRecv.find((e=>e.ssrc===o));if(!s&&!a)return void(t+=1);const c=xw(this,cA.NeedSignalRTT),u=e.rtt,l=(u&&c?(u+c)/2:u||c)||0,d=s?s.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*l/1500;d&&(p=.6*h*100/50+.2*l/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Gh(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=fx(),o=this.getAllTracks();e=Vw(e=e.filter((e=>-1===o.indexOf(e))));let s=!1,a=!1;for(const c of e){if(c instanceof Sj&&(this.localTrackMap.has(sA.LocalVideoTrack)||s?new nw(tw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:sA.LocalVideoTrack}),s=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:sA.LocalVideoLowTrack})}if(c instanceof PF){const e=this.localTrackMap.get(sA.LocalAudioTrack);if(e){if(!(e.track instanceof xF))throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(a){const e=r.find((e=>{let{type:t}=e;return t===sA.LocalAudioTrack}));if(!(e.track instanceof xF))throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof xF||c._bypassWebAudio)r.push({track:c,type:sA.LocalAudioTrack});else{const e=new xF;e.addAudioTrack(c),r.push({track:e,type:sA.LocalAudioTrack})}a=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Vw(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof PF){const e=this.localTrackMap.get(sA.LocalAudioTrack);if(!e)continue;e.track instanceof xF?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([sA.LocalAudioTrack,e]),e.track.close())):t.push([sA.LocalAudioTrack,e])}if(r instanceof Sj){const e=this.localTrackMap.get(sA.LocalVideoTrack);if(!e)continue;t.push([sA.LocalVideoTrack,e]);const n=this.localTrackMap.get(sA.LocalVideoLowTrack);n&&t.push([sA.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case sA.LocalVideoTrack:t.addListener(Dx.GET_STATS,this.handleGetLocalVideoStats),t.addListener(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Dx.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(Dx.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(Dx.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case sA.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case sA.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof xF?e.trackList.forEach((e=>{e.addListener(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Dx.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(Dx.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Dx.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case sA.LocalVideoTrack:t.off(Dx.GET_STATS,this.handleGetLocalVideoStats),t.off(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Dx.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(Dx.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(Dx.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case sA.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case sA.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof xF?e.trackList.forEach((e=>{e.off(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Dx.GET_STATS,this.handleGetLocalAudioStats),e.off(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(Dx.GET_STATS,this.handleGetLocalAudioStats),e.off(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Dx.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof jj&&t.addListener(Dx.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof Vj&&t.addListener(Dx.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Dx.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(rA.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(rA.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,{track:o,type:s}=e;switch(s){case sA.LocalAudioTrack:i=HC.Audio;break;case sA.LocalVideoTrack:i=Dr(r=o._hints).call(r,Px.SCREEN_TRACK)?HC.Screen:HC.High;break;case sA.LocalVideoLowTrack:i=HC.Low}return{kind:s===sA.LocalAudioTrack?rA.AUDIO:rA.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:o.muted||!o.enabled}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case sA.LocalVideoTrack:n=Dr(t=i._hints).call(t,Px.SCREEN_TRACK)?HC.Screen:HC.High;break;case sA.LocalAudioTrack:n=HC.Audio;break;case sA.LocalVideoLowTrack:n=HC.Low}return{stream_type:n,ssrcs:o,mid:s}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(cA.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),Dr(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await $w(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),oI.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Sw.TRACER}).onSuccess(),this.emit(cA.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(lf(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(jx.FIRST_FRAME_DECODED),oI.firstRemoteFrame(this.store.sessionId,tI.FIRST_AUDIO_DECODE,nI.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:nV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(lf(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&oI.firstRemoteFrame(this.store.sessionId,tI.FIRST_AUDIO_RECEIVED,nI.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:nV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(lf(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&oI.firstRemoteFrame(this.store.sessionId,tI.FIRST_VIDEO_RECEIVED,nI.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:nV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(cA.ConnectionTypeChange,n),QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ZA(t))," -> ").concat(JSON.stringify(ZA(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ZA(t))," -> ").concat(JSON.stringify(ZA(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(cA.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===RC.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,QR.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===RC.SEND_ONLY?this.restartICE(e):Lw(this,cA.RequestP2PRestartICE,{direction:RC.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(sA.LocalAudioTrack);if(e instanceof PF&&(null==n?void 0:n.track)instanceof xF)return n.track.isActive||t.push([sA.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===sA.LocalVideoTrack)){const e=this.localTrackMap.get(sA.LocalVideoLowTrack);e&&t.push([sA.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(sA.LocalAudioTrack);if(e instanceof PF&&(null==n?void 0:n.track)instanceof xF)return n.track.isActive&&t.push([sA.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===sA.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(sA.LocalVideoLowTrack);e&&t.push([sA.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case sA.LocalAudioTrack:n=HC.Audio;break;case sA.LocalVideoTrack:n=Dr(t=i._hints).call(t,Px.SCREEN_TRACK)?HC.Screen:HC.High;break;case sA.LocalVideoLowTrack:n=HC.Low}return{stream_type:n,ssrcs:o,mid:s}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case sA.LocalAudioTrack:n=HC.Audio;break;case sA.LocalVideoTrack:n=Dr(t=i._hints).call(t,Px.SCREEN_TRACK)?HC.Screen:HC.High;break;case sA.LocalVideoLowTrack:n=HC.Low}return{stream_type:n,ssrcs:o,mid:s}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case rA.VIDEO:return void(n._videoSSRC&&t.push({stream_type:rA.VIDEO,ssrcId:n._videoSSRC}));case rA.AUDIO:return void(n._audioSSRC&&t.push({stream_type:rA.AUDIO,ssrcId:n._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(sA.LocalVideoTrack),n=this.localTrackMap.get(sA.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return"connected"!==e&&"connected"!==t}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof PF){const n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;const r=this.createUnmuteMessage(n);return void await Mw(this,cA.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(cA.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(cA.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $w(mR(this.dtlsFailedCount,fR)),this.emit(cA.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(sA.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof Sj))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof Sj)).length>1)throw new nw(tw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof PF)).length>1&&(e.some((e=>e instanceof PF&&e._bypassWebAudio))||!fx().webAudioMediaStreamDest))throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Sj&&this.pendingLocalTracks.some((e=>e instanceof Sj)))throw new nw(tw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof PF&&this.pendingLocalTracks.some((e=>e instanceof PF))&&(!fx().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof PF&&e._bypassWebAudio))))throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!kR("DISABLE_DUAL_STREAM_USE_ENCODING")&&fx().supportDualStreamEncoding,r=iG(iG({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():SB(e,r);const o=eR(8,"track-low-"),s=new Sj(i,iG(iG({},n&&{scaleResolutionDownBy:QA(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return s.on(Ux.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,Lx.LOW_STREAM)})),s._hints.push(Px.LOW_STREAM),e.addListener(Dx.NEED_CLOSE,(()=>{s.close()})),s}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(lf(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,s=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));oI.firstRemoteVideoDecode(this.store.sessionId,tI.FIRST_VIDEO_DECODE,nI.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:nV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.recvConnection.getRemoteSSRC(i);return void 0!==o&&o!==n}resetConnection(e){QR.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===aA.Connected?(QR.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new nw(tw.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new nw(tw.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new nw(tw.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new nw(tw.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new nw(tw.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new nw(tw.NOT_SUPPORTED)}async preConnect(e,t,n,r,i,o){throw new nw(tw.NOT_SUPPORTED)}getEstablishParams(){throw new nw(tw.NOT_SUPPORTED)}async reSubscribe(e){throw new nw(tw.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new nw(tw.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===sA.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Lx.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},rC(nG.prototype,"p2pConnect",[HB],Object.getOwnPropertyDescriptor(nG.prototype,"p2pConnect"),nG.prototype),rC(nG.prototype,"unpublish",[KB],Object.getOwnPropertyDescriptor(nG.prototype,"unpublish"),nG.prototype),rC(nG.prototype,"unpublishLowStream",[zB],Object.getOwnPropertyDescriptor(nG.prototype,"unpublishLowStream"),nG.prototype),rC(nG.prototype,"subscribe",[YB],Object.getOwnPropertyDescriptor(nG.prototype,"subscribe"),nG.prototype),rC(nG.prototype,"mockSubscribe",[JB],Object.getOwnPropertyDescriptor(nG.prototype,"mockSubscribe"),nG.prototype),rC(nG.prototype,"unsubscribe",[XB],Object.getOwnPropertyDescriptor(nG.prototype,"unsubscribe"),nG.prototype),rC(nG.prototype,"muteRemote",[QB],Object.getOwnPropertyDescriptor(nG.prototype,"muteRemote"),nG.prototype),rC(nG.prototype,"unmuteRemote",[ZB],Object.getOwnPropertyDescriptor(nG.prototype,"unmuteRemote"),nG.prototype),rC(nG.prototype,"hasRemoteMediaWithLock",[$B],Object.getOwnPropertyDescriptor(nG.prototype,"hasRemoteMediaWithLock"),nG.prototype),rC(nG.prototype,"disconnectForReconnect",[eG],Object.getOwnPropertyDescriptor(nG.prototype,"disconnectForReconnect"),nG.prototype),rC(nG.prototype,"remoteMediaSsrcChanged",[tG],Object.getOwnPropertyDescriptor(nG.prototype,"remoteMediaSsrcChanged"),nG.prototype),nG);function sG(e){return function(t,n,r){const i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];switch(e){case BB.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}case BB.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e(),t()}}}},r}}function aG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class uG{constructor(e){ry(this,"store",void 0),ry(this,"onStatsException",void 0),ry(this,"onUploadPublishDuration",void 0),ry(this,"onStatsChanged",void 0),ry(this,"localStats",new Map),ry(this,"remoteStats",new Map),ry(this,"updateStatsInterval",void 0),ry(this,"trafficStats",void 0),ry(this,"trafficStatsPeerList",[]),ry(this,"uplinkStats",void 0),ry(this,"exceptionMonitor",void 0),ry(this,"p2pChannel",void 0),ry(this,"scalabilityMode",pC.L1T1),ry(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=e,this.exceptionMonitor=new eV,this.exceptionMonitor.on("exception",((e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(sA.LocalAudioTrack)||cG({},Bx)}getLocalVideoTrackStats(){return this.localStats.get(sA.LocalVideoTrack)||cG({},Gx)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)}));return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRTCStats(){let e=0,t=0,n=0,r=0;const i=this.localStats.get(sA.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const o=this.localStats.get(sA.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);const s=this.localStats.get(sA.LocalVideoLowTrack);s&&(e+=s.sendBytes,t+=s.sendBitrate),this.remoteStats.forEach((e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));let a=1;return this.trafficStats&&(a+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:a,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter((e=>void 0!==e.B_ppad||void 0!==e.B_ppvd)),e.peer_delay.filter((e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid))).forEach((e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?nV.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?nV.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&QR.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach((t=>{let[n,r]=t;switch(n){case sA.LocalVideoTrack:case sA.LocalVideoLowTrack:{const t=r,o=cG({},Gx),s=e.getStats(),a=e.getLocalMedia(n);if(s){const n=s.videoSend.find((e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId)));if(n){const r=e.getLocalVideoSize(),i=e.getEncoderConfig(sA.LocalVideoTrack);"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(o.codecType=n.codec),o.sendBytes=n.bytes,o.sendBitrate=t?8*Math.max(0,o.sendBytes-t.sendBytes):0,n.inputFrame?(o.captureFrameRate=n.inputFrame.frameRate,o.captureResolutionHeight=n.inputFrame.height,o.captureResolutionWidth=n.inputFrame.width):r&&(o.captureResolutionWidth=r.width,o.captureResolutionHeight=r.height),n.sentFrame?(o.sendFrameRate=n.sentFrame.frameRate,o.sendResolutionHeight=n.sentFrame.height,o.sendResolutionWidth=n.sentFrame.width):r&&(o.sendResolutionWidth=r.width,o.sendResolutionHeight=r.height),n.avgEncodeMs&&(o.encodeDelay=n.avgEncodeMs),i&&i.bitrateMax&&(o.targetSendBitrate=1e3*i.bitrateMax),o.sendPackets=n.packets,o.sendPacketsLost=n.packetsLost,o.sendJitterMs=n.jitterMs,o.sendRttMs=n.rttMs,o.totalDuration=t?t.totalDuration+1:1,o.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(o.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(QR.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(o.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var i;this.localStats.set(n,o),((null==t?void 0:t.sendResolutionWidth)!==o.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==o.sendResolutionHeight)&&(null===(i=this.onStatsChanged)||void 0===i||i.call(this,"resolution",{width:o.sendResolutionWidth,height:o.sendResolutionHeight})),o&&a&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,a.track,o);break}case sA.LocalAudioTrack:{const t=r,i=cG({},Bx),o=e.getStats(),s=e.getLocalMedia(n);if(o){const n=o.audioSend.find((e=>e.ssrc===(null==s?void 0:s.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(sA.LocalAudioTrack,i),i&&s&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,s.track,i);break}}}))}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach((t=>{var n,r;let[i,{videoStats:o,audioStats:s,videoPcStats:a}]=t;const c=s,u=o,l=a,d=cG({},qx),h=cG({},Hx),p=cG({},Wx),{audioTrack:f,videoTrack:m,audioSSRC:g,videoSSRC:_}=e.getRemoteMedia(i);let E;E=e instanceof oG?e.getStats(!0):e.getStats();const v=null===(n=E)||void 0===n?void 0:n.audioRecv.find((e=>e.ssrc===g)),y=null===(r=E)||void 0===r?void 0:r.videoRecv.find((e=>e.ssrc===_)),b=this.trafficStats&&this.trafficStats.peer_delay.find((e=>e.peer_uid===i));if(v&&("opus"!==v.codec&&"aac"!==v.codec&&"PCMU"!==v.codec&&"PCMA"!==v.codec&&"G722"!==v.codec||(d.codecType=v.codec),v.outputLevel?d.receiveLevel=Math.round(32767*v.outputLevel):f&&(d.receiveLevel=Math.round(32767*f.getVolumeLevel())),d.receiveBytes=v.bytes,d.receivePackets=v.packets,d.receivePacketsLost=v.packetsLost,d.packetLossRate=d.receivePacketsLost/(d.receivePackets+d.receivePacketsLost),d.receiveBitrate=c?8*Math.max(0,d.receiveBytes-c.receiveBytes):0,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,d.freezeRate=d.totalFreezeTime/d.totalDuration,d.receiveDelay=v.jitterBufferMs,d.totalDuration>10&&uG.isRemoteAudioFreeze(f)&&(d.totalFreezeTime+=1)),y){"H264"!==y.codec&&"H265"!==y.codec&&"VP8"!==y.codec&&"VP9"!==y.codec&&"AV1X"!==y.codec&&"AV1"!==y.codec||(h.codecType=y.codec),h.receiveBytes=y.bytes,h.receiveBitrate=u?8*Math.max(0,h.receiveBytes-u.receiveBytes):0,h.decodeFrameRate=y.decodeFrameRate<0?0:y.decodeFrameRate,h.renderFrameRate=y.decodeFrameRate<0?0:y.decodeFrameRate,y.outputFrame&&(h.renderFrameRate=y.outputFrame.frameRate),y.receivedFrame?(h.receiveFrameRate=y.receivedFrame.frameRate,h.receiveResolutionHeight=y.receivedFrame.height,h.receiveResolutionWidth=y.receivedFrame.width):m&&(h.receiveResolutionHeight=m._videoHeight||0,h.receiveResolutionWidth=m._videoWidth||0),void 0!==y.framesRateFirefox&&(h.receiveFrameRate=Math.round(y.framesRateFirefox)),h.receivePackets=y.packets,h.receivePacketsLost=y.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.totalDuration=u?u.totalDuration+1:1,h.totalFreezeTime=u?u.totalFreezeTime:0,h.receiveDelay=y.jitterBufferMs||0;const t=!!_&&e.getRemoteVideoIsReady(_);m&&t&&uG.isRemoteVideoFreeze(m,y,l)&&(h.totalFreezeTime+=1),h.freezeRate=h.totalFreezeTime/h.totalDuration}b&&(d.end2EndDelay=b.B_ad,h.end2EndDelay=b.B_vd,d.transportDelay=b.B_ed,h.transportDelay=b.B_ed,d.currentPacketLossRate=b.B_ealr4/100,h.currentPacketLossRate=b.B_evlr4/100,p.uplinkNetworkQuality=b.B_punq?b.B_punq:0,p.downlinkNetworkQuality=b.B_pdnq?b.B_pdnq:0),this.remoteStats.set(i,{audioStats:d,videoStats:h,videoPcStats:y,networkStats:p}),f&&this.exceptionMonitor.setRemoteAudioStats(f,d),m&&this.exceptionMonitor.setRemoteVideoStats(m,h)}))}}function lG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class hG extends vw{constructor(e,t,n,r){super(),ry(this,"spec",void 0),ry(this,"token",void 0),ry(this,"websocket",void 0),ry(this,"pingpongTimer",void 0),ry(this,"reconnectMode","retry"),ry(this,"serviceMode",void 0),ry(this,"reqId",0),ry(this,"commandReqId",0),ry(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),ry(this,"handleWebSocketMessage",(e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):this.serviceMode===NC.INJECT?this.emit(UC.INJECT_STREAM_STATUS,t):(oI.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===NC.TRANSCODE?1:2}),this.emit(UC.PUBLISH_STREAM_STATUS,t))})),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new jA("live-streaming",n),this.websocket.on(IC.CONNECTED,this.handleWebSocketOpen),this.websocket.on(IC.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(IC.REQUEST_NEW_URLS,((e,t)=>{Lw(this,UC.REQUEST_NEW_ADDRESS).then(e).catch(t)})),this.websocket.on(IC.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new CC(tw.UNEXPECTED_ERROR);const s=dG({command:e,sdkVersion:"4.21.0"===wR?"0.0.1":wR,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new CC(tw.WS_DISCONNECT);const a=()=>new Gh(((e,t)=>{this.websocket.once(IC.CLOSED,(()=>t(new CC(tw.WS_ABORT)))),this.websocket.once(IC.CONNECTED,e)}));"connected"!==this.websocket.state&&await a(),s.clientRequest&&(s.clientRequest.workerToken=this.token);const c=new Gh(((e,t)=>{const n=()=>{t(new CC(tw.WS_ABORT))};this.websocket.once(IC.RECONNECTING,n),this.websocket.once(IC.CLOSED,n),this.once("@".concat(o,"-").concat(this.spec.sid),(t=>{e(t)}))}));r&&oI.workerEvent(this.spec.sid,dG(dG({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const u=Date.now();this.websocket.sendMessage(s);let l=null;try{l=await c}catch(r){if("closed"===this.websocket.state)throw r;return await a(),await this.request(e,t,n)}return r&&oI.workerEvent(this.spec.sid,dG(dG({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(l.serverResponse),serverCode:l.code,success:200===l.code,responseTime:Date.now()-u})),200!==l.code&&this.handleResponseError(l),l}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.21.0"===wR?"0.0.1":wR;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case jC.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void QR.warning("live stream response already exists stream");case jC.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case jC.LIVE_STREAM_RESPONSE_BAD_STREAM:case jC.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new CC(tw.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case jC.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new CC(tw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case jC.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new CC(tw.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case jC.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new CC(tw.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(UC.WARNING,t,e.serverResponse.url)}case jC.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new CC(tw.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(UC.WARNING,t,e.serverResponse.url)}case jC.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new CC(tw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case jC.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new CC(tw.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case jC.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new CC(tw.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(UC.WARNING,t,e.serverResponse.url)}case jC.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new CC(tw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case jC.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new CC(tw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case jC.LIVE_STREAM_RESPONSE_WORKER_LOST:case jC.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new CC(tw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case jC.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new CC(tw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new CC(tw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case jC.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case jC.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case jC.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case jC.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new CC(tw.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(nR)}),6e3)}}function pG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class mG extends vw{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fR,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:fR;super(),ry(this,"onLiveStreamWarning",void 0),ry(this,"onLiveStreamError",void 0),ry(this,"onInjectStatusChange",void 0),ry(this,"spec",void 0),ry(this,"retryTimeout",1e4),ry(this,"connection",void 0),ry(this,"httpRetryConfig",void 0),ry(this,"wsRetryConfig",void 0),ry(this,"streamingTasks",new Map),ry(this,"isStartingStreamingTask",!1),ry(this,"taskMutex",new hR("live-streaming")),ry(this,"cancelToken",pS.CancelToken.source()),ry(this,"transcodingConfig",void 0),ry(this,"injectConfig",fG({},xC)),ry(this,"injectLoopTimes",0),ry(this,"uapResponse",void 0),ry(this,"lastTaskId",1),ry(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=fG(fG({},MC),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(QR.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((e=>fG(fG(fG({},DC),e),{},{zOrder:e.zOrder?e.zOrder+1:1})))),function(e){uw(e.width)||ow(e.width,"config.width",0,1e4),uw(e.height)||ow(e.height,"config.height",0,1e4),uw(e.videoBitrate)||ow(e.videoBitrate,"config.videoBitrate",1,1e6),uw(e.videoFrameRate)||ow(e.videoFrameRate,"config.videoFrameRate"),uw(e.lowLatency)||rw(e.lowLatency,"config.lowLatency"),uw(e.audioSampleRate)||iw(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),uw(e.audioBitrate)||ow(e.audioBitrate,"config.audioBitrate",1,128),uw(e.audioChannels)||iw(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),uw(e.videoGop)||ow(e.videoGop,"config.videoGop"),uw(e.videoCodecProfile)||iw(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),uw(e.userCount)||ow(e.userCount,"config.userCount",0,17),uw(e.backgroundColor)||ow(e.backgroundColor,"config.backgroundColor",0,16777215),uw(e.userConfigExtraInfo)||aw(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!uw(e.transcodingUsers)&&(cw(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach(((e,t)=>{OC(e.uid),uw(e.x)||ow(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),uw(e.y)||ow(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),uw(e.width)||ow(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),uw(e.height)||ow(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),uw(e.zOrder)||ow(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),uw(e.alpha)||ow(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),uw(e.watermark)||LC(e.watermark,"watermark"),uw(e.backgroundImage)||LC(e.backgroundImage,"backgroundImage"),e.images&&!uw(e.images)&&(cw(e.images,"config.images"),e.images.forEach(((e,t)=>{LC(e,"images[".concat(t,"]"))})))}(t);const n=[];t.images&&n.push(...t.images.map((e=>fG(fG(fG({},PC),e),{},{zOrder:255})))),t.backgroundImage&&(n.push(fG(fG(fG({},PC),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(fG(fG(fG({},PC),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((e=>fG({},e))),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const r=(t.userConfigs||[]).map((e=>"number"==typeof e.uid?Gh.resolve(e.uid):BO(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await Gh.all(r)).forEach(((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)})),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(hC(i=this.streamingTasks).call(i)).map((e=>e.taskId)).join("#")});QR.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((t=>{QR.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then((()=>{QR.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((e=>{QR.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}))}))}}setInjectStreamConfig(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t}async startLiveStreamingTask(e,t,n){var r;const i=Array.from(hC(r=this.streamingTasks).call(r)).find((e=>e.mode===NC.INJECT));if(i&&t===NC.INJECT)return new CC(tw.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&t===NC.TRANSCODE)throw new CC(tw.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let o={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};QR.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const s=await this.taskMutex.lock();if(!this.connection&&n)return void s();if(this.streamingTasks.get(e)&&!n)return s(),new CC(tw.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw s(),e}switch(t){case NC.TRANSCODE:o.transcodingConfig=fG({},this.transcodingConfig);break;case NC.RAW:break;case NC.INJECT:o={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const a=this.lastTaskId++;try{const r=new Gh(((t,r)=>{$w(this.retryTimeout).then((()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0}))})),i=await Gh.race([this.connection.request("request",{clientRequest:o},!0,{url:e,command:"PublishStream",workerType:t===NC.TRANSCODE?1:2,requestByUser:!n,tid:a.toString()}),r]);this.isStartingStreamingTask=!1,QR.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(i.code)),this.streamingTasks.set(e,{clientRequest:o,mode:t,url:e,taskId:a}),s()}catch(r){if(s(),this.isStartingStreamingTask=!1,!r.data||!r.data.retry||n)throw r;return r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,r)):await this.startLiveStreamingTask(e,t,r)}}stopLiveStreamingTask(e){return new Gh(((t,n)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new CC(tw.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=r.mode;r.abortTask=()=>{QR.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:i===NC.INJECT?"UninjectStream":"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===NC.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{QR.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&i!==NC.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),t(),i===NC.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(kC.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,e)})).catch(n)}))}async controlInjectStream(e,t,n,r){const i=this.streamingTasks.get(e);if(!i||!this.connection||i.mode!==NC.INJECT)throw new CC(tw.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:n,position:r}})).serverResponse}resetAllTask(){var e;const t=Array.from(hC(e=this.streamingTasks).call(e));this.terminate();for(const n of t)this.startLiveStreamingTask(n.url,n.mode).catch((e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=pS.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new CC(tw.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await Lw(this,FC.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new hG(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(UC.WARNING,((e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e))),this.connection.on(UC.PUBLISH_STREAM_STATUS,(e=>this.handlePublishStreamServer(e))),this.connection.on(UC.INJECT_STREAM_STATUS,(e=>this.handleInjectStreamServerStatus(e))),this.connection.on(UC.REQUEST_NEW_ADDRESS,((t,n)=>{if(!this.connection)return n(new CC(tw.UNEXPECTED_ERROR,"can not get new live streaming address list"));Lw(this,FC.REQUEST_WORKER_MANAGER_LIST,e).then((e=>{this.uapResponse=e,t(e.addressList)})).catch(n)})),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case jC.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case jC.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case jC.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case jC.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const r=new CC(tw.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return QR.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case jC.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new CC(tw.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case jC.LIVE_STREAM_RESPONSE_WORKER_LOST:case jC.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(hC(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(QR.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new CC(tw.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((()=>{QR.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((e=>{QR.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})));return}}}handleInjectStreamServerStatus(e){const t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(kC.INJECT_STREAM_STATUS_START_SUCCESS,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(kC.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(kC.INJECT_STREAM_STATUS_START_UNAUTHORIZED,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(kC.INJECT_STREAM_STATUS_BROKEN,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(kC.INJECT_STREAM_STATUS_START_TIMEOUT,t,n),void this.streamingTasks.delete(n);default:return void QR.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class gG{constructor(){ry(this,"destChannelMediaInfos",new Map),ry(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){VC(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){VC(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){AC(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function _G(e){if(!(e instanceof gG))return new CC(tw.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new CC(tw.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new CC(tw.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class EG extends vw{constructor(e,t,n){super(),ry(this,"ws",void 0),ry(this,"requestId",1),ry(this,"heartBeatTimer",void 0),ry(this,"joinInfo",void 0),ry(this,"clientId",void 0),ry(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),ry(this,"onClose",(e=>{this.emit("close"),this.dispose()})),ry(this,"onMessage",(e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)})),this.joinInfo=e,this.clientId=t,this.ws=new jA("cross-channel-".concat(this.clientId),n),this.ws.on(IC.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(IC.CONNECTED,this.onOpen),this.ws.on(IC.ON_MESSAGE,this.onMessage),this.ws.on(IC.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new Gh(((t,n)=>{const r=window.setTimeout((()=>{n(new CC(tw.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);this.once(e,(i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new CC(tw.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)})),this.once("dispose",(()=>{window.clearTimeout(r),n(new CC(tw.WS_ABORT))}))}))}async request(e){if("closed"===this.ws.state)throw new CC(tw.WS_DISCONNECT);const t=()=>new Gh(((e,t)=>{this.ws.once(IC.CLOSED,(()=>t(new CC(tw.WS_ABORT)))),this.ws.once(IC.CONNECTED,e)}));"connected"!==this.ws.state&&await t();const n=this.sendMessage(e),r=new Gh(((e,t)=>{const r=()=>{t(new CC(tw.WS_ABORT))};this.ws.once(IC.RECONNECTING,r),this.ws.once(IC.CLOSED,r),this.once("req_".concat(n),e),$w(3e3).then((()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(IC.RECONNECTING,r),this.ws.off(IC.CLOSED,r),t(new CC(tw.TIMEOUT,"cross channel ws request timeout"))}))})),i=await r;if(!i||200!==i.code)throw new CC(tw.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(i)));return i}async connect(e){this.ws.removeAllListeners(IC.REQUEST_NEW_URLS),this.ws.on(IC.REQUEST_NEW_URLS,(t=>{t(e)})),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class vG extends vw{set state(e){e!==this._state&&(e!==qC.RELAY_STATE_FAILURE&&(this.errorCode=WC.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),ry(this,"joinInfo",void 0),ry(this,"sid",void 0),ry(this,"clientId",void 0),ry(this,"cancelToken",pS.CancelToken.source()),ry(this,"workerToken",void 0),ry(this,"requestId",0),ry(this,"signal",void 0),ry(this,"prevChannelMediaConfig",void 0),ry(this,"httpRetryConfig",void 0),ry(this,"_resolution",void 0),ry(this,"_state",qC.RELAY_STATE_IDLE),ry(this,"errorCode",WC.RELAY_OK),ry(this,"onStatus",(e=>{QR.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",GC.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",GC.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=WC.SRC_TOKEN_EXPIRED,this.state=qC.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=WC.DEST_TOKEN_EXPIRED,this.state=qC.RELAY_STATE_FAILURE))})),ry(this,"onReconnect",(async()=>{QR.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",GC.NETWORK_DISCONNECTED),this.state=qC.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((e=>{this.state!==qC.RELAY_STATE_IDLE&&(QR.error("auto restart channel media relay failed",e.toString()),this.errorCode=WC.SERVER_CONNECTION_LOST,this.state=qC.RELAY_STATE_FAILURE)}))})),this.joinInfo=e,this.clientId=t,this.sid=tR(),this.signal=new EG(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==qC.RELAY_STATE_IDLE)throw new CC(tw.INVALID_OPERATION);this.state=qC.RELAY_STATE_CONNECTING,await this.connect(),QR.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new CC(tw.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new CC(tw.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new CC(tw.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==qC.RELAY_STATE_RUNNING)throw new CC(tw.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==qC.RELAY_STATE_RUNNING)throw new CC(tw.INVALID_OPERATION);const t=this.genMessage(BC.SetVideoProfile);await this.signal.request(t),QR.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),QR.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=qC.RELAY_STATE_IDLE,this.dispose()}dispose(){QR.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=pS.CancelToken.source(),this.state=qC.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await zO(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",GC.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage(BC.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),QR.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(BC.SetSdkProfile,e);await this.signal.request(n),QR.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(BC.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",GC.PACKET_JOINED_SRC_CHANNEL),QR.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(BC.SetSourceUserId,e);await this.signal.request(i),QR.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(BC.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",GC.PACKET_JOINED_DEST_CHANNEL),QR.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const s=this.genMessage(BC.StartPacketTransfer,e);await this.signal.request(s),this.emit("event",GC.PACKET_SENT_TO_DEST_CHANNEL),this.state=qC.RELAY_STATE_RUNNING,QR.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage(BC.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",GC.PACKET_UPDATE_DEST_CHANNEL),QR.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(BC.StopPacketTransfer);await this.signal.request(e),QR.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],r=[],i=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:wR,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.21.0"===o.sdkVersion&&(o.sdkVersion="0.0.1");let s=null,a=null;switch(e){case BC.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case BC.SetSourceChannel:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new CC(tw.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:a.channelName,token:a.token||this.joinInfo.appId},o;case BC.SetSourceUserId:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new CC(tw.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:a.uid+""},o;case BC.SetDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new CC(tw.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},o;case BC.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case BC.Reconnect:return o.clientRequest={command:"Reconnect"},o;case BC.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case BC.UpdateDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new CC(tw.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},o;case BC.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}function yG(e){var t={},n=!1;function r(t,r){return n=!0,{done:!1,value:new rV(r=new uV((function(n){n(e[t](r))})),1)}}return t[void 0!==Zv&&$v||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}var bG,TG=r(lV);function SG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?SG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function RG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function IG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?RG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let CG=(bG=class e extends nA{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Dr(t=Object.keys(MR)).call(t,e)})))]}constructor(t,n){super(t,n),ry(this,"store",void 0),ry(this,"peerConnection",void 0),ry(this,"remoteSDP",void 0),ry(this,"initialOffer",void 0),ry(this,"statsFilter",void 0),ry(this,"useRTX",!1),ry(this,"localCapabilities",void 0),ry(this,"localCandidateCount",0),ry(this,"allCandidatesReceived",!1),ry(this,"establishPromise",void 0),ry(this,"mutex",new hR("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=YV(this.peerConnection,kR("STATS_UPDATE_INTERVAL"),void 0,DS()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ZV(e.sdp),n=QV(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:kR("FILTER_VIDEO_FEC"),filterAudioFec:kR("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,IG(IG({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new nw(tw.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(e){ry(this,"sessionDesc",void 0),ry(this,"localCapabilities",void 0),ry(this,"rtpCapabilities",void 0),ry(this,"candidates",void 0),ry(this,"iceParameters",void 0),ry(this,"dtlsParameters",void 0),ry(this,"setup",void 0),ry(this,"currentMidIndex",void 0),ry(this,"cname",void 0),e=Gw(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:s,sdkCodec:a,cname:c}=e,u=AV.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this.iceParameters=t,this.dtlsParameters=n,this.setup=o,this.localCapabilities=s,this.cname=c;for(let l=0;l<u.mediaDescriptions.length;l++){const e=u.mediaDescriptions[l];if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=o,"video"===e.media.mediaType){e.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10)));let t=i.videoCodecs.filter((e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dr(n=t.encodingName.toLowerCase()).call(n,a)}));0===t.length&&(t=i.videoCodecs),e.attributes.payloads=t,e.attributes.extmaps=i.videoExtensions}"audio"===e.media.mediaType&&(e.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=i.audioCodecs,e.attributes.extmaps=i.audioExtensions),u.mediaDescriptions[l]=this.mungMediaDesc(e)}this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1}toString(){return AV.print(this.sessionDesc)}send(e,t,n){const{ssrcs:r,ssrcGroups:i}=tB(t,this.cname),o=this.sessionDesc.mediaDescriptions.find((t=>e===rA.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType)),s=r[0].attributes.label,a=r[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(r),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(i),{id:s,mslabel:a}}batchSend(e){return e.map((e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)}))}stopSending(e){this.sessionDesc.mediaDescriptions.forEach((t=>{const n=[],r=[],i=[];t.attributes.ssrcs.forEach((t=>{Dr(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((e=>{var t;Dr(t=i.map((e=>e.ssrcId))).call(t,e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach(((e,t)=>{const n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===n.kind)),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i}))}stopReceiving(e){}updateCandidates(e){e===iA.TCP?this.candidates.forEach((e=>{-1===this.candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this.candidates.push(wG(wG({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this.candidates=this.candidates.filter((e=>"tcp"!==e.transport));for(const t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(e){e=Gw(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=Gw(e);return nB(n,t),iB(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const r=this.sessionDesc.mediaDescriptions.find((t=>e===rA.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid));if(r){const e=r.attributes.ssrcs.find((e=>e.attributes.label===t));var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=Gw(e);return rB(t),function(e){const t=e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r.send,remoteSetup:i,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:o});const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new nw(tw.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(e,t){var n=this;return pV((function*(){const r=yield iV(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=e.map((e=>n.peerConnection.addTrack(e._mediaStreamTrack))),i=yield iV(n.peerConnection.createOffer()),o=AV.parse(i.sdp),s=e.map((e=>{const t=e._mediaStreamTrack,r=o.mediaDescriptions.find((e=>e.attributes.mid===t.kind));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const r=e.attributes.ssrcs.filter((e=>e.attributes.label===t)),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){const e=i.find((e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId)));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)}));let a;try{a=yield s}catch(e){throw r.forEach((e=>{NS()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),e}const c=n.mungSendOfferSDP(i.sdp,e);n.remoteSDP.receive(e,t,a);const u=n.remoteSDP.toString();return yield iV(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield iV(n.applySendEncodings(r,e)),yield iV(n.peerConnection.setRemoteDescription({type:"answer",sdp:u})),e.map(((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:s[t],id:n}}))}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}}))()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{NS()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),o=new Gh(((t,r)=>{const o=setTimeout((()=>{r(new Error("Cannot receive track, id: ".concat(n)))}),1e4),s=r=>{const a=wS();if(("Safari"===a.name&&11===Number(a.version)||PS())&&r.track.id!==n&&r.streams[0].id===i){var c;const i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",s),clearTimeout(o),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",s),clearTimeout(o),void t(r.track)};this.peerConnection.addEventListener("track",s)})),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),{track:await o,id:n}}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map((e=>{if(NS()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!1)),e.setParameters(t)}}))}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map((async e=>{if(NS()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!0)),await e.setParameters(t)}}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return pV((function*(){const n=yield iV(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(fx().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===iA.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(QR.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===iA.RELAY)return;e!==iA.RELAY&&t.remoteSDP.updateCandidates(e);const n=yield iV(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=ZV(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString();yield iV(t.peerConnection.setLocalDescription(n)),yield iV(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){QR.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new nw(tw.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new nw(tw.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,QR.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,QR.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),kR("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Cw(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),kR("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id}))),!t)return QR.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!fx().supportSetRtpSenderParameters)return QR.warn("Browser not support set rtp-sender parameters");const r={},i={};if(e instanceof Sj)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(kR("DSCP_TYPE")&&JS()){var o;const e=kR("DSCP_TYPE");Dr(o=["very-low","low","medium","high"]).call(o,e)&&(i.networkPriority=e)}const s=t.getParameters(),a=null===(n=s.encodings)||void 0===n?void 0:n[0];a&&Object.assign(a,i),Object.assign(s,r),QR.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await t.setParameters(s)}async applySendEncodings(e,t){try{if(!fx().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];r&&i&&await this.updateRtpSenderEncodings(i,r)}}catch(e){QR.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=AV.parse(e);return t.forEach(((e,t)=>{const r=e._mediaStreamTrack,i=n.mediaDescriptions.find((e=>e.attributes.mid===r.kind));i&&nB(i,e)})),AV.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map(((t,n)=>{let{id:r,mslabel:i}=t;const{kind:o}=e[n];return new Gh(((e,t)=>{const n=setTimeout((()=>{t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),s=t=>{const a=wS();if("Safari"===a.name&&11===Number(a.version)&&t.track.id!==r&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(o,r,t.track.id),this.peerConnection.removeEventListener("track",s),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",s),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",s)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await Gh.all(t)}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(fx().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},rC(bG.prototype,"connect",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"connect"),bG.prototype),rC(bG.prototype,"stopSending",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"stopSending"),bG.prototype),rC(bG.prototype,"receive",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"receive"),bG.prototype),rC(bG.prototype,"stopReceiving",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"stopReceiving"),bG.prototype),rC(bG.prototype,"muteRemote",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"muteRemote"),bG.prototype),rC(bG.prototype,"unmuteRemote",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"unmuteRemote"),bG.prototype),rC(bG.prototype,"muteLocal",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"muteLocal"),bG.prototype),rC(bG.prototype,"unmuteLocal",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"unmuteLocal"),bG.prototype),rC(bG.prototype,"close",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"close"),bG.prototype),rC(bG.prototype,"updateEncoderConfig",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"updateEncoderConfig"),bG.prototype),rC(bG.prototype,"updateSendParameters",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"updateSendParameters"),bG.prototype),rC(bG.prototype,"replaceTrack",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"replaceTrack"),bG.prototype),rC(bG.prototype,"getRemoteSSRC",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"getRemoteSSRC"),bG.prototype),bG);function AG(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function OG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function NG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const kG="9",DG=4e4;function PG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function LG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?PG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let MG=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var xG=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(xG||{});const UG=new Map;function FG(e,t,n,r){let{scale:i}=e;if(0===i&&r===xG.UP||i>=t.length-1&&r===xG.DOWN)return e;let o=LG(LG({},e),{},{scale:r===xG.DOWN?++i:--i});switch(n){case"maintain-framerate":o=LG(LG({},o),t[i].motion);break;case"maintain-resolution":o=LG(LG({},o),t[i].detail);break;case"balanced":o=LG(LG({},o),t[i].balanced)}return o}function jG(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:VG(t)};UG.set(e,n)}else UG.delete(e)}function VG(e){const t=LG({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:o}=t,{MIN_FRAME_RATE:s,MAX_THRESHOLD_FRAMERATE:a,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:u,BITRATE_MAX_THRESHOLD:l,BWE_SCALE_UP_THRESHOLD:d,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:f,BALANCE_BITRATE_FACTOR:m,BALANCE_FRAMERATE_FACTOR:g,BALANCE_RESOLUTION_FACTOR:_,MOTION_RESOLUTION_FACTOR:E,MOTION_BITRATE_FACTOR:v,DETAIL_FRAMERATE_FACTOR:y,DETAIL_BITRATE_FACTOR:b}=CR,T=Math.min(t.frameRate,a),S=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*T),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o}}];for(let w=1;w<=c;w++){const e={bwe_up:Math.round(Math.pow(d,w)*n),bwe_down:Math.round(Math.pow(h,w+1)*n),fps_up:Math.round(Math.pow(f,w)*T),fps_down:Math.round(Math.pow(p,w+1)*T)},t={scaleResolutionDownBy:i/Math.pow(_,w),frameRate:Math.max(Math.round(Math.pow(g,w)*r),s),bitrateMax:Math.max(Math.round(Math.pow(m,w)*n),l),bitrateMin:Math.max(Math.round(Math.pow(m,w)*o),u)},a={scaleResolutionDownBy:i/Math.pow(E,w),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(v,w)*n),l),bitrateMin:Math.max(Math.round(Math.pow(v,w)*o),u)},c={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(y,w)*r),s),bitrateMax:Math.max(Math.round(Math.pow(b,w)*n),l),bitrateMin:Math.max(Math.round(Math.pow(b,w)*o),u)};S.push({scale:w,threshold:e,balanced:t,motion:a,detail:c})}return S}function BG(e,t,n,r,i,o){const s=UG.get(e)||{overUse:0,underUse:0,adaptationList:VG(i)},{adaptationList:a}=s;UG.set(e,s);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:u}=CR,{scale:l}=r;let d,h;return"number"==typeof t&&t>0&&function(e,t,n,r){if(t>=n.length)return!1;let{threshold:{fps_down:i}}=n[t];return kR("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[0].threshold.fps_down),e<i}(t,l,a,o)&&(s.overUse++,h=MG.CPU,s.overUse>c)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;const{threshold:{bwe_down:r}}=n[t];return e<r}(n,l,a)&&(s.overUse++,h=MG.BANDWIDTH,s.overUse>c)?(s.overUse=0,s.underUse=0,d=FG(r,a,o,xG.DOWN),[d,h]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,r){if(0===t)return;let{threshold:{fps_up:i}}=n[t];return kR("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[1].threshold.fps_up),e>i}(t,l,a,o)&&function(e,t,n){if(0===t)return;const{threshold:{bwe_up:r}}=n[t];return e>r}(n,l,a)&&(s.underUse++,s.underUse>u&&(s.overUse=0,s.underUse=0,d=FG(r,a,o,xG.UP),0===d.scale&&(h=MG.NONE))),[d,h])}function GG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?GG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function WG(e){var t;return!!kR("ENABLE_AG_ADAPTATION")&&!!(e instanceof wj||Dr(t=e._hints).call(t,Px.CUSTOM_TRACK))&&(!!kR("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(e){const t=wS();if(t.os!==vS.IOS||!t.osVersion)return!1;const n=t.osVersion.split(".");return Number(n[0])>=e}(14)&&US(17,4,!0)||xS(14)&&FS(17,4,!0)))}const HG=new Map;function KG(e){const t=HG.get(e);if(t){const{timer:n,adaptationFunc:r,originConfig:i}=t;window.clearTimeout(n),r(i),HG.delete(e)}jG(e)}var zG;function YG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?YG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let XG=(zG=class e extends nA{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Dr(t=Object.keys(MR)).call(t,e)})))]}constructor(t,n){super(t,n),ry(this,"store",void 0),ry(this,"peerConnection",void 0),ry(this,"id",eR(5,"connection-")),ry(this,"remoteSDP",void 0),ry(this,"initialOffer",void 0),ry(this,"transportEventReceiver",void 0),ry(this,"statsFilter",void 0),ry(this,"useXR",kR("USE_XR")),ry(this,"localCapabilities",void 0),ry(this,"remoteCodecs",void 0),ry(this,"localCandidateCount",0),ry(this,"allCandidatesReceived",!1),ry(this,"dataStreamChannelMap",new Map),ry(this,"establishPromise",void 0),ry(this,"recoveredDataChannelIds",[]),ry(this,"currentDataChannelId",1),ry(this,"mutex",new hR("P2PConnection-mutex")),ry(this,"qualityLimitationReason",MG.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=YV(this.peerConnection,kR("STATS_UPDATE_INTERVAL"),void 0,DS()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else QR.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else QR.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ZV(e.sdp),n=await cB({filterRTX:!kR("USE_PUB_RTX")&&!kR("USE_SUB_RTX"),filterVideoFec:kR("FILTER_VIDEO_FEC"),filterAudioFec:kR("FILTER_AUDIO_FEC"),filterVideoCodec:kR("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=dB(n),this.initialOffer=e,JG(JG({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new nw(tw.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return Gw(this._localCapabilities)}get rtpCapabilities(){return Gw(this._rtpCapabilities)}get candidates(){return Gw(this._candidates)}get iceParameters(){return Gw(this._iceParameters)}get dtlsParameters(){return Gw(this._dtlsParameters)}constructor(e){ry(this,"sessionDesc",void 0),ry(this,"_localCapabilities",void 0),ry(this,"_rtpCapabilities",void 0),ry(this,"_candidates",void 0),ry(this,"_iceParameters",void 0),ry(this,"_dtlsParameters",void 0),ry(this,"setup",void 0),ry(this,"currentMidIndex",void 0),ry(this,"cname",void 0),ry(this,"firefoxSsrcMidMap",new Map),e=Gw(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:s,cname:a}=e,c=AV.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s,this.setup=o,this.cname=a;const u=this.rtpCapabilities.send;for(const l of c.mediaDescriptions){if(l.attributes.iceUfrag=t.iceUfrag,l.attributes.icePwd=t.icePwd,l.attributes.fingerprints=n.fingerprints,l.attributes.candidates=r,l.attributes.setup=o,"video"===l.media.mediaType&&(l.media.fmts=u.videoCodecs.map((e=>e.payloadType.toString(10))),l.attributes.payloads=u.videoCodecs,l.attributes.extmaps=u.videoExtensions,kR("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=tB([{ssrcId:DG,rtx:kR("USE_SUB_RTX")?40001:void 0}],this.cname);l.attributes.ssrcs=e,l.attributes.ssrcGroups=t}if("audio"===l.media.mediaType&&(l.media.fmts=u.audioCodecs.map((e=>e.payloadType.toString(10))),l.attributes.payloads=u.audioCodecs,l.attributes.extmaps=u.audioExtensions,hB(l),kR("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=tB([{ssrcId:2e4}],this.cname);l.attributes.ssrcs=e,l.attributes.ssrcGroups=t}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}preloadRemoteMedia(){const e=kR("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){const e=2*o+2e4,s=2*o+DG,{ssrcs:a,ssrcGroups:c}=tB([{ssrcId:e}],this.cname),{ssrcs:u,ssrcGroups:l}=tB([{ssrcId:s,rtx:kR("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:kG,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:kG,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return AV.print(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=tB(t,this.cname,kR("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(i);if(s){if(DS()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&(NS()||VS())||0===t&&kR("USE_SUB_RTX")||BS()?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=Gw(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),DS()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||DS()||BS()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){const t=this._candidates.filter((e=>"udp"===e.transport));if(e===iA.TCP){if(0===t.length)return;if(kR("TCP_CANDIDATE_ONLY")){const e=this._candidates.filter((e=>"tcp"===e.transport));t.forEach((t=>{-1===e.findIndex((e=>e.connectionAddress===t.connectionAddress))&&e.push(NG(NG({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})),this._candidates=e}else{const e=[];t.forEach((t=>{e.push(NG(NG({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})),this._candidates=[...t,...e]}}else if(e===iA.RELAY){if(0!==t.length)return;{const e=this._candidates.filter((e=>"tcp"===e.transport));e.forEach((e=>{t.push(NG(NG({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=[...t,...e]}}else 0===t.length?(this._candidates.filter((e=>"tcp"===e.transport)).forEach((e=>{t.push(NG(NG({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))})),this._candidates=t):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(e){e=Gw(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(DS()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleDataChannel(){for(const n of this.sessionDesc.mediaDescriptions)if("application"===n.media.mediaType)return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:kG,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,o){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,c=fB(s,a,this.localCapabilities.send,s===rA.VIDEO?r:i),u=s===rA.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:s,port:kG,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e,o);const h=this.findFirstClosedMedia(s);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Dr(t=Object.keys(MR)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return QR.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return Dr(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===o.length)return QR.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const s=[...new Set(o.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];let a;if(QR.debug("updateRemoteCodec, from ".concat(r," to ").concat(s)),0===e.length)a=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(a=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&Dr(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),a.length!==e.length)return QR.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(kR("USE_PUB_RTX")||kR("USE_SUB_RTX")){const e=mB(o,this.rtpCapabilities.recv.videoCodecs);o.push(...e)}this._rtpCapabilities.recv.videoCodecs=o;const c=this.localCapabilities.send,u=this.rtpCapabilities.recv,l=fB(rA.VIDEO,u,c,n);return a.forEach((e=>{const t=l.map((e=>e.payloadType.toString(10)));QR.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from ").concat(e.attributes.payloads," to ").concat(l)),e.attributes.payloads=l,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,s=e===rA.VIDEO?o.videoCodecs:o.audioCodecs,a=e===rA.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let u={media:{mediaType:e,port:kG,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);const l=this.findFirstClosedMedia(e);if(l){const e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=Gw(e);return rB(r),nB(r,t),iB(r,t),oB(r),sB(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Gw(e);return sB(n,t,this.localCapabilities.recv),hB(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>DS()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:this.localCapabilities,cname:o}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),a=AV.parse(this.initialOffer.sdp),c=a.mediaDescriptions.find((e=>"audio"===e.media.mediaType));c&&hB(c),this.useXR&&pB(a);const u=AV.print(a),l=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),null==l||l(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const d=this.peerConnection.getTransceivers()[0];if(null!=d&&d.receiver&&this.tryBindTransportEvents(d.receiver),kR("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return pV((function*(){const i=yield iV(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[];e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t),e._updateRtpTransceiver(t)})),DS()&&!0===kR("SIMULCAST")&&(yield iV(r.applySimulcastForFirefox(o,e)));const s=yield iV(r.peerConnection.createOffer()),a=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(s.sdp,e,a),u=AV.parse(c),l=a.map((e=>{const t=u.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return $V(t,kR("USE_PUB_RTX"))}));let d;try{d=yield l}catch(i){d=[],r.remoteSDP.receive(e,t,n,d);const o=r.remoteSDP.toString();throw yield iV(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield iV(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield iV(r.stopSending(a,!0)),i}r.remoteSDP.receive(e,t,n,d);const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return yield iV(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield iV(r.applySimulcastEncodings(o,e)),yield iV(r.applySendEncodings(o,e)),null==p||p(h),yield iV(r.peerConnection.setRemoteDescription({type:"answer",sdp:h})),o.map(((e,t)=>{const n=a[t];return{localSSRC:l[t],id:n,transceiver:e}}))}catch(e){throw e instanceof nw?e:new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)QR.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:kR("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach((e=>{e._updateOriginDataChannel(n)}));const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),QR.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else QR.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof nw?e:new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof nw?e:new nw(tw.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{var t;KG(this.id+e.mid),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),QR.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else QR.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const s=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){const e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();null==t||t(n.sdp||""),await this.peerConnection.setLocalDescription(n),QR.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else QR.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}}))}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return pV((function*(){const n=yield iV(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(fx().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===iA.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(QR.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===iA.RELAY)return;t.remoteSDP.updateCandidates(e);const n=yield iV(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=ZV(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString(),s=t.logSDPExchange(n.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield iV(t.peerConnection.setLocalDescription(n)),null==s||s(o),yield iV(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){QR.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.getTransceivers().forEach((e=>{KG(this.id+e.mid)})),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return JG(JG({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new nw(tw.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?DS()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:JG(JG({},DV),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:JG(JG({},DV),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,QR.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,QR.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),kR("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Cw(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),kR("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),kR("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),kR("ENABLE_ENCODED_TRANSFORM")&&fx().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(WA(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!kR("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair();QR.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,r;if(!t){const n=this.peerConnection.getSenders();t=n.find((t=>t.track===e._mediaStreamTrack))}if(!t)return QR.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return QR.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!fx().supportSetRtpSenderParameters)return QR.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},o={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;case"balanced":i.degradationPreference="balanced"}const s=function(e,t){return e.getTransceivers().find((e=>e.sender.track===t||e.receiver.track===t))}(this.peerConnection,e._mediaStreamTrack),a=qU(e);if(WG(e)&&s&&t&&a&&this.getLocalVideoStats&&Dr(n=["vp8","vp9"]).call(n,this.store.codec)){var c;const n=i.degradationPreference||(Dr(c=e._hints).call(c,Px.CUSTOM_TRACK)?kR("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,r,i,o){if(KG(e),"balanced"!==r&&"maintain-framerate"!==r&&"maintain-resolution"!==r)return;let s=-1;jG(e,t);const a=window.setInterval((()=>{const a=HG.get(e);if(!kR("ENABLE_AG_ADAPTATION")||!a)return void KG(e);const c=o();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===s)return void(s=Date.now());if(Date.now()-s<1e3)return;const o=c.sendFrameRate,u=c.OutgoingAvailableBandwidth,[l,d]=BG(e,o,u,a.adaptationConfig,t,r);d&&(n.qualityLimitationReason=d),l&&a.adaptationConfig.scale!==l.scale&&(QR.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(o,", bwe ").concat(u,", switch from ").concat(a.adaptationConfig.scale," to ").concat(l.scale," ")),a.adaptationConfig=qG(qG({},a.adaptationConfig),l),i(l))}}),kR("CHECK_LOCAL_STATS_INTERVAL")),c=qG({},t);HG.set(e,{timer:a,adaptationConfig:c,originConfig:t,adaptationFunc:i}),QR.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}(this.id+s.mid,a,this,n,(e=>{t&&this.updateAdaptation(t,e)}),this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var u;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(o.maxBitrate=1e3*t),(Dr(u=e._hints).call(u,Px.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(o.maxFramerate=KA(n)),r&&r>=1&&(o.scaleResolutionDownBy=r))}const{maxFramerate:l}=kR("ENCODER_CONFIG_LIMIT");if(l&&"number"==typeof l&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,l):l),kR("DSCP_TYPE")&&JS()){var d;const e=kR("DSCP_TYPE");Dr(d=["very-low","low","medium","high"]).call(d,e)&&(o.networkPriority=e)}const h=t.getParameters(),p=null===(r=h.encodings)||void 0===r?void 0:r[0];DS()&&!p&&(i.encodings=[o]),p&&Object.assign(p,o),Object.assign(h,i),QR.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h)}async updateAdaptation(e,t){var n,r;if(!e)return QR.debug("[updateAdaptation] no rtpSender found");if(!fx().supportSetRtpSenderParameters)return QR.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const i={},{bitrateMax:o,frameRate:s,scaleResolutionDownBy:a}=t;o&&(i.maxBitrate=1e3*o),s&&(i.maxFramerate=KA(s)),a&&a>=1&&Dr(n=["vp8","vp9"]).call(n,this.store.codec)&&(i.scaleResolutionDownBy=a);const c=e.getParameters(),u=null===(r=c.encodings)||void 0===r?void 0:r[0];u&&Object.assign(u,i),Object.assign(c,{});try{await e.setParameters(c),QR.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?QR.debug("[updateAdaptation] peerConnection not connected}"):QR.debug("[updateAdaptation] updateRtpSenderEncodings failed",t):QR.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!fx().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof Sj&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){QR.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=AV.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(nB(o,e),aB(o,e,this.store.codec))})),AV.print(r)}mungReceiveAnswerSDP(e,t,n){const r=AV.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&(n===rA.AUDIO&&"audio"===i.media.mediaType&&hB(i),this.useXR&&pB(r)),AV.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o,s;const c=e[a],u=t[a];if(u instanceof Sj&&!Dr(n=u._hints).call(n,Px.LOW_STREAM)&&null!==(r=u._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=u._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=u._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=u._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!DS()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof Sj&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof Sj&&kR("SIMULCAST")&&"vp8"===this.store.codec&&!Dr(t=e._hints).call(t,Px.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(kR("SDP_LOGGING"))return QR.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(fx().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},rC(zG.prototype,"updateRemoteRTPCapabilities",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"updateRemoteRTPCapabilities"),zG.prototype),rC(zG.prototype,"connect",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"connect"),zG.prototype),rC(zG.prototype,"createDataChannels",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"createDataChannels"),zG.prototype),rC(zG.prototype,"receive",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"receive"),zG.prototype),rC(zG.prototype,"batchReceive",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"batchReceive"),zG.prototype),rC(zG.prototype,"stopReceiving",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"stopReceiving"),zG.prototype),rC(zG.prototype,"muteRemote",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"muteRemote"),zG.prototype),rC(zG.prototype,"unmuteRemote",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"unmuteRemote"),zG.prototype),rC(zG.prototype,"muteLocal",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"muteLocal"),zG.prototype),rC(zG.prototype,"unmuteLocal",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"unmuteLocal"),zG.prototype),rC(zG.prototype,"close",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"close"),zG.prototype),rC(zG.prototype,"updateEncoderConfig",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"updateEncoderConfig"),zG.prototype),rC(zG.prototype,"updateSendParameters",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"updateSendParameters"),zG.prototype),rC(zG.prototype,"replaceTrack",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"replaceTrack"),zG.prototype),rC(zG.prototype,"updateAdaptation",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"updateAdaptation"),zG.prototype),rC(zG.prototype,"getRemoteSSRC",[QG],Object.getOwnPropertyDescriptor(zG.prototype,"getRemoteSSRC"),zG.prototype),zG);function QG(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function ZG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZG(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZG(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const eq="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n",tq="9",nq=2e4,rq=4e4;class iq{get localCapabilities(){return Gw(this._localCapabilities)}get rtpCapabilities(){return Gw(this._rtpCapabilities)}get candidates(){return Gw(this._candidates)}get iceParameters(){return Gw(this._iceParameters)}get dtlsParameters(){return Gw(this._dtlsParameters)}constructor(e){ry(this,"sessionDesc",void 0),ry(this,"_localCapabilities",void 0),ry(this,"_rtpCapabilities",void 0),ry(this,"_candidates",void 0),ry(this,"_iceParameters",void 0),ry(this,"_dtlsParameters",void 0),ry(this,"setup",void 0),ry(this,"currentMidIndex",void 0),ry(this,"cname",void 0),ry(this,"firefoxSsrcMidMap",new Map),e=Gw(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:s,cname:a}=e,c=AV.parse(eq);this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s,this.setup=o,this.cname=a;const u=this.rtpCapabilities.send;for(const l of c.mediaDescriptions){if(l.attributes.iceUfrag=t.iceUfrag,l.attributes.icePwd=t.icePwd,l.attributes.fingerprints=n.fingerprints,l.attributes.candidates=r,l.attributes.setup=o,"application"===l.media.mediaType&&(l.attributes.sctpPort="5000"),"video"===l.media.mediaType&&(l.media.fmts=u.videoCodecs.map((e=>e.payloadType.toString(10))),l.attributes.payloads=u.videoCodecs,l.attributes.extmaps=u.videoExtensions,kR("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=tB([{ssrcId:rq,rtx:kR("USE_SUB_RTX")?40001:void 0}],this.cname);l.attributes.ssrcs=e,l.attributes.ssrcGroups=t}if("audio"===l.media.mediaType&&(l.media.fmts=u.audioCodecs.map((e=>e.payloadType.toString(10))),l.attributes.payloads=u.audioCodecs,l.attributes.extmaps=u.audioExtensions,hB(l),kR("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=tB([{ssrcId:nq}],this.cname);l.attributes.ssrcs=e,l.attributes.ssrcGroups=t}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}updateRemoteRTPCapabilities(e){const t=AV.parse(eq);this._rtpCapabilities=e;const n=this.rtpCapabilities.send;for(const r of t.mediaDescriptions){if(r.attributes.iceUfrag=this._iceParameters.iceUfrag,r.attributes.icePwd=this._iceParameters.icePwd,r.attributes.fingerprints=this._dtlsParameters.fingerprints,r.attributes.candidates=this._candidates,r.attributes.setup=this.setup,"application"===r.media.mediaType&&(r.attributes.sctpPort="5000"),"video"===r.media.mediaType&&(r.media.fmts=n.videoCodecs.map((e=>e.payloadType.toString(10))),r.attributes.payloads=n.videoCodecs,r.attributes.extmaps=n.videoExtensions,kR("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=tB([{ssrcId:rq,rtx:kR("USE_SUB_RTX")?40001:void 0}],this.cname);r.attributes.ssrcs=e,r.attributes.ssrcGroups=t}if("audio"===r.media.mediaType&&(r.media.fmts=n.audioCodecs.map((e=>e.payloadType.toString(10))),r.attributes.payloads=n.audioCodecs,r.attributes.extmaps=n.audioExtensions,kR("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:t}=tB([{ssrcId:nq}],this.cname);r.attributes.ssrcs=e,r.attributes.ssrcGroups=t}}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}preloadRemoteMedia(e){this.rtpCapabilities;const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){const e=2*o+nq,s=2*o+rq,{ssrcs:a,ssrcGroups:c}=tB([{ssrcId:e}],this.cname),{ssrcs:u,ssrcGroups:l}=tB([{ssrcId:s,rtx:kR("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:tq,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:tq,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return AV.print(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=tB(t,this.cname,kR("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(i);if(s){if(DS()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||NS()||PS()||VS()||0===t&&kR("USE_SUB_RTX")?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=Gw(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),DS()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||DS()||NS()||PS()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>Dr(e).call(e,t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){e===iA.TCP?this._candidates.forEach((e=>{-1===this._candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this._candidates.push($G($G({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(const t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(e){e=Gw(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(DS()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleRecvMedia(e,t,n,r,i,o){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,c=fB(s,a,this.localCapabilities.send,s===rA.VIDEO?r:i),u=s===rA.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:s,port:tq,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e,o);const h=this.findFirstClosedMedia(s);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Dr(t=Object.keys(MR)).call(t,e)})))],i=new Set(t);if(r.every((e=>i.has(e))))return QR.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter((e=>t.some((t=>{var n;return Dr(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}))));if(0===o.length)return QR.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const s=[...new Set(o.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")))];let a;if(QR.debug("updateRemoteCodec, from ".concat(r," to ").concat(s)),0===e.length)a=this.sessionDesc.mediaDescriptions.filter((e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction));else if(a=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&Dr(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction)),a.length!==e.length)return QR.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;this._rtpCapabilities.recv.videoCodecs=o;const c=this.localCapabilities.send,u=this.rtpCapabilities.recv,l=fB(rA.VIDEO,u,c,n);return a.forEach((e=>{const t=l.map((e=>e.payloadType.toString(10)));QR.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from ").concat(e.attributes.payloads," to ").concat(l)),e.attributes.payloads=l,e.media.fmts=t})),!0}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,s=e===rA.VIDEO?o.videoCodecs:o.audioCodecs,a=e===rA.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let u={media:{mediaType:e,port:tq,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);const l=this.findFirstClosedMedia(e);if(l){const e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=Gw(e);return rB(r),nB(r,t),iB(r,t),oB(r),sB(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Gw(e);return sB(n,t,this.localCapabilities.recv),hB(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>DS()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}var oq;function sq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aq(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sq(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let cq=(oq=class e extends nA{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let e;return this.localCapabilities&&(e=dB(this.localCapabilities)),[...new Set(e&&e.send.videoCodecs.map((e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"")).filter((e=>{var t;return Dr(t=Object.keys(MR)).call(t,e)})))]}constructor(e,t,n){super(e,t),ry(this,"store",void 0),ry(this,"peerConnection",void 0),ry(this,"remoteSDP",void 0),ry(this,"initialOffer",void 0),ry(this,"transportEventReceiver",void 0),ry(this,"statsFilter",void 0),ry(this,"useXR",kR("USE_XR")),ry(this,"localCapabilities",void 0),ry(this,"localCandidateCount",0),ry(this,"allCandidatesReceived",!1),ry(this,"remoteCodecs",void 0),ry(this,"dataStreamChannelMap",new Map),ry(this,"establishPromise",void 0),ry(this,"mutex",new hR("NVExtentionsConnection-mutex")),ry(this,"rtcMedia",void 0),this.store=t,this.peerConnection=n,this.statsFilter=YV(this.peerConnection,kR("STATS_UPDATE_INTERVAL"),void 0,DS()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(e){try{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=ZV(e.sdp),n=await cB({filterRTX:!kR("USE_PUB_RTX")&&!kR("USE_SUB_RTX"),filterVideoFec:kR("FILTER_VIDEO_FEC"),filterAudioFec:kR("FILTER_AUDIO_FEC"),filterVideoCodec:kR("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=n,this.initialOffer=e,aq(aq({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new CC(tw.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new iq({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:dB(this.localCapabilities),cname:o});const s=this.remoteSDP.toString(),a=AV.parse(this.initialOffer.sdp),c=a.mediaDescriptions.find((e=>"audio"===e.media.mediaType));c&&hB(c),this.useXR&&pB(a);const u=AV.print(a),l=this.logSDPExchange(u||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),null==l||l(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else QR.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else QR.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async updateRemoteConnect(e){var t,n,r,i;null===(t=this.remoteSDP)||void 0===t||t.updateRemoteRTPCapabilities(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&(null===(i=this.remoteSDP)||void 0===i||i.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),null===(n=this.remoteSDP)||void 0===n||n.preloadRemoteMedia(2);const o=null===(r=this.remoteSDP)||void 0===r?void 0:r.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s),QR.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(e,t,n){var r=this;return pV((function*(){const i=yield iV(r.mutex.lock("From NVExtentionsConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const o=[];e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t)})),DS()&&!0===kR("SIMULCAST")&&(yield iV(r.applySimulcastForFirefox(o,e)));const s=yield iV(r.peerConnection.createOffer()),a=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(s.sdp,e,a),u=AV.parse(c),l=a.map((e=>{const t=u.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return $V(t,kR("USE_PUB_RTX"))}));let d;try{d=yield l}catch(i){d=[],r.remoteSDP.receive(e,t,n,d);const o=r.remoteSDP.toString();throw yield iV(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield iV(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield iV(r.stopSending(a,!0)),i}r.remoteSDP.receive(e,t,n,d);const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return yield iV(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield iV(r.applySimulcastEncodings(o,e)),yield iV(r.applySendEncodings(o,e)),null==p||p(h),yield iV(r.peerConnection.setRemoteDescription({type:"answer",sdp:h})),o.map(((e,t)=>{const n=a[t];return{localSSRC:l[t],id:n,transceiver:e}}))}catch(e){throw e instanceof CC?e:new CC(tw.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);return n&&"open"===n.readyState?QR.debug("[P2PConnection] Channels are already available and can be reused directly."):(n=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:kR("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)),void t.forEach((e=>{e._updateOriginDataChannel(n)}))}catch(e){throw e instanceof CC?e:new CC(tw.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return null==t||t.close(),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof CC?e:new CC(tw.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),QR.debug("[NVExtentionsConnection] receive ".concat(e," by exchanging SDP."))}else QR.debug("[NVExtentionsConnection] receive ".concat(e," no need to exchange SDP."));const s=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i}}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){const e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();null==t||t(n.sdp||""),await this.peerConnection.setLocalDescription(n),QR.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else QR.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e}}))}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return pV((function*(){const n=yield iV(t.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(fx().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===iA.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(QR.debug("restartICE change iceTransportPolicy from [".concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===iA.RELAY)return;e!==iA.RELAY&&t.remoteSDP.updateCandidates(e);const n=yield iV(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=ZV(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString(),s=t.logSDPExchange(n.sdp||"","offer","local","restartICE");yield iV(t.peerConnection.setLocalDescription(n)),null==s||s(o),yield iV(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){QR.warning("restart ICE failed, abort operation",e)}finally{n()}}))()}close(){var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new CC(tw.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?DS()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}getP2PConnectionParams(){var e;if(null===(e=this.peerConnection.currentLocalDescription)||void 0===e||!e.sdp||!this.localCapabilities)throw new Error;return aq(aq({},ZV(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,QR.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,QR.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),kR("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Cw(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),kR("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),kR("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(WA(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!kR("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async applySendEncodings(e,t){try{if(!fx().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let l=0;l<e.length;l++){const d=e[l],h=t[l];if(h&&h instanceof Sj){var n,r,i;if(this.isVP8Simulcast(h))continue;const e={},t={};switch(h._optimizationMode){case"motion":e.degradationPreference="maintain-framerate";break;case"detail":e.degradationPreference="maintain-resolution";break;default:e.degradationPreference="balanced"}var o,s,a,c;if(null!==(n=h._encoderConfig)&&void 0!==n&&n.bitrateMax&&(t.maxBitrate=1e3*(null===(o=h._encoderConfig)||void 0===o?void 0:o.bitrateMax)),Dr(r=h._hints).call(r,Px.LOW_STREAM)&&(null!==(s=h._encoderConfig)&&void 0!==s&&s.frameRate&&(t.maxFramerate=KA(h._encoderConfig.frameRate)),null!==(a=h._encoderConfig)&&void 0!==a&&a.scaleResolutionDownBy&&(null===(c=h._encoderConfig)||void 0===c?void 0:c.scaleResolutionDownBy)>1&&(t.scaleResolutionDownBy=h._encoderConfig.scaleResolutionDownBy)),kR("DSCP_TYPE")&&JS()){var u;const e=kR("DSCP_TYPE");Dr(u=["very-low","low","medium","high"]).call(u,e)&&(t.networkPriority=e)}const l=d.sender.getParameters(),p=null===(i=l.encodings)||void 0===i?void 0:i[0];DS()&&!p&&(e.encodings=[t]),p&&Object.assign(p,t),Object.assign(l,e),await d.sender.setParameters(l)}}}catch(e){QR.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(e,t,n){const r=AV.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(nB(o,e),aB(o,e,this.store.codec))})),AV.print(r)}mungReceiveAnswerSDP(e,t,n){const r=AV.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===rA.AUDIO&&"audio"===i.media.mediaType&&hB(i),this.useXR&&pB(r),AV.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let a=0;a<e.length;a++){var n,r,i,o,s;const c=e[a],u=t[a];if(u instanceof Sj&&!Dr(n=u._hints).call(n,Px.LOW_STREAM)&&null!==(r=u._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=u._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=u._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(s=u._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!DS()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof Sj&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof Sj&&kR("SIMULCAST")&&"vp8"===this.store.codec&&!Dr(t=e._hints).call(t,Px.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(kR("SDP_LOGGING"))return QR.upload("exchanging ".concat(n," ").concat(t," SDP during NVExtentionsConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(fx().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},rC(oq.prototype,"connect",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"connect"),oq.prototype),rC(oq.prototype,"updateRemoteRTPCapabilities",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"updateRemoteRTPCapabilities"),oq.prototype),rC(oq.prototype,"updateRemoteConnect",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"updateRemoteConnect"),oq.prototype),rC(oq.prototype,"createDataChannels",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"createDataChannels"),oq.prototype),rC(oq.prototype,"receive",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"receive"),oq.prototype),rC(oq.prototype,"batchReceive",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"batchReceive"),oq.prototype),rC(oq.prototype,"stopReceiving",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"stopReceiving"),oq.prototype),rC(oq.prototype,"muteRemote",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"muteRemote"),oq.prototype),rC(oq.prototype,"unmuteRemote",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"unmuteRemote"),oq.prototype),rC(oq.prototype,"muteLocal",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"muteLocal"),oq.prototype),rC(oq.prototype,"unmuteLocal",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"unmuteLocal"),oq.prototype),rC(oq.prototype,"close",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"close"),oq.prototype),rC(oq.prototype,"updateEncoderConfig",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"updateEncoderConfig"),oq.prototype),rC(oq.prototype,"updateSendParameters",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"updateSendParameters"),oq.prototype),rC(oq.prototype,"replaceTrack",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"replaceTrack"),oq.prototype),rC(oq.prototype,"getRemoteSSRC",[uq],Object.getOwnPropertyDescriptor(oq.prototype,"getRemoteSSRC"),oq.prototype),oq);function uq(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From NVExtentionsConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}var lq;function dq(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=TG,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new hq(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function hq(e){function t(e){if(Object(e)!==e)return Gh.reject(new TypeError(e+" is not an object."));var t=e.done;return Gh.resolve(e.value).then((function(e){return{value:e,done:t}}))}return hq=function(e){this.s=e,this.n=e.next},hq.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Gh.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Gh.reject(e):t(n.apply(this.s,arguments))}},new hq(e)}let pq=(lq=class e extends nA{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,n){super(t,n),ry(this,"store",void 0),ry(this,"peerConnection",void 0),ry(this,"cname",void 0),ry(this,"mutex",new hR("DataChannelConnection-mutex")),ry(this,"dataChannel",void 0),ry(this,"_p2pConnection",void 0),ry(this,"establishPromise",void 0),ry(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new cq(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var e;const t=null===(e=this._nvMedia)||void 0===e?void 0:e.getLocalRtpCapabilities();return await this._p2pConnection.establish(t)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(e,t,n,r,i,o){return this.cname=o,await this._p2pConnection.connect(e,t,n,r,i,o),await new Gh(((e,t)=>{const r=setTimeout((()=>{this.closeSignal(),t(new CC(tw.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(n))))}),2e3);this.dataChannel.onopen=()=>{if("open"===this.dataChannel.readyState)return clearTimeout(r),void e()},this.dataChannel.onerror=e=>{this.closeSignal(),t(e)}})),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(e,t){return this._p2pConnection.updateRemoteRTPCapabilities(e,t)}send(e,t,n){var r=this;return pV((function*(){const i=yield iV(r.mutex.lock("From DataChannelConnection.send"));try{return yield*yG(dq(r._p2pConnection.send(e,t,n)))}finally{i()}}))()}async stopSending(e,t){return this._p2pConnection.stopSending(e,t)}async createDataChannels(e,t){return this._p2pConnection.createDataChannels(e,t)}async stopDataChannels(e){return this._p2pConnection.stopDataChannels(e)}async receive(e,t,n,r){return this._nvMedia?(QR.debug("[DataChannelConnection] receive ".concat(e," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(e,t,this.cname)):(QR.debug("[DataChannelConnection] receive ".concat(e," by WebRTC.")),await this._p2pConnection.receive(e,t,n,r))}async batchReceive(e){return[...await this._p2pConnection.batchReceive(e)]}async stopReceiving(e){return await this._p2pConnection.stopReceiving(e)}async muteRemote(e){return await this._p2pConnection.muteRemote(e)}async unmuteRemote(e){return await this._p2pConnection.unmuteRemote(e)}async muteLocal(e){return await this._p2pConnection.muteLocal(e)}async unmuteLocal(e){return await this._p2pConnection.unmuteLocal(e)}restartICE(e){var t=this;return pV((function*(){return yield*yG(dq(t._p2pConnection.restartICE(e)))}))()}close(){var e;null===(e=this._nvMedia)||void 0===e||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(e){return this._p2pConnection.getRemoteVideoIsReady(e)}updateRemoteConnect(e){var t;null===(t=this._nvMedia)||void 0===t||t.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}async updateEncoderConfig(e,t){return await this._p2pConnection.updateEncoderConfig(e,t)}async updateSendParameters(e,t){return await this._p2pConnection.updateSendParameters(e,t)}setStatsRemoteVideoIsReady(e,t){this._p2pConnection.setStatsRemoteVideoIsReady(e,t)}async replaceTrack(e,t){return await this._p2pConnection.replaceTrack(e,t)}async getRemoteSSRC(e){return this._p2pConnection.getRemoteSSRC(e)}logSDPExchange(e,t,n,r){if(kR("SDP_LOGGING"))return QR.upload("exchanging ".concat(n," ").concat(t," SDP during DataChannelConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Cw(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),kR("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),kR("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(WA(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!kR("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=e=>{var t;return null===(t=this.onICEConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onConnectionStateChange=e=>{var t;return null===(t=this.onConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportStateChange=e=>{var t;return null===(t=this.onDTLSTransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportError=e=>{var t;return null===(t=this.onDTLSTransportError)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onICETransportStateChange=e=>{var t;return null===(t=this.onICETransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioReceived=e=>{var t;return null===(t=this.onFirstAudioReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoReceived=e=>{var t;return null===(t=this.onFirstVideoReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioDecoded=e=>{var t;return null===(t=this.onFirstAudioDecoded)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoDecoded=(e,t,n)=>{var r;return null===(r=this.onFirstVideoDecoded)||void 0===r?void 0:r.call(this,e,t,n)},this._p2pConnection.onFirstVideoDecodedTimeout=e=>{var t;return null===(t=this.onFirstVideoDecodedTimeout)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onSelectedLocalCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedLocalCandidateChanged)||void 0===n?void 0:n.call(this,e,t)},this._p2pConnection.onSelectedRemoteCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n?void 0:n.call(this,e,t)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}setConfiguration(e){this._p2pConnection.setConfiguration(e)}},rC(lq.prototype,"connect",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"connect"),lq.prototype),rC(lq.prototype,"updateRemoteRTPCapabilities",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"updateRemoteRTPCapabilities"),lq.prototype),rC(lq.prototype,"createDataChannels",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"createDataChannels"),lq.prototype),rC(lq.prototype,"receive",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"receive"),lq.prototype),rC(lq.prototype,"stopReceiving",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"stopReceiving"),lq.prototype),rC(lq.prototype,"muteRemote",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"muteRemote"),lq.prototype),rC(lq.prototype,"unmuteRemote",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"unmuteRemote"),lq.prototype),rC(lq.prototype,"muteLocal",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"muteLocal"),lq.prototype),rC(lq.prototype,"unmuteLocal",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"unmuteLocal"),lq.prototype),rC(lq.prototype,"close",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"close"),lq.prototype),rC(lq.prototype,"updateEncoderConfig",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"updateEncoderConfig"),lq.prototype),rC(lq.prototype,"updateSendParameters",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"updateSendParameters"),lq.prototype),rC(lq.prototype,"replaceTrack",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"replaceTrack"),lq.prototype),rC(lq.prototype,"getRemoteSSRC",[fq],Object.getOwnPropertyDescriptor(lq.prototype,"getRemoteSSRC"),lq.prototype),lq);function fq(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From DataChannelConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}var mq;function gq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gq(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Eq(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=TG,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new vq(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function vq(e){function t(e){if(Object(e)!==e)return Gh.reject(new TypeError(e+" is not an object."));var t=e.done;return Gh.resolve(e.value).then((function(e){return{value:e,done:t}}))}return vq=function(e){this.s=e,this.n=e.next},vq.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Gh.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Gh.reject(e):t(n.apply(this.s,arguments))}},new vq(e)}let yq=(mq=class extends vw{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(cA.StateChange,t,this._state)}constructor(e,t){super(),ry(this,"store",void 0),ry(this,"statsUploader",void 0),ry(this,"connection",void 0),ry(this,"localTrackMap",new Map),ry(this,"remoteUserMap",new Map),ry(this,"localDataChannels",[]),ry(this,"remoteDataChannelMap",new Map),ry(this,"pendingLocalTracks",[]),ry(this,"pendingRemoteTracks",[]),ry(this,"pendingLocalDataChannels",[]),ry(this,"pendingRemoteDataChannels",[]),ry(this,"statsCollector",void 0),ry(this,"isPlanB",!1),ry(this,"shouldForwardP2PCreation",void 0),ry(this,"iceFailedCount",0),ry(this,"dtlsFailedCount",0),ry(this,"mutex",new hR("P2PChannel-mutex")),ry(this,"_state",aA.Disconnected),ry(this,"_pcStatsUploadType",kR("NEW_ICE_RESTART")?oA.FIRST_CONNECTION:oA.OLD_FIRST_CONNECTION),ry(this,"_isInRestartIce",!1),ry(this,"_isStartRestartIce",!1),ry(this,"_restartStates",["disconnected","failed"]),ry(this,"_restartTimer",void 0),ry(this,"_isFirstConnected",!0),ry(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==aA.Connected)return void n(new nw(tw.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));i&&i[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createMuteMessage(r);await Mw(this,cA.RequestMuteLocal,o),t()}catch(e){n(e)}finally{r()}})),ry(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==aA.Connected)return void n(new nw(tw.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();const i=r.find((e=>"videoLowTrack"===e[0]));if(i){const t=i[1];if(t.track._originMediaStreamTrack.stop(),!kR("DISABLE_DUAL_STREAM_USE_ENCODING")&&fx().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=SB(e,Uw(this,cA.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new Gh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}await this.connection.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnmuteMessage(r);await Mw(this,cA.RequestUnmuteLocal,o),t()}catch(e){n(e)}finally{r()}})),ry(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const n=this.localTrackMap.get(sA.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==aA.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(cA.UpdateVideoEncoder,i),t()}catch(e){n(e)}finally{r()}})),ry(this,"handleUpdateVideoSendParameters",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(sA.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==aA.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}})),ry(this,"handleReplaceMixingTrack",(async(e,t,n,r)=>{if(!this.connection||this.state!==aA.Connected)return void t();const i=WB([e]);let o;QR.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(i.getTrackId(),"]")),"boolean"==typeof r&&r||(o=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,i),t()}catch(e){n(e)}finally{var s;null===(s=o)||void 0===s||s()}})),ry(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;QR.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.connection||!n||this.state!==aA.Connected)return void t();if(await(null===(o=this.connection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===sA.LocalVideoTrack&&!kR("DISABLE_DUAL_STREAM_USE_ENCODING")&&fx().supportDualStreamEncoding){const t=this.localTrackMap.get(sA.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new Gh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var s;null===(s=i)||void 0===s||s()}})),ry(this,"handleGetRTCStats",(e=>{e(this.statsCollector.getRTCStats())})),ry(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),ry(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),ry(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),ry(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new jB(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!fx().supportUnifiedPlan||kR("CHROME_FORCE_PLAN_B")&&JS(),this.shouldForwardP2PCreation=kR("FORWARD_P2P_CREATION")&&fx().supportPCSetConfiguration&&YS(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new pq({},this.store):this.isPlanB?new CG({},this.store):new XG({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=aA.New;const r=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(QR.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new pq(e,this.store):this.isPlanB?new CG(e,this.store):new XG(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new nw(tw.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=kR("NEW_ICE_RESTART")?oA.FIRST_CONNECTION:oA.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,r,i,o){if(!this.connection)throw new nw(tw.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof pq?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,r,i,o),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=aA.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((e=>{var t;let[n]=e;return Dr(t=[sA.LocalVideoLowTrack,sA.LocalVideoTrack]).call(t,n)})),n=t.map((e=>{let[,{id:t}]=e;return t})),r=t.map((e=>{let[t]=e;return t}));if(this.connection instanceof XG){if(oI.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Dr(e).call(e,this.store.codec)){const t=["vp9","vp8","h264"].find((t=>Dr(e).call(e,t)));t&&(this.store.codec=t,QR.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async preConnect(e,t,n,r,i,o){if(!this.connection)throw new nw(tw.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const s=await this.connection.connect(e,t,n,r,i,o);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=aA.Connected,s}getEstablishParams(){if(this.connection instanceof pq)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection||this.state!==aA.Connected){if(this.state===aA.Disconnected)throw new nw(tw.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void e.forEach((e=>{var t;Dr(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)}))}const t=this.filterTobePublishedDataChannels(e);0!==t.length&&(t.forEach((e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)})))}publish(e,t,n){var r=this;return pV((function*(){const i=yield iV(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==aA.Connected){if(r.state===aA.Disconnected)throw new nw(tw.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,nV.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield iV(r.tryToUnmuteAudio(e)));yield*yG(Eq(r.doPublish(r.connection,i)))}finally{i()}}))()}doPublish(e,t){var n=this;return pV((function*(){t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===sA.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t);const r=t.map((e=>{let{track:t}=e;return t})),i=yield iV(e.send(t.map((e=>{let{track:t}=e;return t})),n.store.codec,n.store.audioCodec)),o=(yield iV(i.next())).value,s=n.createGatewayPublishMessage(t,o);let a;try{a=yield s}catch(e){throw i.throw(e),(null==e?void 0:e.code)===tw.WS_ABORT&&t.forEach((e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),e}const c=n.mapPubResToRemoteConfig(s,a),u=(yield iV(i.next(c))).value,l=kR("ENABLE_VIDEO_SEI");r.forEach((async e=>{const t=e.getRTCRtpTransceiver();t&&l&&(e.trackMediaType===rA.VIDEO?await Qj(t.sender,e):e.trackMediaType===rA.AUDIO&&await async function(e){if(!fx().supportWebRTCEncodedTransform)return void QR.warning("browser not support audio encoded transform");if(Yj.has(e))return;if(!e.track)return;const t={track:e.track};if(OS()){if(!e.createEncodedStreams)return void QR.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(e){return void QR.error("create audio-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(r,i){t.controller||(t.controller=i),e.track&&e.track.id!==t.track.id&&(QR.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n)),i.enqueue(r)}});r.readable.pipeThrough(i).pipeTo(r.writable)}else if(NS()){if("undefined"==typeof RTCRtpScriptTransform)return void QR.warning("browser not support RTCRtpScriptTransform");const r=zj(),i=new MessageChannel;await new Gh((e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)}));const o=new RTCRtpScriptTransform(r,{name:"tx",port:i.port2},[i.port2]);e.transform=o,await new Gh((e=>r.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=r=>{var i;r.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==t.track.id&&(QR.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n))},t.worker=r}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}const t=Yj.get(e);if(t){Yj.delete(e);try{var r,i;null===(r=t.controller)||void 0===r||r.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){QR.warning(e&&e.message)}}}Yj.set(e,t),e.track.addEventListener("ended",n)}(t.sender))})),t.forEach((e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,u),n.statsUploader.startUploadOutboundStats(),t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===sA.LocalAudioTrack?"audio":"video",void 0,i)}))}))()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n)return;if(!(n.track instanceof Sj))return QR.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof XG||this.connection instanceof CG))return QR.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r}=n,i=function(e,t){const n={};return e.height&&e.width&&(n.scaleResolutionDownBy=QA(e,t)),n.maxFramerate=e.framerate?KA(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==sA.LocalVideoLowTrack||!kR("DISABLE_DUAL_STREAM_USE_ENCODING")&&fx().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const t=r._originMediaStreamTrack;if(!t.canvas)return QR.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(e,t){const n=e.canvas;t.width&&(n.width=KA(t.width)),t.height&&(n.height=KA(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=hU((()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),KA(t.framerate)))}(t,e)}null!=i.maxBitrate&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),QR.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return pV((function*(){if(!t.connection||t.state!==aA.Connected)return;const n=yield iV(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get(sA.LocalVideoTrack);if(!n)throw new nw(tw.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(sA.LocalVideoLowTrack))throw new nw(tw.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const i=[{track:t.getLowVideoTrack(n.track,e),type:sA.LocalVideoLowTrack}];if(yield*yG(Eq(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var r;const e=null===(r=t.localTrackMap.get(sA.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield iV(t.connection.muteLocal([e])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(QR.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Lw(this,cA.RequestRePublish,this.pendingLocalTracks),this.emit(cA.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(QR.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Lw(this,cA.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==rA.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==rA.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Lw(this,cA.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===rA.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((e=>{let{user:t}=e;this.emit(cA.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==aA.Connected)return void e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==aA.Connected)return void e.forEach((e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach((e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)})),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map((e=>e.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==aA.Connected)return;const e=this.localTrackMap.get(sA.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[sA.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==aA.Connected)throw new nw(tw.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter((t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))}));if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach((t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const r=this.pendingRemoteDataChannels.findIndex((n=>{let{user:r,id:i}=n;return r.uid===e.uid&&i===t.id}));-1!==r&&this.pendingRemoteDataChannels.splice(r,1)})),n.map((e=>e.id))}async subscribe(e,t,n,r,i){var o;if(!this.connection||this.state!==aA.Connected)throw new nw(tw.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let s,a,c;if(i){const n=i.find((e=>{let{stream_type:n}=e;return n===t}));if(!n)throw new nw(tw.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof XG&&(c=r.transceiver),s=r.track,a=r.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof XG&&(c=i.transceiver),s=i.track,a=i.id}t===rA.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new Vj(s,e.uid,e._uintid,this.store),QR.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new jj(s,e.uid,e._uintid,this.store),QR.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),kR("ENABLE_VIDEO_SEI")&&c&&(t==rA.VIDEO?await $j(c.receiver,{onSei:t=>{var n;null===(n=e._videoTrack)||void 0===n||n._onSei(t)}}):t==rA.AUDIO&&await async function(e){if(!fx().supportWebRTCEncodedTransform)return void QR.warning("browser not support audio encoded transform");if(Jj.has(e))return;const t={track:e.track};if(OS()){if(!e.createEncodedStreams)return void QR.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(e){return void QR.error("create audio-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(r,i){t.controller||(t.controller=i),e.track&&e.track.id!==t.track.id&&(QR.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n)),i.enqueue(r)}});r.readable.pipeThrough(i).pipeTo(r.writable)}else if(NS()){if("undefined"==typeof RTCRtpScriptTransform)return void QR.warning("browser not support RTCRtpScriptTransform");const r=zj(),i=new MessageChannel;await new Gh((e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)}));const o=new RTCRtpScriptTransform(r,{name:"rx",port:i.port2},[i.port2]);e.transform=o,await new Gh((e=>r.onmessage=t=>{"started"===t.data&&e(void 0)})),i.port1.onmessage=r=>{var i;r.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==t.track.id&&(QR.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n))},t.worker=r}function n(){e.track.removeEventListener("ended",n),function(e){const t=Jj.get(e);if(t){Jj.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){QR.warning(e&&e.message)}}}(e)}Jj.set(e,t),e.track.addEventListener("ended",n)}(c.receiver));const u=this.remoteUserMap.get(e);u?u.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const l=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(cA.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==aA.Connected)throw new nw(tw.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))}));const t=await this.connection.batchReceive(e.map((e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}})));e.forEach(((e,n)=>{let{user:r,mediaType:i}=e;const{track:o,id:s,transceiver:a}=t[n];i===rA.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(o):(r._audioTrack=new Vj(o,r.uid,r._uintid,this.store),QR.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),a&&r._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(o):(r._videoTrack=new jj(o,r.uid,r._uintid,this.store),QR.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),a&&r._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(r,r._videoTrack));const c=this.remoteUserMap.get(r);c?c.set(i,s):this.remoteUserMap.set(r,new Map([[i,s]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const u=this.pendingRemoteTracks.findIndex((e=>{let{user:t,kind:n}=e;return t.uid===r.uid&&i===n}));-1!==u&&(this.pendingRemoteTracks.splice(u,1),this.emit(cA.MediaReconnectEnd,r.uid))}))}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===aA.Connected||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===rA.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===rA.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==aA.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===rA.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===rA.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===rA.AUDIO){var s;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(s=t._audioTrack)||void 0===s||s._destroy(),t._audioTrack=void 0)}})),o}async unsubscribeDataChannel(e,t){if(t.forEach((e=>{const t=this.pendingRemoteDataChannels.findIndex((t=>t.id===e.id));-1!==t&&this.pendingRemoteDataChannels.splice(t,1)})),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach((e=>{e._close()}));const r=this.remoteDataChannelMap.get(e);return n.forEach((e=>{r&&r.delete(e.id)})),r&&0===r.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((e=>e.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:i,mediaType:o}of e){const e=this.pendingRemoteTracks.filter((e=>{let{user:t,kind:n}=e;return void 0!==o?t.uid===i.uid&&o===n:t.uid===i.uid}));e.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),t=t.concat(e)}if(!this.connection||this.state!==aA.Connected)return void t.forEach((e=>{let{user:t,kind:n}=e;var r;if(n===rA.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===rA.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}}));const n=Xr(e).call(e,((e,t)=>{let{user:n,mediaType:r}=t;const i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((e=>{let[,{id:t}]=e;return t})));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach((e=>{let[t,{kind:n}]=e;var r,i;if(n===rA.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===rA.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===rA.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0}})),r}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void QR.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void QR.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===rA.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||QR.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):QR.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(sA.LocalAudioTrack);if((null==t?void 0:t.track)instanceof xF){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==sA.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===sA.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===sA.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(sA.LocalAudioTrack),o=r?this.localTrackMap.get(sA.LocalVideoLowTrack):this.localTrackMap.get(sA.LocalVideoTrack);oI.publish(this.store.sessionId,{eventElapse:nV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(Px.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const s=n.find((e=>e instanceof PF)),a=r?null===(o=this.localTrackMap.get(sA.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof Sj));oI.publish(this.store.sessionId,{eventElapse:nV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==s?void 0:s.getTrackLabel(),videoName:null==a?void 0:a.getTrackLabel(),screenshare:-1!==(null==a?void 0:a._hints.indexOf(Px.SCREEN_TRACK)),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===rA.VIDEO?n._videoSSRC:n._audioSSRC;i&&oI.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===rA.VIDEO,audio:r===rA.AUDIO,peerid:n.uid,subscribeRequestid:r===rA.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:nV.measureFromSubscribeStart(this.store.clientId,i)})}reset(){QR.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new hR("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new pq({},this.store):this.isPlanB?new CG({},this.store):new XG({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(sA.LocalAudioTrack);if((null==e?void 0:e.track)instanceof xF){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=aA.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(sA.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(sA.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Sj||t&&t.track instanceof PF?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(lf(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(sA.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=sm(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.connection&&(QR.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=aA.Reconnecting,kR("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new pq({},this.store):this.isPlanB?new CG({},this.store):new XG({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:r}]=e;switch(n){case sA.LocalVideoTrack:Dr(t=r._hints).call(t,Px.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case sA.LocalAudioTrack:r instanceof xF?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case sA.LocalVideoLowTrack:}})),this.emit(cA.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(lf(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(cA.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from(lf(n).call(n)).forEach((e=>{this.setPendingRemoteDataChannel(t,e)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),QR.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof VB?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof VB?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return pV((function*(){if(!t.connection||t.state!==aA.Connected||t.connection instanceof pq)return;const n=yield iV(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield iV(t.connection.restartICE(e));const n=yield iV(r.next());if(n.done)return;const i=n.value,o=yield i;switch(t.reportPCDisconnectedOrFailed(e),e){case iA.TCP:t._pcStatsUploadType=oA.TCP_RESTART;break;case iA.RELAY:t._pcStatsUploadType=oA.RELAY_RESTART;break;default:t._pcStatsUploadType=oA.OLD_RESTART}t._isInRestartIce=!0,r.next(o)}catch(e){var i;null===(i=r)||void 0===i||i.throw(e)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(sA.LocalVideoTrack),n=this.localTrackMap.get(sA.LocalAudioTrack),r=e.videoSend.find((e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId))),i=e.audioSend.find((e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)));if(!r||!i)return 1;const o=xw(this,cA.NeedSignalRTT),s=r?r.rttMs:void 0,a=i?i.rttMs:void 0,c=s&&a?(s+a)/2:s||a,u=(c&&o?(c+o)/2:c||o)||0,l=100*e.sendPacketLossRate*.7/50+.3*u/1500,d=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(Px.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return cI[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,s=e.audioRecv.find((e=>e.ssrc===i)),a=e.videoRecv.find((e=>e.ssrc===o));if(!s&&!a)return void(t+=1);const c=xw(this,cA.NeedSignalRTT),u=e.rtt,l=(u&&c?(u+c)/2:u||c)||0,d=s?s.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*l/1500;d&&(p=.6*h*100/50+.2*l/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Gh(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}async replaceTrack(e,t){var n;if(QR.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==aA.Connected)return;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const e=r[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,e)}if(i===sA.LocalVideoTrack&&!kR("DISABLE_DUAL_STREAM_USE_ENCODING")&&fx().supportDualStreamEncoding){const t=this.localTrackMap.get(sA.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new Gh(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=Vw(e=e.filter((e=>-1===i.indexOf(e))));let o,s=!1;const a=this.localTrackMap.get(sA.LocalAudioTrack);for(const c of e){if(c instanceof Sj&&(this.localTrackMap.has(sA.LocalVideoTrack)||s?new nw(tw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:sA.LocalVideoTrack}),s=!0),t)){const e=this.getLowVideoTrack(c,n);r.push({track:e,type:sA.LocalVideoLowTrack})}if(c instanceof PF)if(a){const e=a.track;if(e instanceof xF)qB([c]),e.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const t=WB([e,c]);QR.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else o instanceof xF?(qB([c]),o.addAudioTrack(c)):o=o||!c._useAudioElement&&fx().webAudioMediaStreamDest&&!c._bypassWebAudio?WB(o?[c,o]:[c]):c}return o&&(QR.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),r.push({track:o,type:sA.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Vw(e=e.filter((e=>-1!==n.indexOf(e))));for(const r of e){if(r instanceof PF){const e=this.localTrackMap.get(sA.LocalAudioTrack);if(!e)continue;e.track instanceof xF?(e.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),0===e.track.trackList.length&&(t.push([sA.LocalAudioTrack,e]),e.track.close())):t.push([sA.LocalAudioTrack,e])}if(r instanceof Sj){const e=this.localTrackMap.get(sA.LocalVideoTrack);if(!e)continue;t.push([sA.LocalVideoTrack,e]);const n=this.localTrackMap.get(sA.LocalVideoLowTrack);n&&t.push([sA.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=Vw(e)).filter((e=>-1===this.localDataChannels.findIndex((t=>t.id===e.id))))}filterTobeUnpublishedDataChannels(e){return(e=(e=Vw(e)).filter((e=>-1!==this.localDataChannels.indexOf(e)))).filter((e=>e._originDataChannel))}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case sA.LocalVideoTrack:t.addListener(Dx.GET_STATS,this.handleGetLocalVideoStats),t.addListener(Dx.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Dx.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(Dx.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(Dx.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case sA.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case sA.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof xF?e.trackList.forEach((e=>{e.addListener(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Dx.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(Dx.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Dx.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Dx.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case sA.LocalVideoTrack:t.off(Dx.GET_STATS,this.handleGetLocalVideoStats),t.off(Dx.GET_RTC_STATS,this.handleGetRTCStats),t.off(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Dx.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(Dx.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(Dx.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case sA.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case sA.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof xF?e.trackList.forEach((e=>{e.off(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Dx.GET_STATS,this.handleGetLocalAudioStats),e.off(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(Dx.GET_STATS,this.handleGetLocalAudioStats),e.off(Dx.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Dx.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Dx.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Dx.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Dx.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Dx.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof jj&&t.addListener(Dx.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof Vj&&t.addListener(Dx.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Dx.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(rA.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(rA.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{var r;let i,o,{track:s,type:a}=e;switch(a){case sA.LocalAudioTrack:i=HC.Audio,o={dtx:s instanceof LF&&s._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case sA.LocalVideoTrack:i=Dr(r=s._hints).call(r,Px.SCREEN_TRACK)?HC.Screen:HC.High,o=_q(_q({},zA(s)),{},{codec:this.store.codec});break;case sA.LocalVideoLowTrack:i=HC.Low,o=_q(_q({},zA(s)),{},{codec:this.store.codec})}return{stream_type:i,attributes:o,ssrcs:t[n]}}))}createGatewayUnpublishMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case sA.LocalVideoTrack:n=Dr(t=i._hints).call(t,Px.SCREEN_TRACK)?HC.Screen:HC.High;break;case sA.LocalAudioTrack:n=HC.Audio;break;case sA.LocalVideoLowTrack:n=HC.Low}return{stream_type:n,ssrcs:o,mid:s}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(cA.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),kR("NEW_ICE_RESTART")){var n;if(Dr(n=this._restartStates).call(n,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(QR.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(t)),"CONNECTED"===xw(this,cA.QueryClientConnectionState)&&this.emit(cA.RequestRestartICE,t))},n=()=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),QR.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(cA.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())},r=kR("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout((()=>{if(kR("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&fx().supportPCSetConfiguration)t(iA.RELAY),this._restartTimer=window.setTimeout(n,r);else if(DS())t(iA.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(t(iA.TCP),fx().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout((()=>{t(iA.RELAY),this._restartTimer=window.setTimeout(n,r)}),r));this._restartTimer=window.setTimeout(n,r)}}),800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout((()=>{"disconnected"===e.iceConnectionState&&kR("ICE_RESTART")&&"CONNECTED"===xw(this,cA.QueryClientConnectionState)&&this.emit(cA.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===e.peerConnectionState&&(QR.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout((()=>this.emit(cA.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===t&&(QR.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout((()=>this.emit(cA.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),oI.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Sw.TRACER}).onSuccess(),this.emit(cA.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(lf(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(jx.FIRST_FRAME_DECODED),oI.firstRemoteFrame(this.store.sessionId,tI.FIRST_AUDIO_DECODE,nI.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:nV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(lf(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&oI.firstRemoteFrame(this.store.sessionId,tI.FIRST_AUDIO_RECEIVED,nI.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:nV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(lf(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&oI.firstRemoteFrame(this.store.sessionId,tI.FIRST_VIDEO_RECEIVED,nI.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:nV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(cA.ConnectionTypeChange,n),QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ZA(t))," -> ").concat(JSON.stringify(ZA(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{QR.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ZA(t))," -> ").concat(JSON.stringify(ZA(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return _q(_q({},e),t)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(sA.LocalAudioTrack);if(e instanceof PF&&(null==n?void 0:n.track)instanceof xF)return n.track.isActive||t.push([sA.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===sA.LocalVideoTrack)){const e=this.localTrackMap.get(sA.LocalVideoLowTrack);e&&t.push([sA.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(sA.LocalAudioTrack);if(e instanceof PF&&(null==n?void 0:n.track)instanceof xF)return n.track.isActive&&t.push([sA.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===sA.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(sA.LocalVideoLowTrack);e&&t.push([sA.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case sA.LocalAudioTrack:n=HC.Audio;break;case sA.LocalVideoTrack:n=Dr(t=i._hints).call(t,Px.SCREEN_TRACK)?HC.Screen:HC.High;break;case sA.LocalVideoLowTrack:n=HC.Low}return{stream_type:n,ssrcs:o,mid:s}}))}createUnmuteMessage(e){return e.map((e=>{var t;let n,[r,{track:i,ssrcs:o,id:s}]=e;switch(r){case sA.LocalAudioTrack:n=HC.Audio;break;case sA.LocalVideoTrack:n=Dr(t=i._hints).call(t,Px.SCREEN_TRACK)?HC.Screen:HC.High;break;case sA.LocalVideoLowTrack:n=HC.Low}return{stream_type:n,ssrcs:o,mid:s}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach((t=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(t.id)&&n.push(t)})),n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case rA.VIDEO:return void(n._videoSSRC&&t.push({stream_type:rA.VIDEO,ssrcId:n._videoSSRC}));case rA.AUDIO:return void(n._audioSSRC&&t.push({stream_type:rA.AUDIO,ssrcId:n._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===rA.VIDEO?e|=YC.Video:e|=YC.Audio,t.set(n,e)}else r===rA.VIDEO?t.set(n,YC.Video):t.set(n,YC.Audio)})),{users:Array.from(t.entries()).map((e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}}))}}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(sA.LocalVideoTrack),n=this.localTrackMap.get(sA.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t){return e.map(((e,n)=>{var r;let{stream_type:i}=e;return null===(r=t.find((e=>{let{stream_type:t}=e;return i===t})))||void 0===r?void 0:r.attributes}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof PF){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t}))));const i=this.createUnmuteMessage(r);return void await Mw(this,cA.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(cA.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(cA.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await $w(mR(this.dtlsFailedCount,fR)),this.emit(cA.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Lw(this,cA.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(cA.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(sA.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof Sj))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof Sj)).length>1)throw new nw(tw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof PF)).length>1&&(e.some((e=>e instanceof PF&&e._bypassWebAudio))||!fx().webAudioMediaStreamDest))throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Sj&&this.pendingLocalTracks.some((e=>e instanceof Sj)))throw new nw(tw.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof PF&&this.pendingLocalTracks.some((e=>e instanceof PF))&&(!fx().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof PF&&e._bypassWebAudio))))throw new nw(tw.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!kR("DISABLE_DUAL_STREAM_USE_ENCODING")&&fx().supportDualStreamEncoding,r=_q(_q({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():SB(e,r);const o=eR(8,"track-low-"),s=new Sj(i,_q(_q({},n&&{scaleResolutionDownBy:QA(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return s.on(Ux.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,Lx.LOW_STREAM)})),s._hints.push(Px.LOW_STREAM),e.on("sei-to-send",(e=>{s.emit("sei-to-send",e)})),e.addListener(Dx.NEED_CLOSE,(()=>{s.close()})),s}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof XG){var i,o,s,a;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:l,peerConnectionState:d}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();oI.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:u,dtlsstate:l,connectionstate:d,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:null!==(i=null==h?void 0:h.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(o=h.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(s=p.protocol)&&void 0!==s?s:"",selectedRemoteCandidateType:null!==(a=p.candidateType)&&void 0!==a?a:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(lf(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,s=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));oI.firstRemoteVideoDecode(this.store.sessionId,tI.FIRST_VIDEO_DECODE,nI.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:nV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.connection.getRemoteSSRC(i);return void 0!==o&&o!==n}resetConnection(e){QR.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===aA.Connected?(QR.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===JC.datachannel?new pq({},this.store):this.isPlanB?new CG({},this.store):new XG({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===sA.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Lx.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof XG&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===oA.TCP_RESTART&&e===iA.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,oA.DISCONNECTED_OR_FAILED)))}},rC(mq.prototype,"startP2PConnection",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"startP2PConnection"),mq.prototype),rC(mq.prototype,"connect",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"connect"),mq.prototype),rC(mq.prototype,"updateRemoteRTPCapabilities",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"updateRemoteRTPCapabilities"),mq.prototype),rC(mq.prototype,"preConnect",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"preConnect"),mq.prototype),rC(mq.prototype,"publishDataChannel",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"publishDataChannel"),mq.prototype),rC(mq.prototype,"unpublish",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"unpublish"),mq.prototype),rC(mq.prototype,"unpublishDataChannel",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"unpublishDataChannel"),mq.prototype),rC(mq.prototype,"unpublishLowStream",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"unpublishLowStream"),mq.prototype),rC(mq.prototype,"subscribeDataChannel",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"subscribeDataChannel"),mq.prototype),rC(mq.prototype,"subscribe",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"subscribe"),mq.prototype),rC(mq.prototype,"massSubscribe",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"massSubscribe"),mq.prototype),rC(mq.prototype,"unsubscribe",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"unsubscribe"),mq.prototype),rC(mq.prototype,"unsubscribeDataChannel",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"unsubscribeDataChannel"),mq.prototype),rC(mq.prototype,"massUnsubscribe",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"massUnsubscribe"),mq.prototype),rC(mq.prototype,"muteRemote",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"muteRemote"),mq.prototype),rC(mq.prototype,"unmuteRemote",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"unmuteRemote"),mq.prototype),rC(mq.prototype,"hasRemoteMediaWithLock",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"hasRemoteMediaWithLock"),mq.prototype),rC(mq.prototype,"disconnectForReconnect",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"disconnectForReconnect"),mq.prototype),rC(mq.prototype,"updateBitrateLimit",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"updateBitrateLimit"),mq.prototype),rC(mq.prototype,"remoteMediaSsrcChanged",[bq],Object.getOwnPropertyDescriptor(mq.prototype,"remoteMediaSsrcChanged"),mq.prototype),mq);function bq(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function Tq(e){let t=Pq();return function(e,t){let n=e.appId;void 0!==n&&(zq(t,10),Vq(t,n));let r=e.cid;void 0!==r&&(zq(t,16),zq(t,r));let i=e.cname;void 0!==i&&(zq(t,26),Vq(t,i));let o=e.deviceId;void 0!==o&&(zq(t,34),Vq(t,o));let s=e.elapse;void 0!==s&&(zq(t,40),Yq(t,s));let a=e.fileSize;void 0!==a&&(zq(t,48),Yq(t,kq(a)));let c=e.height;void 0!==c&&(zq(t,56),Yq(t,kq(c)));let u=e.jpg;void 0!==u&&(zq(t,66),zq(t,u.length),function(e,t){let n=Uq(e,t.length);e.bytes.set(t,n)}(t,u));let l=e.networkType;void 0!==l&&(zq(t,72),Yq(t,kq(l)));let d=e.osType;void 0!==d&&(zq(t,80),Yq(t,kq(d)));let h=e.requestId;void 0!==h&&(zq(t,90),Vq(t,h));let p=e.sdkVersion;void 0!==p&&(zq(t,98),Vq(t,p));let f=e.sequence;void 0!==f&&(zq(t,104),Yq(t,kq(f)));let m=e.sid;void 0!==m&&(zq(t,114),Vq(t,m));let g=e.timestamp;void 0!==g&&(zq(t,120),Yq(t,g));let _=e.uid;void 0!==_&&(zq(t,128),zq(t,_));let E=e.vid;void 0!==E&&(zq(t,136),zq(t,E));let v=e.width;void 0!==v&&(zq(t,144),Yq(t,kq(v)));let y=e.service;void 0!==y&&(zq(t,152),zq(t,y));let b=e.callbackData;void 0!==b&&(zq(t,162),Vq(t,b));let T=e.jpgEncryption;void 0!==T&&(zq(t,168),zq(t,T));let S=e.requestType;void 0!==S&&(zq(t,176),zq(t,S));let w=e.scorePorn;void 0!==w&&(zq(t,185),Hq(t,w));let R=e.scoreSexy;void 0!==R&&(zq(t,193),Hq(t,R));let I=e.scoreNeutral;void 0!==I&&(zq(t,201),Hq(t,I));let C=e.scene;void 0!==C&&(zq(t,208),zq(t,C));let A=e.ossFilePrefix;void 0!==A&&(zq(t,218),Vq(t,A));let O=e.serviceVendor;if(void 0!==O)for(let N of O){zq(t,226);let e=Pq();Rq(N,e),zq(t,e.limit),Bq(t,e),Lq(e)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function Sq(e){return function(e){let t={};e:for(;!xq(e);){let n=Kq(e);switch(n>>>3){case 0:break e;case 1:t.code=Kq(e);break;case 2:t.msg=jq(e,Kq(e));break;case 3:{let n=Iq(e);t.data=wq(e),e.limit=n;break}default:Cq(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function wq(e){let t={};e:for(;!xq(e);){let n=Kq(e);switch(n>>>3){case 0:break e;case 1:t.requestId=jq(e,Kq(e));break;case 2:t.requestType=Kq(e)>>>0;break;case 3:t.scorePorn=Wq(e);break;case 4:t.scoreSexy=Wq(e);break;case 5:t.scoreNeutral=Wq(e);break;case 6:t.requestScene=Kq(e)>>>0;break;case 7:t.scene=Kq(e)>>>0;break;default:Cq(e,7&n)}}return t}function Rq(e,t){let n=e.service;void 0!==n&&(zq(t,8),zq(t,n));let r=e.vendor;void 0!==r&&(zq(t,16),zq(t,r));let i=e.token;void 0!==i&&(zq(t,26),Vq(t,i));let o=e.callbackUrl;void 0!==o&&(zq(t,34),Vq(t,o))}function Iq(e){let t=Kq(e),n=e.limit;return e.limit=e.offset+t,n}function Cq(e,t){switch(t){case 0:for(;128&Gq(e););break;case 2:Mq(e,Kq(e));break;case 5:Mq(e,4);break;case 1:Mq(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Aq=new Float32Array(1);new Uint8Array(Aq.buffer);let Oq=new Float64Array(1),Nq=new Uint8Array(Oq.buffer);function kq(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Dq=[];function Pq(){const e=Dq.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Lq(e){Dq.push(e)}function Mq(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function xq(e){return e.offset>=e.limit}function Uq(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function Fq(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function jq(e,t){let n=Fq(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",s="";for(let a=0;a<t;a++){let e,c,u,l,d=i[a+n];0==(128&d)?s+=r(d):192==(224&d)?a+1>=t?s+=o:(e=i[a+n+1],128!=(192&e)?s+=o:(l=(31&d)<<6|63&e,l<128?s+=o:(s+=r(l),a++))):224==(240&d)?a+2>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],32896!=(49344&(e|c<<8))?s+=o:(l=(15&d)<<12|(63&e)<<6|63&c,l<2048||l>=55296&&l<=57343?s+=o:(s+=r(l),a+=2))):240==(248&d)?a+3>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],u=i[a+n+3],8421504!=(12632256&(e|c<<8|u<<16))?s+=o:(l=(7&d)<<18|(63&e)<<12|(63&c)<<6|63&u,l<65536||l>1114111?s+=o:(l-=65536,s+=r(55296+(l>>10),56320+(1023&l)),a+=3))):s+=o}return s}function Vq(e,t){let n=t.length,r=0;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}zq(e,r);let i=Uq(e,r),o=e.bytes;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function Bq(e,t){let n=Uq(e,t.limit),r=e.bytes,i=t.bytes;for(let o=0,s=t.limit;o<s;o++)r[o+n]=i[o]}function Gq(e){return e.bytes[Fq(e,1)]}function qq(e,t){let n=Uq(e,1);e.bytes[n]=t}function Wq(e){let t=Fq(e,8),n=e.bytes;return Nq[0]=n[t++],Nq[1]=n[t++],Nq[2]=n[t++],Nq[3]=n[t++],Nq[4]=n[t++],Nq[5]=n[t++],Nq[6]=n[t++],Nq[7]=n[t++],Oq[0]}function Hq(e,t){let n=Uq(e,8),r=e.bytes;Oq[0]=t,r[n++]=Nq[0],r[n++]=Nq[1],r[n++]=Nq[2],r[n++]=Nq[3],r[n++]=Nq[4],r[n++]=Nq[5],r[n++]=Nq[6],r[n++]=Nq[7]}function Kq(e){let t,n=0,r=0;do{t=Gq(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function zq(e,t){for(t>>>=0;t>=128;)qq(e,127&t|128),t>>>=7;qq(e,t)}function Yq(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=Uq(e,o),a=e.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=9!==o?128|i:127&i;case 8:a[s+7]=8!==o?r>>>21|128:r>>>21&127;case 7:a[s+6]=7!==o?r>>>14|128:r>>>14&127;case 6:a[s+5]=6!==o?r>>>7|128:r>>>7&127;case 5:a[s+4]=5!==o?128|r:127&r;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}function Jq(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const Xq=new Map([["moderation",1],["supervise",2]]);class Qq extends vw{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(dA.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Xr(t=e.map((e=>Xq.get(e)||0))).call(t,((e,t)=>e+t)),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(e){super(),ry(this,"name","AgoraRTCVideoContentInspect"),ry(this,"_connectionState",uA.CONNECTING),ry(this,"_innerConnectionState",void 0),ry(this,"sequence",0),ry(this,"inspectStartTime",void 0),ry(this,"workerManagerConnection",void 0),ry(this,"workerConnection",void 0),ry(this,"workerMessageLengthLimit",void 0),ry(this,"inspectIntervalMinimum",void 0),ry(this,"qualityRatio",void 0),ry(this,"_connectInfo",void 0),ry(this,"_cancelTokenSource",pS.CancelToken.source()),ry(this,"_retryConfig",void 0),ry(this,"wmSequence",0),ry(this,"inspectInterval",void 0),ry(this,"inspectTimer",null),ry(this,"ossFilePrefix",void 0),ry(this,"extraInfo",void 0),ry(this,"_inspectType",void 0),ry(this,"_inspectMode",void 0),ry(this,"_quality",1),ry(this,"qualityTimer",null),ry(this,"_inspectId",void 0),ry(this,"_needWorkUrlOnly",!1),ry(this,"inspectImage",(()=>{if(this.connectionState!==uA.CONNECTED)throw new CC(tw.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===uA.CONNECTED?this.requestToInspectImage():QR.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=eR(5,"inspect-"),this.workerMessageLengthLimit=kR("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=kR("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=kR("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new jA("worker-manager-"+this._inspectId,fR),this.on(dA.STATE_CHANGE,((e,t)=>{this._innerConnectionState=e,QR.debug("[".concat(this._inspectId,"] Inspect operation :").concat(lA[e]," ").concat(t||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new jA("worker-"+this._inspectId,fR),this.handleWorkerEvents()}async init(e,t){this.emit(dA.STATE_CHANGE,lA.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new Gh(((r,i)=>{this.on(dA.CONNECTION_STATE_CHANGE,((e,t)=>{t===uA.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorkerManager(e)})).catch((e=>{i(e)}))}))}async requestAP(e,t,n){const r=kR("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:s,sid:a,token:c,uid:u}=t;MO++;const l="image_moderation_api",d={service_name:l,json_body:JSON.stringify({appId:i,areaCode:o,cname:s,command:"allocateEdge",requestId:MO,seq:MO,sid:a,token:c,ts:Date.now(),uid:u+""})};let h,p,f=e[0];return gR((async()=>{h=Date.now();const e=await pO(f,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new CC(tw.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw QR.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new CC(tw.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw QR.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new CC(tw.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw QR.error(e.toString()),e}const r=kR("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=kR("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,responseTime:p}}),((t,n)=>(oI.apworkerEvent(a,{success:!0,sc:200,serviceName:l,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1)),((t,n)=>(oI.apworkerEvent(a,{success:!1,sc:t.data&&t.data.code||200,serviceName:l,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==tw.OPERATION_ABORTED&&t.code!==tw.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(dA.STATE_CHANGE,lA.AP_CONNECTED);const{addressList:o}=i;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(dA.STATE_CHANGE,lA.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(IC.CONNECTED,(async()=>{this.emit(dA.STATE_CHANGE,lA.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.21.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(IC.CLOSED,(()=>{this._innerConnectionState<lA.GET_WORKER_MANAGER_RESPONSE&&QR.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(IC.FAILED,(()=>{this._innerConnectionState<lA.GET_WORKER_MANAGER_RESPONSE&&QR.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(IC.RECONNECTING,(()=>{this._innerConnectionState<lA.GET_WORKER_MANAGER_RESPONSE&&QR.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(IC.ON_MESSAGE,(async e=>{this.emit(dA.STATE_CHANGE,lA.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw QR.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new CC(tw.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw QR.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new CC(tw.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=kR("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(dA.STATE_CHANGE,lA.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(dA.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}})),this.workerManagerConnection.on(IC.WILL_RECONNECT,((e,t,n)=>{n(e)})),this.workerManagerConnection.on(IC.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}handleWorkerEvents(){this.workerConnection.on(IC.CONNECTED,(async()=>{this.emit(dA.STATE_CHANGE,lA.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=uA.CONNECTED})),this.workerConnection.on(IC.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const n=Sq(new Uint8Array(e.data));if(kR("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&QR.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(dA.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=Xr(t=Object.keys(e)).call(t,((t,n)=>e[t]>e[n]?t:n),"porn"),i=Object.keys(e).find((e=>e===r));this.emit(dA.INSPECT_RESULT,i)}else this.emit(dA.INSPECT_RESULT,void 0,new CC(tw.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(dA.INSPECT_RESULT,void 0,new CC(tw.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else QR.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(dA.INSPECT_RESULT,void 0,new CC(tw.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(IC.CLOSED,(()=>{this.connectionState=uA.CLOSED})),this.workerConnection.on(IC.FAILED,(()=>{this.connectionState=uA.CLOSED})),this.workerConnection.on(IC.RECONNECTING,(()=>{this.connectionState=this.connectionState===uA.CONNECTED?uA.RECONNECTING:uA.CONNECTING})),this.workerConnection.on(IC.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this.workerConnection.on(IC.REQUEST_NEW_URLS,((e,t)=>{this.workerManagerConnection.close(),this.once(dA.REQUEST_NEW_WORKER_URL,(t=>{e([t])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((e=>{this.connectWorkerManager(e,!0)})).catch((e=>{t(e)}))}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){this.sequence++;const e=xw(this,dA.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(dA.INSPECT_RESULT,void 0,new CC(tw.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(dA.INSPECT_RESULT,void 0,new CC(tw.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a}=t;const c=Date.now(),u=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await WU(u,n,r),d=this.sequence+"-"+i+"-"+a+"-"+c+"-"+eR(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:Qq.intToLong(Number(c-this.inspectStartTime)),fileSize:l.byteLength,jpgEncryption:2,height:u.height,width:u.width,jpg:l,networkType:6,osType:7,requestId:d,sdkVersion:"4.21.0",sequence:this.sequence,sid:s,timestamp:Qq.intToLong(c),uid:a,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const p=Tq(h);if(p.byteLength<this.workerMessageLengthLimit){if(kR("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jq(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jq(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,QR.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return p}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=pS.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=uA.CLOSED,this.emit(dA.STATE_CHANGE,lA.CLOSED)}}function Zq(e){let t=function(){const e=nW.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(pW(t,10),uW(t,n));let r=e.cid;void 0!==r&&(pW(t,16),pW(t,r));let i=e.cname;void 0!==i&&(pW(t,26),uW(t,i));let o=e.deviceId;void 0!==o&&(pW(t,34),uW(t,o));let s=e.elapse;void 0!==s&&(pW(t,40),mW(t,s));let a=e.fileSize;void 0!==a&&(pW(t,48),mW(t,tW(a)));let c=e.height;void 0!==c&&(pW(t,56),mW(t,tW(c)));let u=e.jpg;void 0!==u&&(pW(t,66),pW(t,u.length),aW(t,u));let l=e.networkType;void 0!==l&&(pW(t,72),mW(t,tW(l)));let d=e.osType;void 0!==d&&(pW(t,80),mW(t,tW(d)));let h=e.requestId;void 0!==h&&(pW(t,90),uW(t,h));let p=e.sdkVersion;void 0!==p&&(pW(t,98),uW(t,p));let f=e.sequence;void 0!==f&&(pW(t,104),mW(t,tW(f)));let m=e.sid;void 0!==m&&(pW(t,114),uW(t,m));let g=e.timestamp;void 0!==g&&(pW(t,120),mW(t,g));let _=e.uid;void 0!==_&&(pW(t,128),pW(t,_));let E=e.vid;void 0!==E&&(pW(t,136),pW(t,E));let v=e.width;void 0!==v&&(pW(t,144),mW(t,tW(v)));let y=e.service;void 0!==y&&(pW(t,152),pW(t,y));let b=e.callbackData;void 0!==b&&(pW(t,162),pW(t,b.length),aW(t,b));let T=e.ticket;void 0!==T&&(pW(t,170),uW(t,T));let S=e.vendorConfigs;void 0!==S&&(pW(t,178),uW(t,S))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function $q(e){return function(e){let t={};e:for(;!iW(e);){let n=hW(e);switch(n>>>3){case 0:break e;case 1:t.code=hW(e);break;case 2:t.msg=cW(e,hW(e));break;case 3:t.requestId=cW(e,hW(e));break;case 4:t.timestamp=fW(e,!1);break;default:eW(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function eW(e,t){switch(t){case 0:for(;128&lW(e););break;case 2:rW(e,hW(e));break;case 5:rW(e,4);break;case 1:rW(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function tW(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let nW=[];function rW(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function iW(e){return e.offset>=e.limit}function oW(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function sW(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function aW(e,t){let n=oW(e,t.length);e.bytes.set(t,n)}function cW(e,t){let n=sW(e,t),r=String.fromCharCode,i=e.bytes,o="\ufffd",s="";for(let a=0;a<t;a++){let e,c,u,l,d=i[a+n];0==(128&d)?s+=r(d):192==(224&d)?a+1>=t?s+=o:(e=i[a+n+1],128!=(192&e)?s+=o:(l=(31&d)<<6|63&e,l<128?s+=o:(s+=r(l),a++))):224==(240&d)?a+2>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],32896!=(49344&(e|c<<8))?s+=o:(l=(15&d)<<12|(63&e)<<6|63&c,l<2048||l>=55296&&l<=57343?s+=o:(s+=r(l),a+=2))):240==(248&d)?a+3>=t?s+=o:(e=i[a+n+1],c=i[a+n+2],u=i[a+n+3],8421504!=(12632256&(e|c<<8|u<<16))?s+=o:(l=(7&d)<<18|(63&e)<<12|(63&c)<<6|63&u,l<65536||l>1114111?s+=o:(l-=65536,s+=r(55296+(l>>10),56320+(1023&l)),a+=3))):s+=o}return s}function uW(e,t){let n=t.length,r=0;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),r+=e<128?1:e<2048?2:e<65536?3:4}pW(e,r);let i=oW(e,r),o=e.bytes;for(let s=0;s<n;s++){let e=t.charCodeAt(s);e>=55296&&e<=56319&&s+1<n&&(e=(e<<10)+t.charCodeAt(++s)-56613888),e<128?o[i++]=e:(e<2048?o[i++]=e>>6&31|192:(e<65536?o[i++]=e>>12&15|224:(o[i++]=e>>18&7|240,o[i++]=e>>12&63|128),o[i++]=e>>6&63|128),o[i++]=63&e|128)}}function lW(e){return e.bytes[sW(e,1)]}function dW(e,t){let n=oW(e,1);e.bytes[n]=t}function hW(e){let t,n=0,r=0;do{t=lW(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function pW(e,t){for(t>>>=0;t>=128;)dW(e,127&t|128),t>>>=7;dW(e,t)}function fW(e,t){let n,r=0,i=0,o=0;return n=lW(e),r=127&n,128&n&&(n=lW(e),r|=(127&n)<<7,128&n&&(n=lW(e),r|=(127&n)<<14,128&n&&(n=lW(e),r|=(127&n)<<21,128&n&&(n=lW(e),i=127&n,128&n&&(n=lW(e),i|=(127&n)<<7,128&n&&(n=lW(e),i|=(127&n)<<14,128&n&&(n=lW(e),i|=(127&n)<<21,128&n&&(n=lW(e),o=127&n,128&n&&(n=lW(e),o|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|o<<24,unsigned:t}}function mW(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=oW(e,o),a=e.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=9!==o?128|i:127&i;case 8:a[s+7]=8!==o?r>>>21|128:r>>>21&127;case 7:a[s+6]=7!==o?r>>>14|128:r>>>14&127;case 6:a[s+5]=6!==o?r>>>7|128:r>>>7&127;case 5:a[s+4]=5!==o?128|r:127&r;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}const gW={},_W={},EW=4294967296,vW=EW*EW,yW=vW/2,bW=IW(0,!0),TW=IW(0),SW=CW(0,-2147483648,!1),wW=CW(-1,2147483647,!1),RW=CW(-1,-1,!0);function IW(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=_W[e],r)?r:(n=CW(e,0,!0),i&&(_W[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=gW[e],r)?r:(n=CW(e,e<0?-1:0,!1),i&&(gW[e]=n),n)}function CW(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function AW(e,t){if(isNaN(e))return t?bW:TW;if(t){if(e<0)return bW;if(e>=vW)return RW}else{if(e<=-yW)return SW;if(e+1>=yW)return wW}return e<0?t?bW:TW:CW(e%EW|0,e/EW|0,t)}function OW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class NW extends vw{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(gA.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(e){var t;super(),ry(this,"name","AgoraRTCImageModeration"),ry(this,"_connectionState",mA.CONNECTING),ry(this,"_sequence",0),ry(this,"_moderationStartTime",void 0),ry(this,"_workerConnection",void 0),ry(this,"_workerMessageLengthLimit",void 0),ry(this,"_qualityRatio",void 0),ry(this,"_connectInfo",void 0),ry(this,"_cancelTokenSource",pS.CancelToken.source()),ry(this,"_retryConfig",void 0),ry(this,"_moderationInterval",void 0),ry(this,"_moderationTimer",null),ry(this,"_moderationMode",1),ry(this,"_quality",1),ry(this,"_qualityTimer",null),ry(this,"_ticket",void 0),ry(this,"_moderationIntervalMinimum",void 0),ry(this,"_uploadFailedNum",0),ry(this,"_uploadNum",0),ry(this,"_uploadTimer",null),ry(this,"_extraInfo",void 0),ry(this,"_vendor",""),ry(this,"_encoder",new TextEncoder),ry(this,"_moderationId",void 0),ry(this,"inspectImage",(()=>{if(this.connectionState!==mA.CONNECTED)throw new CC(tw.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===mA.CONNECTED?this.requestToInspectImage():QR.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=eR(5,"image-moderation-"),this._workerMessageLengthLimit=kR("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=kR("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=kR("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new jA("worker-"+this._moderationId,fR),this.on(gA.STATE_CHANGE,((e,t)=>{QR.debug("[".concat(this._moderationId,"] Moderation operation :").concat(_A[e]," ").concat(t||""))})),this.handleWorkerEvents()}async init(e,t){this.emit(gA.STATE_CHANGE,_A.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new Gh(((r,i)=>{this.on(gA.CONNECTION_STATE_CHANGE,((e,t)=>{e===mA.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorker(e)})).catch((e=>{i(e)}))}))}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),QR.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===mA.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const r=kR("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:s,sid:a,token:c,uid:u}=t;MO++;const l="moderation_plugin",d={service_name:l,json_body:JSON.stringify({appId:i,areaCode:o,cname:s,command:"allocateEdge",requestId:MO,seq:MO,sid:a,appToken:c,ts:Date.now(),uid:u+""})};let h,p,f=e[0];return gR((async()=>{h=Date.now();const e=await pO(f,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new CC(tw.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw QR.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new CC(tw.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw QR.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new CC(tw.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw QR.error(e.toString()),e}if(!t.servers.some((e=>!!e.wss))){const e=new CC(tw.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw QR.error(e.toString()),e}const r=kR("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}}),((t,n)=>(oI.apworkerEvent(a,{success:!0,sc:200,serviceName:l,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1)),((t,n)=>(oI.apworkerEvent(a,{success:!1,sc:t.data&&t.data.code||200,serviceName:l,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==tw.OPERATION_ABORTED&&t.code!==tw.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(gA.STATE_CHANGE,_A.AP_CONNECTED);const{addressList:o,ticket:s}=i;return this._ticket=s,o}async connectWorker(e){this.emit(gA.STATE_CHANGE,_A.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(IC.CONNECTED,(async()=>{this.emit(gA.STATE_CHANGE,_A.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=mA.CONNECTED})),this._workerConnection.on(IC.CLOSED,(()=>{this.connectionState=mA.CLOSED})),this._workerConnection.on(IC.FAILED,(()=>{this.connectionState=mA.CLOSED})),this._workerConnection.on(IC.RECONNECTING,(()=>{this.connectionState=this.connectionState===mA.CONNECTED?mA.RECONNECTING:mA.CONNECTING})),this._workerConnection.on(IC.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const t=$q(new Uint8Array(e.data));kR("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&QR.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,QR.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{oI.reportApiInvoke(this._connectInfo.sid||null,{name:Tw.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:Sw.TRACER}).onError(new CC(tw.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null}),kR("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else QR.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(IC.WILL_RECONNECT,((e,t,n)=>{"recover"===e&&n(e),n("tryNext")})),this._workerConnection.on(IC.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=xw(this,gA.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(kR("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&QR.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else kR("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&QR.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a}=t;const c=Date.now(),u=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await WU(u,n,r),d=this._sequence+"-"+i+"-"+a+"-"+c+"-"+eR(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:NW.intToLong(Number(c-this._moderationStartTime)),fileSize:u.buffer.byteLength,height:u.height,width:u.width,jpg:l,networkType:6,osType:7,requestId:d,sdkVersion:"4.21.0",sequence:this._sequence,sid:s,timestamp:AW(c),uid:a,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete h.callbackData;const p=Zq(h);if(p.byteLength<this._workerMessageLengthLimit){if(kR("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OW(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,QR.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return p}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=pS.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=mA.CLOSED,this.emit(gA.STATE_CHANGE,_A.CLOSED)}}function kW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function DW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kW(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const PW=Date.now(),LW=20,MW=new Map,xW=new Map;async function UW(e){const t=MW.get(e),n=Array.isArray(t)&&t[t.length-1],r=xW.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};0===r.firstRecvTs&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const o=n.sendTs-r.firstSendTs,s=o-(Date.now()-r.firstRecvTs);s>0&&(r.firstRecvTs=Date.now()-o);let a=n.mediaDelay+s;a<=0?(t.pop(),FW(n.context,i),a=0):a=Math.min(a,LW),setTimeout((()=>t.length&&UW(e)),a)}function FW(e,t){e.safeEmit(Nw.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function jW(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return FW(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=MW.get(r)||[],o=i.findIndex((t=>e.sendTs>=t.sendTs)),s=DW(DW({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===o?i.push(s):i.splice(o,0,s),MW.set(r,i);let a=!1;var c;xW.has(r)?a=!(null===(c=xW.get(r))||void 0===c||!c.isSyncing):xW.set(r,{isSyncing:a,firstRecvTs:0,firstSendTs:0}),a||UW(r)}const VW=wS().name;function BW(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GW(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?BW(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BW(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const qW="websdk_ng_cache_parameter",WW=kR("MAX_PRELOAD_ASYNC_LENGTH"),HW=1e4,KW=new Map,zW=[];let YW=null,JW=0,XW=0;const QW=new Map,ZW=function(e,t){const n=[];let r=0;const i=async()=>{const e=n.shift();e&&await e(),n.length>0&&r<t?i():r--};return async function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return new Gh((async(o,a)=>{n.push((async()=>{try{const t=await e(...s);o(t)}catch(e){a(e)}})),r<t&&(r++,i())}))}}(eH,WW),$W=pS.CancelToken.source();async function eH(e,t,n,r,i){try{if(!kR("ENABLE_PRELOAD"))return;if(!fx().supportWebCrypto)return void Hw((()=>{QR.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!n&&null!==n)throw new nw(tw.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&aw(n,"token",1,2047),aw(e,"appid",1,2047),AC(t),r&&OC(r);const o=tR();QR.debug("preload channel ".concat(t,", uid is ").concat(r));const s={appId:e,cname:t,token:n||e,uid:"string"!=typeof r?r:null,sid:o,proxyServer:i};let a,c;"string"==typeof r?(s.stringUid=r,[c,a]=await Gh.all([GO(r,{sid:o,appId:e},$W.token),WO(GW(GW({},s),{},{token:n||e,uid:0}),$W.token)]),s.uid=c.uid,a.gatewayInfo.uid=s.uid,a.gatewayInfo.res.uid=s.uid):a=await WO(s,$W.token);const u={sid:o,appId:e,cname:t,token:n||e,uid:s.stringUid||r,intUid:s.uid||a.gatewayInfo.uid,stringUid:s.stringUid,ts:Date.now(),sua:c,ap:a};await async function(e){let t;try{e.uid&&nH({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=cH(e),r=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",Yw(t),"AES-GCM",!1,["encrypt"]),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,Kw(window.btoa(JSON.stringify(e))));return zw(new Uint8Array(r))}catch(e){return}}(e,e.token||e.appId);if(!r)return;t=sH(qW);const i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>kR("AP_CACHE_NUM")&&i.shift(),aH(qW,JSON.stringify(i))}catch(e){QR.warn("Error caching server parameters:",e.message),aH(qW,"")}}(u),JW++}catch(e){throw XW++,function(e){YW||(YW=window.setTimeout((()=>{let t="";QW.forEach(((e,n)=>{t+="".concat(n,": ").concat(e," ;")})),oI.reportApiInvoke(null,{name:Tw.PRELOAD,options:{success:JW,failed:XW,err:t}}).onError(e),JW=0,XW=0,QW.clear(),YW=null}),HW));const t=QW.get(e.code)||0;QW.set(e.code,t+1)}(e),e}}async function tH(e){try{const t=nH(e);if(!t||"disabled"!==e.cloudProxyServer)return;const n=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",Yw(t),"AES-GCM",!1,["decrypt"]),r=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,Kw(e));return JSON.parse(window.atob(zw(new Uint8Array(r))))}catch(e){return}}(t,e.token||e.appId);if(!n)return;if(!function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(n,e))return;if(n&&Date.now()-n.ts<kR("AP_CACHE_LIFETIME"))return n}catch(e){QR.warn("Error get preloadInfo",e.message)}}function nH(e){let t;try{if(t=sH(qW),!t)return;const n=JSON.parse(t),r=cH(e),i=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,(e=>r in e));if(-1===i)return;const o=n.splice(i,1)[0];return aH(qW,JSON.stringify(n)),o[r]}catch(e){QR.warn("Error delete preload info: ".concat(t),e.message),aH(qW,"")}}function rH(e){if(e){let t=KW.get(e);t&&(window.clearTimeout(t),t=null,KW.delete(e)),Dr(zW).call(zW,e)||"disabled"!==e.cloudProxyServer||zW.push(e)}if(KW.size<kR("AP_CACHE_NUM")&&zW.length>0){const e=zW.shift();KW.set(e,window.setTimeout((async()=>{const{appId:t,cname:n,token:r,uid:i,proxyServer:o}=e;try{await ZW(t,n,r,i,o),KW.has(e)&&rH(e)}catch(t){QR.warn("update preload failed",t.message),iH(e)}}),kR("AP_UPDATE_INTERVAL")))}}function iH(e){const t=zW.indexOf(e);-1!==t&&zW.splice(t,1);let n=KW.get(e);n&&(window.clearTimeout(n),n=null,KW.delete(e),rH())}function oH(e,t){const n=e.sua,r=e.ap;t&&n&&oI.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),oI.reportResourceTiming(e.ap.url,e.sid),oI.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map((e=>e.ip)).join(","),eventType:"disabled",unilbsServerIds:[BA.CHOOSE_SERVER,BA.CLOUD_PROXY_FALLBACK].toString()}),oI.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[BA.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function sH(e){return window.atob(window.localStorage.getItem(e)||"")}function aH(e,t){window.localStorage.setItem(e,window.btoa(t))}function cH(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),uR(t)}var uH,lH,dH,hH,pH,fH,mH,gH,_H,EH,vH,yH,bH,TH,SH,wH,RH,IH,CH,AH,OH,NH,kH,DH,PH,LH,MH,xH,UH,FH,jH,VH,BH,GH,qH,WH,HH,KH,zH,YH,JH,XH,QH;function ZH(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ZH(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZH(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}hR.setLogger(QR);let eK=(uH=iI(),lH=iI({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof oU))return[t];t=[t]}return t.map((e=>e?Object(e).toString():"null"))}}),dH=iI({argsMap:(e,t)=>(t||(t=[]),t instanceof Kj?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map((e=>e.getTrackId()))))}),hH=iI({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),pH=iI({argsMap:(e,t,n)=>[t,n]}),fH=iI({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]}))}),mH=iI({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),gH=iI({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}}))}),_H=iI(),EH=iI(),vH=iI(),yH=iI(),bH=iI(),TH=iI(),SH=iI(),wH=iI(),RH=iI(),IH=iI(),CH=iI(),AH=iI(),OH=iI(),NH=iI(),kH=iI({argsMap:(e,t)=>[t]}),DH=iI(),PH=iI(),LH=iI(),MH=iI(),xH=iI(),UH=iI(),FH=iI(),jH=iI(),VH=iI(),BH=iI(),GH=iI({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),qH=iI(),WH=iI(),HH=iI(),KH=iI(),zH=iI(),YH=iI(),JH=iI({reportResult:!0}),XH=iI(),QH=class extends vw{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),ry(this,"store",void 0),ry(this,"_uid",void 0),ry(this,"_channelName",void 0),ry(this,"_uintUid",void 0),ry(this,"_users",[]),ry(this,"_config",void 0),ry(this,"_clientId",void 0),ry(this,"_appId",void 0),ry(this,"_sessionId",null),ry(this,"_key",void 0),ry(this,"_rtmConfig",{}),ry(this,"_joinInfo",void 0),ry(this,"_gateway",void 0),ry(this,"_statsCollector",void 0),ry(this,"_configDistribute",void 0),ry(this,"_leaveMutex",new hR("client-leave")),ry(this,"_publishMutex",new hR("client-publish")),ry(this,"_renewTokenMutex",new hR("client-renewtoken")),ry(this,"_subscribeMutex",new hR("client-subscribe")),ry(this,"_encryptionMode","none"),ry(this,"_encryptionSecret",null),ry(this,"_encryptionSalt",null),ry(this,"_encryptDataStream",!1),ry(this,"_encryptDataStreamKey",null),ry(this,"_encryptDataStreamIv",null),ry(this,"_proxyServer",void 0),ry(this,"_turnServer",{servers:[],mode:"auto"}),ry(this,"_cloudProxyServerMode","disabled"),ry(this,"_isDualStreamEnabled",!1),ry(this,"_defaultStreamFallbackType",void 0),ry(this,"_lowStreamParameter",void 0),ry(this,"_streamFallbackTypeCacheMap",new Map),ry(this,"_remoteStreamTypeCacheMap",new Map),ry(this,"_axiosCancelSource",pS.CancelToken.source()),ry(this,"_audioVolumeIndicationInterval",void 0),ry(this,"_networkQualityInterval",void 0),ry(this,"_userOfflineTimeout",void 0),ry(this,"_streamRemovedTimeout",void 0),ry(this,"_injectStreamingClient",void 0),ry(this,"_liveTranscodeStreamingClient",void 0),ry(this,"_liveRawStreamingClient",void 0),ry(this,"_channelMediaRelayClient",void 0),ry(this,"_networkQualitySensitivity","normal"),ry(this,"_p2pChannel",void 0),ry(this,"_useLocalAccessPoint",!1),ry(this,"_setLocalAPVersion",void 0),ry(this,"_joinAndNotLeaveYet",!1),ry(this,"_numberOfJoinCount",0),ry(this,"_remoteDefaultVideoStreamType",void 0),ry(this,"_inspect",void 0),ry(this,"_moderation",void 0),ry(this,"_license",void 0),ry(this,"_pendingPublishedUsers",[]),ry(this,"ntpAlignErrorCount",0),ry(this,"remoteInboundOffset",0),ry(this,"_handleLocalTrackEnable",((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),ry(this,"_handleLocalTrackDisable",((e,t,n)=>{this.unpublish(e).then(t).catch(n)})),ry(this,"_handleUserOnline",(e=>{if(kR("BLOCK_LOCAL_CLIENT")&&lI(e.uid,this.channelName))return void QR.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&QR.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find((t=>t.uid===e.uid));if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(Nw.USER_JOINED,t));else{const t=new VB(e.uid,e.uint_id||e.uid);this._users.push(t),QR.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(Nw.USER_JOINED,t)}})),ry(this,"_handleUserOffline",(e=>{if(kR("BLOCK_LOCAL_CLIENT")&&lI(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:jw(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),QR.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(Nw.USER_LEAVED,t,e.reason))})),ry(this,"_handleAddAudioOrVideoStream",((e,t,n,r,i,o,s)=>{if(kR("BLOCK_LOCAL_CLIENT")&&lI(t,this.channelName))return;const a=this._users.find((e=>e.uid===t));if(!a)return void QR.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));QR.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(a.uid,e,void 0,void 0,void 0,Date.now());const c="audio"===e?a.hasAudio:a.hasVideo;a._uintid||(a._uintid=i||t),"audio"===e?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,"audio"===e?(a._audio_added_=!0,void 0!==n&&(a._audioSSRC=n),void 0!==r&&(a._cname=r),o&&(a._audioOrtc=o)):(a._video_added_=!0,void 0!==n&&(a._videoSSRC=n),void 0!==r&&(a._cname=r),void 0!==s&&(a._rtxSsrcId=s),o&&(a._videoOrtc=o)),("audio"===e?a.hasAudio:a.hasVideo)&&!c&&(QR.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(e)),this.safeEmit(Nw.USER_PUBLISHED,a,e)),"video"===e?oI.onGatewayStream(this._sessionId,tI.ON_ADD_VIDEO_STREAM,nI.ON_ADD_VIDEO_STREAM,{peer:i||t,ssrc:a._videoSSRC}):oI.onGatewayStream(this._sessionId,tI.ON_ADD_AUDIO_STREAM,nI.ON_ADD_AUDIO_STREAM,{peer:i||t,ssrc:a._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(a,e,n).then((t=>{if(t&&(QR.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(a.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof yq))return this._p2pChannel.unsubscribe(a,e,!0).then((()=>this._subscribe(a,e,!0).catch((e=>{QR.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(a,e)&&(QR.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,e,!0).catch((e=>{QR.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),ry(this,"_handleRemoveStream",(e=>{if(kR("BLOCK_LOCAL_CLIENT")&&lI(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));if(!t)return void QR.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));QR.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{QR.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(Nw.USER_UNPUBLISHED,t,"audio"),QR.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(Nw.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{QR.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(Nw.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{QR.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(Nw.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof yq&&this._p2pChannel.unsubscribe(t).then((e=>{if(e)return this._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),oI.onGatewayStream(this._sessionId,tI.ON_REMOVE_STREAM,nI.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()})),ry(this,"_handleSetStreamLocalEnable",((e,t,n)=>{if(kR("BLOCK_LOCAL_CLIENT")&&lI(t,this.channelName))return;const r=this._users.find((e=>e.uid===t));if(!r)return void QR.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));QR.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;const e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{const e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";QR.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(Nw.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;const e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{const e=r._video_enabled_?"enable-local-video":"disable-local-video";QR.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(Nw.USER_INFO_UPDATED,t,e)}}const o="audio"===e?r.hasAudio:r.hasVideo;return i!==o?!i&&o?(QR.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(Nw.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),QR.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(Nw.USER_UNPUBLISHED,r,e)):void 0})),ry(this,"_handleMuteStream",((e,t,n)=>{if(kR("BLOCK_LOCAL_CLIENT")&&lI(e,this.channelName))return;QR.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const r=this._users.find((t=>t.uid===e));if(!r)return void QR.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;const t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{const t=r._audio_muted_?"mute-audio":"unmute-audio";QR.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(Nw.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;const t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{const t=r._video_muted_?"mute-video":"unmute-video";QR.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(Nw.USER_INFO_UPDATED,e,t)}}const o="audio"===t?r.hasAudio:r.hasVideo;if(i!==o){if(!i&&o)return("audio"===t?r._audioSSRC:r._videoSSRC)?(QR.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(Nw.USER_PUBLISHED,r,t)):void QR.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&!r._video_pre_subscribed&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,this._p2pChannel.muteRemote(r,t),QR.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(Nw.USER_UNPUBLISHED,r,t)}})),ry(this,"_handleP2PLost",(async e=>{QR.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():QR.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)})),ry(this,"_handleTokenWillExpire",(()=>{QR.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Nw.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),ry(this,"_handleBeforeUnload",(e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),QR.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),ry(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(Nw.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Nw.NETWORK_QUALITY,e)})),ry(this,"_handleP2PAddAudioOrVideoStream",((e,t,n,r)=>{const i=this._users.find((e=>e.uid===t));if(!i)return void QR.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));QR.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(i.uid,e,void 0,void 0,void 0,Date.now());const o="audio"===e?i.hasAudio:i.hasVideo;"audio"===e?i._trust_audio_stream_added_state_=!0:i._trust_video_stream_added_state_=!0,"audio"===e?(i._audio_added_=!0,void 0!==n&&(i._audioSSRC=n),void 0!==r&&(i._audioMid=r)):(i._video_added_=!0,void 0!==n&&(i._videoSSRC=n),void 0!==r&&(i._videoMid=r)),("audio"===e?i.hasAudio:i.hasVideo)&&!o&&(QR.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published ").concat(e)),this.safeEmit(Nw.USER_PUBLISHED,i,e)),this._p2pChannel.hasPendingRemoteMedia(i,e)&&(QR.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(i.uid," after reconnect.")),this._subscribe(i,e,!0).catch((e=>{QR.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),this._config=e,this._clientId=eR(5,"client-"),this.store=new LR(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),QR.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(wR," build: ").concat(AR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{Ow(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(e){QR.warning("[".concat(this._clientId,"] ").concat(e.toString()))}this._statsCollector=new uG(this.store),this._statsCollector.onStatsException=(e,t,n)=>{QR.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),this.safeEmit(Nw.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{const i=this._users.find((t=>t.uid===e));i&&oI.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid})},this.store.useDataChannel=fx().supportDataChannel&&kR("SIGNAL_CHANNEL"),this.store.useP2P="p2p"===e.mode,this._gateway=new lO(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||fR,httpRetryConfig:e.httpRetryConfig||fR,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new QO,this.store.useP2P?(this._p2pChannel=new oG(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new yq(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];NR("JOIN_GATEWAY_USE_443PORT_ONLY",o),NR("JOIN_GATEWAY_USE_DUAL_DOMAIN",s);const a=this._gateway.signal.websocket;return a instanceof FA&&(a.use443PortOnly=o,a.tryDoubleDomain=s),async function(e,t,n){gS.get(e)||gS.set(e,[]),_S.get(e)||_S.set(e,t),ES.get(e)||ES.set(e,0);const r=gS.get(e),i=_S.get(e);if(!r||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ES.get(e)===i){const e=mS();r.push(e),await e.promise}ES.set(e,ES.get(e)+1);for(var o=arguments.length,s=new Array(o>3?o-3:0),a=3;a<o;a++)s[a-3]=arguments[a];const c=await n(...s);return ES.set(e,ES.get(e)-1),ES.get(e)===i-1&&r.length>0&&(r[0].resolve(),r.shift()),0===ES.get(e)&&(gS.set(e,[]),_S.set(e,0),ES.set(e,0)),c}("client.join",kR("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const s="HTTPS"===(ER||ER||(ER=(window.location.protocol.split(":")[0]||"").toUpperCase(),ER)),a=SR()?window.isSecureContext:"Browser Not Support";if(!SR()&&!s||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";QR.warning(e)}"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),QR.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),oI.setAppId(e);try{if(!n&&null!==n)throw new CC(tw.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&aw(n,"token",1,2047),aw(e,"appid",1,2047),AC(t),r&&OC(r),i&&aw(i,"optionalInfo",1,2047)}catch(i){throw oI.reportApiInvoke(tR(),{name:Tw.JOIN,options:[e,t,n,r],states:{isHttps:s,isSecureContext:a},tag:Sw.TRACER}).onError(i),i}const c=await tH({appId:e,cname:t,uid:r,stringUid:"string"==typeof r?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode}),u=(null==c?void 0:c.sid)||tR(),l=oI.reportApiInvoke(u,{name:Tw.JOIN,options:[e,t,n,r],states:{isHttps:s,isSecureContext:a},tag:Sw.TRACER});if(QR.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._leaveMutex.isLocked&&(QR.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),QR.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const e=new CC(tw.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw l.onError(e),e}this._sessionId||(this._sessionId=u,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const d=$H($H({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(d.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(d.stringUid=r,this._uintUid?(d.uid=this._uintUid,this._uintUid=void 0):d.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(d.aesmode=this._encryptionMode,d.aespassword=await(async e=>{const t=function(e){const t=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=gw(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new CC(tw.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(d.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const e=new TextEncoder,t=kR("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(d.appId+this._encryptionSecret+this._encryptionSecret):e.encode(d.appId+d.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,o=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:FR,hash:"SHA-256",salt:n},r,i+UR);return new Uint8Array(o).subarray(i/8)}(this._encryptionMode,t,Kw(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:FR,hash:"SHA-256",salt:n},r,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}(this._encryptionMode,t,Kw(this._encryptionSalt))}else a?QR.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):QR.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,QR.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:d.stringUid,preload:d.preload});const h=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&h===this._sessionId&&oI.joinChannelTimeout(this._sessionId,5)}),5e3);try{var p;let r;const i=d.cloudProxyServer;if(Dr(p=["proxy3","proxy4","proxy5"]).call(p,i)){const e=kR("PROXY_SERVER_TYPE3");Array.isArray(e)?d.proxyServer=e[0]:d.proxyServer=e}if(oI.setProxyServer(d.proxyServer),QR.setProxyServer(d.proxyServer),this.store.requestAPStart(),c){if(QR.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(d.stringUid?", ".concat(d.stringUid," => ").concat(c.intUid):""," ")),d.stringUid&&!d.uid&&(d.uid=c.intUid),r={gatewayInfo:c.ap.gatewayInfo},kR("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===d.turnServer.mode)if(0===c.ap.proxyInfo.addresses.length)QR.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const e=(await XA(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map((e=>({turnServerURL:e.address,tcpport:e.tcpport||aI.tcpport,udpport:e.udpport||aI.udpport,username:e.username||aI.username,password:e.password||aI.password,forceturn:!1,security:!0})));d.turnServer={mode:"manual",servers:e}}oH(c,d.stringUid)}else{if(d.stringUid&&!d.uid){let e;[e,r]=await Gh.all([BO(d.stringUid,d,this._axiosCancelSource.token,this._config.httpRetryConfig||fR,this.store),VO(d,this._axiosCancelSource.token,this._config.httpRetryConfig||fR,!0,this.store)]),QR.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(d.stringUid," => ").concat(e)),d.uid=e,r.gatewayInfo.uid=e,r.gatewayInfo.res.uid=e}else r=await VO(d,this._axiosCancelSource.token,this._config.httpRetryConfig||fR,!0,this.store);if(!this._joinAndNotLeaveYet)throw new CC(tw.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(d,this._axiosCancelSource.token),this._configDistribute.on(eA.UPDATE_BITRATE_LIMIT,(e=>{this._p2pChannel.updateBitrateLimit(e)}))}),0),this._key=n||e;const o=r.gatewayInfo,s=d.uid?d.uid:o.uid;this._joinInfo=$H($H({},d),{},{cid:o.cid,uid:s,vid:o.vid,apResponse:o.res,uni_lbs_ip:o.uni_lbs_ip,gatewayAddrs:o.gatewayAddrs}),this.store.intUid=s;const a=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new CC(tw.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l.onSuccess(a),this._appId=e,this._channelName=d.cname,this._uid=a,this.store.uid=a,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(NS()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const u=d.stringUid?"string uid: ".concat(d.stringUid,",uid: ").concat(d.uid):"uid: ".concat(this._uid);return QR.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(u)),setTimeout((()=>{QR.startUpload()}),5e3),this.store.joinEnd(),f=this,Dr(uI).call(uI,f)||uI.push(f),"disabled"===this._cloudProxyServerMode&&fx().supportWebCrypto&&kR("ENABLE_PRELOAD")&&rH(this._joinInfo),a}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===tw.OPERATION_ABORTED?QR.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t):QR.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t),t.code!==tw.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),l.onError(t),t}var f}_joinGateway(){if(!this._joinInfo||!this._key)throw new CC(tw.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!kR("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then((e=>e)).catch((e=>{if(e.code===tw.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Iw.FALLBACK),e;if(e.code===tw.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Iw.FALLBACK),e;throw e})).then((e=>{if(e instanceof CC){if(e.code===tw.INIT_WEBSOCKET_TIMEOUT){if(QR.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new CC(tw.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const e=kR("PROXY_SERVER_TYPE3");if(Array.isArray(e))if(this._joinInfo.apUrl){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),n=t.slice(t.length-2).join(".");e.forEach((e=>{this._joinInfo&&Dr(e).call(e,n)&&(this._joinInfo.proxyServer=e)})),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;const t=kR("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return t&&t[1]&&"443"!==t[1]&&QR.setProxyServer(this._joinInfo.proxyServer),"443"!==kR("STATS_COLLECTOR_PORT").toString()&&oI.setProxyServer(this._joinInfo.proxyServer),oI.reportApiInvoke(this._sessionId,{name:Tw.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Sw.TRACER}).onSuccess(),this.safeEmit(Nw.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),kR("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach((e=>{"forceturn"in e&&(e.forceturn=!0)})),this._gateway.join(this._joinInfo,this._key)}if(QR.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new CC(tw.INVALID_OPERATION);return oI.reportApiInvoke(this._sessionId,{name:Tw.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Sw.TRACER}).onSuccess(),this._joinGateway()}return e})).then((e=>e))}async leave(){QR.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(NS()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=uI.indexOf(e);-1!==t&&uI.splice(t,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return QR.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState),QR.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof oU))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new CC(tw.INVALID_PARAMS,"param list is empty");const n=e;if("audience"===this._gateway.role)throw new CC(tw.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof oU))throw new CC(tw.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new CC(tw.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}QR.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((e=>{const t=this._configDistribute.getBitrateLimit();e instanceof Sj&&t&&e.setBitrateLimit(t.uplink)}));try{await this._publishHighStream(n),QR.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((e=>"".concat(e.getTrackId()," ")))))}catch(e){throw QR.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{r()}}async _publishDataChannel(e){ow(e.id,"id",0,65535,!0),rw(e.ordered,"ordered"),aw(e.metadata,"metadata",0,512),QR.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex((t=>t.id===e.id)))throw new CC(tw.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new CC(tw.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&kR("FORCE_TURN")&&!kR("TURN_ENABLE_TCP")&&!kR("TURN_ENABLE_UDP"))throw new CC(tw.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=new Kj(e);if(await this._p2pChannel.publishDataChannel([t]),!this._p2pChannel.isP2PDisconnected()){if("number"!=typeof t._originDataChannelId)throw QR.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new CC(tw.CREATE_DATACHANNEL_ERROR);try{const n={streamId:e.id,ordered:e.ordered,maxRetransmits:kR("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:t._originDataChannelId};await this._gateway.publishDataChannel(this._uid,n,!0),await t._waitTillOpen()}catch(e){if(e.code!==tw.DISCONNECT_P2P)throw e}}return QR.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw QR.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new CC(tw.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof oU))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);QR.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((e=>"".concat(e.getTrackId()," ")))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof oG){const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(EA.UNPUBLISH,{unpubMsg:e},!0)}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),QR.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((e=>"".concat(e.getTrackId())))))}}catch(e){throw QR.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),QR.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((e=>"".concat(e.id," ")))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),QR.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((e=>"".concat(e.id)))))}catch(e){throw QR.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof VB)){const t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new CC(tw.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(iw(t,"mediaType",["audio","video"]),this._p2pChannel instanceof oG)throw new CC(tw.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===rA.AUDIO,r=t===rA.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:i,ortc:o,rtxSsrcId:s,cname:a,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==i)throw new CC(tw.UNEXPECTED_RESPONSE,"no ssrc id");let u=this._users.find((t=>t.uid===e));u||(u=new VB(e,c||e),u._is_pre_created=!0,this._users.push(u)),a&&(u._cname=a),u._uintid||(u._uintid=c||e),n&&(u._audioSSRC=i,u._audio_pre_subscribed=!0,o&&(u._audioOrtc=o)),r&&(u._videoSSRC=i,u._video_pre_subscribed=!0,o&&(u._videoOrtc=o),null!=s&&(u._rtxSsrcId=s)),QR.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(i)),await this._p2pChannel.subscribe(u,t,i,s,o);const l=n?u._audioTrack:u._videoTrack;if(!l)throw new CC(tw.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(u._trust_audio_stream_added_state_=!0,u._audio_added_=!0),r&&(u._trust_video_stream_added_state_=!0,u._video_added_=!0),l}catch(t){throw QR.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{i()}}async _subscribeDataChannel(e,t){var n;if(ow(t,"channelId",0,65535,!0),!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r)throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new CC(tw.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new CC(tw.INVALID_REMOTE_USER,"user is not published");const i=null===(n=e._dataChannels)||void 0===n?void 0:n.find((e=>e.id===t));if(!i)throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new CC(tw.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();QR.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(e,[i]);if(n&&Dr(n).call(n,i.id))try{var s;if("number"!=typeof i._originDataChannelId)throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new CC(tw.CREATE_DATACHANNEL_ERROR);const t={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(s=i.metadata)&&void 0!==s?s:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await i._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==tw.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),t;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return QR.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{o()}}async _p2pSubscribe(e,t,n){if(iw(t,"mediaType",["audio","video"]),!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r){const t=new CC(tw.INVALID_REMOTE_USER,"user is not in the channel");throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new CC(tw.INVALID_REMOTE_USER,"user is not published");throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const n=new CC(tw.REMOTE_USER_IS_NOT_PUBLISHED);throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const i=await this._subscribeMutex.lock();QR.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const n="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof oG&&await this._p2pChannel.subscribe(e,t,n,r)}catch(e){throw e}QR.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{QR.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new CC(tw.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(t){throw QR.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{i()}}async _subscribe(e,t,n){if(this._p2pChannel instanceof oG)return this._p2pSubscribe(e,t);if(iw(t,"mediaType",["audio","video"]),!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find((t=>t===e));if(!r){const t=new CC(tw.INVALID_REMOTE_USER,"user is not in the channel");throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new CC(tw.INVALID_REMOTE_USER,"user is not published");throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new CC(tw.REMOTE_USER_IS_NOT_PUBLISHED);throw QR.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let i="audio"===t?e._audioSSRC:e._videoSSRC,o="audio"===t?e._audioOrtc:e._videoOrtc,s="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?rA.AUDIO:rA.VIDEO,ssrcId:i};const c=await this._subscribeMutex.lock();QR.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const r="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==r&&r!==i&&(i=r,o="audio"===t?e._audioOrtc:e._videoOrtc,s="video"===t?e._rtxSsrcId:void 0,a={stream_type:"audio"===t?rA.AUDIO:rA.VIDEO,ssrcId:i}),nV.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,s,o);try{await this._gateway.subscribe(e.uid,a,!0)}catch(n){if((null==n?void 0:n.code)!==tw.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}QR.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{QR.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new CC(tw.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(t){throw QR.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{c()}}async massSubscribe(e){if(cw(e,"subscribeList"),!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();QR.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; ")));const i=(e=[...e]).map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}})),o=await this._p2pChannel.globalLock();try{var s;for(let t=e.length-1;t>=0;t--){const r=e[t],{user:o,mediaType:s}=r;if(iw(s,"mediaType",["audio","video"]),!o){const e=new CC(tw.INVALID_PARAMS,"user property does not exist in subscribeList item");throw QR.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}const a=this._users.find((e=>e===o));if(!a){const n=new CC(tw.INVALID_REMOTE_USER,"user is not in the channel");QR.error("[".concat(this._clientId,"] can not massSubscribe ").concat(o.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===s&&(!o.hasAudio||void 0===o._audioSSRC)||"video"===s&&(!o.hasVideo||void 0===o._videoSSRC)){const n=new CC(tw.REMOTE_USER_IS_NOT_PUBLISHED);QR.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(s,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const c=YC.Video|YC.LwoVideo,u=n.get(o);if(u){if("video"===s?u&c:u&YC.Audio){e.splice(t,1),QR.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(o.uid,", mediaType:").concat(s," twice"));continue}n.set(o,u|("video"===s?c:YC.Audio))}else n.set(o,"video"===s?c:YC.Audio)}for(let t=e.length-1;t>=0;t--){const r=e[t],{user:i,mediaType:o}=r,s=YC.Video|YC.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,o)){await this._p2pChannel.unmuteRemoteNoLock(i,o);const r=n.get(i);n.set(i,"video"===o?r^s:r^YC.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map((e=>({userId:e.user.uid,type:e.mediaType}))),t);const r=Xr(s=Array.from(n.entries())).call(s,((e,t)=>{let[n,r]=t;if(0===r)return e;const i={stream_id:n.uid,stream_type:r};return r&YC.Audio&&(i.audio_ssrc=n._audioSSRC),r&YC.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===rA.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===rA.VIDEO?t._rtxSsrcId:void 0}})));const n=new Map;if(r.length>0){const e=await this._gateway.subscribeAll(r,!0);((null==e?void 0:e.users)||[]).forEach((e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:o}=e;(r||i||o)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:o})}))}if(Array.from(n.entries()).length>0){const e=[];Array.from(n.entries()).forEach((t=>{let[n,r]=t;const i=this.remoteUsers.find((e=>e.uid===n));if(i){let t;r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=rA.VIDEO:r.audio_error_code&&(t=rA.AUDIO),e.push({user:i,mediaType:t})}})),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=RA(n);QR.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new CC(tw.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter((e=>!e.error)).map((e=>({userId:e.user.uid,type:e.mediaType}))),void 0,Date.now()),i.forEach((e=>{var n;oI.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===rA.VIDEO,audio:e.mediaType===rA.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===rA.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)})),QR.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{o(),r()}}async unsubscribe(e,t,n){if(!(e instanceof VB)){const t=this.remoteUsers.find((t=>t.uid===e));if(!t)throw new CC(tw.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&iw(t,"mediaType",["audio","video"]),!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const r=this._users.find((t=>t===e));if(!r){const t=new CC(tw.INVALID_REMOTE_USER,"user is not in the channel");throw QR.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}QR.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof oG)await this._p2pChannel.unsubscribe(e,t);else{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&jw(this._users,e),QR.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===tw.DISCONNECT_P2P)return void QR.warning("disconnecting p2p, abort unsubscribe request.");throw QR.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&ow(t,"id",0,65535,!0),!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");const n=this._users.find((t=>t===e));if(!n){const t=new CC(tw.INVALID_REMOTE_USER,"user is not in the channel");throw QR.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let r;if("number"==typeof t){const n=e._dataChannels.find((e=>e.id===t));n&&(r=[n])}else r=e._dataChannels;if(void 0===r){const n=new CC(tw.REMOTE_USER_IS_NOT_PUBLISHED);throw QR.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}QR.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map((e=>e.id))));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,r);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),QR.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===tw.DISCONNECT_P2P)return void QR.warning("disconnecting p2p, abort unsubscribe request.");throw QR.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(cw(e,"unsubscribeList"),!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");QR.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const e=new CC(tw.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw QR.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}iw(i,"mediaType",["video","audio",void 0]);const o=this._users.find((e=>e===r));if(!o){QR.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const s=YC.Video|YC.LwoVideo;if(t.has(r)){const o=t.get(r);let a;switch(i){case"video":a=o&s;break;case"audio":a=o&YC.Audio;break;default:a=o&(YC.Audio|s)}if(a){QR.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,o|YC.Audio):"video"===i&&t.set(r,o|s):t.set(r,o|YC.Audio|s)}else i?"audio"===i?t.set(r,YC.Audio):"video"===i&&t.set(r,s):t.set(r,YC.Audio|s)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),QR.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join()))}catch(e){if(e.code===tw.DISCONNECT_P2P)return void QR.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw QR.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new nw(tw.INVALID_PARAMS);uw(e.width)||sw(e.width,"streamParameter.width"),uw(e.height)||sw(e.height,"streamParameter.height"),uw(e.framerate)||sw(e.framerate,"streamParameter.framerate"),uw(e.bitrate)||ow(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&QR.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),QR.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,sA.LocalVideoLowTrack)}async enableDualStream(){if(!fx().supportDualStream)throw oI.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new CC(tw.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new CC(tw.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw oI.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,oI.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),QR.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(sA.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw oI.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,oI.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),QR.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){iw(e,"role",["audience","host"])}(e),t&&Ow(t),"rtc"===this.mode||"p2p"===this.mode)throw QR.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new CC(tw.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new CC(tw.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new CC(tw.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,QR.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(aw(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new CC(tw.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,oI.setProxyServer(this._proxyServer),QR.setProxyServer(this._proxyServer),QR.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new CC(tw.INVALID_OPERATION,"You have already set the proxy")}if(Cw(e))return this._turnServer={servers:e,mode:"original-manual"},void QR.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((e=>e.urls)).join(","),"."));e.forEach((e=>Aw(e))),this._turnServer={servers:e,mode:"manual"},QR.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"you should set license before join channel");if(aw(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new CC(tw.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,QR.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new CC(tw.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new CC(tw.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new CC(tw.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,QR.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"Stop proxy server after leave channel");oI.setProxyServer(),QR.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",QR.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new CC(tw.INVALID_PARAMS,"accessPoints is required.");cw(e.accessPoints.serverList,"accessPoints.serverList"),aw(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{ow(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new CC(tw.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");kR("CLOSE_AFB_FOR_LOCAL_AP")&&(NR("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),NR("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map((e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e)),s=o.map((e=>"".concat(e,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,NR("WEBCS_DOMAIN",s),NR("WEBCS_DOMAIN_BACKUP_LIST",s),NR("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(cw(e.report.hostname,"report.hostname"),NR("EVENT_REPORT_DOMAIN",e.report.hostname[0]),NR("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(NR("EVENT_REPORT_DOMAIN",o[0]),NR("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let a=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),a=e.report.port),NR("STATS_COLLECTOR_PORT",a),e.report?NR("ENABLE_EVENT_REPORT",!0):NR("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(cw(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let u=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),u=e.log.port),NR("LOG_UPLOAD_SERVER","".concat(c,":").concat(u));let l=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(cw(e.cds.hostname,"cds.hostname"),l=e.cds.hostname):l=o;let d=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),d=e.cds.port),NR("CDS_AP",l.map((e=>"".concat(e,":").concat(d)))),e.cds?NR("ENABLE_CONFIG_DISTRIBUTE",!0):NR("ENABLE_CONFIG_DISTRIBUTE",!1),QR.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(cw(e,"serverList"),aw(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new CC(tw.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,NR("WEBCS_DOMAIN",e),NR("WEBCS_DOMAIN_BACKUP_LIST",e),NR("GATEWAY_DOMAINS",[t]),NR("EVENT_REPORT_DOMAIN",e[0]),NR("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),NR("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),QR.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(iw(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw QR.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else QR.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){iw(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const t=this._users.find((t=>t.uid===e));t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(e){throw QR.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}QR.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){iw(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw QR.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}QR.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){!function(e){iw(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),aw(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Dr(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new CC(tw.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new CC(tw.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(rw(r,"encryptDataStream"),!Dr(i).call(i,e))throw new CC(tw.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||QR.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=zw(n))}async renewToken(e){if(aw(e,"token",1,2047),!this._key||!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(kR("USE_NEW_TOKEN")){QR.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await YO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||fR);QR.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else QR.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});QR.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,QR.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?QR.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Nw.VOLUME_INDICATOR,e)}),kR("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new CC(tw.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new CC(tw.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new CC(tw.LIVE_STREAMING_TASK_CONFLICT);const n=t?NC.TRANSCODE:NC.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(NC.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((t=>t&&t.hasUrl(e)));if(!t.length)throw new CC(tw.INVALID_PARAMS,"can not find live streaming url to stop");await Gh.all(t.map((t=>t&&t.stopLiveStreamingTask(e))))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(NC.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,NC.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(NC.INJECT),n=Array.from(hC(e=t.streamingTasks).call(e)).find((e=>e.mode===NC.INJECT));if(!this._joinInfo||!n)throw new CC(tw.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){_G(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){_G(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(e,t,n){var r;const i=Xr(r=Array.from(n)).call(r,((e,t)=>e+t),0),o={serverTs:0,seq:VR++,length:n.length,checkSum:i},s=new Uint8Array(aR(i,2)),a=new ArrayBuffer(jR),c=new DataView(a);c.setUint32(0,o.serverTs),c.setUint16(4,o.seq),c.setUint16(6,o.length),c.setUint16(8,o.checkSum);const u=16-n.length%16;n=Jw(n,new Uint8Array(u));const l=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:xR,additionalData:s},t,n);return Jw(new Uint8Array(a),new Uint8Array(l))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new CC(tw.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(TC.DATA_STREAM,{payload:zw(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-PW},!n)}sendMetadata(e){if(!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new CC(tw.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(TC.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:zw(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach($R),!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"can not send custom report, not joined");await oI.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){iw(t.spatialLayer,"spatialLayer",[0,1,2,3]),iw(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw QR.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(rw(t,"apRTM"),ow(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,QR.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(QR.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=pS.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&iH(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((e=>e._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new hR("client-publish"),this._subscribeMutex=new hR("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var n;const r=e||tR();e?QR.debug("[".concat(this._clientId,"] new Session ").concat(r)):QR.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r;const o={lts:(new Date).getTime(),mode:this.mode,buildFormat:1,stringUid:(null==t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};t?oI.sessionInit(this._sessionId,$H({cname:t.channel,appid:t.appId,preload:t.preload},o)):this._joinInfo?oI.sessionInit(this._sessionId,$H({cname:this._joinInfo.cname,appid:this._joinInfo.appId,preload:!!this._joinInfo.recoverPreloadCache},o)):this._gateway.joinInfo&&oI.sessionInit(this._sessionId,$H({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},o)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new CC(tw.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&kR("FORCE_TURN")&&!kR("TURN_ENABLE_TCP")&&!kR("TURN_ENABLE_UDP"))throw new CC(tw.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");QR.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof oG){const t=(await n.next()).value;if(t){try{await this._gateway.sendExtensionMessage(EA.PUBLISH,t,!0)}catch(e){throw n.throw(e),e}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(e){if(e.code!==tw.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof Sj&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===tw.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new CC(tw.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new CC(tw.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));QR.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==tw.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===tw.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new CC(tw.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new mG(this._joinInfo,this._config.websocketRetryConfig||fR,this._config.httpRetryConfig||fR),n=e=>{e.onLiveStreamError=(e,t)=>{oI.reportApiInvoke(this._sessionId,{name:Tw.ON_LIVE_STREAM_ERROR,options:[e,t],tag:Sw.TRACER}).onSuccess(),this.safeEmit(Nw.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{oI.reportApiInvoke(this._sessionId,{name:Tw.ON_LIVE_STREAM_WARNING,options:[e,t],tag:Sw.TRACER}).onSuccess(),this.safeEmit(Nw.LIVE_STREAMING_WARNING,e,t)},e.on(FC.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new CC(tw.INVALID_OPERATION,"can not find join info to get worker manager"));KO(e,this._joinInfo,this._axiosCancelSource.token,fR).then(t).catch(n)}))};switch(e){case NC.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case NC.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case NC.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(FC.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new CC(tw.INVALID_OPERATION,"can not find join info to get worker manager"));KO(e,this._joinInfo,this._axiosCancelSource.token,fR).then(t).catch(n)})),this._injectStreamingClient.onInjectStatusChange=(e,t,n)=>{this.safeEmit(Nw.INJECT_STREAM_STATUS,e,t,n)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new CC(tw.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new vG(this._joinInfo,this._clientId,this._config.websocketRetryConfig||fR,this._config.httpRetryConfig||fR,n),this._channelMediaRelayClient.on("state",(e=>{e===qC.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(Nw.CHANNEL_MEDIA_RELAY_STATE,e)})),this._channelMediaRelayClient.on("event",(e=>{this.safeEmit(Nw.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];Array.isArray(n)&&n.length>0&&n.forEach((e=>{const{uid:n,stream_id:r,ordered:o,max_retrans_times:s,metadata:a}=e,c=this._users.find((e=>e._uintid===n));if(c){if(QR.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),Dr(i).call(i,c)||i.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex((t=>t.id===e.stream_id))){const e={id:r,ordered:!!o,maxRetransmits:s,metadata:a},n=new Hj(e);c._dataChannels.push(n),QR.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(Nw.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(QR.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch((e=>{QR.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())})))}else QR.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))})),t&&(this.safeEmit(Nw.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach((e=>{const{uid:t,stream_id:n}=e,r=this._users.find((e=>e._uintid===t));if(!r)return void QR.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const i=r._dataChannels.find((t=>t.id===e.stream_id));i&&(QR.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(r,[i]).then((e=>{if(r._dataChannels=r._dataChannels.filter((e=>e!==i)),e)return this._gateway.unsubscribeDataChannel(e,r.uid)})),QR.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(i.id)),this.safeEmit(Nw.USER_UNPUBLISHED,r,"datachannel",i._config))}))}_handleRemoveDataChannels(e){const t=this._users.find((t=>t.uid===e.uid));if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){QR.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{QR.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((e=>{this.safeEmit(Nw.USER_UNPUBLISHED,t,"datachannel",e._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)})),n()}}else QR.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(KC.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(KC.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===Iw.FALLBACK)return;const i=()=>{this.safeEmit(Nw.CONNECTION_STATE_CHANGE,e,t,n)};if(oI.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:Tw.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Sw.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),QR.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach((e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var o;this._streamFallbackTypeCacheMap.forEach(((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch((e=>{QR.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)}))})),this._remoteStreamTypeCacheMap.forEach(((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch((e=>{QR.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(o=this._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{QR.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((e=>{QR.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((e=>!e._trust_in_room_)).forEach((e=>{QR.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((e=>{e._trust_audio_mute_state_||(QR.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,rA.AUDIO,!1)),e._trust_video_mute_state_||(QR.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,rA.VIDEO,!1)),e._trust_audio_enabled_state_||(QR.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(QR.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(QR.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(QR.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(QR.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))})))}),1e3))}i()})),this._gateway.on(KC.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new CC(tw.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;this._joinInfo.recoverPreloadCache?(t=this._joinInfo.recoverPreloadCache.ap,oH(this._joinInfo.recoverPreloadCache),this._joinInfo.recoverPreloadCache=void 0):t=await jO(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||fR,this.store),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const n=[];t.gatewayInfo.gatewayAddrs.forEach((e=>{let{address:t}=e;const[r,i]=t.split(":");this._joinInfo&&this._joinInfo.proxyServer?n.push({proxy:this._joinInfo.proxyServer,host:r,port:i}):n.push({host:r,port:i})})),e(n)}catch(e){t(e)}})),this._gateway.on(KC.NETWORK_QUALITY,(e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(Nw.NETWORK_QUALITY,e)})),this._gateway.on(KC.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(Nw.STREAM_TYPE_CHANGED,e,t),oI.reportApiInvoke(this._sessionId,{name:Tw.STREAM_TYPE_CHANGE,options:[e,t],tag:Sw.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.on(KC.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(KC.NEED_RENEW_SESSION,(async e=>{if("recover"===e&&this._joinInfo){const e=await tH($H($H({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));this._joinInfo.recoverPreloadCache=e,this._startSession(null==e?void 0:e.sid)}else this._startSession()})),this._gateway.on(KC.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(e){n(e)}})),this._gateway.on(KC.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;const{dtlsParameters:n,iceParameters:r,candidates:i,rtpCapabilities:o,setup:s,cname:a}=eB(e.ortc,t);this._p2pChannel.connect(r,n,i,o,s,a)})),this._gateway.on(KC.REQUEST_DC_CONNECTION_PARAMS,(e=>{e(this._p2pChannel.getEstablishParams())})),this._gateway.on(KC.RESET_SIGNAL,(e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()})),this._gateway.on(KC.DATACHANNEL_FAILBACK,(()=>{this._joinGateway()})),this._gateway.on(KC.DATACHANNEL_PRECONNECT,(async(e,t,n,r)=>{var i,o,s,a,c,u;await this._p2pChannel.startP2PConnection({turnServer:null===(i=this._joinInfo)||void 0===i?void 0:i.turnServer},!0);const l=function(e,t){let n;return t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],QR.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),QR.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],n}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat(null===(o=this._joinInfo)||void 0===o?void 0:o.apResponse.cid,"_").concat(null===(s=this._joinInfo)||void 0===s?void 0:s.apResponse.cert),icePwd:"".concat(null===(a=this._joinInfo)||void 0===a?void 0:a.apResponse.cid,"_").concat(null===(c=this._joinInfo)||void 0===c?void 0:c.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(u=kR("FINGERPRINT"))&&void 0!==u?u:e.fingerprint}]},l,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(r)}))}_handleGatewaySignalEvents(){this._gateway.signal.on(wC.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(wC.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(wC.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc))),this._gateway.signal.on(wC.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(wC.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(wC.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)})),this._gateway.signal.on(wC.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(wC.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(wC.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,rA.AUDIO,!0))),this._gateway.signal.on(wC.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,rA.AUDIO,!1))),this._gateway.signal.on(wC.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,rA.VIDEO,!0))),this._gateway.signal.on(wC.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,rA.VIDEO,!1))),this._gateway.signal.on(wC.RECEIVE_METADATA,(e=>{const t=Kw(e.metadata);this.safeEmit(Nw.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(wC.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let n=Kw(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dr(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<jR)throw new CC(tw.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(jR));const t=await async function(e,t,n){const r=n.subarray(0,jR),i=r.slice(8,jR),o=(i[0]<<8)+i[1],s=(r[6]<<8)+r[7],a=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:xR,additionalData:new Uint8Array(aR(o,2))},t,n.subarray(jR));return new Uint8Array(a).subarray(0,s)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n);n=t}let r=0;if(e.ordered||e.syncWithAudio){const t=this._p2pChannel.getStats(),n=this.remoteUsers.find((t=>t.uid===e.uid)),i=null==t?void 0:t.audioRecv.find((e=>e.ssrc===(null==n?void 0:n._audioSSRC)));r=null==i?void 0:i.jitterBufferMs}null==r&&(r=0),jW($H($H({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(wC.ON_CRYPT_ERROR,(()=>{Hw((()=>{QR.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Nw.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(wC.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(wC.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{QR.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Iw.TOKEN_EXPIRE),this.safeEmit(Nw.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(wC.ON_STREAM_FALLBACK_UPDATE,(e=>{QR.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Nw.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")})),this._gateway.signal.on(wC.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),QR.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(wC.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(wC.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(bC.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case TC.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,r;const i=e.some((e=>{let{stream_type:t}=e;return t===HC.Audio})),o=e.some((e=>{let{stream_type:t}=e;return t!==HC.Audio})),s=e.some((e=>{let{stream_type:t}=e;return t===HC.Screen||t===HC.ScreenLow}));"offer"===t.state&&oI.publish(this._joinInfo.sid,{eventElapse:nV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:tw.TIMEOUT,audio:i,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:s,audioName:i?null===(n=e.find((e=>{let{stream_type:t}=e;return t===HC.Audio})))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:o?null===(r=e.find((e=>{let{stream_type:t}=e;return t!==HC.Audio})))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case TC.SUBSCRIBE:t&&oI.subscribe(this._joinInfo.sid,{succ:!1,ec:tw.TIMEOUT,audio:t.stream_type===rA.AUDIO,video:t.stream_type===rA.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:nV.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}})),this._gateway.signal.on(wC.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(wC.ON_PUBLISHED_USER_LIST,(e=>{if(null==e||!e.users)return;kR("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((e=>!lI(e.string_id||e.stream_id,this.channelName))));const t=[],n=[];for(const r of e.users){let e=this._users.find((e=>e._uintid===r.stream_id));e?e._trust_in_room_=!0:(e=new VB(r.string_id||r.stream_id,r.stream_id),this._users.push(e),0===this.getListeners(Nw.PUBLISHED_USER_LIST).length&&(QR.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Nw.USER_JOINED,e)));const i=YC.Audio&r.stream_type,o=(YC.Video|YC.LwoVideo)&r.stream_type,s=0!=(65280&r.stream_type),a=i&&e.hasAudio,c=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!a&&0===this.getListeners(Nw.PUBLISHED_USER_LIST).length&&(QR.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(Nw.USER_PUBLISHED,e,"audio")),o&&!c&&0===this.getListeners(Nw.PUBLISHED_USER_LIST).length&&(QR.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(Nw.USER_PUBLISHED,e,"video")),(i&&!a||o&&!c||s)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(QR.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((e=>{QR.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())}))),this.getListeners(Nw.PUBLISHED_USER_LIST).length>0?kR("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(QR.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((e=>e.uid)).join(", "))),this.safeEmit(Nw.PUBLISHED_USER_LIST,t)):QR.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((e=>e.uid)).join(", ")))})),this._gateway.signal.on(wC.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof yq&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((e=>e.toLowerCase())).filter((e=>{var t;return Dr(t=Object.keys(MR)).call(t,e)})))}))}_handleP2PEvents(){this._gateway.signal.on(wC.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(EA.PUBLISH,((e,t,n)=>{const{uid:r}=e;e.forEach((e=>{const{kind:i,ssrcs:o,mid:s,isMuted:a}=e;this._handleP2PAddAudioOrVideoStream(i,r,o[0].ssrcId,s);const c=this._users.find((e=>e.uid===r));return c&&this._p2pChannel instanceof oG?this._p2pChannel.mockSubscribe(c,i,o[0].ssrcId,s).then((()=>{t()})).catch(n):t(),this._handleMuteStream(r,i,!!a)}))})),this._gateway.signal.on(EA.CALL,(async(e,t,n)=>{if(this._p2pChannel instanceof oG)try{var r;t(await this._p2pChannel.startP2P({turnServer:null===(r=this._joinInfo)||void 0===r?void 0:r.turnServer},e))}catch(e){n(e)}})),this._gateway.signal.on(bC.P2P_CONNECTION,(async e=>{this._p2pChannel instanceof oG&&await this._p2pChannel.p2pConnect(e)})),this._gateway.signal.on(EA.UNPUBLISH,(async(e,t,n)=>{if(this._p2pChannel instanceof oG){const{unpubMsg:r,uid:i}=e,o=this._users.find((e=>e.uid===i));if(!o)return QR.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach((async e=>{let{stream_type:t}=e;const n=t===HC.Audio?rA.AUDIO:rA.VIDEO;await this._p2pChannel.unsubscribe(o,n),this._handleMuteStream(i,n,!0)})),t()}catch(e){n(e)}}})),this._gateway.signal.on(EA.CONTROL,(async(e,t)=>{const{action:n}=e;switch(n){case yA.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,rA.VIDEO,!0);break;case yA.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,rA.AUDIO,!0);break;case yA.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,rA.VIDEO,!1);break;case yA.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,rA.AUDIO,!1)}})),this._gateway.signal.on(EA.RESTART_ICE,(async(e,t,n)=>{if(this._p2pChannel instanceof oG)try{const{direction:n,iceParameter:r}=e;n!==RC.SEND_ONLY||r?t(await this._p2pChannel.restartICE(n,r)):(this._p2pChannel.handleDisconnect(n),t())}catch(e){n(e)}})),this._gateway.signal.on(EA.CANDIDATE,(e=>{if(this._p2pChannel instanceof oG){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}})),this._p2pChannel.on(cA.RequestP2PRestartICE,(async(e,t,n)=>{try{const{direction:n}=e;t(await this._gateway.sendExtensionMessage(EA.RESTART_ICE,e,n===RC.SEND_ONLY))}catch(e){n(e)}})),this._p2pChannel.on(cA.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(EA.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(cA.RequestP2PMuteLocal,(async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(EA.CONTROL,e,!0),t()}catch(e){n(e)}})),this._p2pChannel.on(cA.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===tw.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(cA.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===tw.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(cA.StateChange,((e,t)=>{t===aA.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(cA.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===tw.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(cA.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===tw.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(cA.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(cA.RequestRePublishDataChannel,((e,t,n)=>{Gh.all(e.map((async e=>{await this._p2pChannel.publishDataChannel([e]);const t={streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,t,!0)}catch(e){if(e.code!==tw.DISCONNECT_P2P)throw e}}))).then(t).catch(n)})),this._p2pChannel.on(cA.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===rA.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}})),this._p2pChannel.on(cA.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(cA.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(cA.MediaReconnectStart,(e=>{this.safeEmit(Nw.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(cA.MediaReconnectEnd,(e=>{this.safeEmit(Nw.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(cA.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(cA.RequestRestartICE,(async e=>{if(this._p2pChannel instanceof oG)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(e){return void t.throw(e)}const{iceParameters:o}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:o})})),this._p2pChannel.on(cA.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(cA.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),{dtlsParameters:s,iceParameters:a,candidates:c,rtpCapabilities:u,setup:l,cname:d}=eB(i,o);await this._p2pChannel.connect(a,s,c,u,l,d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(cA.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(cA.P2PLost,(()=>{this.safeEmit(Nw.P2P_LOST,this.store.uid)})),this._p2pChannel.on(cA.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(cA.ConnectionTypeChange,(e=>{this.safeEmit(Nw.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(cA.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(cA.QueryClientConnectionState,(e=>{e(this.connectionState)}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if("CONNECTED"!==this.connectionState||!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new CC(tw.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new CC(tw.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new CC(tw.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach((e=>{var t;if(!Dr(t=["supervise","moderation"]).call(t,e))throw new CC(tw.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(e," is not a valid inspect type."))})),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new CC(tw.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new Qq(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},fR)}catch(e){throw Array.isArray(e)?e[0]:e}}async disableContentInspect(){if(!this._inspect)throw new CC(tw.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(rw(e,"enabled"),e){if(!t)throw new CC(tw.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(ow(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new CC(tw.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(t&&t.vendor&&t.vendor.length>1024)throw new CC(tw.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if("CONNECTED"!==this.connectionState||!this._joinInfo)throw new CC(tw.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const e=new NW(t);this._moderation=e,this.handleImageModerationEvents(this._moderation),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},fR)}catch(e){throw Array.isArray(e)?e[0]:e}}else{if(!this._moderation)throw new CC(tw.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}setP2PTransport(e){if(function(e){iw(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new CC(tw.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,QR.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}handleImageModerationEvents(e){e.on(gA.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(Nw.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===mA.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new CC(tw.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(gA.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}handleVideoInspectEvents(e){e.on(dA.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit(Nw.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===uA.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(Nw.CONTENT_INSPECT_ERROR,new CC(tw.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(dA.INSPECT_RESULT,((e,t)=>{var n;if((null==t?void 0:t.code)===tw.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return QR.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(Nw.CONTENT_INSPECT_RESULT,e,t)})),e.on(dA.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}getJoinChannelServiceRecords(){return QR.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){rw(e,"enabled"),NR("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},rC(QH.prototype,"leave",[uH],Object.getOwnPropertyDescriptor(QH.prototype,"leave"),QH.prototype),rC(QH.prototype,"publish",[lH],Object.getOwnPropertyDescriptor(QH.prototype,"publish"),QH.prototype),rC(QH.prototype,"unpublish",[dH],Object.getOwnPropertyDescriptor(QH.prototype,"unpublish"),QH.prototype),rC(QH.prototype,"subscribe",[hH],Object.getOwnPropertyDescriptor(QH.prototype,"subscribe"),QH.prototype),rC(QH.prototype,"presubscribe",[pH],Object.getOwnPropertyDescriptor(QH.prototype,"presubscribe"),QH.prototype),rC(QH.prototype,"massSubscribe",[fH],Object.getOwnPropertyDescriptor(QH.prototype,"massSubscribe"),QH.prototype),rC(QH.prototype,"unsubscribe",[mH],Object.getOwnPropertyDescriptor(QH.prototype,"unsubscribe"),QH.prototype),rC(QH.prototype,"massUnsubscribe",[gH],Object.getOwnPropertyDescriptor(QH.prototype,"massUnsubscribe"),QH.prototype),rC(QH.prototype,"setLowStreamParameter",[_H],Object.getOwnPropertyDescriptor(QH.prototype,"setLowStreamParameter"),QH.prototype),rC(QH.prototype,"enableDualStream",[EH],Object.getOwnPropertyDescriptor(QH.prototype,"enableDualStream"),QH.prototype),rC(QH.prototype,"disableDualStream",[vH],Object.getOwnPropertyDescriptor(QH.prototype,"disableDualStream"),QH.prototype),rC(QH.prototype,"setClientRole",[yH],Object.getOwnPropertyDescriptor(QH.prototype,"setClientRole"),QH.prototype),rC(QH.prototype,"setProxyServer",[bH],Object.getOwnPropertyDescriptor(QH.prototype,"setProxyServer"),QH.prototype),rC(QH.prototype,"setTurnServer",[TH],Object.getOwnPropertyDescriptor(QH.prototype,"setTurnServer"),QH.prototype),rC(QH.prototype,"setLicense",[SH],Object.getOwnPropertyDescriptor(QH.prototype,"setLicense"),QH.prototype),rC(QH.prototype,"startProxyServer",[wH],Object.getOwnPropertyDescriptor(QH.prototype,"startProxyServer"),QH.prototype),rC(QH.prototype,"stopProxyServer",[RH],Object.getOwnPropertyDescriptor(QH.prototype,"stopProxyServer"),QH.prototype),rC(QH.prototype,"setLocalAccessPointsV2",[IH],Object.getOwnPropertyDescriptor(QH.prototype,"setLocalAccessPointsV2"),QH.prototype),rC(QH.prototype,"setLocalAccessPoints",[CH],Object.getOwnPropertyDescriptor(QH.prototype,"setLocalAccessPoints"),QH.prototype),rC(QH.prototype,"setRemoteDefaultVideoStreamType",[AH],Object.getOwnPropertyDescriptor(QH.prototype,"setRemoteDefaultVideoStreamType"),QH.prototype),rC(QH.prototype,"setRemoteVideoStreamType",[OH],Object.getOwnPropertyDescriptor(QH.prototype,"setRemoteVideoStreamType"),QH.prototype),rC(QH.prototype,"setStreamFallbackOption",[NH],Object.getOwnPropertyDescriptor(QH.prototype,"setStreamFallbackOption"),QH.prototype),rC(QH.prototype,"setEncryptionConfig",[kH],Object.getOwnPropertyDescriptor(QH.prototype,"setEncryptionConfig"),QH.prototype),rC(QH.prototype,"renewToken",[DH],Object.getOwnPropertyDescriptor(QH.prototype,"renewToken"),QH.prototype),rC(QH.prototype,"enableAudioVolumeIndicator",[PH],Object.getOwnPropertyDescriptor(QH.prototype,"enableAudioVolumeIndicator"),QH.prototype),rC(QH.prototype,"startLiveStreaming",[LH],Object.getOwnPropertyDescriptor(QH.prototype,"startLiveStreaming"),QH.prototype),rC(QH.prototype,"setLiveTranscoding",[MH],Object.getOwnPropertyDescriptor(QH.prototype,"setLiveTranscoding"),QH.prototype),rC(QH.prototype,"stopLiveStreaming",[xH],Object.getOwnPropertyDescriptor(QH.prototype,"stopLiveStreaming"),QH.prototype),rC(QH.prototype,"addInjectStreamUrl",[UH],Object.getOwnPropertyDescriptor(QH.prototype,"addInjectStreamUrl"),QH.prototype),rC(QH.prototype,"removeInjectStreamUrl",[FH],Object.getOwnPropertyDescriptor(QH.prototype,"removeInjectStreamUrl"),QH.prototype),rC(QH.prototype,"startChannelMediaRelay",[jH],Object.getOwnPropertyDescriptor(QH.prototype,"startChannelMediaRelay"),QH.prototype),rC(QH.prototype,"updateChannelMediaRelay",[VH],Object.getOwnPropertyDescriptor(QH.prototype,"updateChannelMediaRelay"),QH.prototype),rC(QH.prototype,"stopChannelMediaRelay",[BH],Object.getOwnPropertyDescriptor(QH.prototype,"stopChannelMediaRelay"),QH.prototype),rC(QH.prototype,"sendCustomReportMessage",[GH],Object.getOwnPropertyDescriptor(QH.prototype,"sendCustomReportMessage"),QH.prototype),rC(QH.prototype,"pickSVCLayer",[qH],Object.getOwnPropertyDescriptor(QH.prototype,"pickSVCLayer"),QH.prototype),rC(QH.prototype,"setRTMConfig",[WH],Object.getOwnPropertyDescriptor(QH.prototype,"setRTMConfig"),QH.prototype),rC(QH.prototype,"enableContentInspect",[HH],Object.getOwnPropertyDescriptor(QH.prototype,"enableContentInspect"),QH.prototype),rC(QH.prototype,"disableContentInspect",[KH],Object.getOwnPropertyDescriptor(QH.prototype,"disableContentInspect"),QH.prototype),rC(QH.prototype,"setImageModeration",[zH],Object.getOwnPropertyDescriptor(QH.prototype,"setImageModeration"),QH.prototype),rC(QH.prototype,"setP2PTransport",[YH],Object.getOwnPropertyDescriptor(QH.prototype,"setP2PTransport"),QH.prototype),rC(QH.prototype,"getJoinChannelServiceRecords",[JH],Object.getOwnPropertyDescriptor(QH.prototype,"getJoinChannelServiceRecords"),QH.prototype),rC(QH.prototype,"setPublishAudioFilterEnabled",[XH],Object.getOwnPropertyDescriptor(QH.prototype,"setPublishAudioFilterEnabled"),QH.prototype),QH);class tK{constructor(e,t){ry(this,"id",0),ry(this,"element",void 0),ry(this,"peerPair",void 0),ry(this,"context",void 0),ry(this,"audioPlayerElement",void 0),ry(this,"audioTrack",void 0),tK.count+=1,this.id=tK.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new Gh((t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}}))},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(e){throw new CC(tw.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new CC(tw.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new CC(tw.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){QR.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((e=>{e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var nK,rK;ry(tK,"count",0);const iK=window.AudioContext||window.webkitAudioContext,oK=new(nK=iI({report:oI}),rC((rK=class{constructor(){ry(this,"units",[]),ry(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return QR.debug("the system does not need to process local aec"),-1;this.context||(this.context=new iK);let t=this.units.find((t=>t&&t.getElement()===e));return t||(t=new tK(e,this.context),this.units.push(t)),t.startEchoCancellation(),QR.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return wS().name!==yS.SAFARI}}).prototype,"processExternalMediaAEC",[nK],Object.getOwnPropertyDescriptor(rK.prototype,"processExternalMediaAEC"),rK.prototype),rK);function sK(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function aK(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sK(Object(n),!0).forEach((function(t){ry(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sK(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const cK=window||document;function uK(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!cK)return;const n=dK._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=e=>{if(!(e&&e.blockedURI&&(dK.onSecurityPolicyViolation||dK.getListeners(fA.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;kR("CSP_DETECTED_HOSTNAME_LIST").some((e=>Dr(t).call(t,e)))&&(dK.onSecurityPolicyViolation&&"function"==typeof dK.onSecurityPolicyViolation&&dK.onSecurityPolicyViolation(e),dK.getListeners(fA.SECURITY_POLICY_VIOLATION).length>0&&dK.safeEmit(fA.SECURITY_POLICY_VIOLATION,e))};n&&cK.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||dK.getListeners(fA.SECURITY_POLICY_VIOLATION).length>0)&&cK.addEventListener("securitypolicyviolation",r),dK._cspEventHandlerPointer=r}NR("PROCESS_ID","process-".concat(eR(8,""),"-").concat(eR(4,""),"-").concat(eR(4,""),"-").concat(eR(4,""),"-").concat(eR(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void QR.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();QR.debug("Loading global parameters from cache",t),Object.keys(t).forEach((e=>{if(Object.prototype.hasOwnProperty.call(OR,e)){const{value:r,expires:i}=t[e];if(i&&i<=n)return;DR[e]=r,OR[e]=r}}))}catch(t){QR.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(DR.AREAS)&&DR.AREAS.length>0&&TO(DR.AREAS,!0);const lK=(e,t,n)=>{QR.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),NR(e,t,n)},dK=function(e){const t=new vw,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===fA.SECURITY_POLICY_VIOLATION&&uK(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return aK(aK({},n),r)}({__TRACK_LIST__:Nx,VERSION:wR,BUILD:AR,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:lK,getParameter:kR,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(e){let t;return fx().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new CC(tw.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=oI.reportApiInvoke(null,{name:Tw.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Sw.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r),t&&YS()&&function(e){const t=wS();return!(t.name!==yS.CHROME||!t.osVersion)&&Number(t.version)<e}(75)&&(new e).close()}catch(e){return QR.error("check system requirement failed: ",e),!1}let n=!1;const r=wS();r.name===yS.CHROME&&Number(r.version)>=58&&("WebKit"!==TS.engine.name||function(){const e=wS();if(AS()){if(e.os===vS.MAC_OS)return!0;if(e.os===vS.IOS){const e=TS.os.version&&TS.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(r.name===yS.FIREFOX&&Number(r.version)>=56||r.name===yS.OPERA&&Number(r.version)>=45||r.name===yS.SAFARI&&Number(r.version)>=11||"WebKit"===r.name&&(PS()||HS())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||KS()||wS().name===yS.QQ)&&(n=!0),QR.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return IU.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return IU.getRecordingDevices(e)},getCameras:function(e){return IU.getCamerasDevices(e)},getElectronScreenSources:EU,getPlaybackDevices:function(e){return IU.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=oI.reportApiInvoke(null,{name:Tw.CREATE_CLIENT,options:[t],tag:Sw.TRACER});try{!function(e){iw(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),iw(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&iw(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&aw(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&Aw(e.turnServer),void 0!==e.httpRetryConfig&&ww(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&ww(e.websocketRetryConfig)}(t)}catch(e){throw n.onError(e),e}return(US(16,0,!0)||FS(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",QR.debug("browser not support vp9, force use vp8")),NR("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),n.onSuccess(),new eK($H($H({forceWaitGatewayResponse:!0},t),{},{role:Dr(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=kR("CAMERA_CAPTURE_CONFIG"),n=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.CREATE_CAM_VIDEO_TRACK,options:[tU({},e),t]});t&&(e.encoderConfig=t);const r=BU(e),i=eR(8,"track-cam-");let o=null;const s="720p_auto"===e.encoderConfig;QR.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{o=(await TU({video:r},i)).getVideoTracks()[0]||null}catch(e){throw n.onError(e),e}if(!o){const e=new nw(tw.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(QR)}e.optimizationMode&&Rj(i,o,e,Rx(e.encoderConfig));const a=new wj(o,e,r,e.scalabiltyMode?Cx(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return s&&a.startMonitorStats(),n.onSuccess(a.getTrackId()),QR.info("create camera video success, trackId:",i),a},createCustomVideoTrack:function(e){const t=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new Sj(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Cx(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,eR(8,"track-cus-"),[Px.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),QR.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.CREATE_SCREEN_VIDEO_TRACK,options:[tU({},e),t]}),r="720p_auto"===e.encoderConfig;e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&OS()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:o}=e;(LS(107)||MS(107)||jS(93))&&(n&&(iw(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(iw(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(iw(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(LS(105)||MS(105)||jS(91))&&o&&(iw(o,"systemAudio",["exclude","include"]),t.systemAudio=o),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const s=e.encoderConfig?Ix(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:s?s.width:void 0,maxHeight:s?s.height:void 0},s&&(s.frameRate&&("number"==typeof s.frameRate?(t.mandatory.maxFrameRate=s.frameRate,t.mandatory.minFrameRate=s.frameRate):(t.mandatory.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||void 0,t.mandatory.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||void 0),t.frameRate=s.frameRate),s.width&&(t.width=s.width),s.height&&(t.height=s.height)),t}(e),o=eR(8,"track-scr-v-");let s=null,a=null;const c=fx();if(!c.supportShareAudio&&"enable"===t){const e=new nw(tw.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(e),e.throw(QR)}QR.info("start create screen video track with config",e,"withAudio",t,"trackId",o);try{const e=await TU({screen:i,screenAudio:"auto"===t?c.supportShareAudio:"enable"===t},o);s=e.getVideoTracks()[0]||null,a=e.getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!s){const e=new nw(tw.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(QR)}if(!a&&"enable"===t){s&&s.stop();const e=new nw(tw.SHARE_AUDIO_NOT_ALLOWED);return n.onError(e),e.throw(QR)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(Rj(o,s,e,e.encoderConfig&&Ix(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const u=new Sj(s,e.encoderConfig?Ix(e.encoderConfig):{},e.scalabiltyMode?Cx(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[Px.SCREEN_TRACK]);if(r&&u.startMonitorStats(),!a)return n.onSuccess(u.getTrackId()),QR.info("create screen video track success","video:",u.getTrackId()),u;const l=new PF(a,void 0,eR(8,"track-scr-a-"),!1);return n.onSuccess([u.getTrackId(),l.getTrackId()]),QR.info("create screen video track success","video:",u.getTrackId(),"audio:",l.getTrackId()),[u,l]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=kR("CAMERA_CAPTURE_CONFIG"),r=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const i="720p_auto"===t.encoderConfig,o=BU(t),s=GU(e),a=eR(8,"track-mic-"),c=eR(8,"track-cam-");let u=null,l=null;QR.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await TU({audio:s,video:o},"".concat(a,"-").concat(c));u=e.getAudioTracks()[0],l=e.getVideoTracks()[0]}catch(e){throw r.onError(e),e}if(!u||!l){const e=new nw(tw.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(e),e.throw(QR)}t.optimizationMode&&Rj(c,l,t,Rx(t.encoderConfig));const d=new LF(u,e,s,a),h=new wj(l,t,o,t.scalabiltyMode?Cx(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return i&&h.startMonitorStats(),r.onSuccess([d.getTrackId(),h.getTrackId()]),QR.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[d,h]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=GU(e),r=eR(8,"track-mic-");let i=null;QR.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{i=(await TU({audio:n},r)).getAudioTracks()[0]||null}catch(e){throw t.onError(e),e}if(!i){const e=new nw(tw.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw(QR)}const o=new LF(i,e,n,r);return t.onSuccess(o.getTrackId()),QR.info("create microphone audio track success, trackId:",r),o},createCustomAudioTrack:function(e){const t=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new PF(e.mediaStreamTrack,e.encoderConfig?Ox(e.encoderConfig):{},eR(8,"track-cus-"),!1);return QR.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:r},s=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(kR("DISABLE_WEBAUDIO"))throw new nw(tw.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a=eR(8,"track-buf-");QR.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",a);const c=i;if(!(i instanceof AudioBuffer))try{i=await async function(e,t){let n=null;if("string"==typeof e){const t=FF.get(e);if(t)return QR.debug("use cached audio resource: ",e),t;try{n=(await gR((()=>pS.get(e,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new nw(tw.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new Gh(((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new nw(tw.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new nw(tw.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)}));n=await t}const r=await function(e){const t=uU();return new Gh(((n,r)=>{t.decodeAudioData(e,(e=>{n(e)}),(e=>{r(new nw(tw.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(n);return"string"==typeof e&&t&&FF.set(e,r),r}(i,n)}catch(e){return s.onError(e),e.throw(QR)}const u=new UF(i),l=new MF(c,u,r?Ox(r):{},a);return QR.info("create buffer source audio track success, trackId:",a),s.onSuccess(l.getTrackId()),l},setAppType:function(e){if(QR.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw QR.debug("Invalid appType"),new CC(tw.INVALID_PARAMS,"invalid app type",e);NR("APP_TYPE",Math.floor(e))},setLogLevel:function(e){QR.setLogLevel(e)},enableLogUpload:function(){kR("USE_NEW_LOG")?NR("UPLOAD_LOG",!0):QR.enableLogUpload()},disableLogUpload:function(){kR("USE_NEW_LOG")?NR("UPLOAD_LOG",!1):QR.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new gG},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof PF||e instanceof Vj)){const e=new CC(tw.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof PF?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let o=i,s=i;const a=Date.now();return new Gh((i=>{const c=setInterval((()=>{const u=e.getVolumeLevel();o=u>o?u:o,s=u<s?u:s;const l=o-s>1e-4,d=Date.now()-a;if(l||d>t){clearInterval(c);const t=l,s={duration:d,deviceLabel:r,maxVolumeLevel:o,result:t};QR.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(s))),n.onSuccess(s),i(t)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=oI.reportApiInvoke(null,{tag:Sw.TRACER,name:Tw.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Sj||e instanceof jj)){const e=new CC(tw.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof Sj?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(NS()||AS())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();const s=document.createElement("canvas");s.width=160,s.height=120;let a=0,c=0;try{const e=Date.now();a=await function(e,t,n,r){let i,o=0,s=null;return new Gh(((a,c)=>{function u(){o>r&&i&&(i(),a(o));const t=n.getContext("2d");if(!t){const e=new CC(tw.UNEXPECTED_ERROR,"can not get canvas 2d context.");return QR.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const u=t.getImageData(0,0,n.width,n.height),l=Math.floor(u.data.length/3);if(s){for(let e=0;e<l;e+=3)if(u.data[e]!==s[e])return o+=1,void(s=u.data);s=u.data}else s=u.data}setTimeout((()=>{i&&(i(),a(o))}),t),i=hU((()=>{u()}),30)}))}(o,t,s,4),c=Date.now()-e}catch(e){throw n.onError(e),e}VW===yS.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const u=a>4,l={duration:c,changedPicNum:a,deviceLabel:r,result:u};return QR.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l))),n.onSuccess(l),u},setArea:TO,audioElementPlayCenter:DU,resumeAudioContext:function(){DU.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){oK.processExternalMediaAEC(e)},registerExtensions:function(e){const t=kR("PLUGIN_INFO")||[];e.forEach((e=>{"name"in e&&!Dr(t).call(t,e.name)&&t.push(e.name);const n=e;n.__registered__=!0,n.logger.hookLog=QR.extLog,n.reporter.hookApiInvoke=oI.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach((e=>{n.parameters[e]=kR(e)}))})),lK("PLUGIN_INFO",t)},ChannelMediaRelayError:WC,ChannelMediaRelayEvent:GC,ChannelMediaRelayState:qC,RemoteStreamFallbackType:xx,RemoteStreamType:Mx,ConnectionDisconnectedReason:Iw,AudienceLatencyLevelType:Rw,AREAS:XC,preload:async function(e,t,n,r){return eH(e,t,n,r)}});return Object.defineProperties(dK,{onAudioAutoplayFailed:{get:()=>AU.onAudioAutoplayFailed,set:e=>{AU.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>AU.onAutoplayFailed,set:e=>{AU.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>dK._onSecurityPolicyViolation,set(e){dK._onSecurityPolicyViolation=e,uK(e)}},__CLIENT_LIST__:{get:()=>kR("SHOW_GLOBAL_CLIENT_LIST")?uI:[]}}),IU.on(Jx.CAMERA_DEVICE_CHANGED,(e=>{QR.info("camera device changed",JSON.stringify(e)),dK.onCameraChanged&&dK.onCameraChanged(e),dK.safeEmit(fA.CAMERA_CHANGED,e)})),IU.on(Jx.RECORDING_DEVICE_CHANGED,(e=>{QR.info("microphone device changed",JSON.stringify(e)),dK.onMicrophoneChanged&&dK.onMicrophoneChanged(e),dK.safeEmit(fA.MICROPHONE_CHANGED,e)})),IU.on(Jx.PLAYOUT_DEVICE_CHANGED,(e=>{QR.debug("playout device changed",JSON.stringify(e)),dK.onPlaybackDeviceChanged&&dK.onPlaybackDeviceChanged(e),dK.safeEmit(fA.PLAYBACK_DEVICE_CHANGED,e)})),DU.onAutoplayFailed=()=>{QR.info("detect audio element autoplay failed"),AU.onAudioAutoplayFailed&&AU.onAudioAutoplayFailed()},cU.on("autoplay-failed",(()=>{QR.info("detect webaudio autoplay failed"),AU.onAudioAutoplayFailed&&AU.onAudioAutoplayFailed(),dK.safeEmit(fA.AUTOPLAY_FAILED)})),cU.on(gx.STATE_CHANGE,((e,t)=>{QR.info("audio context state changed: ".concat(t," => ").concat(e)),dK.onAudioContextStateChanged&&dK.onAudioContextStateChanged(e,t),dK.safeEmit(fA.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),Fw.on(Pw.NETWORK_STATE_CHANGE,((e,t)=>{QR.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=dK),dK}()},621:function(module,__unused_webpack_exports,__webpack_require__){"use strict";var t;module=__webpack_require__.nmd(module),t=function(){function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sl(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function J(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){function o(e){sl(a,r,i,o,s,"next",e)}function s(e){sl(a,r,i,o,s,"throw",e)}var a=e.apply(t,n);o(void 0)}))}}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ha(e,t,n){return t&&tl(e.prototype,t),n&&tl(e,n),e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function la(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&df(e,t)}function wd(e){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function df(e,t){return(df=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ul(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Sh(e,t,n){return(Sh=ul()?Reflect.construct:function(e,t,n){var r=[null];return r.push.apply(r,t),e=new(Function.bind.apply(e,r)),n&&df(e,n.prototype),e}).apply(null,arguments)}function ef(e){var t="function"==typeof Map?new Map:void 0;return(ef=function(e){function n(){return Sh(e,arguments,wd(this).constructor)}if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),df(n,e)})(e)}function ff(e,t){if(null==e)return{};if(null==e)var n={};else{n={};var r,i=Object.keys(e);for(r=0;r<i.length;r++){var o=i[r];0<=t.indexOf(o)||(n[o]=e[o])}}if(Object.getOwnPropertySymbols)for(r=Object.getOwnPropertySymbols(e),o=0;o<r.length;o++)i=r[o],0<=t.indexOf(i)||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);return n}function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ma(e){var t=ul();return function(){var r=wd(e);if(t){var i=wd(this).constructor;r=Reflect.construct(r,arguments,i)}else r=r.apply(this,arguments);return!r||"object"!=typeof r&&"function"!=typeof r?n(this):r}}function Th(e,t,n){return(Th="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wd(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}function ra(e,t){var n=Array.isArray(e)?e:void 0;if(!n)if(null==(n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"])))n=void 0;else{var r,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0;var a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}n=i}if(!(e=n||vl(e,t)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function G(e){var t=Array.isArray(e)?Uh(e):void 0;if(t||(t="undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"]?Array.from(e):void 0),!(e=t||vl(e)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function vl(e,t){if(e){if("string"==typeof e)return Uh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Uh(e,t)}}function Uh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function fa(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function $a(e){var t={exports:{}};return e(t,t.exports),t.exports}function wl(e,t){var n,r=3>arguments.length?e:arguments[2];return va(e)===r?e[t]:(n=Fb.f(e,t))?Q(n,"value")?n.value:void 0===n.get?void 0:n.get.call(r):ha(n=Vb(e))?wl(n,t,r):void 0}function rs(e){var t=e.charCodeAt(0)<<24,n=0|ss(~t),r=0,i=0|e.length,o="";if(5>n&&i>=n){for(t=t<<n>>>24+n,r=1;r<n;r=r+1|0)t=t<<6|63&e.charCodeAt(r);65535>=t?o+=xd(t):1114111>=t?o+=xd(55296+((t=t-65536|0)>>10)|0,56320+(1023&t)|0):r=0}for(;r<i;r=r+1|0)o+="\ufffd";return o}function xl(){}function ts(e){var t=0|e.charCodeAt(0);if(55296<=t&&56319>=t){var n=0|e.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return xd(239,191,189);if(65535<(t=(t-55296<<10)+n-56320+65536|0))return xd(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return 127>=t?e:2047>=t?xd(192|t>>>6,128|63&t):xd(224|t>>>12,128|t>>>6&63,128|63&t)}function yl(){}function ea(){ea.init.call(this)}function ng(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+X(e))}function zl(e,t,n,r){ng(n);var i=e._events;if(void 0===i)i=e._events=Object.create(null),e._eventsCount=0;else{void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events);var o=i[t]}return void 0===o?(i[t]=n,++e._eventsCount):("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),0<(n=void 0===e._maxListeners?ea.defaultMaxListeners:e._maxListeners)&&o.length>n&&!o.warned&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,console&&console.warn&&console.warn(n))),e}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(e,t,n){return e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},(t=us.bind(e)).listener=n,e.wrapFn=t}function Bl(e,t,n){if(void 0===(e=e._events))return[];if(void 0===(t=e[t]))return[];if("function"==typeof t)return n?[t.listener||t]:[t];if(n)for(n=Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];else n=Cl(t,t.length);return n}function Dl(e){var t=this._events;if(void 0!==t){if("function"==typeof(e=t[e]))return 1;if(void 0!==e)return e.length}return 0}function Cl(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function vs(e,t,n){"function"==typeof e.on&&El(e,"error",t,n)}function El(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(e));e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}function ws(e){return e?G(e):xs((function(){return[]}),(function(e,t){return e.push(t),e}))}function Fl(e,t){var n,r,i,o;return w.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:n=Gl(e)([Hl,Hl,function(e,t){return t}])[2],r=0;case 2:if(!(r<t.length)){s.next=17;break}if(i=t[r],!((o=n(Vh,i))instanceof og)){s.next=11;break}if((o=Wh(o.deref()))===Vh){s.next=10;break}return s.next=10,o;case 10:return s.abrupt("return");case 11:if(o===Vh){s.next=14;break}return s.next=14,o;case 14:r++,s.next=2;break;case 17:case"end":return s.stop()}}),ys)}function pg(e,t){return null!=t&&"function"==typeof t[Symbol.iterator]?Fl(pg(e),t):function(t){var n=t[2];return zs(t,(function(t,r){return n(t,e(r))}))}}function Ac(e){return Object.prototype.toString.call(e).slice(8,-1)}function yd(e){return"Object"===Ac(e)&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Il(e){var t;return(t="Boolean"===Ac(e)||"Null"===Ac(e)||"Undefined"===Ac(e))||(t="Number"===Ac(e)&&!isNaN(e)),t||"String"===Ac(e)||"Symbol"===Ac(e)}function zd(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ce(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function de(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function gf(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new qg;++t<n;)this.add(e[t])}function ee(e){this.size=(this.__data__=new rg(e)).size}function fe(e,t,n,r,i,o){var s,a=1&t,c=2&t,u=4&t;if(n&&(s=i?n(e,r,i,o):n(e)),void 0!==s)return s;if(!lb(e))return e;if(r=Va(e)){if(s=As(e),!a)return Xh(e,s)}else{var l=hf(e),d="[object Function]"==l||"[object GeneratorFunction]"==l;if(jf(e))return Jl(e,a);if("[object Object]"==l||"[object Arguments]"==l||d&&!i){if(s=c||d?{}:Kl(e),!a)return c?Bs(e,Cs(s,e)):Ds(e,Es(s,e))}else{if(!wa[l])return i?e:{};s=Fs(e,l,a)}}if(o||(o=new ge),i=o.get(e))return i;o.set(e,s),Gs(e)?e.forEach((function(r){s.add(fe(r,t,n,r,e,o))})):Hs(e)&&e.forEach((function(r,i){s.set(i,fe(r,t,n,i,e,o))})),c=u?c?Ll:Yh:c?kf:Ad;var h=r?void 0:c(e);return Is(h||e,(function(r,i){h&&(r=e[i=r]),Ml(s,i,fe(r,t,n,i,e,o))})),s}function Zh(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;return o.has(i)?o.get(i):(r=e.apply(this,r),n.cache=o.set(i,r)||o,r)};return n.cache=new(Zh.Cache||qg),n}function Nl(e){if("string"==typeof e)return e;if(Va(e))return he(e,Nl)+"";if(ie(e))return Ol?Ol.call(e):"";var t=e+"";return"0"==t&&1/e==-Js?"-0":t}function $h(e,t,n,r,i){var o=-1,s=e.length;for(n||(n=Ks),i||(i=[]);++o<s;){var a=e[o];0<t&&n(a)?1<t?$h(a,t-1,n,r,i):ai(i,a):r||(i[i.length]=a)}return i}function je(e,t,n,r,i){if(e===t)t=!0;else if(null==e||null==t||!gc(e)&&!gc(t))t=e!=e&&t!=t;else e:{var o=Va(e),s=Va(t),a=o?"[object Array]":hf(e),c=s?"[object Array]":hf(t),u="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a);if(s="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=a==c)&&jf(e)){if(!jf(t)){t=!1;break e}o=!0,u=!1}if(c&&!u)i||(i=new ge),t=o||bi(e)?Pl(e,t,n,r,je,i):Ls(e,t,a,n,r,je,i);else{if(!(1&n)&&(o=u&&Ql.call(e,"__wrapped__"),a=s&&Ql.call(t,"__wrapped__"),o||a)){e=o?e.value():e,t=a?t.value():t,i||(i=new ge),t=je(e,t,n,r,i);break e}if(c)t:if(i||(i=new ge),o=1&n,a=Yh(e),s=a.length,c=Yh(t).length,s==c||o){for(c=s;c--;){var l=a[c];if(!(o?l in t:Ms.call(t,l))){t=!1;break t}}if(u=i.get(e),l=i.get(t),u&&l)t=u==t&&l==e;else{u=!0,i.set(e,t),i.set(t,e);for(var d=o;++c<s;){var h=e[l=a[c]],p=t[l];if(r)var f=o?r(p,h,l,t,e,i):r(h,p,l,e,t,i);if(void 0===f?h!==p&&!je(h,p,n,r,i):!f){u=!1;break}d||(d="constructor"==l)}u&&!d&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(u=!1),i.delete(e),i.delete(t),t=u}}else t=!1;else t=!1}}return t}function xa(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function mb(e){return!0===(e&&e.__isLong__)}function Bd(e,t){var n;if(t){if((t=0<=(e>>>=0)&&256>e)&&(n=Rl[e]))return n;n=ya(e,0>(0|e)?-1:0,!0),t&&(Rl[e]=n)}else{if((t=-128<=(e|=0)&&128>e)&&(n=Sl[e]))return n;n=ya(e,0>e?-1:0,!1),t&&(Sl[e]=n)}return n}function Gb(e,t){if(isNaN(e))return t?Cd:Hb;if(t){if(0>e)return Cd;if(e>=Tl)return Ul}else{if(e<=-Vl)return nb;if(e+1>=Vl)return Wl}return 0>e?Gb(-e,t).neg():ya(e%ke|0,e/ke|0,t)}function ya(e,t,n){return new xa(e,t,n)}function ci(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return Hb;if("number"==typeof t?(n=t,t=!1):t=!!t,2>(n=n||10)||36<n)throw RangeError("radix");var r;if(0<(r=e.indexOf("-")))throw Error("interior hyphen");if(0===r)return ci(e.substring(1),t,n).neg();r=Gb(sg(n,8));for(var i=Hb,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),a=parseInt(e.substring(o,o+s),n);8>s?(s=Gb(sg(n,s)),i=i.mul(s).add(Gb(a))):i=(i=i.mul(r)).add(Gb(a))}return i.unsigned=t,i}function Wb(e,t){return"number"==typeof e?Gb(e,t):"string"==typeof e?ci(e,t):ya(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}function O(e,t){function n(){this.constructor=e}di(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function le(e){return"function"==typeof e}function me(e){setTimeout((function(){throw e}),0)}function ei(e){return null!==e&&"object"===X(e)}function Xl(e){return e.reduce((function(e,t){return e.concat(t instanceof lf?t.errors:t)}),[])}function fi(e){for(;e;){var t=e.destination,n=e.isStopped;if(e.closed||n)return!1;e=t&&t instanceof ia?t:null}return!0}function Yc(e){return e}function gi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Yl(e)}function Yl(e){return 0===e.length?Yc:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}function Zl(e){if(e||(e=Ib.Promise||Promise),!e)throw Error("no Promise impl found");return e}function $l(){return function(e){return e.lift(new Ns(e))}}function mf(e){return e?Os(e):vb}function Os(e){return new Y((function(t){return e.schedule((function(){return t.complete()}))}))}function Zc(e){return e&&"function"==typeof e.schedule}function hi(e,t){return new Y((function(n){var r=new Oa,i=0;return r.add(t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||r.add(this.schedule()))}))),r}))}function nf(e,t){return t?hi(e,t):new Y(am(e))}function bb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Zc(t=e[e.length-1])?(e.pop(),hi(e,t)):nf(e)}function Z(e,t){return new Y(t?function(n){return t.schedule(Ps,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function Ps(e){e.subscriber.error(e.error)}function Qs(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Rs(e,t))}}function bm(e){return e in ii&&(delete ii[e],!0)}function hc(){}function ba(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Ss(e,t))}}function cm(e,t,n){if(t){if(!Zc(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return cm(e,n).apply(void 0,r).pipe(ba((function(e){return Jb(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i,o=this,s={context:o,subject:i,callbackFunc:e,scheduler:n};return new Y((function(r){if(n)return n.schedule(Ts,0,{args:t,subscriber:r,params:s});if(!i){i=new of;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.next(1>=e.length?e[0]:e),i.complete()}]))}catch(e){fi(i)?i.error(e):console.warn(e)}}return i.subscribe(r)}))}}function Ts(e){var t=this,n=e.args,r=e.subscriber,i=e.params;e=i.callbackFunc;var o=i.context,s=i.scheduler,a=i.subject;if(!a){a=i.subject=new of,i=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.add(s.schedule(Us,0,{value:1>=e.length?e[0]:e,subject:a}))};try{e.apply(o,n.concat([i]))}catch(e){a.error(e)}}this.add(a.subscribe(r))}function Us(e){var t=e.subject;t.next(e.value),t.complete()}function dm(e,t,n){if(t){if(!Zc(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return dm(e,n).apply(void 0,r).pipe(ba((function(e){return Jb(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new Y((function(r){var o=i.context,s=i.subject;if(n)return n.schedule(Vs,0,{params:i,subscriber:r,context:o});if(!s){s=i.subject=new of;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(t=e.shift())?s.error(t):(s.next(1>=e.length?e[0]:e),s.complete())}]))}catch(e){fi(s)?s.error(e):console.warn(e)}}return s.subscribe(r)}))}}function Vs(e){var t=this,n=e.params,r=e.subscriber;e=e.context;var i=n.callbackFunc,o=n.args,s=n.scheduler,a=n.subject;if(!a){a=n.subject=new of,n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(n=e.shift())?t.add(s.schedule(em,0,{err:n,subject:a})):t.add(s.schedule(Ws,0,{value:1>=e.length?e[0]:e,subject:a}))};try{i.apply(e,o.concat([n]))}catch(e){this.add(s.schedule(em,0,{err:e,subject:a}))}}this.add(a.subscribe(r))}function Ws(e){var t=e.subject;t.next(e.value),t.complete()}function em(e){e.subject.error(e.err)}function fm(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}function ji(e,t,n,r,i){if(void 0===i&&(i=new Xs(e,n,r)),!i.closed)return t instanceof Y?t.subscribe(i):pf(t)(i)}function Ys(e,t){return new Y((function(n){var r=new Oa;return r.add(t.schedule((function(){var i=e[ne]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}function Zs(e,t){return new Y((function(n){var r=new Oa;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}function $s(e,t){if(!e)throw Error("Iterable cannot be null");return new Y((function(n){var r,i=new Oa;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[$c](),i.add(t.schedule((function(){if(!n.closed){try{var e=r.next(),t=e.value,i=e.done}catch(e){return void n.error(e)}i?n.complete():(n.next(t),this.schedule())}})))}))),i}))}function gm(e,t){if(null!=e){if(e&&"function"==typeof e[ne])return Ys(e,t);if(fm(e))return Zs(e,t);if(hm(e))return hi(e,t);if(e&&"function"==typeof e[$c]||"string"==typeof e)return $s(e,t)}throw new TypeError((null!==e&&X(e)||e)+" is not observable")}function Kb(e,t){return t?gm(e,t):e instanceof Y?e:new Y(pf(e))}function ic(e,t){if(!t.closed){if(e instanceof Y)return e.subscribe(t);try{var n=pf(e)(t)}catch(e){t.error(e)}return n}}function cb(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(cb((function(n,r){return Kb(e(n,r)).pipe(ba((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new at(e,n))})}function tg(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),cb(Yc,e)}function im(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return tg(1)(bb.apply(void 0,e))}function ad(e){return new Y((function(t){try{var n=e()}catch(e){return void t.error(e)}return(n?Kb(n):mf()).subscribe(t)}))}function jm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(Jb(n))return ug(n,null);if(ei(n)&&Object.getPrototypeOf(n)===Object.prototype)return ug((e=Object.keys(n)).map((function(e){return n[e]})),e)}if("function"==typeof e[e.length-1]){var r=e.pop();return ug(e=1===e.length&&Jb(e[0])?e[0]:e,null).pipe(ba((function(e){return r.apply(void 0,e)})))}return ug(e,null)}function ug(e,t){return new Y((function(n){var r=e.length;if(0===r)n.complete();else for(var i=Array(r),o=0,s=0,a=function(a){var c=Kb(e[a]),u=!1;n.add(c.subscribe({next:function(e){u||(u=!0,s++),i[a]=e},error:function(e){return n.error(e)},complete:function(){++o!==r&&u||(s===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)a(c)}))}function gb(e,t,n,r){return le(n)&&(r=n,n=void 0),r?gb(e,t,n).pipe(ba((function(e){return Jb(e)?r.apply(void 0,e):r(e)}))):new Y((function(r){km(e,t,(function(e){1<arguments.length?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function km(e,t,n,r,i){if(e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){e.addEventListener(t,n,i);var o=function(){return e.removeEventListener(t,n,i)}}else if(e&&"function"==typeof e.on&&"function"==typeof e.off)e.on(t,n),o=function(){return e.off(t,n)};else if(e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener)e.addListener(t,n),o=function(){return e.removeListener(t,n)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var s=0,a=e.length;s<a;s++)km(e[s],t,n,r,i)}r.add(o)}function lm(e,t,n){return n?lm(e,t).pipe(ba((function(e){return Jb(e)?n.apply(void 0,e):n(e)}))):new Y((function(n){var r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{var i=e(r)}catch(e){return void n.error(e)}if(le(t))return function(){return t(r,i)}}))}function bt(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}try{var i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function ki(e){return!Jb(e)&&0<=e-parseFloat(e)+1}function mm(e,t){return void 0===e&&(e=0),void 0===t&&(t=bd),(!ki(e)||0>e)&&(e=0),t&&"function"==typeof t.schedule||(t=bd),new Y((function(n){return n.add(t.schedule(ct,e,{subscriber:n,counter:0,period:e})),n}))}function ct(e){var t=e.subscriber,n=e.counter;e=e.period,t.next(n),this.schedule({subscriber:t,counter:n+1,period:e},e)}function Xb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];t=Number.POSITIVE_INFINITY;var n=null,r=e[e.length-1];return Zc(r)?(n=e.pop(),1<e.length&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof Y?e[0]:tg(t)(nf(e,n))}function li(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return vb;var n=e[0],r=e.slice(1);return 1===e.length&&Jb(n)?li.apply(void 0,n):new Y((function(e){var t=function(){return e.add(li.apply(void 0,r).subscribe(e))};return Kb(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function dt(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription;if(e=e.obj,!r.closed)if(n<t.length){var o=t[n];r.next([o,e[o]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:e}))}else r.complete()}function et(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function wb(e,t){return function(n){return n.lift(new ft(e,t))}}function Ca(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Jb(e[0]))return e[0];e=e[0]}return nf(e,void 0).lift(new gt)}function ht(e){var t=e.start,n=e.index,r=e.subscriber;n>=e.count?r.complete():(r.next(t),r.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function Bc(e,t,n){void 0===e&&(e=0);var r=-1;return ki(t)?r=1>Number(t)?1:Number(t):Zc(t)&&(n=t),Zc(n)||(n=bd),new Y((function(t){var i=ki(e)?e:+e-n.now();return n.schedule(it,i,{index:0,period:r,subscriber:t})}))}function it(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function mi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"function"==typeof(t=e[e.length-1])&&e.pop(),nf(e,void 0).lift(new jt(t))}function Ga(e){return function(t){var n=new kt(e);return t=t.lift(n),n.caught=t}}function ni(e,t){return cb(e,t,1)}function nm(e){return void 0===e&&(e=null),function(t){return t.lift(new lt(e))}}function cd(e,t){void 0===t&&(t=bd);var n=e instanceof Date&&!isNaN(+e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new mt(n,t))}}function om(e,t){return function(n){return n.lift(new nt(e,t))}}function Dd(e){return void 0===e&&(e=ot),function(t){return t.lift(new pt(e))}}function ot(){return new vg}function Ka(e){return function(t){return 0===e?mf():t.lift(new qt(e))}}function pm(e,t){return t?function(n){return n.pipe(pm((function(n,r){return Kb(e(n,r)).pipe(ba((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new rt(e))}}function wg(e){return function(t){return t.lift(new st(e))}}function aa(e,t){var n=2<=arguments.length;return function(r){return r.pipe(e?wb((function(t,n){return e(t,n,r)})):Yc,Ka(1),n?nm(t):Dd((function(){return new vg})))}}function tt(){return function(e){return e.lift(new ut)}}function qm(e){return function(t){return 0===e?mf():t.lift(new vt(e))}}function qf(e){return function(t){return t.lift(new wt(e))}}function xg(e,t){var n=!1;return 2<=arguments.length&&(n=!0),function(r){return r.lift(new xt(e,t,n))}}function rm(e,t){return 2<=arguments.length?function(n){return gi(xg(e,t),qm(1),nm(t))(n)}:function(t){return gi(xg((function(t,n,r){return e(t,n,r+1)})),qm(1))(t)}}function yt(e,t){return function(n){var r="function"==typeof e?e:function(){return e};if("function"==typeof t)return n.lift(new zt(r,t));var i=Object.create(n,At);return i.source=n,i.subjectFactory=r,i}}function oe(e){return function(t){return t.lift(new Bt(e,t))}}function Ct(){return new Pa}function pe(){return function(e){return $l()(yt(Ct)(e))}}function sm(e,t,n){var r=e&&"object"===X(e)?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n};return function(e){return e.lift(Dt(r))}}function Dt(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=void 0===(r=e.windowTime)?Number.POSITIVE_INFINITY:r,s=e.refCount,a=e.scheduler,c=0,u=!1,l=!1;return function(e){if(c++,!t||u){u=!1;var r=(t=new qe(i,o,a)).subscribe(this);n=e.subscribe({next:function(e){t.next(e)},error:function(e){u=!0,t.error(e)},complete:function(){l=!0,n=void 0,t.complete()}}),l&&(n=void 0)}else r=t.subscribe(this);this.add((function(){c--,r.unsubscribe(),r=void 0,n&&!l&&s&&0===c&&(n.unsubscribe(),t=n=void 0)}))}}function Cc(e,t){return"function"==typeof t?function(n){return n.pipe(Cc((function(n,r){return Kb(e(n,r)).pipe(ba((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new Et(e))}}function ob(e){return function(t){return t.lift(new Ft(e))}}function Gt(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new Ht(e,t))}}function ca(e,t,n){return function(r){return r.lift(new It(e,t,n))}}function Jt(e,t,n){return void 0===t&&(t=bd),void 0===n&&(n=Kt),function(r){return r.lift(new Lt(e,t,n.leading,n.trailing))}}function Mt(e){e.subscriber.clearThrottle()}function Nt(e,t,n){return void 0===n&&(n=bd),function(r){var i=e instanceof Date&&!isNaN(+e),o=i?+e-n.now():Math.abs(e);return r.lift(new Ot(o,i,t,n))}}function hb(e,t){return void 0===t&&(t=bd),Nt(e,Z(new pb),t)}function Pt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;return"function"==typeof e[e.length-1]&&(n=e.pop()),t.lift(new Qt(e,n))}}function tm(e,t,n,r,i){e!==t&&um(t,(function(o,s){if(i||(i=new ge),lb(o)){o=i;var a=oi(e,s),c=oi(t,s),u=o.get(c);if(u)pi(e,s,u);else{var l=void 0===(u=r?r(a,c,s+"",e,t,o):void 0);if(l){var d=Va(c),h=!d&&jf(c),p=!d&&!h&&bi(c);u=c,d||h||p?Va(a)?u=a:gc(a)&&Ed(a)?u=Xh(a):h?(l=!1,u=Jl(c,!0)):p?(l=!1,u=vm(c,!0)):u=[]:wm(c)||rf(c)?(u=a,rf(a)?u=re(a,kf(a)):lb(a)&&!qi(a)||(u=Kl(c))):l=!1}l&&(o.set(c,u),tm(u,c,n,r,o),o.delete(c)),pi(e,s,u)}}else void 0===(a=r?r(oi(e,s),o,s+"",e,t,i):void 0)&&(a=o),pi(e,s,a)}),kf)}function Rt(e){var t=1,n=ri;1==(1>=arguments.length?0:arguments.length-1)?"number"==typeof(1>=arguments.length?void 0:arguments[1])?t=1>=arguments.length?void 0:arguments[1]:n=1>=arguments.length?void 0:arguments[1]:2==(1>=arguments.length?0:arguments.length-1)&&(t=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2]);var r=t||1;return function(t){return t.pipe(xg((function(t,i){var o=n.now(),s=o-e;if((t=t.filter((function(e){return e.until>s}))).length>=r){var a=t[t.length-1],c=t[0].until+e*Math.floor(t.length/r);t.push({delay:a.until<o?c-o:c-a.until,until:c,value:i})}else t.push({delay:0,until:o,value:i});return t}),[]),ba((function(e){return e[e.length-1]})),ni((function(e){var t=bb(e.value);return e.delay?t.pipe(cd(e.delay,n)):t})))}}function St(e,t){var n=(t=void 0===t?{protocols:xm,makeWebSocket:ym}:t).protocols,r=void 0===n?xm:n,i=void 0===(t=t.makeWebSocket)?ym:t;return new Y((function(t){var n,o=new Pa,s=i(e,r),a=!1,c=!1,u=function(e){if(n)throw a=!0,e=Error("Web socket message factory function called more than once"),t.error(e),e;return n=e.subscribe((function(e){s.send(e)})),o};return s.onopen=function(){c?(a=!0,s.close()):t.next(u)},s.onmessage=function(e){o.next(e.data)},s.onerror=function(e){a=!0,t.error(Error(e.message))},s.onclose=function(e){a||(a=!0,c?(t.complete(),o.complete()):t.error(Error(1e3===e.code?"Normal closure":e.reason)))},function(){c=!0,n&&n.unsubscribe(),a||(a=!0,s.close())}}))}function yg(){this._listeners={}}function zm(e){return"undefined"!=typeof Float32Array?function(){function t(e,t,n){o[0]=e,t[n]=s[0],t[n+1]=s[1],t[n+2]=s[2],t[n+3]=s[3]}function n(e,t,n){o[0]=e,t[n]=s[3],t[n+1]=s[2],t[n+2]=s[1],t[n+3]=s[0]}function r(e,t){return s[0]=e[t],s[1]=e[t+1],s[2]=e[t+2],s[3]=e[t+3],o[0]}function i(e,t){return s[3]=e[t],s[2]=e[t+1],s[1]=e[t+2],s[0]=e[t+3],o[0]}var o=new Float32Array([-0]),s=new Uint8Array(o.buffer),a=128===s[3];e.writeFloatLE=a?t:n,e.writeFloatBE=a?n:t,e.readFloatLE=a?r:i,e.readFloatBE=a?i:r}():function(){function t(e,t,n,r){var i=0>t?1:0;if(i&&(t=-t),0===t)e(0<1/t?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(34028234663852886e22<t)e((i<<31|2139095040)>>>0,n,r);else if(11754943508222875e-54>t)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){return n=e(t,n),e=2*(n>>31)+1,t=n>>>23&255,n&=8388607,255===t?n?NaN:1/0*e:0===t?1401298464324817e-60*e*n:e*Math.pow(2,t-150)*(n+8388608)}e.writeFloatLE=t.bind(null,Am),e.writeFloatBE=t.bind(null,Bm),e.readFloatLE=n.bind(null,Cm),e.readFloatBE=n.bind(null,Dm)}(),"undefined"!=typeof Float64Array?function(){function t(e,t,n){o[0]=e,t[n]=s[0],t[n+1]=s[1],t[n+2]=s[2],t[n+3]=s[3],t[n+4]=s[4],t[n+5]=s[5],t[n+6]=s[6],t[n+7]=s[7]}function n(e,t,n){o[0]=e,t[n]=s[7],t[n+1]=s[6],t[n+2]=s[5],t[n+3]=s[4],t[n+4]=s[3],t[n+5]=s[2],t[n+6]=s[1],t[n+7]=s[0]}function r(e,t){return s[0]=e[t],s[1]=e[t+1],s[2]=e[t+2],s[3]=e[t+3],s[4]=e[t+4],s[5]=e[t+5],s[6]=e[t+6],s[7]=e[t+7],o[0]}function i(e,t){return s[7]=e[t],s[6]=e[t+1],s[5]=e[t+2],s[4]=e[t+3],s[3]=e[t+4],s[2]=e[t+5],s[1]=e[t+6],s[0]=e[t+7],o[0]}var o=new Float64Array([-0]),s=new Uint8Array(o.buffer),a=128===s[7];e.writeDoubleLE=a?t:n,e.writeDoubleBE=a?n:t,e.readDoubleLE=a?r:i,e.readDoubleBE=a?i:r}():function(){function t(e,t,n,r,i,o){var s=0>r?1:0;if(s&&(r=-r),0===r)e(0,i,o+t),e(0<1/r?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(17976931348623157e292<r)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+n);else if(22250738585072014e-324>r)e((r/=5e-324)>>>0,i,o+t),e((s<<31|r/4294967296)>>>0,i,o+n);else{var a=Math.floor(Math.log(r)/Math.LN2);1024===a&&(a=1023),e(4503599627370496*(r*=Math.pow(2,-a))>>>0,i,o+t),e((s<<31|a+1023<<20|1048576*r&1048575)>>>0,i,o+n)}}function n(e,t,n,r,i){return t=e(r,i+t),r=e(r,i+n),e=2*(r>>31)+1,t=4294967296*(1048575&r)+t,2047===(n=r>>>20&2047)?t?NaN:1/0*e:0===n?5e-324*e*t:e*Math.pow(2,n-1075)*(t+4503599627370496)}e.writeDoubleLE=t.bind(null,Am,0,4),e.writeDoubleBE=t.bind(null,Bm,4,0),e.readDoubleLE=n.bind(null,Cm,0,4),e.readDoubleBE=n.bind(null,Dm,4,0)}(),e}function Am(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function Bm(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function Cm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Dm(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function Wa(e,t){this.lo=e>>>0,this.hi=t>>>0}function sf(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function si(){}function Tt(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(e,t,n){t[n]=255&e}function ui(e,t){this.len=e,this.next=void 0,this.val=t}function vi(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo>>>=7;t[n++]=e.lo}function wi(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function jc(){xi.call(this)}function Ut(e,t,n){40>e.length?V.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}function Yb(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function La(e){this.buf=e,this.pos=0,this.len=e.length}function yi(){var e=new Em(0,0),t=0;if(!(4<this.len-this.pos)){for(;3>t;++t){if(this.pos>=this.len)throw Yb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(t=0,4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>t;++t){if(this.pos>=this.len)throw Yb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function zg(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(e){zi.call(this,e)}function tf(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}function za(e){return"string"==typeof e&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&"null"!==e}function Gm(e){try{var t=e.split(".").map((function(e){return Number(e)}))}catch(e){return!1}if(4!==t.length||0===t[0])return!1;for(e=0;e<t.length;e++){var n=t[e];if(!Number.isInteger(n)||0>n||255<n)return!1}return!0}function Hm(e,t){if(!Array.isArray(t)||0===t.length||32<t.length||t.some((function(e){return 0===e.length||32<e.length})))throw new I("arguments is not valid",Ja);if(!za(e))throw new I("ID is invalid",Ja)}function uf(e){var t=e.attributes,n=e.attrSizeMap,r=e.maxAttrsCount,i=e.maxAttrValueSize;if(e=e.maxTotalSize,!yd(t))throw new I("attributes must be an object",Ja);if(Object.keys(t).length>r)throw new ib("Exceed the limit of ".concat(r," attributes"),se);if(0===Object.keys(t).length)throw new I("The attributes is an empty object",Ja);var o=0,s=0;for(t=Object.entries(t);s<t.length;s++){var a=ra(t[s],2),c=a[1];a=new Blob([a[0]]).size;var u=new Blob([c]).size;if(0===a||32<a)throw new I("Invalid attribute key",Ja);if(u>i)throw new ib("Invalid attribute value, over the limit of ".concat(i," bytes"),se);if("string"!=typeof c||0===c.length)throw new I("Invalid attribute value",Ja);o+=a,o+=u}if(o>e)throw new ib("The attributes size overflow",se);if(void 0!==n){if(Object.keys(n).length>r)throw new ib("Exceed the limit of ".concat(r," attributes"),se);for(o=r=0,n=Object.entries(n);o<n.length;o++){if(s=(t=ra(n[o],2))[1],0===(t=new Blob([t[0]]).size))throw new I("Invalid attribute key",Ja);if(s>i)throw new ib("Invalid attribute value, over the limit of ".concat(i," bytes"),se);r+=t,r+=s}if(r>e)throw new ib("The attributes size overflow",se)}}function Ag(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)+1))+e}function Bg(){var e=Ag(0,4294967295),t=Ag(1,4294967295);return new U(e,t,!0)}function Xa(e){return e.toString().padEnd(32,"0")}function Im(e,t){return new TypeError("Unexpected ".concat(e,": ").concat(t))}function Jm(e,t){return e=e.split(".").map((function(e){return Number(e)})),t=t.split(".").map((function(e){return Number(e)})),Math.sqrt(1e3*Math.pow(e[0]-t[0],2)+100*Math.pow(e[1]-t[1],2)+10*Math.pow(e[2]-t[2],2)+1*Math.pow(e[3]-t[3],2))}function Km(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function Ai(e,t){t="".concat(e).concat(t||"");var n=Lm.get(t)||1;return Lm.set(t,n+1),"".concat(e).concat(n)}function Mm(e,t){var n="number"==typeof t?t:void 0!==t&&"string"!=typeof t?t.code:void 0;return t="number"!=typeof t&&"string"!=typeof t&&void 0!==t&&void 0!==t.serverCode?t.serverCode:void 0,n="".concat(void 0!==n?" Error Code ".concat(n):"").concat(void 0!==t?", server Code ".concat(t):""),e="string"==typeof e&&e?Cg(e):Array.isArray(e)&&"string"==typeof e[0]&&e[0]?Cg(Nm.apply(void 0,[e[0]].concat(G(e.slice(1))))):"","".concat(""===n?"":"".concat(n," - ")).concat(e)}function Om(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pm(e){return e instanceof Blob||"[object Blob]"===Object.prototype.toString.call(e)}function Dg(e){var t=255&e,n=e>>8&255,r=e>>16&255;return"".concat(e>>24&255,".").concat(r,".").concat(n,".").concat(t)}function te(e,t,n){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark((function e(t,n,r){var i,o,s,a,c,u,l,d,h,p,f,m,g,_,E,v,y,b,T,S,R,I,C,A,O,N;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.body,o=n.headers,s=void 0===o?{}:o,a=n.timeout,c=void 0===a?1e4:a,u=n.signal,l=n.withCredentials,d=void 0!==l&&l,h=(r||{}).useBinaryResponse,p=void 0!==h&&h,(f=new XMLHttpRequest).open("POST",t,!0),f.responseType=p?"arraybuffer":"text",f.withCredentials=d,f.timeout=c,m=i instanceof FormData,g=i instanceof Uint8Array,!(1<(_=Object.keys(s).filter((function(e){return"content-type"===e.toLowerCase()}))).length)){e.next=14;break}throw new RangeError("multiple content-type");case 14:0===_.length&&(g?s["Content-Type"]="application/octet-stream":m||(s["Content-Type"]="application/json"));case 15:if("setRequestHeader"in f){e.next=46;break}return f.abort(),e.next=19,fetch(t,{body:m||g?i:JSON.stringify(i),cache:"no-cache",credentials:d?"include":"same-origin",headers:s,method:"POST",mode:"cors",referrer:"no-referrer",signal:u});case 19:if(E=e.sent,!(200<=(v=E.status)&&300>v||304===v)){e.next=31;break}if(!p){e.next=27;break}return e.next=25,E.arrayBuffer();case 25:return y=e.sent,e.abrupt("return",{status:v,responseData:y});case 27:return e.next=29,E.text();case 29:return b=e.sent,e.abrupt("return",{status:v,responseText:b});case 31:return T=new da(["Post XHR failure, status %d",v]),e.prev=32,e.next=35,E.text();case 35:throw S=e.sent,T.statusCode=v,T.message=S||"Request failed, status ".concat(v),T;case 41:throw e.prev=41,e.t0=e.catch(32),T.statusCode=v,T.message="Request failed, status ".concat(v),T;case 46:if(0!==Object.keys(s).length)for(R=0,I=Object.entries(s);R<I.length;R++)C=ra(I[R],2),A=C[0],O=C[1],f.setRequestHeader(A,O);return void 0!==u&&(N=function e(){f.abort(),u.removeEventListener("abort",e)},u.addEventListener("abort",N)),m||g?f.send(i):f.send(JSON.stringify(i)),e.abrupt("return",new Promise((function(e,t){f.onload=function(){var n=f.status;if(200<=n&&300>n||304===n)e(p?{status:n,responseData:f.response}:{status:n,responseText:f.responseText});else{var r=new da(["Post XHR failure, status %d",n]);r.statusCode=n,r.message=f.response||"Request failed, status ".concat(f.status),t(r)}},f.ontimeout=function(e){t(new db(["XHR request timed out after %d ms",c],{originalError:e}))},f.onerror=function(){var e=new da(["Post XHR failure, status %d",f.status]);e.statusCode=f.status,e.message=f.response||"Request failed, status ".concat(f.status),t(e)},f.onabort=function(){try{t(new DOMException("The request aborted.","AbortError"))}catch(n){var e=Error("The request aborted.");e.name="AbortError",t(e)}}})));case 50:case"end":return e.stop()}}),e,null,[[32,41]])})))).apply(this,arguments)}function Rm(e){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark((function e(t){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Image).src=t,e.abrupt("return",new Promise((function(e,t){n.onload=function(){e({width:n.width,height:n.height})},n.onerror=t})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xt(e,t){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark((function e(t,n){var r,i,o,s,a,c,u,l,d,h;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.thumbnailHeight,i=void 0===r?0:r,o=t.thumbnailWidth,s=void 0===o?0:o,a=t.width,c=void 0===a?0:a,u=t.height,l=void 0===u?0:u,d=t.thumbnail,h=[],"number"==typeof i&&"number"==typeof s&&"number"==typeof c&&"number"==typeof l){e.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=c&&0>=l&&h.push(Rm(Sm(n)).then((function(e){c=e.width,l=e.height}))),0>=s&&0>=i&&void 0!==d&&h.push(Ji(d).then(function(){var e=J(w.mark((function e(t){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rm(Sm(t));case 2:n=e.sent,s=n.width,i=n.height;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.next=9,Promise.all(h).catch((function(){}));case 9:return e.abrupt("return",{width:c,height:l,thumbnailWidth:s,thumbnailHeight:i});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tm(e,t){if(!yd(e))throw new I("message object is not a plain object",t);if(void 0===e.messageType)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",void 0!==e.text)throw new I("Raw messages cannot have text property. Use description instead",t)}else{if("string"!=typeof e.text)throw new I("messageType is undefined",t);if(e.messageType="TEXT",void 0!==e.rawMessage)throw new I("Text messages cannot have rawMessage property",t)}}function Gg(e){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark((function e(t){var n,r,i,o,s,a,c,u,l,d,h,p,f,m,g,_,E,v,y,b,T;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.message,r=t.peerId,i=t.toPeer,o=t.session,s=t.errorCodes,a=t.diff,c=t.logger,u=t.options,void 0!==o){e.next=3;break}throw new K("The client is not logged in. Cannot do the operation",s.NOT_LOGGED_IN);case 3:if(l=!1,"TEXT"!==n.messageType||!n.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i){e.next=11;break}if(d=n.text.split("_"),h=ra(d,3),p=h[0],f=h[1],void 0!==h[2]&&za(f)&&"AgoraRTMLegacyEndcallCompatibleMessagePrefix"===p){e.next=10;break}throw new I("Message is not valid",ve);case 10:l=!0;case 11:if(m=Date.now(),g=o.messageSentTimes.length-1,!((_=o.messageSentTimes[g])&&_+3e3<m)){e.next=18;break}o.messageSentTimes=[m],e.next=29;break;case 18:E=g;case 19:if(!(0<=E)){e.next=28;break}if(!(o.messageSentTimes[E]+3e3<m)){e.next=23;break}return o.messageSentTimes=o.messageSentTimes.slice(E+1,g+1),e.abrupt("break",28);case 23:if(!(180<=g-E+1)){e.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",s.TOO_OFTEN);case 25:E--,e.next=19;break;case 28:o.messageSentTimes.push(m);case 29:e.t0=n.messageType,e.next="TEXT"===e.t0?32:"RAW"===e.t0?37:"FILE"===e.t0||"IMAGE"===e.t0?39:40;break;case 32:if(!l){e.next=36;break}return v=n.text.split("_"),y=ra(v,3),b=y[1],T=y[2],c.info("[rtm-API] EndCall message send api is called"),e.abrupt("return",o.sendInvitationMessage({peerId:r,type:"CallCancel",extra:T,channelId:b,callId:"0"}));case 36:return e.abrupt("return",o.sendTextMessage(n.text,r,i,u,1e4-a));case 37:return void 0===n.description&&(n.description=""),e.abrupt("return",o.sendRawMessage(n.rawMessage,n.description,r,i,u,1e4-a));case 39:return e.abrupt("return",o.sendMediaMessage(n.messageType,n,r,i,u,1e4-a));case 40:throw new I("Invalid message type",ve);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yt(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e.replace(/(https?:\/\/)?(www.)?/i,"");return t||(n=n.split(".").slice(e.length-2).join(".")),-1!==n.indexOf("/")?n.split("/")[0]:n}function oa(e){if("string"!=typeof e)return"[Sensitive Info]";var t=Math.floor(.7*e.length),n=e.length;return Um(e,t,n,"*".repeat(n-t))}function Vm(e,t,n){function r(i){if(void 0===e)return e;if(Il(i))return i;if(Array.isArray(i))return i.map(r);var o={},s=0;for(i=Hg(i);s<i.length;s++){var a=ra(i[s],2),c=a[0];if("string"==typeof(a=a[1])&&n.includes(c)){o[c]="string"==typeof a?oa(a):"[Sensitive Info]";break}t.includes(c)?o[c]="[Hidden Info]":o[c]=null==a?a:n.includes(c)?"[Sensitive Info]":r(a)}return o}return Array.isArray(e)?e.map(r):r(e)}function Wm(e){return Object.getOwnPropertyNames(e).forEach((function(t){"object"==X(t=e[t])&&null!==t&&Wm(t)})),Object.freeze(e)}function pa(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function Ig(e){return(new TextEncoder).encode(e).length}function Xm(){for(var e=0,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e+=n[t].length;for(e=new Uint8Array(e),r=t=0;r<n.length;r++){var i=n[r];e.set(i,t),t+=i.length}return e}function we(e,t,n){var r=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=null==r?void 0:r[1],r=null==r?void 0:r[2]){var i;for(r=r.substr(1).split("&"),i=0;i<r.length;i++)if(r[i].split("=")[0]==t){r[i]=t+"="+encodeURIComponent(n);break}return i==r.length&&r.push(t+"="+encodeURIComponent(n)),e+"?"+r.join("&")}return e+"?"+t+"="+encodeURIComponent(n)}function Ji(e){return new Promise((function(t,n){var r=new FileReader;r.onloadend=function(){var e=r.result||new ArrayBuffer(0);t(e)},r.onerror=n,r.readAsArrayBuffer(e)}))}function Zt(e,t){e=e=[e],"string"==typeof(t=t||{})&&(t={type:t});try{var n=new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder);for(var r=0;r<e.length;r+=1)n.append(e[r]);n=n.getBlob(t.type)}return n}function Um(e,t,n,r){return"string"!=typeof e?"[Sensitive Info]":e.substring(0,t)+r+e.substring(n)}function Ym(e){var t=[];return function e(n){if(null===n||"object"!==X(n))return n;if(-1!==t.indexOf(n))return"[Circular]";if(t.push(n),"function"==typeof n.toJSON)try{var r=e(n.toJSON());return t.pop(),r}catch(e){return"[Throws: "+(e?e.message:"?")+"]"}return Array.isArray(n)?(r=n.map(e),t.pop(),r):(r=Object.keys(n).reduce((function(t,r){e:{if($t.call(n,r))try{var i=n[r];break e}catch(e){i="[Throws: "+(e?e.message:"?")+"]";break e}i=n[r]}return t[r]=e(i),t}),{}),t.pop(),r)}(e)}function au(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var t=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*t;case"weeks":case"week":case"w":return 6048e5*t;case"days":case"day":case"d":return 864e5*t;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*t;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t}}}function Jg(e,t,n,r){return Math.round(e/n)+" "+r+(t>=1.5*n?"s":"")}function bu(e){var t=e.areas,n=e.excludedArea;if(1===t.length&&t[0]===F.GLOBAL&&n===F.CHINA)return xe([F.OVERSEA]);if(t.includes(F.GLOBAL)){if(e=xf(Kg).filter((function(e){return e!==F.GLOBAL&&e!==F.OVERSEA})),n in yf){t=yf[n];var r=[].concat(G(null!=t?t:[]),[n]);return xe(e.filter((function(e){return!r.includes(e)})))}if(Zm(n)){var i=cu(n);return xe(e.filter((function(e){return e!==n&&e!==i})))}}if(Zm(n)||n in yf)return xe(t);throw new I("Invalid excludedArea area config")}function Ma(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(G(i.map(ye))));try{var s=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(G(i.map(ye)))),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var a=Date.now();return J(w.mark((function n(){var r,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(G(i.map(ye)))),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==s?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-a):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-a,ye(r)):"Object"!==Ac(r)||yd(r)?e.resultTracker("%s result is %o",t,ye(r)):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),s},n}function Nb(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(i));try{var s=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var a=Date.now();return J(w.mark((function n(){var r,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==s?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-a):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-a,r):"Object"!==Ac(r)||yd(r)?e.resultTracker("%s result is %o",t,r):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),s},n}function du(e,t){var n="".concat(e,"Uri");if("number"!=typeof(n=Li[n])||0===n)throw new TypeError("Got Unknown URI Name");return t=new(e=$m[e])(t),t=e.encode(t).finish(),new eu({uri:n,data:t})}function an(e,t){return"".concat(e.split(".").join("-"),".edge.").concat(t?"sd-rtn.com":"agora.io")}function eb(e,t,n){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark((function e(t,n,r){var i,o;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:return i=fu[t].encode(n).finish(),o=function(){var e=J(w.mark((function e(n){var s,a,c,u=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(3<(a=1<u.length&&void 0!==u[1]?u[1]:0))){e.next=3;break}return e.abrupt("return");case 3:return c=we(c=r?"https://".concat(null!==(s=null==M?void 0:M.PROXY_NGINX[0])&&void 0!==s?s:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(n,"&p=6443&d=events/proto-raw"):"https://".concat(n,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),c=we(c,"id",gu[t].toString()),e.next=8,te(c,{body:i,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch((function(e){return o(n,a+1)}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=4,e.next=7,o((null==M?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(4),e.next=13,o(M&&bn(1<(null==M?void 0:M.EVENT_REPORT_DOMAIN.length)?null==M?void 0:M.EVENT_REPORT_DOMAIN.slice(1):null==M?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return e.stop()}}),e,null,[[4,9]])})))).apply(this,arguments)}function fb(e){return void 0===e?U.fromNumber(0):U.fromNumber(Date.now()-e)}function hu(e){return btoa(String.fromCharCode.apply({},e.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map((function(e){return parseInt(e,16)})))).replace(/={1,2}$/,"")}function Lg(e,t){return U.fromValue(e).eq(t)}function Mg(e,t){var n=void 0===t?e.val:t,r=e.isBoolean;t=e.isNumber;var i=e.oneof,o=e.len;if(2!==[r,t,i].filter((function(e){return!e})).length)throw new TypeError("invalid field type");if(void 0!==n&&(e=!1,void 0!==i&&(i=Ni(i),iu(i,Lg).length===i.length&&void 0!==ju(i,(function(e){return Lg(n,e)}))&&(e=!0)),r=void 0!==r&&(0===n||1===n)&&1===o,t=void 0!==t&&n.toString(2).length<=o,!(e||r||t)))throw Error("invalid field value")}function cn(e){return function(){var t=e();if(!t)throw new K("Client is not logged in. Cannot do the operation");return t}}var Ya="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof __webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},Ng=function(e){return e&&e.Math==Math&&e},y=Ng("object"==typeof globalThis&&globalThis)||Ng("object"==typeof window&&window)||Ng("object"==typeof self&&self)||Ng("object"==typeof Ya&&Ya)||function(){return this}()||Function("return this")(),R=function(e){try{return!!e()}catch(e){return!0}},ka=!R((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(e){return!!(e=en(this,e))&&e.enumerable}:dn,dd=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ku={}.toString,Zb=function(e){return ku.call(e).slice(8,-1)},lu="".split,Af=R((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==Zb(e)?lu.call(e,""):Object(e)}:Object,jb=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},qb=function(e){return Af(jb(e))},ha=function(e){return"object"==typeof e?null!==e:"function"==typeof e},lc=function(e,t){if(!ha(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!ha(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Qa=function(e){return Object(jb(e))},mu={}.hasOwnProperty,Q=function(e,t){return mu.call(Qa(e),t)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R((function(){return 7!=Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a})),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(e,t){if(e=qb(e),t=lc(t,!0),fn)try{return gn(e,t)}catch(e){}if(Q(e,t))return dd(!zf.call(e,t),e[t])}},va=function(e){if(!ha(e))throw TypeError(String(e)+" is not an object");return e},hn=Object.defineProperty,Ra={f:ka?hn:function(e,t,n){if(va(e),t=lc(t,!0),va(n),fn)try{return hn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},Na=ka?function(e,t,n){return Ra.f(e,t,dd(1,n))}:function(e,t,n){return e[t]=n,e},Oi=function(e,t){try{Na(y,e,t)}catch(n){y[e]=t}return t},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;"function"!=typeof ed.inspectSource&&(ed.inspectSource=function(e){return nu.call(e)});var Pi=ed.inspectSource,jn=y.WeakMap,ou="function"==typeof jn&&/native code/.test(Pi(jn)),fd=$a((function(e){(e.exports=function(e,t){return ed[e]||(ed[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"\xa9 2021 Denis Pushkarev (zloirock.ru)"})})),pu=0,qu=Math.random(),Ae=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(e){return kn[e]||(kn[e]=Ae(e))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(e,t){if(ln.call(Gd,e))throw new TypeError("Object already initialized");return t.facade=e,tu.call(Gd,e,t),t},Qg=function(e){return su.call(Gd,e)||{}},Ri=function(e){return ln.call(Gd,e)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(e,t){if(Q(e,Ce))throw new TypeError("Object already initialized");return t.facade=e,Na(e,Ce,t),t},Qg=function(e){return Q(e,Ce)?e[Ce]:{}},Ri=function(e){return Q(e,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(e){return Ri(e)?Qg(e):Qi(e,{})},getterFor:function(e){return function(t){var n;if(!ha(t)||(n=Qg(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Ta=$a((function(e){var t=Za.get,n=Za.enforce,r=String(String).split("String");(e.exports=function(e,t,i,o){var s=!!o&&!!o.unsafe,a=!!o&&!!o.enumerable;if(o=!!o&&!!o.noTargetGet,"function"==typeof i){"string"!=typeof t||Q(i,"name")||Na(i,"name",t);var c=n(i);c.source||(c.source=r.join("string"==typeof t?t:""))}e===y?a?e[t]=i:Oi(t,i):(s?!o&&e[t]&&(a=!0):delete e[t],a?e[t]=i:Na(e,t,i))})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||Pi(this)}))})),mn=function(e){return"function"==typeof e?e:void 0},mc=function(e,t){return 2>arguments.length?mn(y[e])||mn(y[e]):y[e]&&y[e][t]||y[e]&&y[e][t]},uu=Math.ceil,vu=Math.floor,$b=function(e){return isNaN(e=+e)?0:(0<e?vu:uu)(e)},wu=Math.min,ta=function(e){return 0<e?wu($b(e),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(e,t){return 0>(e=$b(e))?xu(e+t,0):yu(e,t)},nn=function(e){return function(t,n,r){t=qb(t);var i=ta(t.length);if(r=xb(r,i),e&&n!=n){for(;i>r;)if((n=t[r++])!=n)return!0}else for(;i>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},on=nn(!0),Si=nn(!1),pn=function(e,t){e=qb(e);var n,r=0,i=[];for(n in e)!Q(Be,n)&&Q(e,n)&&i.push(n);for(;t.length>r;)Q(e,n=t[r++])&&(~Si(i,n)||i.push(n));return i},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(e){return pn(e,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(e){var t=Hd.f(va(e)),n=Bf.f;return n?t.concat(n(e)):t},rn=function(e,t){for(var n=qn(t),r=Ra.f,i=Fb.f,o=0;o<n.length;o++){var s=n[o];Q(e,s)||r(e,s,i(t,s))}},Au=/#|\.prototype\./,nc=function(e,t){return(e=Bu[Cu(e)])==Du||e!=Eu&&("function"==typeof t?R(t):!!t)},Cu=nc.normalize=function(e){return String(e).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(e,t){var n,r,i,o=e.target,s=e.global,a=e.stat;if(r=s?y:a?y[o]||Oi(o,{}):(y[o]||{}).prototype)for(i in t){var c=t[i],u=e.noTargetGet?(n=Fu(r,i))&&n.value:r[i];if(!(n=nc(s?i:o+(a?".":"#")+i,e.forced))&&void 0!==u){if(typeof c==typeof u)continue;rn(c,u)}(e.sham||u&&u.sham)&&Na(c,"sham",!0);try{Ta(r,i,c,e)}catch(e){}}},yb=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Id=function(e,t,n){if(yb(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},gd=Array.isArray||function(e){return"Array"==Zb(e)},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R((function(){return!String(Symbol())||!Symbol.sham&&id&&41>id})),vn=oc&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(e){return Q(Cf,e)&&(oc||"string"==typeof Cf[e])||(oc&&Q(Df,e)?Cf[e]=Df[e]:Cf[e]=Gu("Symbol."+e)),Cf[e]},Hu=qa("species"),Sg=function(e,t){if(gd(e)){var n=e.constructor;"function"!=typeof n||n!==Array&&!gd(n.prototype)?ha(n)&&null===(n=n[Hu])&&(n=void 0):n=void 0}return new(void 0===n?Array:n)(0===t?0:t)},wn=[].push,jd=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,u,l,d){var h=Qa(c),p=Af(h);u=Id(u,l,3),l=ta(p.length);var f,m=0;for(d=d||Sg,c=t?d(c,l):n||s?d(c,0):void 0;l>m;m++)if((a||m in p)&&(f=u(d=p[m],m,h),e))if(t)c[m]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return m;case 2:wn.call(c,d)}else switch(e){case 4:return!1;case 7:wn.call(c,d)}return o?-1:r||i?i:c}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6);jd(7);var Ku=qa("species"),Ef=function(e){return 51<=id||!R((function(){var t=[];return(t.constructor={})[Ku]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(e){return yn(this,e,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(e){return pn(e,Rg)},Mu=R((function(){Dc(1)}));N({target:"Object",stat:!0,forced:Mu},{keys:function(e){return Dc(Qa(e))}});var Ee=function(e,t){var n=[][e];return!!n&&R((function(){n.call(null,t||function(){throw 1},1)}))},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(e){return Nu.call(qb(this),void 0===e?",":e)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(e){return xn(this,e,1<arguments.length?arguments[1]:void 0)}});var Ui=function(e){var t=e.return;if(void 0!==t)return va(t.call(e)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(e){return void 0!==e&&(Fe.Array===e||Su[Ru]===e)},Ge=function(e,t,n){(t=lc(t))in e?Ra.f(e,t,dd(0,n)):e[t]=n},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi="[object z]"===String(Bn),Uu=qa("toStringTag"),Vu="Arguments"==Zb(function(){return arguments}()),Ff=Wi?Zb:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[Uu];break e}catch(e){}r=void 0}r="string"==typeof(n=r)?n:Vu?Zb(e):"Object"==(t=Zb(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},Wu=qa("iterator"),Xi=function(e){if(null!=e)return e[Wu]||e["@@iterator"]||Fe[Ff(e)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,(function(){throw 2}))}catch(c){}var Tg=function(e,t){if(!t&&!Dn)return!1;var n=!1;try{(t={})[Cn]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(e){}return n},Yu=!Tg((function(e){Array.from(e)}));N({target:"Array",stat:!0,forced:Yu},{from:function(e){var t,n=Qa(e),r="function"==typeof this?this:Array,i=arguments.length,o=1<i?arguments[1]:void 0,s=void 0!==o,a=Xi(n),c=0;if(s&&(o=Id(o,2<i?arguments[2]:void 0,2)),null==a||r==Array&&Vi(a)){var u=ta(n.length);for(r=new r(u);u>c;c++)a=s?o(n[c],c):n[c],Ge(r,c,a)}else for(i=(n=a.call(n)).next,r=new r;!(t=i.call(n)).done;c++){if(s){a=n;var l=o;t=[t.value,c];try{u=l(va(t)[0],t[1])}catch(e){throw Ui(a),e}}else u=t.value;Ge(r,c,a=u)}return r.length=c,r}});var Fn=function(e){return function(t,n){t=String(jb(t)),n=$b(n);var r,i=t.length;if(0>n||n>=i)return e?"":void 0;var o=t.charCodeAt(n);return 55296>o||56319<o||n+1===i||56320>(r=t.charCodeAt(n+1))||57343<r?e?t.charAt(n):o:e?t.slice(n,n+2):r-56320+(o-55296<<10)+65536}};Fn(!1);var Gn=Fn(!0),Hn=!R((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(e){return e=Qa(e),Q(e,In)?e[In]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(null==Kd||R((function(){var e={};return Kd[Yi].call(e)!==e})))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(e,t){va(e);for(var n,r=Dc(t),i=r.length,o=0;i>o;)Ra.f(e,n=r[o++],t[n]);return e},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch(e){}if(aj){var e=aj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(Wg=e,e=Rg.length;e--;)delete Wg.prototype[Rg[e]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(e,t){if(null!==e){$i.prototype=va(e);var n=new $i;$i.prototype=null,n[Mn]=e}else n=Wg();return void 0===t?n:av(n,t)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(e,t,n){e&&!Q(e=n?e:e.prototype,Nn)&&bv(e,Nn,{configurable:!0,value:t})},cv=function(){return this},dv=function(e,t,n){return t+=" Iterator",e.prototype=ac(Ug,{next:dd(1,n)}),Ec(e,t,!1),Fe[t]=cv,e},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,t={};try{var n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n.call(t,[]),e=t instanceof Array}catch(e){}return function(t,r){if(va(t),!ha(r)&&null!==r)throw TypeError("Can't set "+String(r)+" as a prototype");return e?n.call(t,r):t.__proto__=r,t}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(e,t,n,r,i,o,s){dv(n,t,r),r=function(e){if(e===i&&h)return h;if(!Vg&&e in l)return l[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var a,c=t+" Iterator",u=!1,l=e.prototype,d=l[Gf]||l["@@iterator"]||i&&l[i],h=!Vg&&d||r(i),p="Array"==t&&l.entries||d;if(p&&(e=Vb(p.call(new e)),Ug!==Object.prototype&&e.next&&(Vb(e)!==Ug&&(Ua?Ua(e,Ug):"function"!=typeof e[Gf]&&Na(e,Gf,ev)),Ec(e,c,!0))),"values"==i&&d&&"values"!==d.name&&(u=!0,h=function(){return d.call(this)}),l[Gf]!==h&&Na(l,Gf,h),Fe[t]=h,i){var f={values:r("values"),keys:o?h:r("keys"),entries:r("entries")};if(s)for(a in f)!Vg&&!u&&a in l||Ta(l,a,f[a]);else N({target:t,proto:!0,forced:Vg||u},f)}return f},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",(function(e){fv(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e=gv(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=Gn(t,n),e.index+=t.length,{value:t,done:!1})}));var cj=qa("unscopables"),dj=Array.prototype;null==dj[cj]&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(e){dj[cj][e]=!0},On=!0;"find"in[]&&Array(1).find((function(){On=!1})),N({target:"Array",proto:!0,forced:On},{find:function(e){return zn(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(e){var t=String(jb(this)),n="";if(0>(e=$b(e))||1/0==e)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(t+=t))1&e&&(n+=t);return n};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(e,t,n){for(var r in t)Ta(e,r,t[r],n);return e},Qn=qa("species"),If=function(e){e=mc(e);var t=Ra.f;ka&&e&&!e[Qn]&&t(e,Qn,{configurable:!0,get:function(){return this}})},Gc=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Jf=function(e,t){this.stopped=e,this.result=t},Xg=function(e,t,n){var r,i=!(!n||!n.AS_ENTRIES),o=!(!n||!n.IS_ITERATOR),s=!(!n||!n.INTERRUPTED),a=Id(t,n&&n.that,1+i+s),c=function(e){return u&&Ui(u),new Jf(!0,e)};if(t=function(e){return i?(va(e),s?a(e[0],e[1],c):a(e[0],e[1])):s?a(e,c):a(e)},o)var u=e;else{if("function"!=typeof(o=Xi(e)))throw TypeError("Target is not iterable");if(Vi(o)){for(o=0,n=ta(e.length);n>o;o++)if((r=t(e[o]))&&r instanceof Jf)return r;return new Jf(!1)}u=o.call(e)}for(e=u.next;!(o=e.call(u)).done;){try{r=t(o.value)}catch(e){throw Ui(u),e}if("object"==typeof r&&r&&r instanceof Jf)return r}return new Jf(!1)},iv=qa("species"),kd=function(e,t){var n;return void 0===(e=va(e).constructor)||null==(n=va(e)[iv])?t:yb(n)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc="process"==Zb(y.process),Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(e){if(Kf.hasOwnProperty(e)){var t=Kf[e];delete Kf[e],t()}},ij=function(e){return function(){hj(e)}},Un=function(e){hj(e.data)},Vn=function(e){y.postMessage(e+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Kf[++gj]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Lf(gj),gj},Sn=function(e){delete Kf[e]},Hc)var Lf=function(e){jv.nextTick(ij(e))};else if(fj&&fj.now)Lf=function(e){fj.now(ij(e))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&"function"==typeof postMessage&&!y.importScripts&&Yg&&"file:"!==Yg.protocol&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(e){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(e)}}:function(e){setTimeout(ij(e),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var e;for(Hc&&(e=$n.domain)&&e.exit();Md;){var t=Md.fn;Md=Md.next;try{t()}catch(e){throw Md?$g():Mf=void 0,e}}Mf=void 0,e&&e.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(e){e={fn:e,next:void 0},Mf&&(Mf.next=e),Md||(Md=e,$g()),Mf=e},nv=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=yb(t),this.reject=yb(n)},lj={f:function(e){return new nv(e)}},mj=function(e,t){return va(e),ha(t)&&t.constructor===e?t:((0,(e=lj.f(e)).resolve)(t),e.promise)},ov=function(e,t){var n=y.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},nj=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},pv="object"==typeof window,qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io="function"==typeof PromiseRejectionEvent,jo=!1,Nf=nc("Promise",(function(){var e=Pi(zb)!==String(zb);if(!e&&66===id)return!0;if(51<=id&&/native code/.test(zb))return!1;var t=new zb((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(t.constructor={})[qv]=n,!(jo=t.then((function(){}))instanceof n)||!e&&pv&&!io})),vv=Nf||!Tg((function(e){zb.all(e).catch((function(){}))})),ko=function(e){var t;return!(!ha(e)||"function"!=typeof(t=e.then))&&t},qj=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;fo((function(){for(var r=e.value,i=1==e.state,o=0;n.length>o;){var s,a=n[o++],c=i?a.ok:a.fail,u=a.resolve,l=a.reject,d=a.domain;try{if(c){if(i||(2===e.rejection&&wv(e),e.rejection=1),!0===c)var h=r;else if(d&&d.enter(),h=c(r),d){d.exit();var p=!0}h===a.promise?l(ho("Promise-chain cycle")):(s=ko(h))?s.call(h,u,l):u(h)}else l(r)}catch(e){d&&!p&&d.exit(),l(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&xv(e)}))}},lo=function(e,t,n){var r;if(uv){var i=oj.createEvent("Event");i.promise=t,i.reason=n,i.initEvent(e,!1,!0),y.dispatchEvent(i)}else i={promise:t,reason:n};!io&&(r=y["on"+e])?r(i):"unhandledrejection"===e&&ov("Unhandled promise rejection",n)},xv=function(e){jj.call(y,(function(){var t=e.facade,n=e.value;if(1!==e.rejection&&!e.parent){var r=nj((function(){Hc?pj.emit("unhandledRejection",n,t):lo("unhandledrejection",t,n)}));if(e.rejection=Hc||1!==e.rejection&&!e.parent?2:1,r.error)throw r.value}}))},wv=function(e){jj.call(y,(function(){var t=e.facade;Hc?pj.emit("rejectionHandled",t):lo("rejectionhandled",t,e.value)}))},Ie=function(e,t,n){return function(r){e(t,r,n)}},Je=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,qj(e,!0))},rj=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw ho("Promise can't be resolved itself");var r=ko(t);r?fo((function(){var n={done:!1};try{r.call(t,Ie(rj,n,e),Ie(Je,n,e))}catch(t){Je(n,t,e)}})):(e.value=t,e.state=1,qj(e,!1))}catch(t){Je({done:!1},t,e)}}};if(Nf){zb=function(e){Gc(this,zb,"Promise"),yb(e),sj.call(this);var t=go(this);try{e(Ie(rj,t),Ie(Je,t))}catch(e){Je(t,e)}},bh=zb.prototype;var sj=function(e){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(e,t){var n=sv(this),r=He(kd(this,zb));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Hc?pj.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&qj(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}});var yv=function(){var e=new sj,t=go(e);this.promise=e,this.resolve=Ie(rj,t),this.reject=Ie(Je,t)};if(lj.f=He=function(e){return e===zb||e===zv?new yv(e):tv(e)},"function"==typeof Fc&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",(function(e,t){var n=this;return new zb((function(e,t){Av.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch(c){}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(e){var t=He(this);return t.reject.call(void 0,e),t.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(e){return mj(this,e)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(e){var t=this,n=He(t),r=n.resolve,i=n.reject,o=nj((function(){var n=yb(t.resolve),o=[],s=0,a=1;Xg(e,(function(e){var c=s++,u=!1;o.push(void 0),a++,n.call(t,e).then((function(e){u||(u=!0,o[c]=e,--a||r(o))}),i)})),--a||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=He(t),r=n.reject,i=nj((function(){var i=yb(t.resolve);Xg(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(e){return no?mo.apply(this,arguments)||0:Si(this,e,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var e=va(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},pc=R((function(){var e=RegExp("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Cv=R((function(){var e=RegExp("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),0!==c.lastIndex||0!==a.lastIndex),po=pc||Cv,vj=void 0!==/()??/.exec("")[1],c,a;(uj||vj||po)&&(oo=function(e){var t,n=po&&this.sticky,r=tj.call(this),i=this.source,o=0,s=e;if(n){-1===(r=r.replace("y","")).indexOf("g")&&(r+="g"),s=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&"\n"!==e[this.lastIndex-1])&&(i="(?: "+i+")",s=" "+s,o++);var a=new RegExp("^(?:"+i+")",r)}if(vj&&(a=new RegExp("^"+i+"$(?!\\s)",r)),uj)var c=this.lastIndex;var u=ch.call(n?a:this,s);return n?u?(u.input=u.input.slice(o),u[0]=u[0].slice(o),u.index=this.lastIndex,this.lastIndex+=u[0].length):this.lastIndex=0:uj&&u&&(this.lastIndex=this.global?u.index+u[0].length:c),vj&&u&&1<u.length&&Dv.call(u[0],a,(function(){for(t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(u[t]=void 0)})),u});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),qo="$0"==="a".replace(/./,"$0"),ro=qa("replace"),so=!!/./[ro]&&""===/./[ro]("a","$0"),Gv=!R((function(){var e=/(?:)/,t=e.exec;return e.exec=function(){return t.apply(this,arguments)},2!==(e="ab".split(e)).length||"a"!==e[0]||"b"!==e[1]})),dh=function(e,t,n,r){var i=qa(e),o=!R((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),s=o&&!R((function(){var t=!1,n=/a/;return"split"===e&&((n={constructor:{}}).constructor[Ev]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!s||"replace"===e&&(!Fv||!qo||so)||"split"===e&&!Gv){var a=/./[i],c=(n=n(i,""[e],(function(e,t,n,r,i){var s=t.exec;return s===Of||s===wj.exec?o&&!i?{done:!0,value:a.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,e,n[0]),Ta(wj,i,2==t?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)})}r&&Na(wj[i],"sham",!0)},xj=function(e,t,n){return t+(n?Gn(e,t).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(e,t,n,r,i,o){var s=n+e.length,a=r.length,c=Kv;return void 0!==i&&(i=Qa(i),c=Jv),Iv.call(o,c,(function(o,c){switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(s);case"<":o=i[c.slice(1,-1)];break;default:var u=+c;if(0===u)return o;if(u>a)return 0===(u=Hv(u/10))?o:u<=a?void 0===r[u-1]?c.charAt(1):r[u-1]+c.charAt(1):o;o=r[u-1]}return void 0===o?"":o}))},Ke=function(e,t){var n=e.exec;if("function"==typeof n){if("object"!=typeof(e=n.call(e,t)))throw TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==Zb(e))throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(e,t)},Mv=Math.max,Nv=Math.min,Ov=function(e){return void 0===e?e:String(e)};dh("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,s=i?"$":"$0";return[function(n,r){var i=jb(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(s)){var a=n(t,e,this,r);if(a.done)return a.value}var c=va(e);e=String(this),(a="function"==typeof r)||(r=String(r));var u=c.global;if(u){var l=c.unicode;c.lastIndex=0}for(var d=[];;){var h=Ke(c,e);if(null===h)break;if(d.push(h),!u)break;""===String(h[0])&&(c.lastIndex=xj(e,ta(c.lastIndex),l))}for(l="",u=c=0;u<d.length;u++){h=d[u];for(var p=String(h[0]),f=Mv(Nv($b(h.index),e.length),0),m=[],g=1;g<h.length;g++)m.push(Ov(h[g]));h=h.groups,a?(m=[p].concat(m,f,e),void 0!==h&&m.push(h),h=String(r.apply(void 0,m))):h=Lv(p,e,f,m,h,r),f>=c&&(l+=e.slice(c,f)+h,c=f+p.length)}return l+e.slice(c)}]}));var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(e,t){var n=qb(this),r=ta(n.length);if(e=xb(e,r),t=xb(void 0===t?r:t,r),gd(n)){var i=n.constructor;if("function"!=typeof i||i!==Array&&!gd(i.prototype)?ha(i)&&null===(i=i[Qv])&&(i=void 0):i=void 0,i===Array||void 0===i)return Rv.call(n,e,t)}for(i=new(void 0===i?Array:i)(Sv(t-e,0)),r=0;e<t;e++,r++)e in n&&Ge(i,r,n[e]);return i.length=r,i}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",(function(e,t){Tv(this,{type:"Array Iterator",target:qb(e),index:0,kind:t})}),(function(){var e=Uv(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Le=function(e){if(void 0===e)return 0;e=$b(e);var t=ta(e);if(e!==t)throw RangeError("Wrong length or index");return t},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(e){var t=Qa(this),n=ta(t.length),r=arguments.length,i=xb(1<r?arguments[1]:void 0,n);for(n=void 0===(r=2<r?arguments[2]:void 0)?n:xb(r,n);n>i;)t[i++]=e;return t},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(e,t,n){var r,i=Array(n),o=(1<<(n=8*n-t-1))-1,s=o>>1,a=23===t?Ic(2,-24)-Ic(2,-77):0,c=0>e||0===e&&0>1/e?1:0,u=0;if((e=Vv(e))!=e||1/0===e){e=e!=e?1:0;var l=o}else l=Wv(Xv(e)/Yv),1>e*(r=Ic(2,-l))&&(l--,r*=2),2<=(e=1<=l+s?e+a/r:e+a*Ic(2,1-s))*r&&(l++,r/=2),l+s>=o?(e=0,l=o):1<=l+s?(e=(e*r-1)*Ic(2,t),l+=s):(e=e*Ic(2,s-1)*Ic(2,t),l=0);for(;8<=t;i[u++]=255&e,e/=256,t-=8);for(l=l<<t|e,n+=t;0<n;i[u++]=255&l,l/=256,n-=8);return i[--u]|=128*c,i},xo=function(e,t){var n=e.length,r=8*n-t-1,i=(1<<r)-1,o=i>>1;r-=7,--n;var s=e[n--],a=127&s;for(s>>=7;0<r;a=256*a+e[n],n--,r-=8);var c=a&(1<<-r)-1;for(a>>=-r,r+=t;0<r;c=256*c+e[n],n--,r-=8);if(0===a)a=1-o;else{if(a===i)return c?NaN:s?-1/0:1/0;c+=Ic(2,t),a-=o}return(s?-1:1)*c*Ic(2,a-t)},yo=function(e){return[255&e]},zo=function(e){return[255&e,e>>8&255]},Ao=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Bo=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},aw=function(e){return wo(e,23,4)},bw=function(e){return wo(e,52,8)},gh=function(e,t){$v(e.prototype,t,{get:function(){return Me(this)[t]}})},md=function(e,t,n,r){n=Le(n);var i=Me(e);if(n+t>i.byteLength)throw fh("Wrong index");return e=Me(i.buffer).bytes,n+=i.byteOffset,t=e.slice(n,n+t),r?t:t.reverse()},nd=function(e,t,n,r,i,o){n=Le(n);var s=Me(e);if(n+t>s.byteLength)throw fh("Wrong index");for(e=Me(s.buffer).bytes,n+=s.byteOffset,r=r(+i),i=0;i<t;i++)e[n+i]=r[o?i:t-i-1]};if(to){if(!R((function(){bc(1)}))||!R((function(){new bc(-1)}))||R((function(){return new bc,new bc(1.5),new bc(NaN),"ArrayBuffer"!=bc.name}))){Ab=function(e){return Gc(this,Ab),new bc(Le(e))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(e,t){Eo.call(this,e,t<<24>>24)},setUint8:function(e,t){Eo.call(this,e,t<<24>>24)}},{unsafe:!0})}else Ab=function(e){Gc(this,Ab,"ArrayBuffer"),e=Le(e),uo(this,{bytes:yj.call(Array(e),0),byteLength:e}),ka||(this.byteLength=e)},cc=function(e,t,n){Gc(this,cc,"DataView"),Gc(e,Ab,"DataView");var r=Me(e).byteLength;if(0>(t=$b(t))||t>r)throw fh("Wrong offset");if(t+(n=void 0===n?r-t:ta(n))>r)throw fh("Wrong length");uo(this,{buffer:e,byteLength:n,byteOffset:t}),ka||(this.buffer=e,this.byteLength=n,this.byteOffset=t)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(e){return md(this,1,e)[0]<<24>>24},getUint8:function(e){return md(this,1,e)[0]},getInt16:function(e){var t=md(this,2,e,1<arguments.length?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=md(this,2,e,1<arguments.length?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return xo(md(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return xo(md(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,t){nd(this,1,e,yo,t)},setUint8:function(e,t){nd(this,1,e,yo,t)},setInt16:function(e,t){nd(this,2,e,zo,t,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,t){nd(this,2,e,zo,t,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,t){nd(this,4,e,Ao,t,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,t){nd(this,4,e,Ao,t,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,t){nd(this,4,e,aw,t,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,t){nd(this,8,e,bw,t,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R((function(){return!new Aj(2).slice(1,void 0).byteLength}));N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(e,t){if(void 0!==Go&&void 0===t)return Go.call(va(this),e);var n=va(this).byteLength;e=xb(e,n),t=xb(void 0===t?n:t,n),n=new(kd(this,Aj))(ta(t-e));for(var r=new Fo(this),i=new Fo(n),o=0;e<t;)i.setUint8(o++,r.getUint8(e++));return n}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&"Opera"!==Ff(y.opera),Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(e){return!!ha(e)&&(e=Ff(e),Q(rc,e)||Q(fw,e))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||"function"!=typeof qc||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(e){if(jh(e))return e;throw TypeError("Target is not a typed array")},Ne=function(e){if(Ua){if(Ko.call(qc,e))return e}else for(var t in rc)if(Q(rc,Bb)){var n=y[t];if(n&&(e===n||Ko.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},Aa=function(e,t,n){if(ka){if(n)for(var r in rc){var i=y[r];if(i&&Q(i.prototype,e))try{delete i.prototype[e]}catch(e){}}dc[e]&&!n||Ta(dc,e,n?t:Jc&&Bj[e]||t)}},Oo=function(e,t,n){var r,i;if(ka){if(Ua){if(n)for(r in rc)if((i=y[r])&&Q(i,e))try{delete i[e]}catch(e){}if(qc[e]&&!n)return;try{return Ta(qc,e,n?t:Jc&&qc[e]||t)}catch(e){}}for(r in rc)!(i=y[r])||i[e]&&!n||Ta(i,e,t)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R((function(){Od(1)}))||!R((function(){new Od(-1)}))||!Tg((function(e){new Od,new Od(null),new Od(1.5),new Od(e)}),!0)||R((function(){return 1!==new Od(new gw(2),1,void 0).length})),kh=function(e,t){if(0>(e=$b(e)))throw RangeError("The argument can't be less than 0");if(e%t)throw RangeError("Wrong offset");return e},Ej=function(e){var t=Qa(e),n=arguments.length,r=1<n?arguments[1]:void 0,i=void 0!==r,o=Xi(t);if(null!=o&&!Vi(o)){var s=o.call(t),a=s.next;for(t=[];!(o=a.call(s)).done;)t.push(o.value)}for(i&&2<n&&(r=Id(r,arguments[2],2)),o=ta(t.length),s=new(Ne(this))(o),n=0;o>n;n++)s[n]=i?r(t[n],n):t[n];return s},lh=function(e,t,n){var r,i;return Ua&&"function"==typeof(r=t.constructor)&&r!==n&&ha(i=r.prototype)&&i!==n.prototype&&Ua(e,i),e},Sf=$a((function(e){var t=Hd.f,n=Za.get,r=Za.set,i=Ra.f,o=Fb.f,s=Math.round,a=y.RangeError,c=Pf.ArrayBuffer,u=Pf.DataView,l=function(e,t){var n=0,r=t.length;for(e=new(Ne(e))(r);r>n;)e[n]=t[n++];return e},d=function(e,t){i(e,t,{get:function(){return n(this)[t]}})},h=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=Ff(e))||"SharedArrayBuffer"==t},p=function(e,t){return jh(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},f=function(e,t){return p(e,t=lc(t,!0))?dd(2,e[t]):o(e,t)},m=function(e,t,n){return!(p(e,t=lc(t,!0))&&ha(n)&&Q(n,"value"))||Q(n,"get")||Q(n,"set")||n.configurable||Q(n,"writable")&&!n.writable||Q(n,"enumerable")&&!n.enumerable?i(e,t,n):(e[t]=n.value,e)};ka?(Qf||(Fb.f=f,Ra.f=m,d(Rf,"buffer"),d(Rf,"byteOffset"),d(Rf,"byteLength"),d(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:f,defineProperty:m}),e.exports=function(e,o,d){var p=e.match(/\d+$/)[0]/8,f=e+(d?"Clamped":"")+"Array",m="get"+e,g="set"+e,_=y[f],E=_;e=E&&E.prototype;var v={},b=function(e,t){i(e,t,{get:function(){var e=n(this);return e.view[m](t*p+e.byteOffset,!0)},set:function(e){var r=n(this);d&&(e=0>(e=s(e))?0:255<e?255:255&e),r.view[g](t*p+r.byteOffset,e,!0)},enumerable:!0})};Qf?Dj&&(E=o((function(e,t,n,r){return Gc(e,E,f),lh(ha(t)?h(t)?void 0!==r?new _(t,kh(n,p),r):void 0!==n?new _(t,kh(n,p)):new _(t):jh(t)?l(E,t):Ej.call(E,t):new _(Le(t)),e,E)})),Ua&&Ua(E,Po),Jd(t(_),(function(e){e in E||Na(E,e,_[e])})),E.prototype=e):(E=o((function(e,t,n,i){Gc(e,E,f);var o=0,s=0;if(ha(t)){if(!h(t))return jh(t)?l(E,t):Ej.call(E,t);var d=t;if(s=kh(n,p),t=t.byteLength,void 0===i){if(t%p)throw a("Wrong length");if(0>(i=t-s))throw a("Wrong length")}else if((i=ta(i)*p)+s>t)throw a("Wrong length");t=i/p}else t=Le(t),d=new c(i=t*p);for(r(e,{buffer:d,byteOffset:s,byteLength:i,length:t,view:new u(d)});o<t;)b(e,o++)})),Ua&&Ua(E,Po),e=E.prototype=ac(Rf)),e.constructor!==E&&Na(e,"constructor",E),No&&Na(e,No,f),v[f]=E,N({global:!0,forced:E!=_,sham:!Qf},v),"BYTES_PER_ELEMENT"in E||Na(E,"BYTES_PER_ELEMENT",p),"BYTES_PER_ELEMENT"in e||Na(e,"BYTES_PER_ELEMENT",p),If(f)}):e.exports=function(){}}));Sf("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var hw=Math.min,iw=[].copyWithin||function(e,t){var n=Qa(this),r=ta(n.length),i=xb(e,r),o=xb(t,r),s=2<arguments.length?arguments[2]:void 0;for(r=hw((void 0===s?r:xb(s,r))-o,r-i),s=1,o<i&&i<o+r&&(s=-1,o+=r-1,i+=r-1);0<r--;)o in n?n[i]=n[o]:delete n[i],i+=s,o+=s;return n};Aa("copyWithin",(function(e,t){return iw.call(Da(this),e,t,2<arguments.length?arguments[2]:void 0)})),Aa("every",(function(e){return Ju(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("fill",(function(e){return yj.apply(Da(this),arguments)})),Aa("filter",(function(e){var t=yn(Da(this),e,1<arguments.length?arguments[1]:void 0),n=kd(this,this.constructor),r=0,i=t.length;for(n=new(Ne(n))(i);i>r;)n[r]=t[r++];return n})),Aa("find",(function(e){return zn(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("findIndex",(function(e){return An(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("forEach",(function(e){Jd(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("includes",(function(e){return on(Da(this),e,1<arguments.length?arguments[1]:void 0)})),Aa("indexOf",(function(e){return Si(Da(this),e,1<arguments.length?arguments[1]:void 0)}));var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&("values"==Fj.name||null==Fj.name),To=function(){return jw.call(Da(this))};Aa("entries",(function(){return lw.call(Da(this))})),Aa("keys",(function(){return kw.call(Da(this))})),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",(function(e){return mw.apply(Da(this),arguments)}));var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(e){if(Uo)return Gj.apply(this,arguments)||0;var t=qb(this),n=ta(t.length),r=n-1;for(1<arguments.length&&(r=nw(r,$b(arguments[1]))),0>r&&(r=n+r);0<=r;r--)if(r in t&&t[r]===e)return r||0;return-1}:Gj;Aa("lastIndexOf",(function(e){return pw.apply(Da(this),arguments)})),Aa("map",(function(e){return xn(Da(this),e,1<arguments.length?arguments[1]:void 0,(function(e,t){return new(Ne(kd(e,e.constructor)))(t)}))}));var Vo=function(e){return function(t,n,r,i){yb(n),t=Qa(t);var o=Af(t),s=ta(t.length),a=e?s-1:0,c=e?-1:1;if(2>r)for(;;){if(a in o){i=o[a],a+=c;break}if(a+=c,e?0>a:s<=a)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=a:s>a;a+=c)a in o&&(i=n(i,o[a],a,t));return i}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",(function(e){return Wo(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)})),Aa("reduceRight",(function(e){return qw(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}));var rw=Math.floor;Aa("reverse",(function(){for(var e,t=Da(this).length,n=rw(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var sw=R((function(){new Int8Array(1).set({})}));Aa("set",(function(e){Da(this);var t=kh(1<arguments.length?arguments[1]:void 0,1),n=this.length,r=Qa(e),i=ta(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]}),sw);var tw=[].slice,uw=R((function(){new Int8Array(1).slice()}));Aa("slice",(function(e,t){e=tw.call(Da(this),e,t);var n=kd(this,this.constructor);t=0;var r=e.length;for(n=new(Ne(n))(r);r>t;)n[t]=e[t++];return n}),uw),Aa("some",(function(e){return Iu(Da(this),e,1<arguments.length?arguments[1]:void 0)}));var vw=[].sort;Aa("sort",(function(e){return vw.call(Da(this),e)})),Aa("subarray",(function(e,t){var n=Da(this),r=n.length;return e=xb(e,r),new(kd(n,n.constructor))(n.buffer,n.byteOffset+e*n.BYTES_PER_ELEMENT,ta((void 0===t?r:xb(t,r))-e))}));var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R((function(){Xo.call(new mh(1))})),yw=R((function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()}))||!R((function(){mh.prototype.toLocaleString.call([1,2])}));Aa("toLocaleString",(function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)}),yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R((function(){nh.call({})}))&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch(e){return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R((function(){return"/a/b"!=ap.call({source:"a",flags:"b"})})),Fw="toString"!=ap.name;(Ew||Fw)&&Ta(RegExp.prototype,"toString",(function(){var e=va(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in $o)?tj.call(e):n)}),{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(e,t){var n,r,i=Qa(this),o=ta(i.length),s=xb(e,o),a=arguments.length;if(0===a?a=n=0:1===a?(a=0,n=o-s):(a-=2,n=Iw(Hw($b(t),0),o-s)),9007199254740991<o+a-n)throw TypeError("Maximum allowed length exceeded");var c=Sg(i,n);for(r=0;r<n;r++){var u=s+r;u in i&&Ge(c,r,i[u])}if(c.length=n,a<n){for(r=s;r<o-n;r++){var l=r+a;(u=r+n)in i?i[l]=i[u]:delete i[l]}for(r=o;r>o-n+a;r--)delete i[r-1]}else if(a>n)for(r=o-n;r>s;r--)l=r+a-1,(u=r+n-1)in i?i[l]=i[u]:delete i[l];for(r=0;r<a;r++)i[r+s]=arguments[r+2];return i.length=o-n+a,c}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch(c){Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh])for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch(c){Kc[Oe]=ld[Oe]}}}var dp=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};dh("search",1,(function(e,t,n){return[function(t){var n=jb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;e=va(e);var i=String(this);return r=e.lastIndex,dp(r,0)||(e.lastIndex=0),i=Ke(e,i),dp(e.lastIndex,r)||(e.lastIndex=r),null===i?-1:i.index}]})),$a((function(e){!function(t,n){e.exports?e.exports=n(t):n(t)}("undefined"!=typeof self?self:Ya,(function(e){function t(e){return btoa(e).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e){return e=(e+="===").slice(0,-e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function r(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function i(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),String.fromCharCode.apply(String,e)}function o(e){var t={name:(e.name||e||"").toUpperCase().replace("V","v")};switch(t.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":e.length&&(t.length=e.length);break;case"HMAC":e.hash&&(t.hash=o(e.hash)),e.length&&(t.length=e.length);break;case"RSAES-PKCS1-v1_5":e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":e.hash&&(t.hash=o(e.hash)),e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return t}function s(e){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[e.name][(e.hash||{}).name||e.length||""]}function a(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&(e=JSON.parse(decodeURIComponent(escape(i(e)))));var t={kty:e.kty,alg:e.alg,ext:e.ext||e.extractable};switch(t.kty){case"oct":t.k=e.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach((function(n){n in e&&(t[n]=e[n])}));break;default:throw new TypeError("Unsupported key type")}return t}function c(e){var n=u(e),r=!1;if("1.2.840.113549.1.1.1"!==(2<n.length&&(r=!0,n.shift()),e={ext:!0},n[0][0]))throw new TypeError("Unsupported key type");var o="n e d p q dp dq qi".split(" ");for(n=u(n[1]),r&&n.shift(),r=0;r<n.length;r++)n[r][0]||(n[r]=n[r].subarray(1)),e[o[r]]=t(i(n[r]));return e.kty="RSA",e}function u(e,t){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t||(t={pos:0,end:e.length}),2>t.end-t.pos||t.end>e.length)throw new RangeError("Malformed DER");var n=e[t.pos++],r=e[t.pos++];if(128<=r){if(r&=127,t.end-t.pos<r)throw new RangeError("Malformed DER");for(var o=0;r--;)o<<=8,o|=e[t.pos++];r=o}if(t.end-t.pos<r)throw new RangeError("Malformed DER");switch(n){case 2:n=e.subarray(t.pos,t.pos+=r);break;case 3:if(e[t.pos++])throw Error("Unsupported bit string");r--;case 4:n=new Uint8Array(e.subarray(t.pos,t.pos+=r)).buffer;break;case 5:n=null;break;case 6:if(!((e=btoa(i(e.subarray(t.pos,t.pos+=r))))in b))throw Error("Unsupported OBJECT ID "+e);n=b[e];break;case 48:for(n=[],r=t.pos+r;t.pos<r;)n.push(u(e,t));break;default:throw Error("Unsupported DER tag 0x"+n.toString(16))}return n}function l(e,t){t||(t=[]);var n=t.length+2;if(t.push(0,0),e instanceof Uint8Array)for(var i=2,o=e.length,s=0;s<o;s++)t.push(e[s]);else if(e instanceof ArrayBuffer)for(i=4,o=e.byteLength,e=new Uint8Array(e),s=0;s<o;s++)t.push(e[s]);else if(null===e)i=5,o=0;else if("string"==typeof e&&e in T)for(i=6,o=(e=r(atob(T[e]))).length,s=0;s<o;s++)t.push(e[s]);else if(e instanceof Array){for(s=0;s<e.length;s++)l(e[s],t);i=48,o=t.length-n}else{if(!("object"===X(e)&&3===e.tag&&e.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+e);for(i=3,o=(e=new Uint8Array(e.value)).byteLength,t.push(0),s=0;s<o;s++)t.push(e[s]);o++}if(128<=o){for(s=o,o=4,t.splice(n,0,s>>24&255,s>>16&255,s>>8&255,255&s);1<o&&!(s>>24);)s<<=8,o--;4>o&&t.splice(n,4-o),o|=128}return t.splice(n-2,2,i,o),t}function d(e,t,n,r){Object.defineProperties(this,{_key:{value:e},type:{value:e.type,enumerable:!0},extractable:{value:void 0===n?e.extractable:n,enumerable:!0},algorithm:{value:void 0===t?e.algorithm:t,enumerable:!0},usages:{value:void 0===r?e.usages:r,enumerable:!0}})}function h(e){return"verify"===e||"encrypt"===e||"wrapKey"===e}function p(e){return"sign"===e||"decrypt"===e||"unwrapKey"===e}if("function"!=typeof Promise)throw"Promise support required";var f=e.crypto||e.msCrypto;if(f){var m=f.subtle||f.webkitSubtle;if(m){var g=e.Crypto||f.constructor||Object,_=e.SubtleCrypto||m.constructor||Object;e.CryptoKey||e.Key;var E=-1<e.navigator.userAgent.indexOf("Edge/"),v=!!e.msCrypto&&!E,y=!f.subtle&&!!f.webkitSubtle;if(v||y){var b={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},T={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach((function(e){var t=m[e];m[e]=function(i,u,l){var g=[].slice.call(arguments);switch(e){case"generateKey":var _=o(i),E=u,b=l;break;case"importKey":_=o(l),E=g[3],b=g[4],"jwk"===i&&((u=a(u)).alg||(u.alg=s(_)),u.key_ops||(u.key_ops="oct"!==u.kty?"d"in u?b.filter(p):b.filter(h):b.slice()),g[1]=function(e){return e=a(e),v&&(e.extractable=e.ext,delete e.ext),r(unescape(encodeURIComponent(JSON.stringify(e)))).buffer}(u));break;case"unwrapKey":_=g[4],E=g[5],b=g[6],g[2]=l._key}if("generateKey"===e&&"HMAC"===_.name&&_.hash)return _.length=_.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[_.hash.name],m.importKey("raw",f.getRandomValues(new Uint8Array(_.length+7>>3)),_,E,b);if(y&&"generateKey"===e&&"RSASSA-PKCS1-v1_5"===_.name&&(!_.modulusLength||2048<=_.modulusLength))return(i=o(i)).name="RSAES-PKCS1-v1_5",delete i.hash,m.generateKey(i,!0,["encrypt","decrypt"]).then((function(e){return Promise.all([m.exportKey("jwk",e.publicKey),m.exportKey("jwk",e.privateKey)])})).then((function(e){return e[0].alg=e[1].alg=s(_),e[0].key_ops=b.filter(h),e[1].key_ops=b.filter(p),Promise.all([m.importKey("jwk",e[0],_,!0,e[0].key_ops),m.importKey("jwk",e[1],_,E,e[1].key_ops)])})).then((function(e){return{publicKey:e[0],privateKey:e[1]}}));if((y||v&&"SHA-1"===(_.hash||{}).name)&&"importKey"===e&&"jwk"===i&&"HMAC"===_.name&&"oct"===u.kty)return m.importKey("raw",r(n(u.k)),l,g[3],g[4]);if(y&&"importKey"===e&&("spki"===i||"pkcs8"===i))return m.importKey("jwk",c(u),l,g[3],g[4]);if(v&&"unwrapKey"===e)return m.decrypt(g[3],l,u).then((function(e){return m.importKey(i,e,g[4],g[5],g[6])}));try{var T=t.apply(m,g)}catch(e){return Promise.reject(e)}return v&&(T=new Promise((function(e,t){T.onabort=T.onerror=function(e){t(e)},T.oncomplete=function(t){e(t.target.result)}}))),T=T.then((function(e){return"HMAC"!==_.name||_.length||(_.length=8*e.algorithm.length),0==_.name.search("RSA")&&(_.modulusLength||(_.modulusLength=(e.publicKey||e).algorithm.modulusLength),_.publicExponent||(_.publicExponent=(e.publicKey||e).algorithm.publicExponent)),e.publicKey&&e.privateKey?{publicKey:new d(e.publicKey,_,E,b.filter(h)),privateKey:new d(e.privateKey,_,E,b.filter(p))}:new d(e,_,E,b)}))}})),["exportKey","wrapKey"].forEach((function(e){var o=m[e];m[e]=function(c,u,d){var f=[].slice.call(arguments);switch(e){case"exportKey":f[1]=u._key;break;case"wrapKey":f[1]=u._key,f[2]=d._key}if((y||v&&"SHA-1"===(u.algorithm.hash||{}).name)&&"exportKey"===e&&"jwk"===c&&"HMAC"===u.algorithm.name&&(f[0]="raw"),!y||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(f[0]="jwk"),v&&"wrapKey"===e)return m.exportKey(c,u).then((function(e){return"jwk"===c&&(e=r(unescape(encodeURIComponent(JSON.stringify(a(e)))))),m.encrypt(f[3],d,e)}));try{var g=o.apply(m,f)}catch(e){return Promise.reject(e)}return v&&(g=new Promise((function(e,t){g.onabort=g.onerror=function(e){t(e)},g.oncomplete=function(t){e(t.target.result)}}))),"exportKey"===e&&"jwk"===c&&(g=g.then((function(e){return(y||v&&"SHA-1"===(u.algorithm.hash||{}).name)&&"HMAC"===u.algorithm.name?{kty:"oct",alg:s(u.algorithm),key_ops:u.usages.slice(),ext:!0,k:t(i(e))}:((e=a(e)).alg||(e.alg=s(u.algorithm)),e.key_ops||(e.key_ops="public"===u.type?u.usages.filter(h):"private"===u.type?u.usages.filter(p):u.usages.slice()),e)}))),!y||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(g=g.then((function(e){var t=[["",null]],i=!1;if("RSA"!==(e=a(e)).kty)throw new TypeError("Unsupported key type");for(var o="n e d p q dp dq qi".split(" "),s=[],c=0;c<o.length&&o[c]in e;c++){var u=s[c]=r(n(e[o[c]]));128&u[0]&&(s[c]=new Uint8Array(u.length+1),s[c].set(u,1))}return 2<s.length&&(i=!0,s.unshift(new Uint8Array([0]))),t[0][0]="1.2.840.113549.1.1.1",t.push(new Uint8Array(l(s)).buffer),i?t.unshift(new Uint8Array([0])):t[1]={tag:3,value:t[1]},new Uint8Array(l(t)).buffer}))),g}})),["encrypt","decrypt","sign","verify"].forEach((function(e){var t=m[e];m[e]=function(n,r,i,s){if(v&&(!i.byteLength||s&&!s.byteLength))throw Error("Empty input is not allowed");var a=[].slice.call(arguments),c=o(n);if(!v||"sign"!==e&&"verify"!==e||"RSASSA-PKCS1-v1_5"!==n&&"HMAC"!==n||(a[0]={name:n}),v&&r.algorithm.hash&&(a[0].hash=a[0].hash||r.algorithm.hash),v&&"decrypt"===e&&"AES-GCM"===c.name){var u=n.tagLength>>3;a[2]=(i.buffer||i).slice(0,i.byteLength-u),n.tag=(i.buffer||i).slice(i.byteLength-u)}v&&"AES-GCM"===c.name&&void 0===a[0].tagLength&&(a[0].tagLength=128),a[1]=r._key;try{var l=t.apply(m,a)}catch(e){return Promise.reject(e)}return v&&(l=new Promise((function(t,n){l.onabort=l.onerror=function(e){n(e)},l.oncomplete=function(n){if(n=n.target.result,"encrypt"===e&&n instanceof AesGcmEncryptResult){var r=n.ciphertext,i=n.tag;(n=new Uint8Array(r.byteLength+i.byteLength)).set(new Uint8Array(r),0),n.set(new Uint8Array(i),r.byteLength),n=n.buffer}t(n)}}))),l}})),v){var S=m.digest;m.digest=function(e,t){if(!t.byteLength)throw Error("Empty input is not allowed");try{var n=S.call(m,e,t)}catch(e){return Promise.reject(e)}return n=new Promise((function(e,t){n.onabort=n.onerror=function(e){t(e)},n.oncomplete=function(t){e(t.target.result)}}))},e.crypto=Object.create(f,{getRandomValues:{value:function(e){return f.getRandomValues(e)}},subtle:{value:m}}),e.CryptoKey=d}y&&(f.subtle=m,e.Crypto=g,e.SubtleCrypto=_,e.CryptoKey=d)}}}}))}));var Jw=qa("match"),Lj=function(e){var t;return ha(e)&&(void 0!==(t=e[Jw])?!!t:"RegExp"==Zb(e))},Kw=[].push,Lw=Math.min;dh("split",2,(function(e,t,n){var r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,n){var r=String(jb(this));if(0===(n=void 0===n?4294967295:n>>>0))return[];if(void 0===e)return[r];if(!Lj(e))return t.call(r,e,n);var i,o,s,a=[],c=0;for(e=new RegExp(e.source,(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":"")+"g");(i=Of.call(e,r))&&!((o=e.lastIndex)>c&&(a.push(r.slice(c,i.index)),1<i.length&&i.index<r.length&&Kw.apply(a,i.slice(1)),s=i[0].length,c=o,a.length>=n));)e.lastIndex===i.index&&e.lastIndex++;return c===r.length?(s||!e.test(""))&&a.push(""):a.push(r.slice(c)),a.length>n?a.slice(0,n):a}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t;return[function(t,n){var i=jb(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var s=va(e);e=String(this);var a=kd(s,RegExp);if(o=s.unicode,s=new a(pc?"^(?:"+s.source+")":s,(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(pc?"g":"y")),0===(i=void 0===i?4294967295:i>>>0))return[];if(0===e.length)return null===Ke(s,e)?[e]:[];var c=0,u=0;for(a=[];u<e.length;){s.lastIndex=pc?0:u;var l,d=Ke(s,pc?e.slice(u):e);if(null===d||(l=Lw(ta(s.lastIndex+(pc?u:0)),e.length))===c)u=xj(e,u,o);else{if(a.push(e.slice(c,u)),a.length===i)return a;for(c=1;c<=d.length-1;c++)if(a.push(d[c]),a.length===i)return a;u=c=l}}return a.push(e.slice(c)),a}]}),pc),function(e){e.console||(e.console={}),e=e.console;for(var t,n=function(){},r=["memory"],i="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");t=r.pop();)e[t]||(e[t]={});for(;t=i.pop();)e[t]||(e[t]=n)}("undefined"==typeof window?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R((function(){Vb(1)}));N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(e){return Vb(Qa(e))}});var ep=[].slice,Mj={},Nw=Function.bind||function(e){var t=yb(this),n=ep.call(arguments,1),r=function(){var i=n.concat(ep.call(arguments));if(this instanceof r){var o=i.length;if(!(o in Mj)){for(var s=[],a=0;a<o;a++)s[a]="a["+a+"]";Mj[o]=Function("C,a","return new C("+s.join(",")+")")}i=Mj[o](t,i)}else i=t.apply(e,i);return i};return ha(t.prototype)&&(r.prototype=t.prototype),r},Nj=mc("Reflect","construct"),fp=R((function(){function e(){}return!(Nj((function(){}),[],e)instanceof e)})),gp=!R((function(){Nj((function(){}))})),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(e,t){yb(e),va(t);var n=3>arguments.length?e:yb(arguments[2]);if(gp&&!fp)return Nj(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}return(n=[null]).push.apply(n,t),new(Nw.apply(e,n))}n=n.prototype,n=ac(ha(n)?n:Object.prototype);var r=Function.apply.call(e,n,t);return ha(r)?r:n}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R((function(){ip(1)}));N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(e,t){return ip(qb(e),t)}});var jp=Hd.f,Pw={}.toString,kp="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(e){if(kp&&"[object Window]"==Pw.call(e))try{var t=jp(e)}catch(e){t=kp.slice()}else t=jp(qb(e));return t},lp={f:qa},Qw=Ra.f,ph=function(e){var t=y.Symbol||(y.Symbol={});Q(t,e)||Qw(t,e,{value:lp.f(e)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R((function(){return 7!=ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=op(Ob,t);r&&delete Ob[t],od(e,t,n),r&&e!==Ob&&od(Ob,t,r)}:od,Uj=function(e,t){var n=Lc[e]=ac(sb.prototype);return Rw(n,{type:"Symbol",tag:e,description:t}),ka||(n.description=t),n},Vj=vn?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof sb},qh=function(e,t,n){return e===Ob&&qh(Uf,t,n),va(e),t=lc(t,!0),va(n),Q(Lc,t)?(n.enumerable?(Q(e,rb)&&e[rb][t]&&(e[rb][t]=!1),n=ac(n,{enumerable:dd(0,!1)})):(Q(e,rb)||od(e,rb,dd(1,{})),e[rb][t]=!0),Tj(e,t,n)):od(e,t,n)},qp=function(e,t){va(e);var n=qb(t);return t=Dc(n).concat(Wj(n)),Jd(t,(function(t){ka&&!Xj.call(n,t)||qh(e,t,n[t])})),e},Xj=function(e){e=lc(e,!0);var t=Sw.call(this,e);return!(this===Ob&&Q(Lc,e)&&!Q(Uf,e))&&(!(t||!Q(this,e)||!Q(Lc,e)||Q(this,rb)&&this[rb][e])||t)},rp=function(e,t){if(e=qb(e),t=lc(t,!0),e!==Ob||!Q(Lc,t)||Q(Uf,t)){var n=op(e,t);return!n||!Q(Lc,t)||Q(e,rb)&&e[rb][t]||(n.enumerable=!0),n}},sp=function(e){e=pp(qb(e));var t=[];return Jd(e,(function(e){Q(Lc,e)||Q(Be,e)||t.push(e)})),t},Wj=function(e){var t=e===Ob;e=pp(t?Uf:qb(e));var n=[];return Jd(e,(function(e){!Q(Lc,e)||t&&!Q(Ob,e)||n.push(Lc[e])})),n};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Ae(e),n=function(e){this===Ob&&n.call(Uf,e),Q(this,rb)&&Q(this[rb],t)&&(this[rb][t]=!1),Tj(this,t,dd(1,e))};return ka&&Sj&&Tj(Ob,t,{configurable:!0,set:n}),Uj(t,e)},Ta(sb.prototype,"toString",(function(){return np(this).tag})),Ta(sb,"withoutSetter",(function(e){return Uj(Ae(e),e)})),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(e){return Uj(qa(e),e)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),(function(e){ph(e)})),N({target:"Symbol",stat:!0,forced:!oc},{for:function(e){if(e=String(e),Q(Pj,e))return Pj[e];var t=sb(e);return Pj[e]=t,Qj[t]=e,t},keyFor:function(e){if(!Vj(e))throw TypeError(e+" is not a symbol");if(Q(Qj,e))return Qj[e]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(e,t){return void 0===t?ac(e):qp(ac(e),t)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R((function(){Bf.f(1)}))},{getOwnPropertySymbols:function(e){return Bf.f(Qa(e))}}),Tf){var Uw=!oc||R((function(){var e=sb();return"[null]"!=Tf([e])||"{}"!=Tf({a:e})||"{}"!=Tf(Object(e))}));N({target:"JSON",stat:!0,forced:Uw},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(ha(t)||void 0!==e)&&!Vj(e))return gd(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Vj(t))return t}),i[1]=t,Tf.apply(null,i)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&"function"==typeof Mc&&(!("description"in Mc.prototype)||void 0!==Mc().description)){var tp={},Vf=function(){var e=1>arguments.length||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Vf?new Mc(e):void 0===e?Mc():Mc(e);return""===e&&(tp[t]=!0),t};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw="Symbol(test)"==String(Mc("test")),Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var e=ha(this)?this.valueOf():this,t=Ww.call(e);return Q(tp,e)?"":""===(e=Xw?t.slice(7,-1):t.replace(Yw,"$1"))?void 0:e}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}var c=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(t,[{key:"addEventListener",value:function(e,t,n){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:n})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=0,r=(e=this.listeners[e]).length;n<r;n++)if(e[n].callback===t){e.splice(n,1);break}}},{key:"dispatchEvent",value:function(e){if(e.type in this.listeners){for(var t=this.listeners[e.type].slice(),n=0,r=t.length;n<r;n++){var i=t[n];try{i.callback.call(this,e)}catch(e){Promise.resolve().then((function(){throw e}))}i.options&&i.options.once&&this.removeEventListener(e.type,i.callback)}return!e.defaultPrevented}}}]),t}(),u=function(t){function o(){e(this,o);var t=u.call(this);return t.listeners||c.call(s(t)),Object.defineProperty(s(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(s(t),"onabort",{value:null,writable:!0,configurable:!0}),t}r(o,t);var u=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n=i(e);if(t){var r=i(this).constructor;n=Reflect.construct(n,arguments,r)}else n=n.apply(this,arguments);return!n||"object"!==X(n)&&"function"!=typeof n?s(this):n}}(o);return n(o,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),a(i(o.prototype),"dispatchEvent",this).call(this,e)}}]),o}(c),l=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new u,writable:!0,configurable:!0})}return n(t,[{key:"abort",value:function(){try{var e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(l.prototype[Symbol.toStringTag]="AbortController",u.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var t=!0}else t="function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController;t&&(e.AbortController=l,e.AbortSignal=u)}("undefined"!=typeof self?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Zw($w(e+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(e){return 31-bx(e>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(e){if(e=e&&e.buffer||e,up.call(e)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var t="",n=0,r=0|(e=Zj?new ak(e):e).length;n<r;n=n+32768|0)t+=xd.apply(0,e[Zj?"slice":"subarray"](n,n+32768|0));return t.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(e){for(var t=0|(e=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,n=new ak(t),r=0;r<t;r=r+1|0)n[r]=e.charCodeAt(r);return n},window.TextEncoder||(window.TextEncoder=yl),function(e){var t,n,r,i,o,s,a,c,u,l,d;!function(e){e.LOGIN="LOGIN",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.LOGIN_FAILURE="LOGIN_FAILURE",e.LOGIN_TIMEOUT="LOGIN_TIMEOUT",e.INTERRUPTED="INTERRUPTED",e.LOGOUT="LOGOUT",e.BANNED_BY_SERVER="BANNED_BY_SERVER",e.REMOTE_LOGIN="REMOTE_LOGIN"}(t||(t={})),e.ConnectionChangeReason=t,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECTING="RECONNECTING",e.ABORTED="ABORTED"}(n||(n={})),e.ConnectionState=n,function(e){e.IDLE="IDLE",e.SENT_TO_REMOTE="SENT_TO_REMOTE",e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(r||(r={})),e.LocalInvitationState=r,function(e){e.INVITATION_RECEIVED="INVITATION_RECEIVED",e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",e.REFUSED="REFUSED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(i||(i={})),e.RemoteInvitationState=i,function(e){e.UNKNOWN="UNKNOWN",e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",e.INVITATION_EXPIRE="INVITATION_EXPIRE",e.PEER_OFFLINE="PEER_OFFLINE",e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(o||(o={})),e.LocalInvitationFailureReason=o,function(e){e.UNKNOWN="UNKNOWN",e.PEER_OFFLINE="PEER_OFFLINE",e.ACCEPT_FAILURE="ACCEPT_FAILURE",e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(s||(s={})),e.RemoteInvitationFailureReason=s,function(e){e.ONLINE="ONLINE",e.UNREACHABLE="UNREACHABLE",e.OFFLINE="OFFLINE"}(a||(a={})),e.PeerOnlineState=a,(c||(c={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=c,function(e){e.TEXT="TEXT",e.RAW="RAW",e.IMAGE="IMAGE",e.FILE="FILE"}(u||(u={})),e.MessageType=u,function(e){e.CN="CN",e.NA="NA",e.EU="EU",e.AS="AS",e.JP="JP",e.IN="IN",e.GLOB="GLOB",e.OC="OC",e.SA="SA",e.AF="AF",e.OVS="OVS"}(l||(l={})),e.LegacyAreaCode=l,function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(d||(d={})),e.AreaCode=d}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(e){return on(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(e){if(Lj(e))throw TypeError("The method doesn't accept regular expressions");return e},ex=qa("match"),dk=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[ex]=!1,"/./"[e](t)}catch(e){}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(e){return!!~String(jb(this)).indexOf(ck(e),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(e){return Jd(this,e,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch(c){rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a((function(e){e=function(e){function t(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function n(e,t,n,o){return t=Object.create((t&&t.prototype instanceof i?t:i).prototype),o=new h(o||[]),t._invoke=function(e,t,n){var i=T;return function(o,s){if(i===w)throw Error("Generator is already running");if(i===R){if("throw"===o)throw s;return f()}for(n.method=o,n.arg=s;;){if((o=n.delegate)&&(o=u(o,n))){if(o===I)continue;return o}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===T)throw i=R,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);if(i=w,"normal"===(o=r(e,t,n)).type){if(i=n.done?R:S,o.arg===I)continue;return{value:o.arg,done:n.done}}"throw"===o.type&&(i=R,n.method="throw",n.arg=o.arg)}}}(e,n,o),t}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function s(){}function a(e){["next","throw","return"].forEach((function(n){t(e,n,(function(e){return this._invoke(n,e)}))}))}function c(e,t){function n(i,o,s,a){if("throw"!==(i=r(e[i],e,o)).type){var c=i.arg;return(i=c.value)&&"object"===X(i)&&_.call(i,"__await")?t.resolve(i.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(i).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,a)}))}a(i.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function u(e,t){var n=e.iterator[t.method];if(n===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,u(e,t),"throw"===t.method))return I;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return I}return"throw"===(n=r(n,e.iterator,t.arg)).type?(t.method="throw",t.arg=n.arg,t.delegate=null,I):(n=n.arg)?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,I):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,I)}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function p(e){if(e){var t=e[v];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1;return(t=function t(){for(;++n<e.length;)if(_.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=m,t.done=!0,t}).next=t}}return{next:f}}function f(){return{value:m,done:!0}}var m,g=Object.prototype,_=g.hasOwnProperty,E="function"==typeof Symbol?Symbol:{},v=E.iterator||"@@iterator",y=E.asyncIterator||"@@asyncIterator",b=E.toStringTag||"@@toStringTag";try{t({},"")}catch(e){t=function(e,t,n){return e[t]=n}}e.wrap=n;var T="suspendedStart",S="suspendedYield",w="executing",R="completed",I={};t(E={},v,(function(){return this}));var C=Object.getPrototypeOf;(C=C&&C(C(p([]))))&&C!==g&&_.call(C,v)&&(E=C);var A=s.prototype=i.prototype=Object.create(E);return o.prototype=s,t(A,"constructor",s),t(s,"constructor",o),o.displayName=t(s,b,"GeneratorFunction"),e.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,t(e,b,"GeneratorFunction")),e.prototype=Object.create(A),e},e.awrap=function(e){return{__await:e}},a(c.prototype),t(c.prototype,y,(function(){return this})),e.AsyncIterator=c,e.async=function(t,r,i,o,s){void 0===s&&(s=Promise);var a=new c(n(t,r,i,o),s);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},a(A),t(A,b,"Generator"),t(A,v,(function(){return this})),t(A,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t,n=[];for(t in e)n.push(t);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=p,h.prototype={constructor:h,reset:function(e){if(this.next=this.prev=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=m),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=_.call(i,"catchLoc"),a=_.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&_.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}return i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null),(n=i?i.completion:{}).type=e,n.arg=t,i?(this.method="next",this.next=i.finallyLoc,I):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),I},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),I}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){if("throw"===(e=n.completion).type){var r=e.arg;d(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:p(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=m),I}},e}(e.exports);try{regeneratorRuntime=e}catch(t){"object"===("undefined"==typeof globalThis?"undefined":X(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})),yp=!R((function(){return Object.isExtensible(Object.preventExtensions({}))})),fk=$a((function(e){var t=Ra.f,n=Ae("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},s=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!ha(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Q(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!Q(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return yp&&s.REQUIRED&&i(e)&&!Q(e,n)&&o(e),e}};Be[n]=!0})),zp=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",s=y[e],a=s&&s.prototype,c=s,u={},l=function(e){var t=a[e];Ta(a,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!ha(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(nc(e,"function"!=typeof s||!(i||a.forEach&&!R((function(){(new s).entries().next()})))))c=n.getConstructor(t,e,r,o),fk.REQUIRED=!0;else if(nc(e,!0)){var d=new c,h=d[o](i?{}:-0,1)!=d,p=R((function(){d.has(1)})),f=Tg((function(e){new s(e)})),m=!i&&R((function(){for(var e=new s,t=5;t--;)e[o](t,t);return!e.has(-0)}));f||((c=t((function(t,n){return Gc(t,c,e),t=lh(new s,t,c),null!=n&&Xg(n,t[o],{that:t,AS_ENTRIES:r}),t}))).prototype=a,a.constructor=c),(p||m)&&(l("delete"),l("has"),r&&l("get")),(m||h)&&l(o),i&&a.clear&&delete a.clear}return u[e]=c,N({global:!0,forced:c!=s},u),Ec(c,e),i||n.setStrong(c,e,r),c},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(e,t,n,r){var i=e((function(e,o){Gc(e,i,t),Bp(e,{type:t,index:ac(null),first:void 0,last:void 0,size:0}),ka||(e.size=0),null!=o&&Xg(o,e[r],{that:e,AS_ENTRIES:n})})),o=gk(t),s=function(e,t,n){var r,i=o(e),s=a(e,t);return s?s.value=n:(i.last=s={index:r=Ap(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=s),t&&(t.next=s),ka?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e},a=function(e,t){e=o(e);var n=Ap(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return Hf(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,ka?e.size=0:this.size=0},delete:function(e){var t=o(this);if(e=a(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),ka?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=o(this),r=Id(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),Hf(i.prototype,n?{get:function(e){return(e=a(this,e))&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),ka&&gx(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=gk(t),o=gk(r);bj(e,t,(function(e,t){Bp(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),If(t)}};zp("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(e){return function(t){return t=String(jb(t)),1&e&&(t=t.replace(hx,"")),2&e&&(t=t.replace(ix,"")),t}};hk(1),hk(2);var ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=8!==sh("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff08")||22!==sh("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff0x16")?function(e,t){return e=ik(String(e)),sh(e,t>>>0||(jx.test(e)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx="Number"==Zb(ac(th)),Ep=function(e){var t,n=lc(e,!1);if("string"==typeof n&&2<n.length)if(43===(e=(n=ik(n)).charCodeAt(0))||45===e){if(88===(e=n.charCodeAt(2))||120===e)return NaN}else if(48===e){switch(n.charCodeAt(1)){case 66:case 98:e=2;var r=49;break;case 79:case 111:e=8,r=55;break;default:return+n}var i=(n=n.slice(2)).length;for(t=0;t<i;t++){var o=n.charCodeAt(t);if(48>o||o>r)return NaN}return parseInt(n,e)}return+n};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(e){var t=1>arguments.length?0:e,n=this;return n instanceof Pd&&(nx?R((function(){th.valueOf.call(n)})):"Number"!=Zb(n))?lh(new pd(Ep(t)),n,Pd):Ep(t)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R((function(){var e=[];return e[Gp]=!1,e.concat()[0]!==e})),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(e){var t,n=Qa(this),r=Sg(n,0),i=0,o=-1;for(t=arguments.length;o<t;o++){var s=-1===o?n:arguments[o],a=s;if(ha(a)){var c=a[Gp];a=void 0!==c?!!c:gd(a)}else a=!1;if(a){if(9007199254740991<i+(c=ta(s.length)))throw TypeError("Maximum allowed index exceeded");for(a=0;a<c;a++,i++)a in s&&Ge(r,i,s[a])}else{if(9007199254740991<=i)throw TypeError("Maximum allowed index exceeded");Ge(r,i++,s)}}return r.length=i,r}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R((function(){kk((function(){}))}));N({target:"Reflect",stat:!0,forced:rx},{apply:function(e,t,n){return yb(e),va(n),kk?kk(e,t,n):qx.call(e,t,n)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R((function(){return!Object.getOwnPropertyNames(1)}));N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe="object"===("undefined"==typeof Reflect?"undefined":X(Reflect))?Reflect:null,Hp=Pe&&"function"==typeof Pe.apply?Pe.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ux=Pe&&"function"==typeof Pe.ownKeys?Pe.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Ip=Number.isNaN||function(e){return e!=e};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(e){if("number"!=typeof e||0>e||Ip(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Jp=e}}),ea.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||Ip(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ea.prototype.getMaxListeners=function(){return void 0===this._maxListeners?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);n="error"===e;var r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var i;if(0<t.length&&(i=t[0]),i instanceof Error)throw i;throw(t=Error("Unhandled error."+(i?" ("+i.message+")":""))).context=i,t}if(void 0===(n=r[e]))return!1;if("function"==typeof n)Hp(n,this,t);else for(r=Cl(n,i=n.length),n=0;n<i;++n)Hp(r[n],this,t);return!0},ea.prototype.addListener=function(e,t){return zl(this,e,t,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(e,t){return zl(this,e,t,!0)},ea.prototype.once=function(e,t){return ng(t),this.on(e,Al(this,e,t)),this},ea.prototype.prependOnceListener=function(e,t){return ng(t),this.prependListener(e,Al(this,e,t)),this},ea.prototype.removeListener=function(e,t){var n;ng(t);var r=this._events;if(void 0===r)return this;var i=r[e];if(void 0===i)return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){var o=-1;for(n=i.length-1;0<=n;n--)if(i[n]===t||i[n].listener===t){var s=i[n].listener;o=n;break}if(0>o)return this;if(0===o)i.shift();else{for(;o+1<i.length;o++)i[o]=i[o+1];i.pop()}1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(e){var t=this._events;if(void 0===t)return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var n=Object.keys(t);for(t=0;t<n.length;++t){var r=n[t];"removeListener"!==r&&this.removeAllListeners(r)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=t[e]))this.removeListener(e,n);else if(void 0!==n)for(t=n.length-1;0<=t;t--)this.removeListener(e,n[t]);return this},ea.prototype.listeners=function(e){return Bl(this,e,!0)},ea.prototype.rawListeners=function(e){return Bl(this,e,!1)},ea.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Dl.call(e,t)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}El(e,t,o,{once:!0}),"error"!==t&&vs(e,i,{once:!0})}))};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R((function(){if(ka&&1!==Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=Qe({},e)[n]||"abcdefghijklmnopqrst"!=Dc(Qe({},t)).join("")}))?function(e,t){for(var n=Qa(e),r=arguments.length,i=1,o=Bf.f,s=zf;r>i;)for(var a,c=Af(arguments[i++]),u=o?Dc(c).concat(o(c)):Dc(c),l=u.length,d=0;l>d;)a=u[d++],(!ka||s.call(c,a))&&(n[a]=c[a]);return n}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(e){return vx(e)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R((function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||"/a/i"!=sc(Wf,"i")})))){for(var Oc=function(e,t){var n,r=this instanceof Oc,i=Lj(e),o=void 0===t;return!r&&i&&e.constructor===Oc&&o||(nk?i&&!o&&(e=e.source):e instanceof Oc&&(o&&(t=tj.call(e)),e=e.source),pc&&(n=!!t&&-1<t.indexOf("y"))&&(t=t.replace(/y/g,"")),e=lh(nk?new sc(e,t):sc(e,t),r?this:lk,Oc),pc&&n&&(zx(e).sticky=!0)),e},Bx=function(e){e in Oc||xx(Oc,e,{configurable:!0,get:function(){return sc[e]},set:function(t){sc[e]=t}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Sf("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Sf("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Sf("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var ok=function(e,t){return e===t?0:null==e?null==t?0:-1:null==t?null==e?0:1:"function"==typeof e.compare?e.compare(t):"function"==typeof t.compare?-t.compare(e):e<t?-1:e>t?1:0},pk=[],Op=pk.sort,Cx=R((function(){pk.sort(void 0)})),Dx=R((function(){pk.sort(null)})),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(e){return void 0===e?Op.call(Qa(this)):Op.call(Qa(this),yb(e))}});var Pp=Object.getPrototypeOf({}),Xf=function(e,t){var n;return e===t||(null==e?e==t:"function"===X(e.equiv)?e.equiv(t):null==t?e==t:"function"===X(t.equiv)?t.equiv(e):"string"!==X(e)&&"string"!==X(t)&&(null!=(n=Object.getPrototypeOf(e))&&n!==Pp||null!=(n=Object.getPrototypeOf(t))&&n!==Pp?"function"!==X(e)&&void 0!==e.length&&"function"!==X(t)&&void 0!==t.length?Gx(e,t):e instanceof Set&&t instanceof Set?Hx(e,t):e instanceof Map&&t instanceof Map?Ix(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:Fx(e,t)))},Gx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf,r=e.length;if(r===t.length)for(;0<=--r&&n(e[r],t[r]););return 0>r},Hx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;return e.size===t.size&&n(G(e.keys()).sort(),G(t.keys()).sort())},Ix=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;return e.size===t.size&&n(G(e).sort(),G(t).sort())},Fx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!t.hasOwnProperty(r)||!n(e[r],t[r]))return!1;return!0},Qp=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return void 0!==e?": "+e:""};return function(n){function r(n){return W(this,r),i.call(this,e(n)+t(n))}la(r,n);var i=ma(r);return r}(ef(Error))},Jx=Qp((function(){return"illegal argument(s)"})),vh=function(e){throw new Jx(e)},qk=Qp((function(){return"index out of bounds"})),Rp=1/4294967295,Kx=function(){function e(){W(this,e)}return Ha(e,[{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.int()*Rp*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(this.int()*Rp-.5)*e}},{key:"minmax",value:function(e,t){return this.float()*(t-e)+e}}]),e}(),rk=Math.random,Lx=new(function(e){function t(){return W(this,t),n.apply(this,arguments)}la(t,e);var n=ma(t);return Ha(t,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return rk()*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(rk()-.5)*e}}]),t}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R((function(){sk(1)}));N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(e){return sk&&ha(e)?sk(Mx(e)):e}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(e){return Wo(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(e){return null!=e&&"function"==typeof e.xform?e.xform():e},og=function(){function e(t){W(this,e),this.value=t}return Ha(e,[{key:"deref",value:function(){return this.value}}]),e}(),Wh=function(e){return e instanceof og?e.deref():e},xs=function(e,t){return[e,function(e){return e},t]},Qx=w.mark((function(e,t){var n,r,i,o,s,a;return w.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=Gl(e)(ws()),r=n[1],i=n[2],o=0;case 4:if(!(o<t.length)){c.next=15;break}if(s=t[o],!((a=i([],s))instanceof og)){c.next=10;break}return c.delegateYield(Wh(r(a.deref())),"t0",9);case 9:return c.abrupt("return");case 10:if(!a.length){c.next=12;break}return c.delegateYield(a,"t1",12);case 12:o++,c.next=4;break;case 15:return c.delegateYield(Wh(r([])),"t2",16);case 16:case"end":return c.stop()}}),Qx)})),ys=w.mark(Fl),zs=function(e,t){return[e[0],e[1],t]},Sp=!0;"findIndex"in[]&&Array(1).findIndex((function(){Sp=!1})),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(e){return An(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function e(t){W(this,e),this._length=0,t&&this.into(t)}return Ha(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e,t=this.head;t;)e=t.next,delete t.value,delete t.prev,delete t.next,t=e;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e){var t=this._length;if(t<e._length)return-1;if(t>e._length)return 1;if(0===t)return 0;t=this.head,e=e.head;for(var n=0;t&&0==n;)n=ok(t.value,e.value),t=t.next,e=e.next;return n}},{key:"equiv",value:function(t){if(!(t instanceof e||null!=t&&"function"!=typeof t&&void 0!==t.length)||this._length!==t.length)return!1;if(!this._length||this===t)return!0;for(var n=this.head,r=0;r<t.length;r++){if(!Xf(n.value,t[r]))return!1;n=n.next}return!0}},{key:Symbol.iterator,value:w.mark((function e(){var t;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.head;case 1:if(!t){e.next=7;break}return e.next=4,t.value;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"seq",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;if(!(e>=t||0>e)){e=this.nthCell(e);var n=this.nthCell(t-1);return t=function e(t){return{first:function(){return t.value},next:function(){return t!==n&&t.next?e(t.next):void 0}}},e?t(e):void 0}}},{key:"cycle",value:w.mark((function e(){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this,"t0",2);case 2:e.next=0;break;case 4:case"end":return e.stop()}}),e,this)}))},{key:"$reduce",value:function(e,t){for(var n=this.head;n&&!(t instanceof og);)t=e(t,n.value),n=n.next;return t}},{key:"drop",value:function(){var e=this.head;if(e)return(this.head=e.next)?delete this.head.prev:delete this.tail,this._length--,e.value}},{key:"cons",value:function(e){return e={value:e,next:this.head},this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}},{key:"insertBefore",value:function(e,t){return e||vh("cell is undefined"),t={value:t,next:e,prev:e.prev},e.prev?e.prev.next=t:this.head=t,e.prev=t,this._length++,this}},{key:"insertAfter",value:function(e,t){return e||vh("cell is undefined"),t={value:t,next:e.next,prev:e},e.next?e.next.prev=t:this.tail=t,e.next=t,this._length++,this}},{key:"insertBeforeNth",value:function(e,t){if(0>e&&(e+=this._length),0>=e)return this.cons(t);if(0>e||e>=this._length)throw new qk(e);return this.insertBefore(this.nthCellUnsafe(e),t)}},{key:"insertAfterNth",value:function(e,t){if(0>e&&(e+=this._length),e>=this._length-1)return this.push(t);if(0>e||e>=this._length)throw new qk(e);return this.insertAfter(this.nthCellUnsafe(e),t)}},{key:"insertSorted",value:function(e,t){t=t||ok;for(var n=this.head;n;){if(0>=t(e,n.value))return this.insertBefore(n,e);n=n.next}return this.push(e)}},{key:"find",value:function(e){for(var t=this.head;t;){if(t.value===e)return t;t=t.next}}},{key:"findWith",value:function(e){for(var t=this.head;t;){if(e(t.value))return t;t=t.next}}},{key:"concat",value:function(){for(var e=this.copy(),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e.into(n[t]);return e}},{key:"into",value:function(e){for(var t=0;t<e.length;t++)this.push(e[t])}},{key:"slice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;t=0>t?t+this._length:t,n=0>n?n+this._length:n,(0>t||0>n)&&vh("invalid indices: ${from} / ${to}");for(var r=new e,i=this.nthCell(t);i&&++t<=n;)r.push(i.value),i=i.next;return r}},{key:"splice",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length?arguments[2]:void 0;if("number"==typeof t){if(0>t&&(t+=this._length),0>t||t>=this._length)throw new qk(t);var i=this.nthCellUnsafe(t)}else i=t;var o=new e;if(0<n)for(;i&&0<n--;)this.remove(i),o.push(i.value),i=i.next;else i&&(i=i.next);if(r)if(i)for(n=0;n<r.length;n++)this.insertBefore(i,r[n]);else for(i=0;i<r.length;i++)this.push(r[i]);return o}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}},{key:"swap",value:function(e,t){if(e!==t){var n=e.value;e.value=t.value,t.value=n}return this}},{key:"push",value:function(e){return this.tail?(e={value:e,prev:this.tail},this.tail=this.tail.next=e,this._length++,this):this.cons(e)}},{key:"pop",value:function(){var e=this.tail;if(e)return(this.tail=e.prev)?delete this.tail.next:delete this.head,this._length--,e.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e){return this.head?(this.head.value=e,this):this.cons(e)}},{key:"setTail",value:function(e){return this.tail?(this.tail.value=e,this):this.push(e)}},{key:"setNth",value:function(e,t){var n=this.nthCell(e);return!n&&vh("index out of bounds: ".concat(e)),n.value=t,this}},{key:"nth",value:function(e,t){return(e=this.nthCell(e))?e.value:t}},{key:"nthCell",value:function(e){if(0>e&&(e+=this._length),!(0>e||e>=this._length))return this.nthCellUnsafe(e)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e=this.peek();return this.pop(),this.cons(e)}}},{key:"map",value:function(t){for(var n=new e,r=this.head;r;)n.push(t(r.value)),r=r.next;return n}},{key:"filter",value:function(t){for(var n=new e,r=this.head;r;)t(r.value)&&n.push(r.value),r=r.next;return n}},{key:"reduce",value:function(e,t){for(var n=this.head;n;)t=e(t,n.value),n=n.next;return t}},{key:"shuffle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Lx;if(2>this._length)return this;for(e=null!=e?e:Math.ceil(1.5*Math.log2(this._length));0<e;e--)for(var n=this.head;n;){var r=n.next;.5>t.float()?this.asHead(n):this.asTail(n),n=r}return this}},{key:"sort",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:ok;if(!this._length)return this;for(var t=1;;){var n=this.head;this.tail=this.head=void 0;for(var r=0;n;){r++;for(var i=n,o=0,s=0;s<t&&(o++,i=i.next);s++);for(s=t;0<o||0<s&&i;){if(0===o){var a=i;i=i.next,s--}else i&&0!==s?0>=e(n.value,i.value)?(a=n,n=n.next,o--):(a=i,i=i.next,s--):(a=n,n=n.next,o--);this.tail?this.tail.next=a:this.head=a,a.prev=this.tail,this.tail=a}n=i}if(this.tail.next=void 0,1>=r)return this;t*=2}}},{key:"reverse",value:function(){for(var e=this.head,t=this.tail,n=(this._length>>>1)+(1&this._length);e&&t&&0<n;){var r=e.value;e.value=t.value,t.value=r,e=e.next,t=t.prev,n--}return this}},{key:"asHead",value:function(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}},{key:"asTail",value:function(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}},{key:"toString",value:function(){for(var e=[],t=this.head;t;)e.push(String(t.value)),t=t.next;return e.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(e){if(e<=this._length>>1)var t=this.head,n="next";else t=this.tail,n="prev",e=this._length-e-1;for(;0<e--&&t;)t=t[n];return t}}]),e}(),tc=function(){function e(t,n){W(this,e),n=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n),this.map=n.map(),this.items=new Rx,this._size=0,this.opts=n,t&&this.into(t)}return Ha(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg((function(e){return[e.k,e]}),this.items)}},{key:"keys",value:function(){return pg((function(e){return e.k}),this.items)}},{key:"values",value:function(){return pg((function(e){return e.v}),this.items)}},{key:"copy",value:function(){var e=this.empty();e.items=this.items.copy();for(var t=e.items.head;t;)e.map.set(t.value.k,t),t=t.next;return e}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e=this.opts.release;if(e){for(var t;t=this.items.drop();)e(t.k,t.v);return!0}return this.items.release()}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e,t){return(e=this.map.get(e))?this.resetEntry(e):t}},{key:"set",value:function(e,t){var n=this.opts.ksize(e)+this.opts.vsize(t),r=this.map.get(e);return this._size+=Math.max(0,n-(r?r.value.s:0)),this.ensureSize()&&this.doSetEntry(r,e,t,n),t}},{key:"into",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.set(n[0],n[1])}return this}},{key:"getSet",value:function(e,t){var n=this,r=this.map.get(e);return r?Promise.resolve(this.resetEntry(r)):t().then((function(t){return n.set(e,t)}))}},{key:"delete",value:function(e){return!!(e=this.map.get(e))&&(this.removeEntry(e),!0)}},{key:"resetEntry",value:function(e){return this.items.asTail(e),e.value.v}},{key:"ensureSize",value:function(){for(var e=this.opts.release,t=this.opts.maxsize,n=this.opts.maxlen;this._size>t||this.length>=n;){var r=this.items.drop();if(!r)return!1;this.map.delete(r.k),e&&e(r.k,r.v),this._size-=r.s}return!0}},{key:"removeEntry",value:function(e){var t=e.value;this.map.delete(t.k),this.items.remove(e),this.opts.release&&this.opts.release(t.k,t.v),this._size-=t.s}},{key:"doSetEntry",value:function(e,t,n,r){e?(e.value.v=n,e.value.s=r,this.items.asTail(e)):(this.items.push({k:t,v:n,s:r}),this.map.set(t,this.items.tail))}}]),e}(),Sx=function(e){function t(e,r){return W(this,t),r=Object.assign({ttl:36e5},r),n.call(this,e,r)}la(t,e);var n=ma(t);return Ha(t,[{key:"empty",value:function(){return new t(null,this.opts)}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"get",value:function(e,t){if(e=this.map.get(e)){if(e.value.t>=Date.now())return this.resetEntry(e);this.removeEntry(e)}return t}},{key:"set",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,r=this.opts.ksize(e)+this.opts.vsize(t),i=this.map.get(e);return this._size+=Math.max(0,r-(i?i.value.s:0)),this.ensureSize()&&(n=Date.now()+n,i?(i.value.v=t,i.value.s=r,i.value.t=n,this.items.asTail(i)):(this.items.push({k:e,v:t,s:r,t:n}),this.map.set(e,this.items.tail))),t}},{key:"getSet",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,i=this.get(e);return i?Promise.resolve(i):t().then((function(t){return n.set(e,t,r)}))}},{key:"prune",value:function(){for(var e=Date.now(),t=this.items.head;t;)t.value.t<e&&this.removeEntry(t),t=t.next}},{key:"ensureSize",value:function(){for(var e=this.opts.maxsize,n=this.opts.maxlen,r=Date.now(),i=this.items.head;i&&(this._size>e||this.length>=n);)i.value.t<r&&this.removeEntry(i),i=i.next;return Th(wd(t.prototype),"ensureSize",this).call(this)}}]),t}(tc),Tp="object"==X(Ya)&&Ya&&Ya.Object===Object&&Ya,Tx="object"==("undefined"==typeof self?"undefined":X(self))&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(e){if(null==e)e=void 0===e?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(e)){var t=Ux.call(e,Yf),n=e[Yf];try{e[Yf]=void 0;var r=!0}catch(e){}var i=Vx.call(e);r&&(t?e[Yf]=n:delete e[Yf]),e=i}else e=Wx.call(e);return e},lb=function(e){var t=X(e);return null!=e&&("object"==t||"function"==t)},qi=function(e){return!!lb(e)&&("[object Function]"==(e=Qd(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},tk=Cb["__core-js_shared__"],Wp=function(){var e=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Xx=Function.prototype.toString,Rd=function(e){if(null!=e){try{return Xx.call(e)}catch(e){}return e+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(e,t){return e=null==e?void 0:e[t],!lb(e)||Wp&&Wp in e||!(qi(e)?Zx:Yx).test(Rd(e))?void 0:e},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},zd.prototype.get=function(e){var t=this.__data__;return Zf?"__lodash_hash_undefined__"===(e=t[e])?void 0:e:$x.call(t,e)?t[e]:void 0},zd.prototype.has=function(e){var t=this.__data__;return Zf?void 0!==t[e]:ay.call(t,e)},zd.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Zf&&void 0===t?"__lodash_hash_undefined__":t,this};var $f=function(e,t){return e===t||e!=e&&t!=t},wh=function(e,t){for(var n=e.length;n--;)if($f(e[n][0],t))return n;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(e){var t=this.__data__;return!(0>(e=wh(t,e)))&&(e==t.length-1?t.pop():by.call(t,e,1),--this.size,!0)},ce.prototype.get=function(e){var t=this.__data__;return 0>(e=wh(t,e))?void 0:t[e][1]},ce.prototype.has=function(e){return-1<wh(this.__data__,e)},ce.prototype.set=function(e,t){var n=this.__data__,r=wh(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(e,t){e=e.__data__;var n=X(t);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(e){return e=xh(this,e).delete(e),this.size-=e?1:0,e},de.prototype.get=function(e){return xh(this,e).get(e)},de.prototype.has=function(e){return xh(this,e).has(e)},de.prototype.set=function(e,t){var n=xh(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},gf.prototype.has=function(e){return this.__data__.has(e)};var Xp=function(e,t,n,r){var i=e.length;for(n+=r?1:-1;r?n--:++n<i;)if(t(e[n],n,e))return n;return-1},cy=function(e){return e!=e},dy=function(e,t){var n;if(n=!(null==e||!e.length)){if(t==t)e:{n=-1;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=Xp(e,cy,0);n=-1<e}return n},ey=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1},fy=function(e,t){return e.has(t)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(e){return new Re(e)}:gy,vk=function(e,t,n){var r=-1,i=dy,o=e.length,s=!0,a=[],c=a;if(n)s=!1,i=ey;else if(200<=o){if(i=t?null:iy(e))return uk(i);s=!1,i=fy,c=new gf}else c=t?[]:a;e:for(;++r<o;){var u=e[r],l=t?t(u):u;if(u=n||0!==u?u:0,s&&l==l){for(var d=c.length;d--;)if(c[d]===l)continue e;t&&c.push(l),a.push(u)}else i(c,l,n)||(c!==a&&c.push(l),a.push(u))}return a},Yp=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},he=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},ee.prototype.get=function(e){return this.__data__.get(e)},ee.prototype.has=function(e){return this.__data__.has(e)},ee.prototype.set=function(e,t){var n=this.__data__;if(n instanceof rg){var r=n.__data__;if(!ag||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new qg(r)}return n.set(e,t),this.size=n.size,this};var ge=ee,Is=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},yh=function(){try{var e=Sd(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),bg=function(e,t,n){"__proto__"==t&&yh?yh(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},jy=Object.prototype.hasOwnProperty,Ml=function(e,t,n){var r=e[t];jy.call(e,t)&&$f(r,n)&&(void 0!==n||t in e)||bg(e,t,n)},re=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?bg(n,a,c):Ml(n,a,c)}return n},gc=function(e){return null!=e&&"object"==X(e)},Zp=function(e){return gc(e)&&"[object Arguments]"==Qd(e)},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(e){return gc(e)&&ky.call(e,"callee")&&!ly.call(e,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e;t=n&&n.exports===t?Cb.Buffer:void 0,e.exports=(t?t.isBuffer:void 0)||my})),ny=/^(?:0|[1-9]\d*)$/,wk=function(e,t){var n=X(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&ny.test(e))&&-1<e&&0==e%1&&e<t},xk=function(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(e){return gc(e)&&xk(e.length)&&!!Ea[Qd(e)]},zh=function(e){return function(t){return e(t)}},Se=$a((function(e,t){var n=t&&!t.nodeType&&t;n=(t=n&&e&&!e.nodeType&&e)&&t.exports===n&&Tp.process;e:{try{var r=t&&t.require&&t.require("util").types;if(r){var i=r;break e}i=n&&n.binding&&n.binding("util");break e}catch(e){}i=void 0}e.exports=i})),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(e,t){var n=Va(e),r=!n&&rf(e),i=!n&&!r&&jf(e),o=!n&&!r&&!i&&bi(e);if(n=n||r||i||o){r=e.length;for(var s=String,a=-1,c=Array(r);++a<r;)c[a]=s(a);r=c}else r=[];for(var u in s=r.length,e)!t&&!py.call(e,u)||n&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||wk(u,s))||r.push(u);return r},qy=Object.prototype,yk=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||qy)},cq=function(e,t){return function(n){return e(t(n))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(e){return null!=e&&xk(e.length)&&!qi(e)},Ad=function(e){if(Ed(e))e=bq(e);else if(yk(e)){var t,n=[];for(t in Object(e))sy.call(e,t)&&"constructor"!=t&&n.push(t);e=n}else e=ry(e);return e},Es=function(e,t){return e&&re(t,Ad(t),e)},ty=Object.prototype.hasOwnProperty,kf=function(e){if(Ed(e))e=bq(e,!0);else if(lb(e)){var t=yk(e),n=[];for(r in e)("constructor"!=r||!t&&ty.call(e,r))&&n.push(r);e=n}else{var r=[];if(null!=e)for(t in Object(e))r.push(t);e=r}return e},Cs=function(e,t){return e&&re(t,kf(t),e)},Jl=$a((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e,r=(t=n&&n.exports===t?Cb.Buffer:void 0)?t.allocUnsafe:void 0;e.exports=function(e,t){return t?e.slice():(t=e.length,t=r?r(t):new e.constructor(t),e.copy(t),t)}})),Xh=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},uy=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(e){return null==e?[]:(e=Object(e),uy(eq(e),(function(t){return vy.call(e,t)})))}:dq,Ds=function(e,t){return re(e,zk(e),t)},ai=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ai(t,zk(e)),e=Ak(e);return t}:dq,Bs=function(e,t){return re(e,fq(e),t)},gq=function(e,t,n){return t=t(e),Va(e)?t:ai(t,n(e))},Yh=function(e){return gq(e,Ad,zk)},Ll=function(e){return gq(e,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&"[object DataView]"!=Td(new Bk(new ArrayBuffer(1)))||ag&&"[object Map]"!=Td(new ag)||Ck&&"[object Promise]"!=Td(Ck.resolve())||Re&&"[object Set]"!=Td(new Re)||Dk&&"[object WeakMap]"!=Td(new Dk))&&(Td=function(e){var t=Qd(e);if(e=(e="[object Object]"==t?e.constructor:void 0)?Rd(e):"")switch(e){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return t});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&By.call(e,"index")&&(n.index=e.index,n.input=e.input),n},Ah=Cb.Uint8Array,Ek=function(e){var t=new e.constructor(e.byteLength);return new Ah(t).set(new Ah(e)),t},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(e,t){return t=t?Ek(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)},Fs=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Ek(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return t=n?Ek(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return(t=new e.constructor(e.source,Cy.exec(e))).lastIndex=e.lastIndex,t;case"[object Symbol]":return iq?Object(iq.call(e)):{}}},jq=Object.create,Dy=function(){function e(){}return function(t){return lb(t)?jq?jq(t):(e.prototype=t,t=new e,e.prototype=void 0,t):{}}}(),Kl=function(e){return"function"!=typeof e.constructor||yk(e)?{}:Dy(Ak(e))},Ey=function(e){return gc(e)&&"[object Map]"==hf(e)},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(e){return gc(e)&&"[object Set]"==hf(e)},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(e){return"symbol"==X(e)||gc(e)&&"[object Symbol]"==Qd(e)},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(e,t){if(Va(e))return!1;var n=X(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ie(e))||Hy.test(e)||!Gy.test(e)||null!=t&&e in Object(t)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(e){var t=(e=Zh(e,(function(e){return 500===t.size&&t.clear(),e}))).cache;return e}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Iy,(function(e,n,r,i){t.push(r?i.replace(Jy,"$1"):n||e)})),t})),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(e,t){return Va(e)?e:Fk(e,t)?[e]:Ky(null==e?"":Nl(e))},Ly=1/0,cg=function(e){if("string"==typeof e||ie(e))return e;var t=e+"";return"0"==t&&1/e==-Ly?"-0":t},Ch=function(e,t){for(var n=0,r=(t=Bh(t,e)).length;null!=e&&n<r;)e=e[cg(t[n++])];return n&&n==r?e:void 0},My=function(e,t){if(!(2>(t=Bh(t,e)).length)){var n=t,r=0,i=-1,o=-1,s=n.length;for(0>r&&(r=-r>s?0:s+r),0>(i=i>s?s:i)&&(i+=s),s=r>i?0:i-r>>>0,r>>>=0,i=Array(s);++o<s;)i[o]=n[o+r];e=Ch(e,i)}return(n=null==e)||(n=null==t?0:t.length,n=delete e[cg(n?t[n-1]:void 0)]),n},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(e){return!(!gc(e)||"[object Object]"!=Qd(e))&&(null===(e=Ak(e))||"function"==typeof(e=Ny.call(e,"constructor")&&e.constructor)&&e instanceof e&&nq.call(e)==Oy)},Py=function(e){return wm(e)?void 0:e},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(e){return Va(e)||rf(e)||!!(oq&&e&&e[oq])},Qy=function(e){return null!=e&&e.length?$h(e,1):[]},Ry=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},pq=Math.max,qq=function(e,t,n){return t=pq(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=pq(r.length-t,0),s=Array(o);++i<o;)s[i]=r[t+i];for(i=-1,o=Array(t+1);++i<t;)o[i]=r[i];return o[t]=n(s),Ry(e,this,o)}},Sy=function(e){return function(){return e}},Dh=function(e){return e},Ty=Date.now,rq=function(e){var t=0,n=0;return function(){var r=Ty(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(yh?function(e,t){return yh(e,"toString",{configurable:!0,enumerable:!1,value:Sy(t),writable:!0})}:Dh),Gk=(e=function(e,t){var n={};if(null==e)return n;var r=!1;t=he(t,(function(t){return t=Bh(t,e),r||(r=1<t.length),t})),re(e,Ll(e),n),r&&(n=fe(n,7,Py));for(var i=t.length;i--;)My(n,t[i]);return n},rq(qq(e,void 0,Qy),e+"")),Uy=function(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var s=e[i];t(r,s,n(s),e)}return r},um=function(e,t,n){for(var r=-1,i=Object(e),o=(n=n(e)).length;o--;){var s=n[++r];if(!1===t(i[s],s,i))break}return e},sq=function(e,t){return e&&um(e,t,Ad)},Hk=function(e,t){return function(t,n){if(null==t)return t;if(!Ed(t))return e(t,n);for(var r=t.length,i=-1,o=Object(t);++i<r&&!1!==n(o[i],i,o););return t}}(sq),Vy=function(e,t,n,r){return Hk(e,(function(e,i,o){t(r,e,n(e),o)})),r},tq=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Pl=function(e,t,n,r,i,o){var s=1&n,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;c=o.get(e);var u=o.get(t);if(c&&u)return c==t&&u==e;c=-1,u=!0;var l=2&n?new gf:void 0;for(o.set(e,t),o.set(t,e);++c<a;){var d=e[c],h=t[c];if(r)var p=s?r(h,d,c,t,e,o):r(d,h,c,e,t,o);if(void 0!==p){if(p)continue;u=!1;break}if(l){if(!tq(t,(function(e,t){if(!l.has(t)&&(d===e||i(d,e,n,r,o)))return l.push(t)}))){u=!1;break}}else if(d!==h&&!i(d,h,n,r,o)){u=!1;break}}return o.delete(e),o.delete(t),u},Wy=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(e,t,n,r,i,o,s){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!o(new Ah(e),new Ah(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=Wy;case"[object Set]":if(a||(a=uk),e.size!=t.size&&!(1&r))break;return(n=s.get(e))?n==t:(r|=2,s.set(e,t),t=Pl(a(e),a(t),r,i,o,s),s.delete(e),t);case"[object Symbol]":if(Ik)return Ik.call(e)==Ik.call(t)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(e,t,n,r){var i=n.length,o=i,s=!r;if(null==e)return!o;for(e=Object(e);i--;){var a=n[i];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<o;){var c=(a=n[i])[0],u=e[c],l=a[1];if(s&&a[2]){if(void 0===u&&!(c in e))return!1}else{if(a=new ge,r)var d=r(u,l,c,e,t,a);if(void 0===d?!je(l,u,3,r,a):!d)return!1}}return!0},Yy=function(e){for(var t=Ad(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!lb(i)]}return t},vq=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},Zy=function(e){var t=Yy(e);return 1==t.length&&t[0][2]?vq(t[0][0],t[0][1]):function(n){return n===e||Xy(n,e,t)}},$y=function(e,t){return Fk(e)&&t==t&&!lb(t)?vq(cg(e),t):function(n){var r=null==n?void 0:Ch(n,e);if(void 0===(r=void 0===r?void 0:r)&&r===t){if(r=null!=n){for(var i=-1,o=(r=Bh(r=e,n)).length,s=!1;++i<o;){var a=cg(r[i]);if(!(s=null!=n&&null!=n&&a in Object(n)))break;n=n[a]}r=s||++i!=o?s:!!(o=null==n?0:n.length)&&xk(o)&&wk(a,o)&&(Va(n)||rf(n))}a=r}else a=je(t,r,3);return a}},az=function(e){return function(t){return null==t?void 0:t[e]}},bz=function(e){return function(t){return Ch(t,e)}},Te=function(e){return"function"==typeof e?e:null==e?Dh:"object"==X(e)?Va(e)?$y(e[0],e[1]):Zy(e):Fk(e)?az(cg(e)):bz(e)},Jk=function(e,t){return function(t,n){return(Va(t)?Uy:Vy)(t,e,Te(n),{})}}((function(e,t,n){bg(e,n,t)})),uc=function(e,t){var n={};return t=Te(t),sq(e,(function(e,r,i){bg(n,r,t(e,r,i))})),n},e;N({target:"String",proto:!0,forced:R((function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length}))},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(c){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var t=Gb(e),n=this.div(t);return t=n.mul(t).sub(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}n=Gb(sg(e,6),this.unsigned),t=this;for(var r="";;){var i=t.div(n),o=(t.sub(i.mul(n)).toInt()>>>0).toString(e);if((t=i).isZero())return o+r;for(;6>o.length;)o="0"+o;r=""+o+r}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},D.isZero=function(){return 0===this.high&&0===this.low},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return 1==(1&this.low)},D.isEven=function(){return 0==(1&this.low)},D.equals=function(e){return mb(e)||(e=Wb(e)),(this.unsigned===e.unsigned||1!=this.high>>>31||1!=e.high>>>31)&&this.high===e.high&&this.low===e.low},D.eq=D.equals,D.notEquals=function(e){return!this.eq(e)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(e){return 0>this.comp(e)},D.lt=D.lessThan,D.lessThanOrEqual=function(e){return 0>=this.comp(e)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(e){return 0<this.comp(e)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(e){return 0<=this.comp(e)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(e){if(mb(e)||(e=Wb(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(e){mb(e)||(e=Wb(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=e.high>>>16,o=65535&e.high,s=e.low>>>16;return r=(s=((e=(65535&this.low)+(65535&e.low))>>>16)+(r+s))>>>16,ya((65535&s)<<16|65535&e,(t=((r+=n+o)>>>16)+(t+i)&65535)<<16|65535&r,this.unsigned)},D.subtract=function(e){return mb(e)||(e=Wb(e)),this.add(e.neg())},D.sub=D.subtract,D.multiply=function(e){if(this.isZero())return Hb;if(mb(e)||(e=Wb(e)),Qb){var t=Qb.mul(this.low,this.high,e.low,e.high);return ya(t,Qb.get_high(),this.unsigned)}if(e.isZero())return Hb;if(this.eq(nb))return e.isOdd()?nb:Hb;if(e.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(wq)&&e.lt(wq))return Gb(this.toNumber()*e.toNumber(),this.unsigned);t=this.high>>>16;var n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,a=e.low>>>16,c=i*(e=65535&e.low),u=(c>>>16)+r*e,l=u>>>16;l+=(u=(65535&u)+i*a)>>>16;var d=(l+=n*e)>>>16;return ya((65535&u)<<16|65535&c,(d=(d+=(l=(65535&l)+r*a)>>>16)+((l=(65535&l)+i*s)>>>16)+(t*e+n*a+r*s+i*o)&65535)<<16|65535&l,this.unsigned)},D.mul=D.multiply,D.divide=function(e){if(mb(e)||(e=Wb(e)),e.isZero())throw Error("division by zero");if(Qb)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?ya(e=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Cd;if(e.gt(this.shru(1)))return xq;var t=Cd}else{if(this.eq(nb)){if(e.eq(Ue)||e.eq(Kk))return nb;if(e.eq(nb))return Ue;var n=this.shr(1).div(e).shl(1);if(n.eq(Hb))return e.isNegative()?Ue:Kk;var r=this.sub(e.mul(n));return n.add(r.div(e))}if(e.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();t=Hb}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));var i=Math.ceil(Math.log(n)/Math.LN2);i=48>=i?1:sg(2,i-48);for(var o=Gb(n),s=o.mul(e);s.isNegative()||s.gt(r);)s=(o=Gb(n-=i,this.unsigned)).mul(e);o.isZero()&&(o=Ue),t=t.add(o),r=r.sub(s)}return t},D.div=D.divide,D.modulo=function(e){return mb(e)||(e=Wb(e)),Qb?ya(e=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(e){return mb(e)||(e=Wb(e)),ya(this.low&e.low,this.high&e.high,this.unsigned)},D.or=function(e){return mb(e)||(e=Wb(e)),ya(this.low|e.low,this.high|e.high,this.unsigned)},D.xor=function(e){return mb(e)||(e=Wb(e)),ya(this.low^e.low,this.high^e.high,this.unsigned)},D.shiftLeft=function(e){return mb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?ya(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ya(0,this.low<<e-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(e){return mb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?ya(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ya(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(e){if(mb(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return 32>e?ya(this.low>>>e|t<<32-e,t>>>e,this.unsigned):ya(32===e?t:t>>>e-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},D.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},xa.fromBytes=function(e,t,n){return n?xa.fromBytesLE(e,t):xa.fromBytesBE(e,t)},xa.fromBytesLE=function(e,t){return new xa(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},xa.fromBytesBE=function(e,t){return new xa(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var di=function(e,t){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=e},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(e){},error:function(e){if(Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)},complete:function(){}},Jb=Array.isArray||function(e){return e&&"number"==typeof e.length},lf=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Oa=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o)t[o].remove(this);if(le(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var s=e instanceof lf?Xl(e.errors):[e]}}if(Jb(i))for(o=-1,t=i.length;++o<t;)if(ei(n=i[o]))try{n.unsubscribe()}catch(e){s=s||[],e instanceof lf?s=s.concat(Xl(e.errors)):s.push(e)}if(s)throw new lf(s)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(X(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),Fh="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=Eh;break;case 1:if(!n){o.destination=Eh;break}if("object"===X(n)){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new yq(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new yq(o,n,r,i)}return o}return O(t,e),t.prototype[Fh]=function(){return this},t.create=function(e,n,r){return(e=new t(e,n,r)).syncErrorThrowable=!1,e},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=e,this},t}(Oa),yq=function(e){function t(t,n,r,i){var o=e.call(this)||this;if(o._parentSubscriber=t,t=o,le(n))var s=n;else n&&(s=n.next,r=n.error,i=n.complete,n!==Eh&&(le((t=Object.create(n)).unsubscribe)&&o.add(t.unsubscribe.bind(t)),t.unsubscribe=o.unsubscribe.bind(o)));return o._context=t,o._next=s,o._error=r,o._complete=i,o}return O(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?this.__tryOrSetError(t,this._error,e):this.__tryOrUnsub(this._error,e),this.unsubscribe();else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):me(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;me(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Ib.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,n):this.__tryOrUnsub(n)}this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{t.call(this._context,n)}catch(t){return Ib.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0):me(t),!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._parentSubscriber=this._context=null,e.unsubscribe()},t}(ia),ne="function"==typeof Symbol&&Symbol.observable||"@@observable",Y=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator;e:{if(e){if(e instanceof ia)break e;if(e[Fh]){e=e[Fh]();break e}}e=e||t||n?new ia(e,t,n):new ia(Eh)}if(r?e.add(r.call(e,this.source)):e.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!e.syncErrorThrowable?this._subscribe(e):this._trySubscribe(e)),Ib.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&(e.syncErrorThrowable=!1,e.syncErrorThrown))throw e.syncErrorValue;return e},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Ib.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),fi(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Zl(t))((function(t,r){var i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[ne]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Yl(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Zl(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}(),qd=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),zq=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return O(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;this.subject=null,!t||0===t.length||e.isStopped||e.closed||-1!==(e=t.indexOf(this.subscriber))&&t.splice(e,1)}},t}(Oa),Aq=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return O(t,e),t}(ia),Pa=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return O(t,e),t.prototype[Fh]=function(){return new Aq(this)},t.prototype.lift=function(e){var t=new Bq(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new qd;if(!this.isStopped){var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].next(e)}},t.prototype.error=function(e){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=e,this.isStopped=!0;var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var e=this.observers,t=e.length;e=e.slice();for(var n=0;n<t;n++)e[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new qd;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new qd;return this.hasError?(e.error(this.thrownError),Oa.EMPTY):this.isStopped?(e.complete(),Oa.EMPTY):(this.observers.push(e),new zq(this,e))},t.prototype.asObservable=function(){var e=new Y;return e.source=this,e},t.create=function(e,t){return new Bq(e,t)},t}(Y),Bq=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return O(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Oa.EMPTY},t}(Pa),Ns=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;return n._refCount++,e=new cz(e,n),t=t.subscribe(e),e.closed||(e.connection=n.connect()),t},e}(),cz=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null},t}(ia),Cq=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return O(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),e.closed&&(this._connection=null,e=Oa.EMPTY)),e},t.prototype.refCount=function(){return $l()(this)},t}(Y),At=function(){var e=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),dz=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(Aq);!function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null}}(ia),function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).keySelector=n,t.elementSelector=r,t.durationSelector=i,t.subjectSelector=o,t.groups=null,t.attemptedToUnsubscribe=!1,t.count=0,t}O(t,e),t.prototype._next=function(e){try{var t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r=n.get(t);if(this.elementSelector)try{var i=this.elementSelector(e)}catch(e){this.error(e)}else i=e;if(!r&&(r=this.subjectSelector?this.subjectSelector():new Pa,n.set(t,r),e=new Mk(t,r,this),this.destination.next(e),this.durationSelector)){e=void 0;try{e=this.durationSelector(new Mk(t,r))}catch(e){return void this.error(e)}this.add(e.subscribe(new ez(t,r,this)))}r.closed||r.next(i)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))}}(ia);var ez=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return O(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(ia),Mk=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return O(t,e),t.prototype._subscribe=function(e){var t=new Oa,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new fz(n)),t.add(r.subscribe(e)),t},t}(Y),fz=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return O(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),--t.count,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(Oa),gz=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return O(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Pa),dg=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return O(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,e=this.id;var n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return O(t,e),t.prototype.schedule=function(e,t){return this},t}(Oa)),hz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),0<n?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return 0<n||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(dg),Nk=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),eg=function(e){function t(n,r){void 0===r&&(r=Nk.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return O(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Nk),fg=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t}(eg))(hz),vb=new Y((function(e){return e.complete()})),am=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},Ok;!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(Ok||(Ok={}));var Ve=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Rs=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new Dq(e,this.scheduler,this.delay))},e}(),Dq=function(e){function t(t,n,r){return void 0===r&&(r=0),(t=e.call(this,t)||this).scheduler=n,t.delay=r,t}return O(t,e),t.dispatch=function(e){e.notification.observe(e.destination),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new iz(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Ve.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Ve.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},t}(ia),iz=function(e,t){this.notification=e,this.destination=t},qe=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=1>t?1:t,i._windowTime=1>n?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return O(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new jz(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var o=Oa.EMPTY;else this.observers.push(e),o=new zq(this,e);if(r&&e.add(e=new Dq(e,r)),t)for(t=0;t<i&&!e.closed;t++)e.next(n[t]);else for(t=0;t<i&&!e.closed;t++)e.next(n[t].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),o},t.prototype._getNow=function(){return(this.scheduler||fg).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),0<o&&r.splice(0,o),r},t}(Pa),jz=function(e,t){this.time=e,this.value=t},of=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return O(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),Oa.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(e){var t=kz++;return ii[t]=!0,lz.then((function(){return bm(t)&&e()})),t},clearImmediate:function(e){bm(e)}},mz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=Eq.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(Eq.clearImmediate(n),t.scheduled=void 0)},t}(dg),ri=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(dg),Fq=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(eg))(oz),pz=function(e){function t(t,n){void 0===t&&(t=Gq),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return O(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(eg),Gq=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return O(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),this.delay=e.frame+r,(e=e.actions).push(this),e.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(dg),Qk=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),vg=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),pb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Ss=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new qz(e,this.project,this.thisArg))},e}(),qz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).project=n,t.count=0,t.thisArg=r||t,t}return O(t,e),t.prototype._next=function(e){try{var t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ia),Rk=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(ia),Xs=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(ia),rz=function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,me),t}},$c="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(e){return function(t){for(var n=e[$c]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t}},tz=function(e){return function(t){var n=e[ne]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}},hm=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},pf=function(e){if(e&&"function"==typeof e[ne])return tz(e);if(hm(e))return am(e);if(fm(e))return rz(e);if(e&&"function"==typeof e[$c])return sz(e);throw e=ei(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new uz(e,this.resultSelector))},e}(),uz=function(e){function t(t,n){return(t=e.call(this,t)||this).resultSelector=n,t.active=0,t.values=[],t.observables=[],t}return O(t,e),t.prototype._next=function(e){this.values.push(Hq),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.toRespond=this.active=t;for(var n=0;n<t;n++)this.add(ji(this,e[n],void 0,n))}},t.prototype.notifyComplete=function(e){0==--this.active&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=(e=this.values)[n];r=this.toRespond?r===Hq?--this.toRespond:this.toRespond:0,e[n]=t,0===r&&(this.resultSelector?this._tryResultSelector(e):this.destination.next(e.slice()))},t.prototype._tryResultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Rk),vc=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(ia);!function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i}O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(ia);var wc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(ia);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}O(t,e),t.prototype.notifyNext=function(e,t,n,r){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()}}(ia);var at=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new wz(e,this.project,this.concurrent))},e}(),wz=function(e){function t(t,n,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),(t=e.call(this,t)||this).project=n,t.concurrent=r,t.hasCompleted=!1,t.buffer=[],t.active=0,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new vc(this),n=this.destination;n.add(t),(e=ic(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(wc),Sk=y.parseFloat,Iq=-1/0!=1/Sk("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff-0")?function(e){e=ik(String(e));var t=Sk(e);return 0===t&&"-"==e.charAt(0)?-0:t}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new xz(e,this.predicate,this.thisArg))},e}(),xz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.thisArg=r,t.count=0,t}return O(t,e),t.prototype._next=function(e){try{var t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(ia),gt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new yz(e))},e}(),yz=function(e){function t(t){return(t=e.call(this,t)||this).hasFirst=!1,t.observables=[],t.subscriptions=[],t}return O(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=ji(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){for(this.hasFirst=!0,e=0;e<this.subscriptions.length;e++)if(e!==n){var r=this.subscriptions[e];r.unsubscribe(),this.remove(r)}this.subscriptions=null}this.destination.next(t)},t}(Rk),jt=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new zz(e,this.resultSelector))},e}(),zz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).resultSelector=n,t.iterators=[],t.active=0,t.resultSelector="function"==typeof n?n:void 0,t}return O(t,e),t.prototype._next=function(e){var t=this.iterators;Jb(e)?t.push(new Az(e)):"function"==typeof e[$c]?t.push(new Bz(e[$c]())):t.push(new Cz(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0===t)this.destination.complete();else{this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){var i=e[r];if("function"==typeof i.hasValue&&!i.hasValue())return}var o=!1,s=[];for(r=0;r<t;r++){var a=(i=e[r]).next();if(i.hasCompleted()&&(o=!0),a.done)return void n.complete();s.push(a.value)}this.resultSelector?this._tryresultSelector(s):n.next(s),o&&n.complete()},t.prototype._tryresultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ia),Bz=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return!(!e||!e.done)},e}(),Az=function(){function e(e){this.array=e,this.length=this.index=0,this.length=e.length}return e.prototype[$c]=function(){return this},e.prototype.next=function(e){e=this.index++;var t=this.array;return e<this.length?{value:t[e],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Cz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).parent=n,t.observable=r,t.stillUnsubscribed=!0,t.buffer=[],t.isComplete=!1,t}return O(t,e),t.prototype[$c]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return 0<this.buffer.length},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return ic(this.observable,new vc(this))},t}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(e){return!!e&&(e instanceof Y||"function"==typeof e.lift&&"function"==typeof e.subscribe)},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=t=void 0;return Zc(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&Jb(e[0])&&(e=e[0]),nf(e,n).lift(new vz(t))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(e,t,n,r,i){if(1==arguments.length){var o=e.initialState;t=e.condition,n=e.iterate;var s=e.resultSelector||Yc;i=e.scheduler}else void 0===r||Zc(r)?(o=e,s=Yc,i=r):(o=e,s=r);return new Y((function(e){var r=o;if(i)return i.schedule(bt,0,{subscriber:e,iterate:n,condition:t,resultSelector:s,state:r});for(;;){if(t){var a=void 0;try{a=t(r)}catch(t){e.error(t);break}if(!a){e.complete();break}}a=void 0;try{a=s(r)}catch(t){e.error(t);break}if(e.next(a),e.closed)break;try{r=n(r)}catch(t){e.error(t);break}}}))},iif:function(e,t,n){return void 0===t&&(t=vb),void 0===n&&(n=vb),ad((function(){return e()?t:n}))},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(e,t){return new Y(t?function(n){var r=Object.keys(e),i=new Oa;return i.add(t.schedule(dt,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}:function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},partition:function(e,t,n){return[wb(t,n)(new Y(pf(e))),wb(et(t,n))(new Y(pf(e)))]},race:Ca,range:function(e,t,n){return void 0===e&&(e=0),new Y((function(r){void 0===t&&(t=e,e=0);var i=0,o=e;if(n)return n.schedule(ht,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(o++),r.closed)break}}))},throwError:Z,timer:Bc,using:function(e,t){return new Y((function(n){try{var r=e()}catch(e){return void n.error(e)}try{var i=t(r)}catch(e){return void n.error(e)}var o=(i?Kb(i):vb).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ez(e,this.selector,this.caught))},e}(),Ez=function(e){function t(t,n,r){return(t=e.call(this,t)||this).selector=n,t.caught=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle(),t=new vc(this),this.add(t),(n=ic(n,t))!==t&&this.add(n)}},t}(wc),lt=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new Fz(e,this.defaultValue))},e}(),Fz=function(e){function t(t,n){return(t=e.call(this,t)||this).defaultValue=n,t.isEmpty=!0,t}return O(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(ia),mt=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Gz(e,this.delay,this.scheduler))},e}(),Gz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).delay=n,t.scheduler=r,t.queue=[],t.active=!1,t.errored=!1,t}return O(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;0<n.length&&0>=n[0].time-r.now();)n.shift().notification.observe(i);0<n.length?(t=Math.max(0,n[0].time-r.now()),this.schedule(e,t)):(this.unsubscribe(),t.active=!1)},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler;e=new Hz(t.now()+this.delay,e),this.queue.push(e),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(Ve.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},t}(ia),Hz=function(e,t){this.time=e,this.notification=t},nt=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new Iz(e,this.keySelector,this.flushes))},e}(),Iz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).keySelector=n,t.values=new Set,r&&t.add(ic(r,new vc(t))),t}return O(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t=this.destination;try{var n=this.keySelector(e)}catch(e){return void t.error(e)}this._finalizeNext(n,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(wc),pt=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new Jz(e,this.errorFactory))},e}(),Jz=function(e){function t(t,n){return(t=e.call(this,t)||this).errorFactory=n,t.hasValue=!1,t}return O(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(ia),qt=function(){function e(e){if(this.total=e,0>this.total)throw new Qk}return e.prototype.call=function(e,t){return t.subscribe(new Kz(e,this.total))},e}(),Kz=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(ia),rt=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Lz(e,this.project))},e}(),Lz=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.hasSubscription=!1,t.hasCompleted=!1,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new vc(this),n=this.destination;n.add(t),(e=ic(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(wc),st=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new Mz(e,this.callback))},e}(),Mz=function(e){function t(t,n){return(t=e.call(this,t)||this).add(new Oa(n)),t}return O(t,e),t}(ia),ut=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Nz(e))},e}(),Nz=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype._next=function(e){},t}(ia),vt=function(){function e(e){if(this.total=e,0>this.total)throw new Qk}return e.prototype.call=function(e,t){return t.subscribe(new Oz(e,this.total))},e}(),Oz=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.ring=[],t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(0<t)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(ia),wt=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new Pz(e,this.value))},e}(),Pz=function(e){function t(t,n){return(t=e.call(this,t)||this).value=n,t}return O(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(ia),xt=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new Qz(e,this.accumulator,this.seed,this.hasSeed))},e}(),Qz=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this).accumulator=n,t._seed=r,t.hasSeed=i,t.index=0,t}return O(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.accumulator(this.seed,e,t)}catch(e){this.destination.error(e)}this.seed=n,this.destination.next(n)},t}(ia),zt=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory();return(e=n(r).subscribe(e)).add(t.subscribe(r)),e},e}(),Bt=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Rz(e,this.notifier,this.source))},e}(),Rz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).notifier=n,t.source=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.retriesSubscription=this.errors=void 0;else{n=new Pa;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=ic(r,new vc(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(wc),Et=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Sz(e,this.project))},e}(),Sz=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this._innerSub(n)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),t=new vc(this);var n=this.destination;n.add(t),this.innerSubscription=ic(e,t),this.innerSubscription!==t&&n.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(wc),Ft=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){e=new Tz(e);var n=ic(this.notifier,new vc(e));return n&&!e.seenValue?(e.add(n),t.subscribe(e)):e},e}(),Tz=function(e){function t(t){return(t=e.call(this,t)||this).seenValue=!1,t}return O(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(wc),Ht=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new Uz(e,this.predicate,this.inclusive))},e}(),Uz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.inclusive=r,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.destination;try{var n=this.predicate(e,this.index++)}catch(e){return void t.error(e)}this.nextOrComplete(e,n)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;t?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(ia),It=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new Vz(e,this.nextOrObserver,this.error,this.complete))},e}(),Vz=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this)._tapNext=hc,t._tapError=hc,t._tapComplete=hc,t._tapError=r||hc,t._tapComplete=i||hc,le(n)?(t._context=t,t._tapNext=n):n&&(t._context=n,t._tapNext=n.next||hc,t._tapError=n.error||hc,t._tapComplete=n.complete||hc),t}return O(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(ia),Kt={leading:!0,trailing:!1};!function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}O(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._sendValue;this._hasValue&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){(e=this.tryDurationSelector(e))&&this.add(this._throttled=ic(e,new vc(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()}}(wc);for(var Lt=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new Wz(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Wz=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).duration=n,t.scheduler=r,t.leading=i,t.trailing=o,t._hasTrailingValue=!1,t._trailingValue=null,t}return O(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(ia),Ot=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Xz(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Xz=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).absoluteTimeout=n,t.waitFor=r,t.withObservable=i,t.scheduler=o,t.scheduleTimeout(),t}return O(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(ic(t,new vc(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},t}(wc),Qt=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new Yz(e,this.observables,this.project))},e}(),Yz=function(e){function t(t,n,r){(t=e.call(this,t)||this).observables=n,t.project=r,t.toRespond=[],r=n.length,t.values=Array(r);for(var i=0;i<r;i++)t.toRespond.push(i);for(i=0;i<r;i++)t.add(ji(t,n[i],void 0,i));return t}return O(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t,0<(e=this.toRespond).length&&-1!==(n=e.indexOf(n))&&e.splice(n,1)},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){0===this.toRespond.length&&(e=[e].concat(this.values),this.project?this._tryProject(e):this.destination.next(e))},t.prototype._tryProject=function(e){try{var t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Rk),Jq=$a((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=Array(16);e.exports=function(){for(var e,t=0;16>t;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}})),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(e,t){return t=t||0,[ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]]].join("")},Ud=function(e,t,n){if(n=t&&n||0,"string"==typeof e&&(t="binary"===e?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Jq)())[6]=15&e[6]|64,e[8]=63&e[8]|128,t)for(var r=0;16>r;++r)t[n+r]=e[r];return t||Kq(e)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;!function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"}(Pc||(Pc={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(e){e[e.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e[e.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e[e.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e[e.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e[e.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e){e[e.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e[e.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e[e.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e[e.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e[e.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(e,t){var n;return Hk(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n},Mh=function(e,t,n){if(!lb(n))return!1;var r=X(t);return!!("number"==r?Ed(n)&&wk(t,n.length):"string"==r&&t in n)&&$f(n[t],e)},dl=function(e,t,n){var r=Va(e)?tq:DA;return n&&Mh(e,t,n)&&(t=void 0),r(e,Te(t))},EA=function(e,t){var n=-1,r=Ed(e)?Array(e.length):[];return Hk(e,(function(e,i,o){r[++n]=t(e,i,o)})),r},FA=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e},GA=function(e,t,n){t=t.length?he(t,(function(e){return Va(e)?function(t){return Ch(t,1===e.length?e[0]:e)}:e})):[Dh];var r=-1;return t=he(t,zh(Te)),e=EA(e,(function(e,n,i){return{criteria:he(t,(function(t){return t(e)})),index:++r,value:e}})),FA(e,(function(e,t){e:{for(var r=-1,i=e.criteria,o=t.criteria,s=i.length,a=n.length;++r<s;){t:{var c=i[r],u=o[r];if(c!==u){var l=void 0!==c,d=null===c,h=c==c,p=ie(c),f=void 0!==u,m=null===u,g=u==u,_=ie(u);if(!m&&!_&&!p&&c>u||p&&f&&g&&!m&&!_||d&&f&&g||!l&&g||!h){c=1;break t}if(!d&&!p&&!_&&c<u||_&&l&&h&&!d&&!p||m&&l&&h||!f&&h||!g){c=-1;break t}}c=0}if(c){e=r>=a?c:c*("desc"==n[r]?-1:1);break e}}e=e.index-t.index}return e}))},jr=function(e,t){return rq(qq(e,t,Dh),e+"")},kr=jr((function(e,t){if(null==e)return[];var n=t.length;return 1<n&&Mh(e,t[0],t[1])?t=[]:2<n&&Mh(t[0],t[1],t[2])&&(t=[t[0]]),GA(e,$h(t,1),[])})),lr=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}(Dz),mr=$a((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[],r=function(e,t){return new WebSocket(e,t)};t.normalClosureMessage="Normal closure",t.default=function(e,i){var o=(i=void 0===i?{protocols:n,makeWebSocket:r}:i).protocols,s=void 0===o?n:o,a=void 0===(i=i.makeWebSocket)?r:i;return new lr.Observable((function(n){var r,i=new lr.Subject,o=a(e,s),c=!1,u=!1,l=function(e){if(r)throw c=!0,e=Error("Web socket message factory function called more than once"),n.error(e),e;return r=e.subscribe((function(e){o.send(e)})),i};return o.onopen=function(){u?(c=!0,o.close()):n.next(l)},o.onmessage=function(e){i.next(e.data)},o.onerror=function(e){c=!0,n.error(Error(e.message))},o.onclose=function(e){c||(c=!0,u?(n.complete(),i.complete()):n.error(Error(1e3===e.code?t.normalClosureMessage:e.reason)))},function(){u=!0,r&&r.unsubscribe(),c||(c=!0,o.close())}}))}}));!function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default}(mr);var pi=function(e,t,n){(void 0===n||$f(e[t],n))&&(void 0!==n||t in e)||bg(e,t,n)},oi=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},HA=function(e){return jr((function(t,n){var r=-1,i=n.length,o=1<i?n[i-1]:void 0,s=2<i?n[2]:void 0;for(o=3<e.length&&"function"==typeof o?(i--,o):void 0,s&&Mh(n[0],n[1],s)&&(o=3>i?void 0:o,i=1),t=Object(t);++r<i;)(s=n[r])&&e(t,s,r,o);return t}))}((function(e,t,n,r){tm(e,t,n,r)})),IA=Math.floor,JA=Math.random,nr=function(e,t){return e+IA(JA()*(t-e+1))},or=function(e){var t=e.length;return t?e[nr(0,t-1)]:void 0},KA=function(e,t){return he(t,(function(t){return e[t]}))},Ni=function(e){return null==e?[]:KA(e,Ad(e))},LA=function(e){return or(Ni(e))},bn=function(e){return(Va(e)?or:LA)(e)},xm=[],ym=function(e,t){return new WebSocket(e,t)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(e){return!ha(e)&&isFinite(e)&&MA(e)===e}}),Oo("from",Ej,Dj);var NA=function(e,t){for(var n=Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,s){n[r]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,s(e))}}))},OA=$a((function(e,t){t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};var n=Array(64),r=Array(123);for(e=0;64>e;)r[n[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;t.encode=function(e,t,r){for(var i,o=null,s=[],a=0,c=0;t<r;){var u=e[t++];switch(c){case 0:s[a++]=n[u>>2],i=(3&u)<<4,c=1;break;case 1:s[a++]=n[i|u>>4],i=(15&u)<<2,c=2;break;case 2:s[a++]=n[i|u>>6],s[a++]=n[63&u],c=0}8191<a&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=n[i],s[a++]=61,1===c&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))},t.decode=function(e,t,n){for(var i,o=n,s=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&1<s)break;if(void 0===(c=r[c]))throw Error("invalid encoding");switch(s){case 0:i=c,s=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,s=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,s=3;break;case 3:t[n++]=(3&i)<<6|c,s=0}}if(1===s)throw Error("invalid encoding");return n-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}));yg.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},yg.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else{e=this._listeners[e];for(var n=0;n<e.length;)e[n].fn===t?e.splice(n,1):++n}return this},yg.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},RA=$a((function(e,t){t.length=function(e){for(var t,n=0,r=0;r<e.length;++r)128>(t=e.charCodeAt(r))?n+=1:2048>t?n+=2:55296==(64512&t)&&56320==(64512&e.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},t.read=function(e,t,n){if(1>n-t)return"";for(var r,i=null,o=[],s=0;t<n;)128>(r=e[t++])?o[s++]=r:191<r&&224>r?o[s++]=(31&r)<<6|63&e[t++]:239<r&&365>r?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],8191<s&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},t.write=function(e,t,n){for(var r,i,o=n,s=0;s<e.length;++s)128>(r=e.charCodeAt(s))?t[n++]=r:(2048>r?t[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-o}})),SA=function(e,t,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){return 1>n||n>i?e(n):(s+n>r&&(o=e(r),s=0),n=t.call(o,s,s+=n),7&s&&(s=1+(7|s)),n)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(e){if(0===e)return Xd;var t=0>e;t&&(e=-e);var n=e>>>0;return e=(e-n)/4294967296>>>0,t&&(e=~e>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++e&&(e=0))),new Wa(n,e)},Wa.from=function(e){if("number"==typeof e)return Wa.fromNumber(e);if(V.isString(e)){if(!V.Long)return Wa.fromNumber(parseInt(e,10));e=V.Long.fromString(e)}return e.low||e.high?new Wa(e.low>>>0,e.high>>>0):Xd},Wa.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var t=~this.hi>>>0;return e||(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(e){return V.Long?new V.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var td=String.prototype.charCodeAt;Wa.fromHash=function(e){return e===TA?Xd:new Wa((td.call(e,0)|td.call(e,1)<<8|td.call(e,2)<<16|td.call(e,3)<<24)>>>0,(td.call(e,4)|td.call(e,5)<<8|td.call(e,6)<<16|td.call(e,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Wa.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Wa.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>n?9:10};var V=$a((function(e,t){function n(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=NA,t.base64=OA,t.EventEmitter=yg,t.float=PA,t.inquire=QA,t.utf8=RA,t.pool=SA,t.LongBits=Wa,t.isNode=!!(void 0!==Ya&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),t.global=t.isNode&&Ya||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||Ya,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"===X(e)},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==X(n)||0<(Array.isArray(n)?n.length:Object.keys(n).length))},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){return e=t.LongBits.fromHash(e),t.Long?t.Long.fromBits(e.lo,e.hi,n):e.toNumber(!!n)},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;-1<n;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}})),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(e){return new V.Array(e)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(e,t,n){return this.tail=this.tail.next=new sf(e,t,n),this.len+=t,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e},ja.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new ui(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},ja.prototype.int32=function(e){return 0>e?this._push(vi,10,Nh.fromNumber(e)):this.uint32(e)},ja.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ja.prototype.uint64=function(e){return e=Nh.from(e),this._push(vi,e.length(),e)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(e){return e=Nh.from(e).zzEncode(),this._push(vi,e.length(),e)},ja.prototype.bool=function(e){return this._push(ti,1,e?1:0)},ja.prototype.fixed32=function(e){return this._push(wi,4,e>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(e){return e=Nh.from(e),this._push(wi,4,e.lo)._push(wi,4,e.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(e){return this._push(V.float.writeFloatLE,4,e)},ja.prototype.double=function(e){return this._push(V.float.writeDoubleLE,8,e)};var UA=V.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};ja.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(ti,1,0);if(V.isString(e)){var n=ja.alloc(t=pr.length(e));pr.decode(e,n,0),e=n}return this.uint32(t)._push(UA,t,e)},ja.prototype.string=function(e){var t=qr.length(e);return t?this.uint32(t)._push(qr.write,t,e):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},ja.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},ja._configure=function(e){el=e,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&"set"===V.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},jc.prototype.bytes=function(e){V.isString(e)&&(e=V._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(jc.writeBytesBuffer,t,e),this},jc.prototype.string=function(e){var t=V.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Ut,t,e),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new La(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new La(e);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(e){return(La.create=function(e){return V.Buffer.isBuffer(e)?new fl(e):sr(e)})(e)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return e}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},La.prototype.bool=function(){return 0!==this.uint32()},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var e=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var e=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},La.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Yb(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},La.prototype.string=function(){var e=this.bytes();return VA.read(e,0,e.length)},La.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw Yb(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Yb(this)}while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},La._configure=function(e){fl=e,La.create=tr(),fl._configure();var t=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[t](!1)},uint64:function(){return yi.call(this)[t](!0)},sint64:function(){return yi.call(this).zzDecode()[t](!1)},fixed64:function(){return Fm.call(this)[t](!0)},sfixed64:function(){return Fm.call(this)[t](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return V.asPromise(e,s,t,n,r,i);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return s.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),o(e)}return s.emit("data",n,t),o(null,n)}s.end(!0)}))}catch(e){s.emit("error",e,t),setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},tf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a((function(e,t){t.Service=tf})),XA={},fc=$a((function(e,t){function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}var r=t;r.build="minimal",r.Writer=xi,r.BufferWriter=jc,r.Reader=zi,r.BufferReader=Fd,r.util=V,r.rpc=WA,r.roots=XA,r.configure=n,n()}));fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var e={},t=Object.create(e);return t[e[0]="Unknown"]=0,t[e[1]="PingUri"]=1,t[e[2]="PongUri"]=2,t[e[11]="UserJoinUri"]=11,t[e[12]="UserRespUri"]=12,t[e[21]="UserQuitUri"]=21,t[e[22]="UserDropUri"]=22,t[e[31]="GroupEnterUri"]=31,t[e[32]="GroupLeaveUri"]=32,t[e[33]="GroupReplyUri"]=33,t[e[36]="GroupEnterNoticeUri"]=36,t[e[37]="GroupLeaveNoticeUri"]=37,t[e[38]="GroupEventNoticeUri"]=38,t[e[39]="GroupCountNoticeUri"]=39,t[e[41]="UserStatusListUri"]=41,t[e[42]="UserStatusResultUri"]=42,t[e[51]="GroupStatusListUri"]=51,t[e[52]="GroupStatusResultUri"]=52,t[e[55]="GroupAllUsersListUri"]=55,t[e[56]="GroupAllUsersResultUri"]=56,t[e[100]="MessageUri"]=100,t[e[101]="AckUri"]=101,t[e[115]="FileUploadIndexGetUri"]=115,t[e[116]="FileUploadIndexRetUri"]=116,t[e[117]="FileUploadIndexSetUri"]=117,t[e[118]="FileUploadIndexFinUri"]=118,t[e[119]="FileUploadIndexErrUri"]=119,t[e[125]="FileDownloadIndexGetUri"]=125,t[e[126]="FileDownloadIndexRetUri"]=126,t[e[127]="FileDownloadIndexErrUri"]=127,t[e[201]="UserJoinNoticeUri"]=201,t[e[202]="UserQuitNoticeUri"]=202,t[e[203]="UserWaitNoticeUri"]=203,t[e[301]="UserAttributeGetUri"]=301,t[e[302]="UserAttributeRetUri"]=302,t[e[303]="UserAttributeSetUri"]=303,t[e[304]="UserAttributeModUri"]=304,t[e[305]="UserAttributeDelUri"]=305,t[e[307]="UserAttributeRspUri"]=307,t[e[308]="UserAttributeErrUri"]=308,t[e[311]="UserAttributeKeysGetUri"]=311,t[e[312]="UserAttributeKeysRetUri"]=312,t[e[351]="GroupAttributeGetUri"]=351,t[e[352]="GroupAttributeRetUri"]=352,t[e[353]="GroupAttributeSetUri"]=353,t[e[354]="GroupAttributeModUri"]=354,t[e[355]="GroupAttributeDelUri"]=355,t[e[356]="GroupAttributeAltUri"]=356,t[e[357]="GroupAttributeRspUri"]=357,t[e[358]="GroupAttributeErrUri"]=358,t[e[361]="GroupAttributeKeysGetUri"]=361,t[e[362]="GroupAttributeKeysRetUri"]=362,t[e[401]="SubscribeUserStatusUri"]=401,t[e[402]="UnsubscribeUserStatusUri"]=402,t[e[499]="SubscribeResponseUri"]=499,t}(),Oh=t.Wrapper=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.uri=0,e.prototype.data=q.newBuffer([]),e.encode=function(e,t){return t||(t=L.create()),null!=e.uri&&Object.hasOwnProperty.call(e,"uri")&&t.uint32(8).int32(e.uri),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Wrapper;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.uri=e.int32();break;case 2:r.data=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),ZA=t.Ping=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ping;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),$A=t.Pong=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Pong;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),aB=t.UserJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.opt&&Object.hasOwnProperty.call(e,"opt")&&t.uint32(16).uint64(e.opt),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(34).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(42).string(e.ticket),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.opt=e.uint64();break;case 3:r.instance=e.uint64();break;case 4:r.account=e.string();break;case 5:r.ticket=e.string();break;default:e.skipType(7&i)}}return r},e}(),bB=t.UserResp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserResp;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),cB=t.UserQuit=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.encode=function(e,t){return t||(t=L.create()),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuit;e.pos<n;){var i=e.uint32();e.skipType(7&i)}return r},e}(),dB=t.UserDrop=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserDrop;e.pos<n;){var i=e.uint32();i>>>3===1?r.code=e.uint32():e.skipType(7&i)}return r},e}(),eB=t.GroupEnter=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnter;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),fB=t.GroupLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeave;e.pos<n;){var i=e.uint32();i>>>3===1?r.account=e.string():e.skipType(7&i)}return r},e}(),gB=t.GroupReply=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupReply;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),ur=t.GroupLeaveNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeaveNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),vr=t.GroupEnterNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnterNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),wr=t.Message=function(){function e(e){if(this.MiscMap={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=q.newBuffer([]),e.prototype.MiscMap=q.emptyObject,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){if(t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&t.uint32(32).uint64(e.options),null!=e.src&&Object.hasOwnProperty.call(e,"src")&&t.uint32(42).string(e.src),null!=e.dst&&Object.hasOwnProperty.call(e,"dst")&&t.uint32(50).string(e.dst),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(58).bytes(e.payload),null!=e.MiscMap&&Object.hasOwnProperty.call(e,"MiscMap"))for(var n=Object.keys(e.MiscMap),r=0;r<n.length;++r)t.uint32(66).fork().uint32(10).string(n[r]).uint32(18).bytes(e.MiscMap[n[r]]).ldelim();return null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(72).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r,i,o=new t.Message;e.pos<n;)switch(r=e.uint32(),r>>>3){case 1:o.instance=e.uint64();break;case 2:o.dialogue=e.uint64();break;case 3:o.sequence=e.uint64();break;case 4:o.options=e.uint64();break;case 5:o.src=e.string();break;case 6:o.dst=e.string();break;case 7:o.payload=e.bytes();break;case 8:o.MiscMap===q.emptyObject&&(o.MiscMap={});var s=e.uint32()+e.pos;for(r="",i=[];e.pos<s;){var a=e.uint32();switch(a>>>3){case 1:r=e.string();break;case 2:i=e.bytes();break;default:e.skipType(7&a)}}o.MiscMap[r]=i;break;case 9:o.ms=e.uint64();break;default:e.skipType(7&r)}return o},e}(),xr=t.Ack=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ack;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.dialogue=e.uint64();break;case 3:r.sequence=e.uint64();break;case 4:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),hB=t.FileUploadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(24).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),iB=t.FileUploadIndexRet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(26).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),jB=t.FileUploadIndexSet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.unit=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),kB=t.FileUploadIndexFin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexFin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),lB=t.FileUploadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),mB=t.FileDownloadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(26).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(40).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.hash=e.bytes();break;case 4:r.size=e.uint32();break;case 5:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),nB=t.FileDownloadIndexRet=function(){function e(e){if(this.servers=[],this.backups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=q.emptyArray,e.prototype.backups=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(24).uint32(e.zone),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}if(null!=e.backups&&e.backups.length){for(t.uint32(42).fork(),n=0;n<e.backups.length;++n)t.uint32(e.backups[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:r.zone=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;case 5:if(r.backups&&r.backups.length||(r.backups=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.backups.push(e.uint32());else r.backups.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),oB=t.FileDownloadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),pB=t.GroupAllUsersList=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(24).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(32).uint32(e.pageNumber),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.pageSize=e.uint32();break;case 4:r.pageNumber=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),qB=t.GroupAllUsersResult=function(){function e(e){if(this.memberInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.totalSize&&Object.hasOwnProperty.call(e,"totalSize")&&n.uint32(24).uint32(e.totalSize),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&n.uint32(32).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&n.uint32(40).uint32(e.pageNumber),null!=e.memberInfos&&e.memberInfos.length)for(var r=0;r<e.memberInfos.length;++r)t.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[r],n.uint32(50).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.totalSize=e.uint32();break;case 4:r.pageSize=e.uint32();break;case 5:r.pageNumber=e.uint32();break;case 6:r.memberInfos&&r.memberInfos.length||(r.memberInfos=[]),r.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.MemberInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult.MemberInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),rB=t.UserStatusList=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),sB=t.UserStatusResult=function(){function e(e){if(this.userInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.userInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.userInfos&&e.userInfos.length)for(var r=0;r<e.userInfos.length;++r)t.UserStatusResult.UserStatusInfo.encode(e.userInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.userInfos&&r.userInfos.length||(r.userInfos=[]),r.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.UserStatusInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult.UserStatusInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),tB=t.UserAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),uB=t.UserAttributeRet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),vB=t.UserAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),wB=t.UserAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),xB=t.UserAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),yB=t.UserAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),zB=t.UserAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),AB=t.UserAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),BB=t.UserAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRsp;e.pos<n;){var i=e.uint32();i>>>3===1?r.seq=e.uint64():e.skipType(7&i)}return r},e}(),CB=t.GroupStatusList=function(){function e(e){if(this.groups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groups=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.groups&&e.groups.length)for(var n=0;n<e.groups.length;++n)t.uint32(18).string(e.groups[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groups&&r.groups.length||(r.groups=[]),r.groups.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),DB=t.GroupStatusResult=function(){function e(e){if(this.groupInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.groupInfos&&e.groupInfos.length)for(var r=0;r<e.groupInfos.length;++r)t.GroupStatusResult.GroupInfo.encode(e.groupInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groupInfos&&r.groupInfos.length||(r.groupInfos=[]),r.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.GroupInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(10).string(e.group),null!=e.memberCount&&Object.hasOwnProperty.call(e,"memberCount")&&t.uint32(16).uint32(e.memberCount),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult.GroupInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.group=e.string();break;case 2:r.memberCount=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),EB=t.GroupCountNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupCountNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.group=e.string();break;case 4:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),FB=t.GroupAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),GB=t.GroupAttributeRet=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),HB=t.GroupAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),IB=t.GroupAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),JB=t.GroupAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(34).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),KB=t.GroupAttributeAlt=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&n.uint32(24).uint64(e.instance),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.instance=e.uint64();break;case 4:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),LB=t.GroupAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRsp;e.pos<n;){var i=e.uint32();i>>>3===1?r.seq=e.uint64():e.skipType(7&i)}return r},e}(),MB=t.GroupAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),NB=t.GroupAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;default:e.skipType(7&i)}}return r},e}(),OB=t.GroupAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),PB=t.SubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),QB=t.UnsubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UnsubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),RB=t.UserJoinNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoinNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),SB=t.UserQuitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),TB=t.UserWaitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserWaitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),UB=t.SubscribeResponse=function(){function e(e){if(this.errors=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.errors=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.errors&&e.errors.length)for(var r=0;r<e.errors.length;++r)t.SubscribeResponse.SubscribeErrorsType.encode(e.errors[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.errors&&r.errors.length||(r.errors=[]),r.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.SubscribeErrorsType=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse.SubscribeErrorsType;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(e){return function(t,n,r){var i=(t=String(jb(t))).length;return r=void 0===r?" ":String(r),(n=ta(n))<=i||""==r?t:(n-=i,(i=Pn.call(r,WB(n/r.length))).length>n&&(i=i.slice(0,n)),e?t+i:i+t)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(e){return YB(this,e,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(e){return function(t){t=qb(t);for(var n,r=Dc(t),i=r.length,o=0,s=[];i>o;)n=r[o++],ka&&!ZB.call(t,n)||s.push(e?[n,t[n]]:t[n]);return s}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(e){return $B(e)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var e=bC(String.prototype,"endsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(e){var t=String(jb(this));ck(e);var n=1<arguments.length?arguments[1]:void 0,r=ta(t.length);return n=void 0===n?r:cC(ta(n),r),r=String(e),Br?Br.call(t,r,n):t.slice(n-r.length,n)===r}}),dh("match",1,(function(e,t,n){return[function(t){var n=jb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;if(e=va(e),r=String(this),!e.global)return Ke(e,r);var i=e.unicode;e.lastIndex=0;for(var o,s=[],a=0;null!==(o=Ke(e,r));)o=String(o[0]),s[a]=o,""===o&&(e.lastIndex=xj(r,ta(e.lastIndex),i)),a++;return 0===a?null:s}]}));var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var e=eC(String.prototype,"startsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(e){var t=String(jb(this));ck(e);var n=ta(fC(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return Dr?Dr.call(t,r,n):t.slice(n,n+r.length)===r}});var Nm=function(e){var t=Array.prototype.slice.call(arguments,1);return t.length&&(e=e.replace(/(%?)(%([jds]))/g,(function(e,n,r,i){switch(r=t.shift(),i){case"s":r=""+r;break;case"d":r=Number(r);break;case"j":r=JSON.stringify(r)}return n?(t.unshift(r),e):r}))),t.length&&(e+=" "+t.join(" ")),""+e.replace(/%{2,2}/g,"%")},hC=/\s/,iC=function(e){for(var t=e.length;t--&&hC.test(e.charAt(t)););return t},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(e){if("number"==typeof e)return e;if(ie(e))return Fr;if(lb(e)&&(e="function"==typeof e.valueOf?e.valueOf():e,e=lb(e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;e=e?e.slice(0,iC(e)+1).replace(jC,""):e;var t=lC.test(e);return t||mC.test(e)?nC(e.slice(2),t?2:8):kC.test(e)?Fr:+e},oC=Math.max,pC=Math.min,qC=function(e,t,n){function r(t){var n=c,r=u;return c=u=void 0,p=t,l=e.apply(r,n)}function i(e){var n=e-h;return e-=p,void 0===h||n>=t||0>n||m&&e>=_}function o(){var e=Cb.Date.now();if(i(e))return s(e);var n=setTimeout,r=e-p;e=t-(e-h),r=m?pC(e,_-r):e,d=n(o,r)}function s(e){return d=void 0,g&&c?r(e):(c=u=void 0,l)}function a(){var e=Cb.Date.now(),n=i(e);if(c=arguments,u=this,h=e,n){if(void 0===d)return p=e=h,d=setTimeout(o,t),f?r(e):l;if(m)return clearTimeout(d),d=setTimeout(o,t),r(h)}return void 0===d&&(d=setTimeout(o,t)),l}var c,u,l,d,h,p=0,f=!1,m=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=gl(t)||0,lb(n)){f=!!n.leading;var _=(m="maxWait"in n)?oC(gl(n.maxWait)||0,t):_;g="trailing"in n?!!n.trailing:g}return a.cancel=function(){void 0!==d&&clearTimeout(d),p=0,c=h=u=d=void 0},a.flush=function(){return void 0===d?l:s(Cb.Date.now())},a},yc=function(e){function t(e,i){return W(this,t),m(n(e=r.call(this,Mm(e,i))),"originalError",void 0),m(n(e),"code",void 0),m(n(e),"serverCode",void 0),"number"==typeof i?e.code=i:"string"==typeof i?e.name=i:void 0!==i&&(i.originalError&&(e.originalError=i.originalError),void 0!==i.code&&(e.code=i.code),void 0!==i.serverCode&&(e.serverCode=i.serverCode)),e}la(t,e);var r=ma(t);return t}(ef(Error)),Ia=function(e){function t(e,i){return W(this,t),m(n(e=r.call(this,Mm(e,i))),"name","RtmInternalError"),m(n(e),"code",void 0),e.code=i,e}la(t,e);var r=ma(t);return t}(ef(Error)),Ph=function(){return function(e){function t(e){W(this,t);var r=Object.keys(e);return n.call(this,e[r[0]],r[0])}la(t,e);var n=ma(t);return t}(Ia)},Fa=Ph(),db=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmTimeoutError"),e}la(t,e);var r=ma(t);return t}(yc),I=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidArgumentError"),e}la(t,e);var r=ma(t);return t}(yc),K=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidStatusError"),e}la(t,e);var r=ma(t);return t}(yc),hl=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInterruptedError"),e}la(t,e);var r=ma(t);return t}(yc),ib=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmLimitExceededError"),e}la(t,e);var r=ma(t);return t}(yc),rC=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvokeTooOftenError"),e}la(t,e);var r=ma(t);return t}(yc),da=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnavailableError"),m(n(e),"serverCode",void 0),m(n(e),"statusCode",void 0),e}la(t,e);var r=ma(t);return t}(yc),Ye=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnauthenticatedError"),m(n(e),"serverCode",void 0),e}la(t,e);var r=ma(t);return t}(yc),Wc=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnknownError"),e}la(t,e);var r=ma(t);return t}(yc),Sa=function(e){return e instanceof db||e instanceof pb},sa=function(e){return e instanceof yc},Yd=function(e,t,n){return['Executing "%s.%s" timed out after %ds',e,t,n/1e3]},Lm=new Map,sC=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(e){return"string"==typeof e?e.endsWith(".")?e:"".concat(e,"."):e},Sm=function(e){for(var t="",n=(e=new Uint8Array(e)).byteLength,r=-1;++r<n;)t+=String.fromCharCode(e[r]);return t=btoa(t),"data:;base64,".concat(t)},tC=R((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));N({target:"Date",proto:!0,forced:tC},{toJSON:function(e){e=Qa(this);var t=lc(e);return"number"!=typeof t||isFinite(t)?e.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(e,t,n){return JSON.stringify(Ym(e),t,n)};Gr.ensureProperties=Ym;var uC=function(e,t){t=t||{};var n=X(e);if("string"===n&&0<e.length)return au(e);if("number"===n&&isFinite(e))return e=t.long?864e5<=(t=Math.abs(e))?Jg(e,t,864e5,"day"):36e5<=t?Jg(e,t,36e5,"hour"):6e4<=t?Jg(e,t,6e4,"minute"):1e3<=t?Jg(e,t,1e3,"second"):e+" ms":864e5<=(t=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=t?Math.round(e/36e5)+"h":6e4<=t?Math.round(e/6e4)+"m":1e3<=t?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},vC=function(e){function t(e){function r(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(r.enabled){e=Number(new Date),r.diff=e-(i||e),r.prev=i,i=r.curr=e,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var s=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,i){return"%%"===e?"%":(s++,"function"==typeof(i=t.formatters[i])&&(e=i.call(r,n[s]),n.splice(s,1),s--),e)})),t.formatArgs.call(r,n),(r.log||t.log).apply(r,n)}}var i,o=null;return r.namespace=e,r.useColors=t.useColors(),r.color=t.selectColor(e),r.extend=n,r.destroy=t.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===o?t.enabled(e):o},set:function(e){o=e}}),"function"==typeof t.init&&t.init(r),r}function n(e,n){return(e=t(this.namespace+(void 0===n?":":n)+e)).log=this.log,e}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(G(t.names.map(r)),G(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r=0;for(n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=uC,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},Hr=$a((function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){try{var e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"/chat-app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var n=localStorage;break e}catch(e){}n=void 0}t.storage=n,t.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),t.log=console.debug||console.log||function(){},e.exports=vC(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function e(t){W(this,e),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=t.processId,this.sdkVersion=t.sdkVersion,this.rtmConfig=t.rtmConfig,this.uploadRequest=t.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(e,[{key:"upload",value:function(e){this.LogCache.push(e),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e){var t=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark((function n(){var r,i,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={sdk_version:t.sdkVersion,process_id:t.processId,payload:JSON.stringify(e)},n.prev=1,n.next=4,t.uploadRequest(r,null!==(i=t.rtmConfig.enableCloudProxy)&&void 0!==i&&i);case 4:if(!Uk){n.next=6;break}throw Error("RTM is busy");case 6:n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),o=2>t.uploadResendCount++?2e3:1e4,setTimeout((function(){return t.postLog(t.LogsToPost)}),o),n.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),0!==t.LogCache.length){n.next=17;break}return t.uploadState=Ze.Free,n.abrupt("return");case 17:t.uploadResendCount=0,t.LogsToPost=40>t.LogCache.length?t.LogCache.splice(0,t.LogCache.length):t.LogCache.splice(0,40),t.postLog(t.LogsToPost);case 20:case"end":return n.stop()}}),n,null,[[1,8]])}))),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Jr=function(e,t,n,r,i,o,s,a){var c=0;for(s=!!s&&Id(s,a,3);c<r;){if(c in n){if(a=s?s(n[c],c,t):n[c],0<o&&gd(a))i=Jr(e,t,a,ta(a.length),i,o-1)-1;else{if(9007199254740991<=i)throw TypeError("Exceed the acceptable array length");e[i]=a}i++}c++}return i},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Qa(this),n=ta(t.length),r=Sg(t,0);return r.length=xC(r,t,t,n,0,void 0===e?1:$b(e)),r}}),N({target:"Object",stat:!0},{values:function(e){return aC(e)}});var yC=["CODE"],Db,ud,F;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(e){return Object.values(yf).flat().includes(e)},cu=function(e){var t;return null===(t=Hg(yf).find((function(t){return(t=ra(t,2))[0],t[1].includes(e)})))||void 0===t?void 0:t[0]},AC=function(e){return e.sort((function(e,t){return Kr.indexOf(e)-Kr.indexOf(t)}))},xe=function(e){var t=new Set;if(0===(e=AC(e).slice(0,3).map((function(e){var n=Kg[e];if(void 0===n)throw new Ia("invalid area key");return e=n.CODE,n=ff(n,yC),t.add(e),n}))).length)throw new Ia("areas cannot be empty");return ua({CODES:t},e.reduce((function(e,t){for(var n=0,r=Hg(e);n<r.length;n++){var i=ra(r[n],2),o=i[0];i=i[1],e[o]=Array.from(new Set([].concat(G(t[o]),G(i))))}return e})))},M,Lr=function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(2<(i=2<c.length&&void 0!==c[2]?c[2]:0))){e.next=3;break}return e.abrupt("return");case 3:return o={withCredentials:!0,body:t,timeout:2e4},s=0<i?(null==M?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(null==M?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",a=n?"https://".concat(null!==(r=null==M?void 0:M.PROXY_NGINX[0])&&void 0!==r?r:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(s,"&p=443&d=upload/v1"):"https://".concat(s,"/upload/v1"),e.next=8,te(a,o).catch((function(e){return Lr(t,n,i+1)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(e){if("string"==typeof e)return oa(e);if(Array.isArray(e)&&e.every((function(e){return"string"==typeof e})))return e.map((function(e){return oa(e)}));if(!Il(e)){for(var t={},n=0;n<Or.length;n++){var r=Or[n];r in e&&(t[r]=e[r])}if(0<Object.keys(t).length)return t;if(5>Object.keys(e).length){for(n=0,e=Object.entries(e);n<e.length;n++){var i=ra(e[n],2);r=i[0],i=i[1],il.includes(r)?t[r]="[Hidden Info]":t[oa(r)]="string"==typeof i?oa(i):"[Sensitive Info]"}return t}return"[Sensitive Info]"}return e},Pr=function(e){return"object"===X(e)?yd(e)?Vm(fe(e,5),il,Nr):e.constructor&&e.constructor.name:e},Qr=function(e,t){return e instanceof Error?e.message:"string"!=typeof e?JSON.stringify(Vm(fe(e,5),il,Nr)):(t=t.map((function(e){return e instanceof Error?e.message:"object"===X(e)?Gr(Array.isArray(e)?e.map(Pr):Pr(e)):e})),Nm.apply(void 0,[e.replace(/%[%Oo]/g,(function(e){return"%%"===e?"%":"%o"===e||"%O"===e?"%s":e}))].concat(G(t))))},CC=1,Rr=function(e,t,n){var r=Hr(e);return r.enabled=!0,r.log=n,r.useColors=!1,function(n){for(var i=arguments.length,o=Array(1<i?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];if(t.enableLogUpload){i=Cg(n);var a=Qr(i,o);Mr.upload({log_item_id:"".concat(CC++),log_level:e,payload_str:"[".concat(sC(),"] ").concat(e," - ").concat(256<a.length?a.slice(0,256):a)})}switch(i=function(e){var t=a||Qr(Cg(n),o),i=Nc.LOG_HANDLER;"function"==typeof i&&i({level:e,message:t}),r(t)},e){case"RTM:INFO":t.logFilter.info&&i("log");break;case"RTM:WARN":t.logFilter.warn&&i("warning");break;case"RTM:ERROR":t.logFilter.error&&i("error");break;case"RTM:TRACK":t.logFilter.track&&i("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":case"RTM:DEBUG":t.logFilter.debug&&i("debug")}}},jl,Sr=function(e){return function(t){var n=1===jl||void 0===e?"":"Ins#".concat(e," ");return"".concat(n).concat(t)}},kl=function(e,t,n){var r=Sr(jl);return Rr("RTM:".concat(t),n,(function(t){return e(r(t))}))},tb=function(){return function(e){function t(e,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,t);var s=r.call(this);if(m(n(s),"logError",void 0),m(n(s),"invokeTracker",void 0),m(n(s),"resultTracker",void 0),m(n(s),"errorTracker",void 0),m(n(s),"eventTracker",void 0),m(n(s),"info",void 0),m(n(s),"warn",void 0),m(n(s),"log",void 0),m(n(s),"genLogger",void 0),m(n(s),"loggerId",void 0),m(n(s),"logger",void 0),m(n(s),"name",void 0),s.logger=e,s.name=i,s.loggerId=e.loggerId,s.info=e.info,s.warn=e.warn,s.logError=e.logError,s.genLogger=e.genLogger,s.log=e.genLogger("RTM:DEBUG","<".concat(i,"> ")),s.invokeTracker=e.genTracker("Invoke"),s.eventTracker=e.genTracker("Event"),s.resultTracker=e.genTracker("Result"),s.errorTracker=e.genTracker("Error"),o){var a=s.emit.bind(n(s));s.emit=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];e=t[0],n=t.slice(1);var r=BC.includes(e);s.eventTracker.apply(s,["%s: ".concat(0<n.length?"%s emitted with args: ".concat(n.map((function(){return"%o"}))):"%s emitted"),i,e].concat(G(r?n.map(ye):n)));try{a.apply(void 0,t)}catch(t){s.logError("Caught in the callback function of the event %s",e,t)}}}return s}la(t,e);var r=ma(t);return t}(ea)},DC=function(e){return kl(console.log.bind(console),"INFO",e)},EC=function(e){return kl(console.warn.bind(console),"WARN",e)},FC=function(e){return kl(console.error.bind(console),"ERROR",e)},Tr=function(e,t){return function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=Sr(e),o=console.debug.bind(console),s=Rr(n,t,(function(e){return o(i(e))}));return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return s.apply(void 0,[r+e].concat(n))}}},GC=function(e,t){return function(n){return Tr(e,t)("RTM:TRACK","[".concat(n,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var o=e[r=nr(n,i)];e[r]=e[n],e[n]=o}return e.length=t,e},IC=function(e){return Ur(Xh(e))},JC=function(e){return Ur(Ni(e))},$e=function(e){return(Va(e)?IC:JC)(e)},af={0:9591,1:9593},$d=function(e){return"https://".concat(e,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(e){function t(e,i,o,s,a,c){W(this,t);var u=r.call(this,a,Ai("Socket-",a.loggerId));if(m(n(u),"isActiveClose",!1),m(n(u),"loggedIn",!1),m(n(u),"useNewDomain",void 0),m(n(u),"receivedPacket",new Pa),m(n(u),"open$",void 0),m(n(u),"input$",new Pa),m(n(u),"userJoin$",new Pa),m(n(u),"attemptsSinceLastError",0),m(n(u),"message$",new Pa),m(n(u),"socket$",void 0),m(n(u),"toClose",new Pa),m(n(u),"toReconnect",new Pa),m(n(u),"sendLogger",void 0),m(n(u),"receiveLogger",void 0),m(n(u),"ip",void 0),m(n(u),"env",void 0),m(n(u),"ticket",void 0),m(n(u),"context",void 0),m(n(u),"getDomain",(function(){return an(u.ip,u.useNewDomain)})),m(n(u),"socketReconnector",(function(e){var t=function(e){return u.attemptsSinceLastError+=1,u.warn("The %s of Env %d reconnecting %s",u.name,u.env,e.message),Bc(3e3)};return e.pipe(Ga((function(e){return u.log("socket connection closed"),u.loggedIn=!1,2<=u.attemptsSinceLastError?(u.warn("socket connection failure"),u.emit("connectionFailure"),u.close(),Z(e)):u.isActiveClose?vb:(u.emit("reconnect"),u.useNewDomain=!u.useNewDomain,Z(e))})),oe((function(e){return e.pipe(Cc(t))})))})),u.ip=e,u.env=i,u.ticket=o,u.context=s,u.useNewDomain=null!=c?c:.5<=Math.random(),u.sendLogger=u.genLogger("RTM:MSG:SEND"),u.receiveLogger=u.genLogger("RTM:MSG:RECV"),0!==i&&1!==i)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(e))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var l=af[i];u.log("Opening websocket address %s for the Env %d",u.ip,u.env);var d=Xb(u.input$,u.userJoin$.pipe(Rt(2)),u.message$).pipe(ba((function(e){return Oh.encode(e).finish()})));return e=Xb(St("",{protocols:[],makeWebSocket:function(){if(u.context.config.enableCloudProxy){if(0===u.context.cloudProxyServers.length)throw u.logError("No cloud proxy server to connect"),new da;var e="wss://".concat(an(bn(u.context.cloudProxyServers),!1),"/");e=we(e,"sid",u.context.sid),e=we(e,"remote_port",l.toString()),e=we(e,"remote_ip",u.ip),e=we(e,"token",u.context.key),e=new WebSocket(e)}else e=new WebSocket("wss://".concat(u.getDomain(),":").concat(l));return e.binaryType="arraybuffer",e}}),u.toReconnect),u.socket$=Ca(e,Tk.pipe(hb(15e3),Ga((function(e){return Sa(e)&&u.warn("socket open timed out"),Z(e)})))).pipe(ba((function(e){if(e instanceof Error)throw u.warn("Env_%d: Force reconnect the socket",u.env),e;return e(d).pipe(ba((function(e){return Oh.decode(new Uint8Array(e))})))})),u.socketReconnector),u.open$=u.socket$.pipe(ca((function(e){u.log("Websocket opened",u.name),e.subscribe((function(e){var t=e.data;e=Li[e.uri].slice(0,-3),t=$m[e].decode(t);var n=HA({},Gk(t,"toJSON"),(function(e,t){return t instanceof U?Km(t):t})),r=!1;if((t instanceof vr||t instanceof ur)&&t.instance.lessThanOrEqual(4294967295)&&(r=!0),t instanceof wr||t instanceof xr){var i=t.instance,o=t.sequence;(t.dialogue.lessThanOrEqual(4294967295)||i.lessThanOrEqual(4294967295)||o.lessThan(1))&&(r=!0)}r?u.warn("Env_%d: Illegal %s, abandoned %o",u.env,e,n):("Pong"!==e&&u.receiveLogger("Env_%d: %s %o",u.env,e,n),u.receivedPacket.next([e,t]))}),(function(){}))})),qf(void 0),ob(u.toClose),pe()),u}la(t,e);var r=ma(t);return Ha(t,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(e,t){if("Ping"!==e){var n=uc(t,(function(e){return e instanceof U?Km(e):e}));this.sendLogger("Env_%d: %s %o",this.env,e,n)}t=du(e,t),"UserJoin"===e?this.userJoin$.next(t):"Message"===e?this.message$.next(t):this.input$.next(t)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(e){var t=this;return this.receivedPacket.pipe(ca((function(e){var n=ra(e,2);e=n[0],n=n[1],"UserResp"===e&&(t.attemptsSinceLastError=0,t.loggedIn=!0),"UserDrop"===e&&t.emit("socketUserDrop",n)})),wb((function(t){return ra(t,1)[0]===e})),ba((function(e){return ra(e,2)[1]})))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),t}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(e){return XB(this,e,1<arguments.length?arguments[1]:void 0)}});var OC=function(e){var t=xf(Kg);e=Yt(e);for(var n=0;n<t.length;n++){var r=Kg[t[n]];if(null!=r&&r.AP_DOMAINS.includes(e)||null!=r&&r.AP_BACKUP_DOMAINS.includes(e)||null!=r&&r.PROXY_AP.includes(e))return[r.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(e){function t(e,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,t);var s=r.call(this,i,"AccessPoint");return m(n(s),"handleUniLbsError",(function(e,t){var n=e;if(4<e.toString().length){var r=e.toString().padStart(8,"0"),i=parseInt(r.slice(0,4),10);if(r=parseInt(r.slice(4,8),10),201===i)n=r;else if(101===i&&!QC.includes(r))return Z(Error("service is currently unavailable"))}if(i=n.toString(),!Object.keys(Vr).includes(i))return(e=new da(["Login is rejected by the server. The response code is %d",e],jg)).serverCode=n,Z(e);switch(i=Vr[i],n=PC[i],i){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(t=new Ye(n,$q)).serverCode=e,Z(t);case"INVALID_USER_ID":return(t=new Ye(n,Jh)).serverCode=e,Z(t);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(t=new Ye(n,Kh)).serverCode=e,Z(t);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(t=new Ye(n,ar)).serverCode=e,Z(t);case"CANNOT_MEET_AREA_DEMAND":return(t=OC(t)).forEach((function(e){return s.failedAreas.add(e)})),s.failedAreas.size===(void 0===M?2:M.CODES.size)?((t=new I(n,jg)).serverCode=e,Z(t)):Z(Error("ap ".concat(t.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(t=new da(n,jg)).serverCode=e,Z(t);default:return Z(Im("ApResErrType",i))}})),m(n(s),"getApEdgeInfo$",void 0),m(n(s),"getApEdgeInfoEndFirst$",void 0),m(n(s),"apFinish$",new Pa),m(n(s),"retryCount",0),m(n(s),"failedAreas",new Set),m(n(s),"usedUrl",[]),m(n(s),"newDomainUsed",!1),m(n(s),"backupNewDomainUsed",!1),m(n(s),"genUrl",(function(){return void 0===M?mi.apply(void 0,G($e([KC,LC]))).pipe(ni((function(e){return bb.apply(void 0,G(e))}))):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))})),m(n(s),"genBackupUrl",(function(){return void 0===M?mi.apply(void 0,G($e([MC,NC]))).pipe(ni((function(e){return bb.apply(void 0,G(e))}))):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))})),m(n(s),"getApUrl$",(function(e){var n,r;return s.genUrl().pipe(wb((function(e){return(!s.newDomainUsed||!e.includes("sd-rtn.com"))&&(e.includes("sd-rtn.com")&&(s.newDomainUsed=!0),!dl(s.usedUrl,(function(t){var n;return t===(null===(n=e.match(Qh))||void 0===n?void 0:n[1])})))})),ca((function(e){var t;void 0===M&&"string"==typeof(e=null===(t=e.match(Qh))||void 0===t?void 0:t[1])&&s.usedUrl.push(e)})),Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:0):null!==(r=null==M?void 0:M.CODES.size)&&void 0!==r?r:2),Dd((function(){return t.runOutOfUrlSymbol})),Ga((function(e,n){return s.newDomainUsed=!1,e===t.runOutOfUrlSymbol?(s.usedUrl=[],n):Z(e)})))})),m(n(s),"getBackupApUrl$",(function(e){var n,r;return s.genBackupUrl().pipe(wb((function(e){return(!s.backupNewDomainUsed||!e.includes("sd-rtn.com"))&&(e.includes("sd-rtn.com")&&(s.backupNewDomainUsed=!0),!dl(s.usedUrl,(function(t){var n;return t===(null===(n=e.match(Qh))||void 0===n?void 0:n[1])})))})),ca((function(e){var t;void 0===M&&"string"==typeof(e=null===(t=e.match(Qh))||void 0===t?void 0:t[1])&&s.usedUrl.push(e)})),Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:0):null!==(r=null==M?void 0:M.CODES.size)&&void 0!==r?r:2),Dd((function(){return t.runOutOfUrlSymbol})),Ga((function(e,n){return s.backupNewDomainUsed=!1,e===t.runOutOfUrlSymbol?(s.usedUrl=[],n):Z(e)})))})),m(n(s),"getProxyApUrl$",(function(e){var t,n;return bb.apply(void 0,G(((null==M?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(t=null==M?void 0:M.CODES.size)&&void 0!==t?t:0):null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:2))})),m(n(s),"context",void 0),m(n(s),"fetchCloudProxy",(function(e,t){var n=Ai("AP-",s.loggerId);s.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return s.apFinish$.pipe(Ka(1)).subscribe((function(){return r.abort()})),ad(J(w.mark((function i(){var o;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=Ag(0,Number.MAX_SAFE_INTEGER),s.log("%s request opid: %d",n,o),i.abrupt("return",te(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:s.context.sid,opid:o,appid:s.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:null!=t?t:s.context.key,cname:s.context.uid,uid:0,detail:ua({},void 0===M?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map((function(e){return e===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):e})).join(",")})}}]},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Ga((function(t){return"AbortError"!==t.name&&(s.logError(t),s.warn("The AP server %s request failure",e,t)),vb})),cb(function(){var t=J(w.mark((function t(r){var i,o,a,c,u,l,d,h,p,f,m,g,_,E,v,y,b,T,S;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,o=JSON.parse(i),s.log("The %s response is %o",n,o),(void 0===(a=o.response_body)||0===a.length||a.some((function(e){var t;return void 0===(null===(t=e.buffer)||void 0===t?void 0:t.code)||23!==e.uri})))&&Z(new da("cloud proxy response_body not valid",jg)),0===(c=a.filter((function(e){return 0!==e.buffer.code}))).length){t.next=14;break}if(void 0===(u=c.find((function(e){return 128===e.buffer.flag})))){t.next=12;break}return t.abrupt("return",s.handleUniLbsError(u.buffer.code,e));case 12:return s.logError("cloud proxy error response"),t.abrupt("return",s.handleUniLbsError(c[0].buffer.code,e));case 14:for(l=[],d=0;d<a.length;d++)if(262144===(null==(f=a[d])||null===(h=f.buffer)||void 0===h?void 0:h.flag))null===(m=f.buffer)||void 0===m||null===(g=m.edges_services)||void 0===g||null===(_=g.forEach)||void 0===_||_.call(g,(function(e){Gm(e=e.ip)&&-1===s.context.cloudProxyServers.indexOf(e)&&(s.log("got cloud proxy server: %s",e),s.context.cloudProxyServers.push(e))}));else if(128===(null==f||null===(p=f.buffer)||void 0===p?void 0:p.flag)){for(b=function(e,t){var n=t[e];l.some((function(e){return e.ip===n.ip}))||l.push({ip:n.ip,ticket:f.buffer.cert})},T=0,S=f.buffer.edges_services;T<S.length;T++)b(T,S);s.context.rtmArea=null!==(E=null===(v=f.buffer)||void 0===v||null===(y=v.detail)||void 0===y?void 0:y[9])&&void 0!==E?E:""}return t.abrupt("return",bb.apply(void 0,G(l).concat([fg])));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Ga((function(e){return sa(e)?Z(e):vb})),tg(),wb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket})))})),m(n(s),"fetchAp",(function(e,t){var n=Ai("AP-",s.loggerId);s.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return s.apFinish$.pipe(Ka(1)).subscribe((function(){return r.abort()})),ad(J(w.mark((function i(){var o;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=Ag(0,Number.MAX_SAFE_INTEGER),s.log("%s request opid: %d",n,o),i.abrupt("return",te(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:o,key:t||s.context.key,cname:s.context.uid,detail:ua({},void 0===M?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map((function(e){return e===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):e})).join(",")}),uid:0,sid:s.context.sid},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(Ga((function(t){return"AbortError"!==t.name&&(s.logError(t),s.warn("The AP server %s request failure",e,t)),vb})),cb(function(){var t=J(w.mark((function t(r){var i,o,a,c,u,l,d;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,o=JSON.parse(i),s.log("The %s response is %o",n,o),c=(a=o).code,u=a.addresses,l=a.detail,0===c){t.next=6;break}return t.abrupt("return",s.handleUniLbsError(c,e));case 6:if(0!==(d=u).length){t.next=11;break}return t.abrupt("return",Z(Error("No available edge address to connect")));case 11:return s.context.rtmArea=null==l?void 0:l[9],t.abrupt("return",bb.apply(void 0,G(d).concat([fg])));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),tg(),Ga((function(e){return sa(e)?Z(e):vb})),wb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket})))})),s.context=e,s.getApEdgeInfoEndFirst$=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return Bc(0,e||o?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca((function(){s.retryCount+=1})),cb((function(){return s.context.config.enableCloudProxy?s.getProxyApUrl$(e||o):(4<=s.retryCount&&(s.retryCount=0),3>=s.retryCount?s.getApUrl$(e||o):s.getBackupApUrl$(e||o))})),cb((function(e){return s.context.config.enableCloudProxy?s.fetchCloudProxy(e):s.fetchAp(e)})),Ga((function(e){return e instanceof pb&&s.warn("AP request timeout"),Z(e)})),om((function(e){return e.ip})),ob(s.apFinish$))},s.getApEdgeInfo$=function(e){return Bc(0,e||o?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca((function(){s.retryCount+=1})),cb((function(){return s.context.config.enableCloudProxy?s.getProxyApUrl$(e||o):3>=s.retryCount?s.getApUrl$(e||o):s.getBackupApUrl$(e||o)})),cb((function(e){return(s.context.config.enableCloudProxy?s.fetchCloudProxy(e):s.fetchAp(e)).pipe()})),Ga((function(e){return e instanceof pb&&s.warn("AP request timeout"),Z(e)})),om((function(e){return e.ip})),ob(s.apFinish$))},s}la(t,e);var r=ma(t);return Ha(t,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),t}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(e){function t(e,i,o){W(this,t);var s=r.call(this,i,"Connection");m(n(s),"apClient",void 0),m(n(s),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(s),"curOpenSockets",[void 0,void 0]),m(n(s),"ipIterator",0),m(n(s),"firstEnv",.5<=Math.random()?1:0),m(n(s),"firstSocketOpener",void 0),m(n(s),"secondSocketOpener",void 0),m(n(s),"firstOpenKeeperSubject",new Pa),m(n(s),"secondOpenKeeperSubject",new Pa),m(n(s),"edgeInfoReplayed",void 0),m(n(s),"firstEnvOpenSocket",void 0),m(n(s),"firstOpenKeeperSub",void 0),m(n(s),"secondOpenKeeperSub",void 0),m(n(s),"context",void 0),m(n(s),"logger",void 0),s.context=e,s.logger=i,s.apClient=new Wr(s.context,i),s.apClient.apFinish$.subscribe((function(){s.log("Ap client fetch finished")}));var a,c=[];return s.edgeInfoReplayed=s.apClient.getApEdgeInfo$(o).pipe(oe((function(e){return e.pipe(ca((function(e){if(sa(e))throw e})),cd(o?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))})),wb((function(e){return!dl(c,e)})),Dd((function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),ca((function(e){c.push(e),s.log("An edge info got %o",e)})),ca({error:function(e){s.emit("connectionInitFailure",e)}}),wg((function(){s.apClient.clearUp()})),sm()),s.firstEnvOpenSocket=s.edgeInfoReplayed.pipe(cb((function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new ml(e.ip,s.firstEnv,e.ticket,s.context,i,a);return s.firstEnv=1===s.firstEnv?0:1,t.on("connectionFailure",(function(){return s.onSocketConnectionFailure(t)})),a=!t.useNewDomain,t.open$.pipe(qf(t))})),ca((function(e){s.log("The websocket of ENV_%d opened to %s:%d",e.env,e.ip,af[e.env]),s.curOpenSockets[e.env]=e,s.lastOpenSockets[e.env].next(e),s.firstEnv=e.env,s.openSecondSocket(e.env,e.ip,e.useNewDomain)})),Ka(1),pe()),s.firstSocketOpener=s.firstEnvOpenSocket.pipe(cb((function(e){return e.open$.pipe(ca((function(){s.log("The websocket of first ENV_%d re-opened to %s:%d",e.env,e.ip,af[e.env]),s.curOpenSockets[e.env]=e,s.lastOpenSockets[e.env].next(e)})))}))),e=s.firstOpenKeeperSubject.pipe(Cc(Yc)),s.firstOpenKeeperSub=e.subscribe({error:s.logError}),s}la(t,e);var r=ma(t);return Ha(t,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(e,t){if(![0,1].includes(e))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var n=e===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var r=this.curOpenSockets[e];this.curOpenSockets[e]=void 0,r&&(r.isActiveClose=!0,setTimeout((function(){r.close()}),t)),void 0!==n&&setTimeout((function(){null==n||n.unsubscribe()}),t)}},{key:"waitClosing",value:function(e){var t=this;return e.isActiveClose=!0,e.open$.pipe(tt(),Ga((function(e){return e.message===mr.normalClosureMessage?vb:Z(e)})),hb(5e3),Ga((function(n){return n instanceof pb?(t.warn("Force closing the ENV_%d connection",e.env),vb):Z(n)})))}},{key:"onSocketConnectionFailure",value:function(e){var t=[0,1].filter((function(t){return t!==e.env}))[0];(t=this.curOpenSockets[t])&&t.loggedIn?this.reopenSocketWithApRequest(e.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(e,t,n){var r=this,i=1===e?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm((function(e,t){return[].concat(G(e),[t])}),[]),ba((function(e){return kr(e,(function(e){return Jm(t,e.ip)})).slice(-1)[0]})),Ka(1),cb((function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new ml(e.ip,i,e.ticket,r.context,r.logger,n);return t.on("connectionFailure",(function(){return r.onSocketConnectionFailure(t)})),t.open$.pipe(ca((function(){r.lastOpenSockets[i].next(t),r.curOpenSockets[i]=t})))})),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(e){var t=this,n=[0,1].filter((function(t){return t!==e}))[0];if(void 0!==(n=this.curOpenSockets[n])){var r,i=n.ip;n=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd((function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),oe((function(e){return e.pipe(ca((function(e){if(e.code===Kh)t.emit("tokenExpired"),t.apClient.apFinish$.next(void 0);else if(sa(e))throw e})),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))})),ca((function(e){t.log("An edge info got %o",e)})),wg((function(){t.apClient.clearUp()}))).pipe(rm((function(e,t){return[].concat(G(e),[t])}),[]),ba((function(e){return(e=kr(e,(function(e){return Jm(i,e.ip)}))).length-1>=t.ipIterator?e.slice(-t.ipIterator++-1)[0]:(t.ipIterator=0,e.slice(-1)[0])})),Dd(),cb((function(n){if(void 0===n)return Z(Error("Invalid edge info"));var i=new ml(n.ip,e,n.ticket,t.context,t.logger,r);return i.on("connectionFailure",(function(){return t.onSocketConnectionFailure(i)})),r=!i.useNewDomain,i.open$.pipe(qf(i))})),ca((function(n){t.log("The websocket of ENV_%d re-opened to %s:%d using ap",n.env,n.ip,af[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})),cb((function(n){return n.open$.pipe(ca((function(){t.log("The websocket of ENV_%d re-opened to %s:%d",n.env,n.ip,af[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})))})),pe()),e===this.firstEnv?this.firstOpenKeeperSubject.next(n):this.secondOpenKeeperSubject.next(n)}}}]),t}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.appId&&Object.hasOwnProperty.call(e,"appId")&&t.uint32(42).string(e.appId),null!=e.ver&&Object.hasOwnProperty.call(e,"ver")&&t.uint32(50).string(e.ver),null!=e.buildno&&Object.hasOwnProperty.call(e,"buildno")&&t.uint32(56).int32(e.buildno),null!=e.installId&&Object.hasOwnProperty.call(e,"installId")&&t.uint32(66).string(e.installId),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(128).int32(e.os),null!=e.did&&Object.hasOwnProperty.call(e,"did")&&t.uint32(138).string(e.did),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&zc.Session.CommonIndex.encode(e.index,t.uint32(162).fork()).ldelim(),null!=e.token&&Object.hasOwnProperty.call(e,"token")&&t.uint32(170).string(e.token),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(176).int32(e.version),null!=e.subVersion&&Object.hasOwnProperty.call(e,"subVersion")&&t.uint32(184).int32(e.subVersion),t},e.CommonIndex=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(e,t){return t||(t=Xc.create()),null!=e.index1&&Object.hasOwnProperty.call(e,"index1")&&t.uint32(10).string(e.index1),null!=e.index2&&Object.hasOwnProperty.call(e,"index2")&&t.uint32(18).string(e.index2),null!=e.index3&&Object.hasOwnProperty.call(e,"index3")&&t.uint32(26).string(e.index3),t},e}(),e}(),SC=zc.Link=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.ec&&Object.hasOwnProperty.call(e,"ec")&&t.uint32(40).int32(e.ec),null!=e.sc&&Object.hasOwnProperty.call(e,"sc")&&t.uint32(48).int32(e.sc),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(58).string(e.destServerIp),null!=e.ackedServerIp&&Object.hasOwnProperty.call(e,"ackedServerIp")&&t.uint32(66).string(e.ackedServerIp),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(72).int32(e.responseTime),t},e}(),TC=zc.Logout=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),t},e}(),UC=zc.KickedOff=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(56).int32(e.code),null!=e.server&&Object.hasOwnProperty.call(e,"server")&&t.uint32(66).string(e.server),null!=e.serverCode&&Object.hasOwnProperty.call(e,"serverCode")&&t.uint32(72).int32(e.serverCode),t},e}(),VC=zc.ChnJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),WC=zc.ChnJoinRes=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(64).int32(e.serverErrCode),t},e}(),XC=zc.ChnLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),YC=zc.ConnectionStateChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.oldState&&Object.hasOwnProperty.call(e,"oldState")&&t.uint32(40).int32(e.oldState),null!=e.newState&&Object.hasOwnProperty.call(e,"newState")&&t.uint32(48).int32(e.newState),null!=e.reason&&Object.hasOwnProperty.call(e,"reason")&&t.uint32(56).int32(e.reason),null!=e.reconnId&&Object.hasOwnProperty.call(e,"reconnId")&&t.uint32(64).int32(e.reconnId),t},e}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(e){function t(e,i,o){return W(this,t),m(n(o=r.call(this,o,"Context")),"_token",void 0),m(n(o),"config",void 0),m(n(o),"_uid",void 0),m(n(o),"_sid",void 0),m(n(o),"_area","CN"),m(n(o),"appId",void 0),m(n(o),"enableCloudProxy",!1),m(n(o),"cloudProxyServers",[]),o.appId=e,o.config=i,o}la(t,e);var r=ma(t);return Ha(t,[{key:"token",set:function(e){this._token="string"==typeof e&&e?e:void 0}},{key:"uid",get:function(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(e){if(this.log("The user ID is set to %s",oa(e)),!za(e))throw new Ia;this._uid=e}},{key:"key",get:function(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(e){if(this.log("sid is set to %s",e),"string"!=typeof e||!e)throw new Ia;this._sid=e}},{key:"rtmArea",get:function(){if("string"==typeof this._area&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(e){this.log("area is set to %s",e),"string"==typeof e&&e?this._area=e:this.warn("set area failed")}}]),t}(tb()),$C=!!Fc&&R((function(){Fc.prototype.finally.call({then:function(){}},(function(){}))}));if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(e){var t=kd(this,mc("Promise")),n="function"==typeof e;return this.then(n?function(n){return mj(t,e()).then((function(){return n}))}:e,n?function(n){return mj(t,e()).then((function(){throw n}))}:e)}}),"function"==typeof Fc){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var e=J(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Uint8Array,e.next=3,crypto.subtle.digest("SHA-256",t);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$r=function(e){return Array.from(e).map((function(e){return e.toString(16).padStart(2,"0")})).join("")},bD=function(e){if("string"!=typeof e)throw new TypeError("Expected input to be a string");if(0!=e.length%2)throw new RangeError("Expected string to be an even number of characters");for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substring(n,n+2),16);return t},as=function(e){return btoa(String.fromCharCode.apply(String,G(e))).replace(/={1,2}$/,"")},bs=function(){var e=J(w.mark((function e(t){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.digest("SHA-1",t);case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n=sha1.arrayBuffer(t);case 9:return e.abrupt("return",as(new Uint8Array(n)));case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),cs=function(e,t,n,r){r[t]=!0,n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))},cD=function(e){switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,o,"ChunkDownloadManager");if(m(n(a),"abortController",new AbortController),m(n(a),"downloadedSize",0),m(n(a),"successCount",0),m(n(a),"timer",void 0),m(n(a),"chunks",[]),m(n(a),"retUnit",void 0),m(n(a),"singleThread",!1),m(n(a),"initialized",!1),m(n(a),"ee",void 0),m(n(a),"chunkCount",void 0),m(n(a),"aborted",!1),m(n(a),"serverToIndices",new Map),m(n(a),"backupToIndices",new Map),m(n(a),"indexToBackupServers",[]),m(n(a),"busyBackupServers",new Map),m(n(a),"downloadingChunks",new Set),m(n(a),"metaInfo",void 0),m(n(a),"transHandler",void 0),a.metaInfo=e,a.transHandler=i,a.ee=void 0===s?new ea:s,o=e.size,e=e.unit,0===o)throw new Ia("size cannot be 0");return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){a.abortController.abort()}),{once:!0}),a.abortController.signal.addEventListener("abort",(function(){a.aborted=!0}),{once:!0}),a.chunkCount=Math.ceil(o/(32768*e)),a}la(t,e);var r=ma(t);return Ha(t,[{key:"setInfoByResponse",value:function(e){var t=this,n=e.serverList,r=e.backupList;if(e=e.unit,n.length<this.chunkCount&&r.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var i=Array(this.chunkCount).fill(!1);if(n.forEach((function(e,n){return e.forEach((function(e){return cs(e,n,t.serverToIndices,i)}))})),r.forEach((function(e,n){return e.forEach((function(e){return cs(e,n,t.backupToIndices,i)}))})),i.some((function(){return!1})))throw new da("Not enough servers to download",mg);this.indexToBackupServers=r.map((function(e){return new Set(e)})),this.retUnit=e}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):1===this.serverToIndices.size&&0===Array.from(this.serverToIndices.keys())[0]?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(e){var t=this,n=this.downloadedSize+e;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&this.successCount!==this.chunkCount&&(this.timer=setTimeout((function(){t.ee.emit("timedOut"),t.abortController.abort()}),12e4)),this.initialized&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var e=0,t=0,n=this.chunks;t<n.length;t++)e+=n[t].byteLength;if(e!==this.metaInfo.size)throw new Ia("invalid chunks total size");e=new Uint8Array(e),n=t=0;for(var r=this.chunks;n<r.length;n++){var i=r[n];e.set(new Uint8Array(i),t),t+=i.byteLength}return t=Array.from(e.subarray(0,4)).map((function(e){return e.toString(16)})).join("").toUpperCase(),Zt(e.buffer,cD(t))}},{key:"getDownloadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(e).split(".").join("-"),".edge.").concat(t,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var e=J(w.mark((function e(t){var n,r=this,i=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<i.length&&void 0!==i[1]&&i[1],e.next=3,Promise.all(Array.from(t.entries()).map((function(e){return e=ra(e,2),r.postDownloadRequest(e[0],Array.from(e[1]),n).catch((function(e){404===e.statusCode?(r.ee.emit("notExist"),r.abortController.abort()):"AbortError"!==e.name&&(Sa(e)?r.singleThread?(r.abortController.abort(),r.ee.emit("timedOut")):(r.warn("%d download timed out after %d, retrying use single thread",e.index,r.singleThread?6e4:3e4),r.abortController.abort(),r.singleThread=!0,r.ee.emit("multiTimeOut")):(r.ee.emit("error",e),r.abortController.abort()))}))})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var e=J(w.mark((function e(t,n,r){var i,o,s,a,c,u,l,d,h,p=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=function(){return(h=J(w.mark((function e(o){var s,h,p,f,m,g,_,E,v;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==o||0!==t){e.next=5;break}throw new Ia("Invalid serverIp");case 5:s=void 0===o?l.getDownloadUrl(t):o;case 6:return l.downloadingChunks.add(i),e.next=9,u(s);case 9:return h=e.sent,p=h.responseData,l.downloadingChunks.delete(i),e.abrupt("return",p);case 15:if(e.prev=15,e.t0=e.catch(0),l.downloadingChunks.delete(i),n.unshift(i),l.metaInfo.useNewDomain=!1,"AbortError"!==e.t0.name){e.next=22;break}throw e.t0;case 22:if(!Sa(e.t0)){e.next=25;break}throw e.t0.index=i,e.t0;case 25:if(f=a,a+=1,!(2>f)){e.next=30;break}return e.t0 instanceof Ia||l.warn("%o, %d download failed, retrying",e.t0,i),e.abrupt("return",d());case 30:if(504!==e.t0.statusCode){e.next=34;break}throw(m=new db("download server timed out",{originalError:e.t0,serverCode:504})).index=i,m;case 34:if(!r||2!==f||0===c[0]){e.next=45;break}return e.t0 instanceof Ia||l.warn("%d download failed, using backup: %d, %o",i,c[0],e.t0),e.next=38,l.busyBackupServers.get(c[0]);case 38:return g=d(l.getDownloadUrl(c[0])),l.busyBackupServers.set(c[0],g),e.next=42,g;case 42:return _=e.sent,l.busyBackupServers.delete(c[0]),e.abrupt("return",_);case 45:if(!(r&&2<f&&void 0!==c[1]&&0!==c[1])){e.next=56;break}return l.warn("%d download failed, using backup 1: %d",i,c[1]),e.next=49,l.busyBackupServers.get(c[1]);case 49:return E=d(l.getDownloadUrl(c[1])),l.busyBackupServers.set(c[1],E),e.next=53,E;case 53:return v=e.sent,l.busyBackupServers.delete(c[1]),e.abrupt("return",v);case 56:throw e.t0.index=i,e.t0;case 58:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)},d=function(e){return h.apply(this,arguments)},!this.aborted){e.next=4;break}throw new Ia("download already aborted");case 4:if(void 0!==(i=n.shift())){e.next=8;break}return this.log("%s download finished",t),e.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){e.next=10;break}return e.abrupt("return");case 10:if(!this.downloadingChunks.has(i)){e.next=13;break}return this.log("%s already downloading, return",i),e.abrupt("return");case 13:if(void 0===this.chunks[i]){e.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",i),e.next=18,this.postDownloadRequest(t,n,r);case 18:return e.abrupt("return");case 19:return o=new FormData,s={hash:hu(this.metaInfo.hashHexStr),unit:void 0===this.retUnit?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:i},o.append("parameter",JSON.stringify(s)),a=0,c=Array.from(this.indexToBackupServers[i]),u=function(e){return te(e,{body:o,signal:p.abortController.signal,timeout:p.singleThread?12e4:3e4},{useBinaryResponse:!0})},l=this,e.next=28,d().then((function(e){return void 0!==p.chunks[i]?p.log("chunk %d download duplicated",i):(p.chunks[i]=e,p.log("chunk %d downloaded",i),p.successCount+=1,p.updateProgress(p.chunks[i].byteLength)),p.successCount===p.chunkCount&&(p.log("chunks all download"),p.ee.emit("finished")),p.singleThread?(p.downloadChunks(),Promise.resolve()):p.postDownloadRequest(t,n,r)}));case 28:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(tb()),es=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,o,"ChunkUploadManager");if(m(n(a),"chunkCount",0),m(n(a),"chunks",[]),m(n(a),"uploadedChunks",[]),m(n(a),"totalFailures",0),m(n(a),"timer",void 0),m(n(a),"initState","uninitialized"),m(n(a),"ee",void 0),m(n(a),"unit",0),m(n(a),"uploadedSize",0),m(n(a),"singleThread",!1),m(n(a),"abortController",new AbortController),m(n(a),"servers",[]),m(n(a),"aborted",!1),m(n(a),"metaInfo",void 0),m(n(a),"transHandler",void 0),a.metaInfo=e,a.transHandler=i,a.ee=void 0===s?new ea:s,0===e.file.length)throw new I("file not found or is empty",wf);return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",(function(){a.abortController.abort()}),{once:!0}),a.abortController.signal.addEventListener("abort",(function(){a.aborted=!0}),{once:!0}),a}la(t,e);var r=ma(t);return Ha(t,[{key:"initChunks",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("initialized"!==this.initState&&"initializing"!==this.initState){e.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=t,n=this.sliceFile(t,this.metaInfo.file),this.chunkCount=n.length,r=[],i=function(e,t){var n=(e=ra(t[e],2))[0],i=e[1];e=bs(i).then((function(e){a.chunks[n]={payload:i,sha1:e,uploadedTo:void 0,index:n,processed:!1}})),r.push(e)},o=0,s=Array.from(n.entries());o<s.length;o++)i(o,s);return e.next=11,Promise.all(r);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var e=this;if(!this.aborted){for(var t=this.chunks.filter((function(e){return!e.processed})),n=function(n){var r=t[n],i=e.servers.filter((function(e){return!e.isUploading})).sort((function(e,t){return e.successCount-t.successCount})).sort((function(e,t){return e.failureCount-t.failureCount}))[0];if(void 0===i||1<i.failureCount)return e.log("Upload server not available, waiting"),e.ee.emit("serverUsedUp"),Om(1e3).then((function(){e.totalFailures>2*e.chunkCount&&e.ee.emit("error"),e.totalFailures+=1,void 0!==i&&(i.failureCount=0),e.uploadToServers()})).catch((function(){})),"break";r.processed=!0,i.isUploading=!0,e.log("uploading chunk %d to server %s",r.index,Dg(i.ip));var o=e.getUploadUrl(i.ip);return J(w.mark((function t(){var n;return w.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.postChunk(r.payload,o,r.index);case 3:n=e.chunks.findIndex((function(e){return e===r})),r.uploadedTo=i.ip,e.chunks.splice(n,1),e.uploadedChunks.push(r),i.successCount+=1,i.isUploading=!1,e.updateProgress(r.payload.byteLength),e.log("upload chunk %d successfully",r.index),t.next=31;break;case 13:if(t.prev=13,t.t0=t.catch(0),i.isUploading=!1,r.processed=!1,504!==t.t0.statusCode&&!Sa(t.t0)){t.next=27;break}if(e.singleThread){t.next=24;break}return e.warn("%d upload timed out after %d, retrying use single thread",r.index,e.singleThread?12e4:3e4),e.abortController.abort(),e.singleThread=!0,e.ee.emit("multiTimeOut"),t.abrupt("return");case 24:return e.ee.emit("timedOut"),e.abortController.abort(),t.abrupt("return");case 27:return e.metaInfo.useNewDomain=!1,i.failureCount+=1,t.next=31,Om(1e3);case 31:e.uploadedChunks.length===e.chunkCount?(e.log("chunks uploaded"),e.ee.emit("finished")):(e.singleThread||1===e.chunks.filter((function(e){return!e.processed})).length)&&e.uploadToServers();case 32:case"end":return t.stop()}}),t,null,[[0,13]])})))(),e.singleThread?"break":void 0},r=0;r<t.length&&"break"!==n(r);r++);0===t.length&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var e=!0,t=[],n=G(this.uploadedChunks).sort((function(e,t){return e.index-t.index})),r=0;for(n=Array.from(n.values());r<n.length;r++){var i=n[r].uploadedTo;if(void 0===i){e=!1;break}t.push(i)}if(!e)throw new Ia("some chunks not uploaded, cannot get upload server ips");return t}},{key:"addServers",value:function(e){var t=this;e.forEach((function(e){var n=t.servers.findIndex((function(t){return t.ip===e}));-1!==n?t.servers[n].failureCount=0:(t.log("server %s added",Dg(e)),t.servers.push({successCount:0,isUploading:!1,ip:e,failureCount:0}))}))}},{key:"updateProgress",value:function(e){var t=this,n=void 0!==e?this.uploadedSize+e:this.metaInfo.file.length;n>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&void 0!==e&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout((function(){t.ee.emit("timedOut"),t.abortController.abort()}),12e4)),"initialized"===this.initState&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(e,t){var n=0,r=[],i=t.length;for(e*=32768;n<i;)r.push(t.slice(n,n+e)),n+=e;return this.log("chunks split into %d",r.length),r}},{key:"postChunk",value:function(){var e=J(w.mark((function e(t,n,r){var i,o,s,a,c,u,l;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.aborted){e.next=2;break}throw new Ia("upload already aborted");case 2:if(void 0!==this.unit){e.next=4;break}throw new Ia("unit is undefined");case 4:return i=this.metaInfo,o=i.ticket,s=i.instance,a=i.loginOpt,c=i.hashStr,e.t0=r,e.t1=c,e.next=9,bs(t);case 9:return e.t2=e.sent,e.t3=this.unit,e.t4=o,e.t5=s,e.t6=a,u={index:e.t0,hash:e.t1,sha1:e.t2,unit:e.t3,ticket:e.t4,instance:e.t5,loginOpt:e.t6},(l=new FormData).append("parameter",JSON.stringify(u)),l.append("payload",new Blob([t])),e.next=20,te(n,{headers:{Accept:"application/json"},body:l,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(201===e.sent.status){e.next=24;break}throw new da("uploading chunk ".concat(r," failed"));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(e).split(".").join("-"),".edge.").concat(t,":9601/api/v1/chuck/upload")}}]),t}(tb()),fs=function(e){function t(e){W(this,t);var i=r.call(this,e,"MediaTaskManager");return m(n(i),"isProcessing",!1),m(n(i),"authInfo",void 0),m(n(i),"taskFinishers",{}),m(n(i),"mediaTasks",new Map),m(n(i),"ongoingTask",void 0),i.on("connectionStateChanged",(function(e){if(e===S.ConnectionState.ABORTED||e===S.ConnectionState.DISCONNECTED){void 0!==i.ongoingTask&&i.cancelTask(i.ongoingTask),e=0;for(var t=Array.from(i.mediaTasks.entries());e<t.length;e++){var n=ra(t[e],2)[1];i.cancelTask(n)}i.mediaTasks.clear(),i.taskFinishers={}}else e===S.ConnectionState.RECONNECTING?void 0!==i.ongoingTask&&i.ongoingTask.manager.abortController.abort():e===S.ConnectionState.CONNECTED&&void 0!==i.ongoingTask&&i.ongoingTask.manager.ee.emit("reconnected")})),i}la(t,e);var r=ma(t);return Ha(t,[{key:"setAuthInfo",value:function(e){this.authInfo=e}},{key:"waitMediaTask",value:function(e){var t=this;return new Promise((function(n,r){t.taskFinishers[e]={resolve:n,reject:r},t.isProcessing||t.processMediaTask()})).finally((function(){void 0!==t.ongoingTask&&void 0!==t.ongoingTask.manager.timer&&clearTimeout(t.ongoingTask.manager.timer),delete t.taskFinishers[e],0!==t.mediaTasks.size?t.processMediaTask():t.isProcessing=!1}))}},{key:"addUploadTask",value:function(e,n,r,i){var o=e.file;if(e=e.hash,void 0===this.authInfo)throw new Ia("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return i=new es({hashStr:as(e),file:o,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},i,this.logger),o=Ud(),this.mediaTasks.set(o,{type:"UPLOAD",manager:i,hash:e,setter:r,fetcher:n,taskId:o}),o}},{key:"addDownloadTask",value:function(e,n,r){var i=e.hashHexStr,o=e.size,s=e.unit;if(e=e.zone,void 0===this.authInfo)throw new Ia("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return r=new ds({hashHexStr:i,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:o,zone:e,unit:s},r,this.logger),i=Ud(),this.mediaTasks.set(i,{type:"DOWNLOAD",manager:r,fetcher:n,taskId:i}),i}},{key:"doDownloadTaskImpl",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,u,l,d=this,h=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<h.length&&void 0!==h[2]&&h[2],o=i=t.manager,r&&(i=new ds(o.metaInfo,o.transHandler,this.logger,o.ee)),s=t.fetcher,e.next=7,s();case 7:if(a=e.sent,c=a.serverList,u=a.backupList,l=a.unit,!r||l===o.retUnit){e.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:r&&(t.manager=i,i.downloadedSize=o.downloadedSize,i.successCount=o.successCount,i.timer=o.timer,i.chunks=o.chunks,i.initialized=o.initialized,i.singleThread=o.singleThread,i.updateProgress(0)),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("error",(function(e){i.ee.removeAllListeners(),n.reject(new da(["download file file, index %d",e.index],{code:mg,originalError:e}))})),i.ee.once("notExist",(function(){i.abortController.abort(),i.ee.removeAllListeners(),n.reject(new da("download file not found",AA))})),i.ee.once("timedOut",(function(){i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new db("download timed out",zA))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new hl("Downloading canceled",ir))}),{once:!0}),i.ee.once("finished",(function(){n.resolve({type:"DOWNLOAD",payload:i.getPayload()})})),i.setInfoByResponse({serverList:c,backupList:u,unit:l}),i.downloadChunks();case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=e),new Promise((function(i,o){n.doDownloadTaskImpl(e,t,r).then(i).catch(o)}))}},{key:"doUploadTaskImpl",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,u,l,d=this,h=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=2<h.length&&void 0!==h[2]&&h[2],o=i=t.manager,r&&(i=new es(o.metaInfo,o.transHandler,this.logger,o.ee)),s=t.fetcher,a=new Pa,u=new Promise((function(e,u){var l=s(),d=l.ret,h=l.err,p=l.timeout;l.fin.pipe(ob(a)).subscribe({next:function(e){n.resolve({type:"UPLOAD",retUnit:e.unit,zone:e.zone})},complete:function(){e({hasExist:!0}),a.next(),a.complete()}}),d.pipe(ob(a),cb(function(){var e=J(w.mark((function e(s){var a,u;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.servers,u=s.unit,r&&o.unit!==u?n.reject(new da("upload unit is different, reject to continue",lg)):r&&(t.manager=i,i.chunkCount=o.chunkCount,i.chunks=o.chunks,i.totalFailures=o.totalFailures,i.uploadedChunks=o.uploadedChunks,i.timer=o.timer,i.initState=o.initState,i.unit=o.unit,i.uploadedSize=o.uploadedSize,i.singleThread=o.singleThread,i.updateProgress(0)),i.addServers(a),"uninitialized"!==i.initState){e.next=7;break}return c=i.initChunks(u),e.next=7,c;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).subscribe({complete:function(){return e({hasExist:!1})},error:u}),l=function(t){"uninitialized"!==i.initState&&c?e(c.then((function(){return{hasExist:!1}}))):u(t)},h.pipe(ob(a)).subscribe({error:l}),p.pipe(ob(a)).subscribe({error:l})})),e.next=9,u;case 9:if(!e.sent.hasExist){e.next=15;break}return i.updateProgress(),this.log("file already exists, skipping upload"),e.abrupt("return");case 15:a.next(),a.complete(),this.log("chunks initialization promise resolved"),l=gb(i.ee,"serverUsedUp").pipe(Gt((function(){return i.chunkCount!==i.uploadedChunks.length})),Jt(5e3,void 0,{leading:!1}),pm((function(){return s().ret}))).subscribe((function(e){i.addServers(e.servers)})),i.ee.once("reconnected",(function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("multiTimeOut",(function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch((function(e){n.reject(e)}))})),i.ee.once("timedOut",(function(){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new db("upload timed out",Lh))})),i.ee.once("error",(function(e){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(e||new da("upload error",lg))})),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",(function(){n.reject(new hl("Uploading canceled",hr))}),{once:!0}),i.ee.once("finished",J(w.mark((function e(){var r,o,s;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.unsubscribe(),e.next=3,t.setter(i.unit,i.getUploadServerIPs());case 3:r=e.sent,o=r.zone,s=r.unit,i.ee.removeAllListeners(),n.resolve({type:"UPLOAD",retUnit:s,zone:o});case 8:case"end":return e.stop()}}),e)})))),i.uploadToServers();case 26:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doUploadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=e.taskId;return r||(this.mediaTasks.delete(i),this.ongoingTask=e),new Promise((function(i,o){n.doUploadTaskImpl(e,t,r).then(i).catch(o)}))}},{key:"processMediaTask",value:function(){var e=J(w.mark((function e(){var t,n,r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.mediaTasks.size){e.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,t=this.mediaTasks.keys().next().value,void 0!==(n=this.taskFinishers[t])){e.next=7;break}throw Error("top task not found");case 7:if(void 0!==(r=this.mediaTasks.get(t))){e.next=10;break}throw new Ia("task invalid");case 10:if("UPLOAD"!==r.type){e.next=15;break}return e.next=13,this.doUploadTask(r,n).catch((function(e){r.manager.ee.removeAllListeners(),n.reject(e)}));case 13:e.next=18;break;case 15:if("DOWNLOAD"!==r.type){e.next=18;break}return e.next=18,this.doDownloadTask(r,n).catch((function(e){r.manager.ee.removeAllListeners(),n.reject(e)}));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancelTask",value:function(e){var t="DOWNLOAD"===e.type?ir:hr;e.manager.ee.removeAllListeners(),e.manager.abortController.abort(),void 0!==this.taskFinishers[e.taskId]&&this.taskFinishers[e.taskId].reject(new hl("User logged out or kicked off, media task canceled",t))}}]),t}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",(function(){for(var e=0,t=arguments.length,n=new(Ne(this))(t);t>e;)n[e]=arguments[e++];return n}),Dj);var gs=1/0,dD=Math.max,ju=function(e,t,n){var r=Object(e);if(!Ed(e)){var i=Te(t);e=Ad(e),t=function(e){return i(r[e],e,r)}}return-1<(t=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;if(null==n)n=0;else{var i=(n=n?(n=gl(n))===gs||n===-gs?17976931348623157e292*(0>n?-1:1):n==n?n:0:0===n?n:0)%1;n=n==n?i?n-i:n:0}return 0>n&&(n=dD(r+n,0)),Xp(e,Te(t),n)}(e,t,n))?r[i?e[t]:t]:void 0},iu=function(e,t){return e&&e.length?vk(e,void 0,"function"==typeof t?t:void 0):[]},hs=function(){function e(){W(this,e),m(this,"size",0),m(this,"fields",new Map)}return Ha(e,[{key:"define",value:function(e,t,n){if(this.size+=n,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(t={val:0,isNumber:"number"===t,isBoolean:"boolean"===t,oneof:"number"===t||"boolean"===t?void 0:t,len:n}),this.fields.set(e,t)}},{key:"set",value:function(e,t){if(!(e=this.fields.get(e)))throw Error("field not found");var n=e.oneof;if(!U.isLong(t)&&"number"!=typeof t)if("boolean"==typeof t)t=t?1:0;else{if(void 0===n)throw Error("invalid field type");if(void 0===(t=n[t]))throw Error("field type not found")}Mg(e,t),e.val=t}},{key:"toNumber",value:function(){for(var e=0,t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e+=U.fromValue(i).shiftLeft(t).toNumber(),t+=o)}return e}},{key:"toLong",value:function(){for(var e=U.fromNumber(0,!0),t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e=U.fromValue(i).shiftLeft(t).add(e),t+=o)}return e}},{key:"assert",value:function(e,t){function n(e){if(!U.isLong(e)&&"number"!=typeof e)if("boolean"==typeof e)e=e?1:0;else{if(void 0===i)throw Error("invalid field type");if(void 0===(e=i[e]))throw Error("field type not found")}return Mg(r,e),Lg(e,r.val)}var r=this.fields.get(e);if(!r)throw Error("field not found");var i=r.oneof;if(!Array.isArray(t))return n(t);if(1===t.length)return n(t[0]);if(t.every((function(e){return"string"==typeof e}))&&void 0!==i)return t.some((function(e){return n(e)}));throw Error("invalid valueTypes")}},{key:"from",value:function(e){e=U.fromValue(e);for(var t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],o=i.len,s=U.fromNumber(Math.pow(2,o)-1,!0).shiftLeft(t);Mg(i,s=e.and(s).shiftRightUnsigned(t)),i.val=s,t+=o}}},{key:"typeOf",value:function(e){if(void 0!==(e=this.fields.get(e))){var t=e.oneof;if(e=e.val,void 0!==t){var n=0;for(t=Object.entries(t);n<t.length;n++){var r=ra(t[n],2),i=r[0];if(Lg(e,r[1]))return i}}}throw new TypeError("can only get type of oneof type")}}]),e}(),is=function(e){function t(e){W(this,t);var r=n.call(this);return r.define("Rejoin","boolean",1),r.define("Unused","number",31),r.define("Platform","number",8),r.define("Version","number",12),r.define("Subversion","number",12),r.set("Platform",7),r.set("Version",4),r.set("Subversion",203),r.set("Rejoin",e),r}la(t,e);var n=ma(t);return t}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(e){function t(e){W(this,t);var r=n.call(this);if(r.define("MessageType",fD,8),r.define("BroadcastJumps","number",2),r.define("ToCache","boolean",1),r.define("FromCache","boolean",1),r.define("CompressionMethod",gD,2),r.define("IterationNumber","number",4),r.define("BufferedMessage","boolean",1),r.define("ToArchive","boolean",1),r.define("FromArchive","boolean",1),"number"==typeof e||U.isLong(e))r.from(e);else if(void 0!==e){var i=0;for(e=Hg(e);i<e.length;i++){var o=ra(e[i],2);r.set(o[0],o[1])}}return r}la(t,e);var n=ma(t);return Ha(t,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(e){var t=this;return void 0!==e?this.assert("MessageType",e):xf(js).some((function(e){return t.assert("MessageType",e)}))}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),t}(hs),hD=function(e){function t(e){return W(this,t),m(n(e=r.call(this,e,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),e}la(t,e);var r=ma(t);return Ha(t,[{key:"getChatInfo",value:function(e){var t=this.dialogueLru.get(e);if(this.dialogueLru.prune(),t){var n=t.dialogue,r={dialogue:n,sequence:t=t.sequence.add(1)};return this.dialogueLru.set(e,{dialogue:n,sequence:t}),r}return n={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(e,n),n}}]),t}(tb()),v={};"object"==X(module)&&(module.exports=v),v.parse=function(e,t){var n,r=v.bin.readUshort,i=v.bin.readUint,o={};for(n=(e=new Uint8Array(e)).length-4;101010256!=i(e,n);)n--;var s=r(e,n=n+4+4);r(e,n+=2),i(e,n+=2),n=i(e,n+=4);for(var a=0;a<s;a++){i(e,n),n+=4,n+=4,n+=4,i(e,n+=4);var c=i(e,n+=4),u=i(e,n+=4),l=r(e,n+=4),d=r(e,n+2),h=r(e,n+4);n+=6;var p=i(e,n+=8);n+=4,n+=l+d+h,v._readLocal(e,p,o,c,u,t)}return o},v._readLocal=function(e,t,n,r,i,o){var s=v.bin.readUshort,a=v.bin.readUint;a(e,t),s(e,t+=4),s(e,t+=2);var c=s(e,t+=2);a(e,t+=2),a(e,t+=4),a=s(e,t=t+4+8);var u=s(e,t+=2);if(t+=2,s=v.bin.readUTF8(e,t,a),t=t+a+u,o)n[s]={size:i,csize:r};else if(e=new Uint8Array(e.buffer,t),0==c)n[s]=new Uint8Array(e.buffer.slice(t,t+r));else{if(8!=c)throw"unknown compression method: "+c;t=new Uint8Array(i),v.inflateRaw(e,t),n[s]=t}},v.inflateRaw=function(e,t){return v.F.inflate(e,t)},v.inflate=function(e,t){return e[0],e[1],v.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),t)},v.deflate=function(e,t){null==t&&(t={level:6});var n=0,r=new Uint8Array(50+Math.floor(1.1*e.length));return r[n]=120,r[n+1]=156,n=v.F.deflateRaw(e,r,n+2,t.level),e=v.adler(e,0,e.length),r[n+0]=e>>>24&255,r[n+1]=e>>>16&255,r[n+2]=e>>>8&255,r[n+3]=e>>>0&255,new Uint8Array(r.buffer,0,n+4)},v.deflateRaw=function(e,t){null==t&&(t={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),r=v.F.deflateRaw(e,n,r,t.level);return new Uint8Array(n.buffer,0,r)},v.encode=function(e,t){null==t&&(t=!1);var n,r=0,i=v.bin.writeUint,o=v.bin.writeUshort,s={};for(n in e){var a=!v._noNeed(n)&&!t,c=e[n],u=v.crc.crc(c,0,c.length);s[n]={cpr:a,usize:c.length,crc:u,file:a?v.deflateRaw(c):c}}for(n in s)r+=s[n].file.length+30+46+2*v.bin.sizeUTF8(n);for(n in e=new Uint8Array(r+22),t=0,c=[],s)u=s[n],c.push(t),t=v._writeHeader(e,t,n,u,0);for(n in r=0,a=t,s)u=s[n],c.push(t),t=v._writeHeader(e,t,n,u,1,c[r++]);return s=t-a,i(e,t,101010256),o(e,t=t+4+4,r),o(e,t+=2,r),i(e,t+=2,s),i(e,t+4,a),e.buffer},v._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),-1!="png,jpg,jpeg,zip".indexOf(e)},v._writeHeader=function(e,t,n,r,i,o){var s=v.bin.writeUint,a=v.bin.writeUshort,c=r.file;return s(e,t,0==i?67324752:33639248),t+=4,1==i&&(t+=2),a(e,t,20),a(e,t+=2,0),a(e,t+=2,r.cpr?8:0),s(e,t+=2,0),s(e,t+=4,r.crc),s(e,t+=4,c.length),s(e,t+=4,r.usize),a(e,t+=4,v.bin.sizeUTF8(n)),a(e,t+=2,0),t+=2,1==i&&(s(e,t=t+2+2+6,o),t+=4),t+=n=v.bin.writeUTF8(e,t,n),0==i&&(e.set(c,t),t+=c.length),t},v.crc={table:function(){for(var e=new Uint32Array(256),t=0;256>t;t++){for(var n=t,r=0;8>r;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=v.crc.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^v.crc.update(4294967295,e,t,n)}},v.adler=function(e,t,n){var r=1,i=0,o=t;for(t+=n;o<t;){for(n=Math.min(o+5552,t);o<n;)i+=r+=e[o++];r%=65521,i%=65521}return i<<16|r},v.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,t,n){for(var r,i="",o=0;o<n;o++)i+="%"+v.bin.pad(e[t+o].toString(16));try{r=decodeURIComponent(i)}catch(r){return v.bin.readASCII(e,t,n)}return r},writeUTF8:function(e,t,n){for(var r=n.length,i=0,o=0;o<r;o++){var s=n.charCodeAt(o);if(0==(4294967168&s))e[t+i]=s,i++;else if(0==(4294965248&s))e[t+i]=192|s>>6,e[t+i+1]=128|63&s,i+=2;else if(0==(4294901760&s))e[t+i]=224|s>>12,e[t+i+1]=128|s>>6&63,e[t+i+2]=128|63&s,i+=3;else{if(0!=(4292870144&s))throw"e";e[t+i]=240|s>>18,e[t+i+1]=128|s>>12&63,e[t+i+2]=128|s>>6&63,e[t+i+3]=128|63&s,i+=4}}return i},sizeUTF8:function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e.charCodeAt(r);if(0==(4294967168&i))n++;else if(0==(4294965248&i))n+=2;else if(0==(4294901760&i))n+=3;else{if(0!=(4292870144&i))throw"e";n+=4}}return n}},v.F={},v.F.deflateRaw=function(e,t,n,r){var i=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r],o=v.F.U,s=v.F._goodIndex;v.F._hash;var a=v.F._putsE,c=0;n<<=3;var u=0,l=e.length;if(0==r){for(;c<l;){var d=Math.min(65535,l-c);a(t,n,c+d==l?1:0),n=v.F._copyExact(e,c,d,t,n+8),c+=d}return n>>>3}a=o.lits,r=o.strt;var h=o.prev,p=0,f=0,m=0,g=0,_=0;for(2<l&&(r[_=v.F._hash(e,0)]=0),c=0;c<l;c++){if(d=_,c+1<l-2){_=v.F._hash(e,c+1);var E=c+1&32767;h[E]=r[_],r[_]=E}if(u<=c){if((14e3<p||26697<f)&&100<l-c&&(u<c&&(a[p]=c-u,p+=2,u=c),n=v.F._writeBlock(c==l-1||u==l?1:0,a,p,g,e,m,c-m,t,n),p=f=g=0,m=c),E=0,c<l-2&&(E=v.F._bestMatch(e,c,h,d,Math.min(i[2],l-c),i[3])),0!=E){d=E>>>16,E&=65535;var y=s(d,o.of0);o.lhst[257+y]++;var b=s(E,o.df0);o.dhst[b]++,g+=o.exb[y]+o.dxb[b],a[p]=d<<23|c-u,a[p+1]=E<<16|y<<8|b,p+=2,u=c+d}else o.lhst[e[c]]++;f++}}for(m==c&&0!=e.length||(u<c&&(a[p]=c-u,p+=2),n=v.F._writeBlock(1,a,p,g,e,m,c-m,t,n));0!=(7&n);)n++;return n>>>3},v.F._bestMatch=function(e,t,n,r,i,o){var s=32767&t,a=n[s],c=s-a+32768&32767;if(a==s||r!=v.F._hash(e,t-c))return 0;for(var u=r=0,l=Math.min(32767,t);c<=l&&0!=--o&&a!=s;){if((0==r||e[t+r]==e[t+r-c])&&(s=v.F._howLong(e,t,c))>r){if(u=c,(r=s)>=i)break;c+2<s&&(s=c+2);for(var d=0,h=0;h<s-2;h++){var p=t-c+h+32768&32767,f=p-n[p]+32768&32767;f>d&&(d=f,a=p)}}c+=(s=a)-(a=n[s])+32768&32767}return r<<16|u},v.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]==e[t-n];)t++;return t-r},v.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e,t,n,r,i,o,s,a,c){var u=v.F.U,l=v.F._putsF,d=v.F._putsE;u.lhst[256]++;var h=v.F.getTrees(),p=h[0],f=h[1],m=h[2],g=h[3],_=h[4],E=h[5],y=h[6];h=h[7];var b=32+(0==(c+3&7)?0:8-(c+3&7))+(s<<3),T=r+v.F.contSize(u.fltree,u.lhst)+v.F.contSize(u.fdtree,u.dhst);r=r+v.F.contSize(u.ltree,u.lhst)+v.F.contSize(u.dtree,u.dhst),r+=14+3*E+v.F.contSize(u.itree,u.ihst)+(2*u.ihst[16]+3*u.ihst[17]+7*u.ihst[18]);for(var S=0;286>S;S++)u.lhst[S]=0;for(S=0;30>S;S++)u.dhst[S]=0;for(S=0;19>S;S++)u.ihst[S]=0;if(b=b<T&&b<r?0:T<r?1:2,l(a,c,e),l(a,c+1,b),c+=3,0==b){for(;0!=(7&c);)c++;c=v.F._copyExact(i,o,s,a,c)}else{if(1==b)var w=u.fltree,R=u.fdtree;if(2==b){for(v.F.makeCodes(u.ltree,p),v.F.revCodes(u.ltree,p),v.F.makeCodes(u.dtree,f),v.F.revCodes(u.dtree,f),v.F.makeCodes(u.itree,m),v.F.revCodes(u.itree,m),w=u.ltree,R=u.dtree,d(a,c,g-257),d(a,c+=5,_-1),d(a,c+=5,E-4),c+=4,e=0;e<E;e++)d(a,c+3*e,u.itree[1+(u.ordr[e]<<1)]);c=v.F._codeTiny(y,u.itree,a,c+3*E),c=v.F._codeTiny(h,u.itree,a,c)}for(E=0;E<n;E+=2){for(y=(e=t[E])>>>23,e=o+(8388607&e);o<e;)c=v.F._writeLit(i[o++],w,a,c);0!=y&&(e=(p=t[E+1])>>16,s=p>>8&255,p&=255,d(a,c=v.F._writeLit(257+s,w,a,c),y-u.of0[s]),c+=u.exb[s],l(a,c=v.F._writeLit(p,R,a,c),e-u.df0[p]),c+=u.dxb[p],o+=y)}c=v.F._writeLit(256,w,a,c)}return c},v.F._copyExact=function(e,t,n,r,i){var o=i>>>3;return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(e.buffer,t,n),o),i+(n+4<<3)},v.F.getTrees=function(){for(var e=v.F.U,t=v.F._hufTree(e.lhst,e.ltree,15),n=v.F._hufTree(e.dhst,e.dtree,15),r=[],i=v.F._lenCodes(e.ltree,r),o=[],s=v.F._lenCodes(e.dtree,o),a=0;a<r.length;a+=2)e.ihst[r[a]]++;for(a=0;a<o.length;a+=2)e.ihst[o[a]]++;a=v.F._hufTree(e.ihst,e.itree,7);for(var c=19;4<c&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,n,a,i,s,c,r,o]},v.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},v.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},v.F.contSize=function(e,t){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n},v.F._codeTiny=function(e,t,n,r){for(var i=0;i<e.length;i+=2){var o=e[i],s=e[i+1];r=v.F._writeLit(o,t,n,r);var a=16==o?2:17==o?3:7;15<o&&(v.F._putsE(n,r,s,a),r+=a)}return r},v.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var r=0;r<n;r+=2){var i=e[r+1],o=r+3<n?e[r+3]:-1,s=r+5<n?e[r+5]:-1,a=0==r?-1:e[r-1];if(0==i&&o==i&&s==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;11>(i=Math.min(o+1-r>>>1,138))?t.push(17,i-3):t.push(18,i-11),r+=2*i-2}else if(i==a&&o==i&&s==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;i=Math.min(o+1-r>>>1,6),t.push(16,i-3),r+=2*i-2}else t.push(i,0)}return n>>>1},v.F._hufTree=function(e,t,n){var r=[],i=e.length,o=t.length,s=0;for(s=0;s<o;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<i;s++)0!=e[s]&&r.push({lit:s,f:e[s]});if(e=r.length,i=r.slice(0),0==e)return 0;if(1==e)return t[1+((n=r[0].lit)<<1)]=1,t[1+((0==n?1:0)<<1)]=1;r.sort((function(e,t){return e.f-t.f})),s=r[0],o=r[1];var a=0,c=1,u=2;for(r[0]={lit:-1,f:s.f+o.f,l:s,r:o,d:0};c!=e-1;)s=a!=c&&(u==e||r[a].f<r[u].f)?r[a++]:r[u++],o=a!=c&&(u==e||r[a].f<r[u].f)?r[a++]:r[u++],r[c++]={lit:-1,f:s.f+o.f,l:s,r:o};for((r=v.F.setDepth(r[c-1],0))>n&&(v.F.restrictDepth(i,n,r),r=n),s=0;s<e;s++)t[1+(i[s].lit<<1)]=i[s].d;return r},v.F.setDepth=function(e,t){return-1!=e.lit?e.d=t:Math.max(v.F.setDepth(e.l,t+1),v.F.setDepth(e.r,t+1))},v.F.restrictDepth=function(e,t,n){var r=0,i=1<<n-t,o=0;for(e.sort((function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d})),r=0;r<e.length&&e[r].d>t;r++){var s=e[r].d;e[r].d=t,o+=i-(1<<n-s)}for(o>>>=n-t;0<o;)(s=e[r].d)<t?(e[r].d++,o-=1<<t-s-1):r++;for(;0<=r;r--)e[r].d==t&&0>o&&(e[r].d--,o++);0!=o&&console.log("debt left")},v.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},v.F._writeLit=function(e,t,n,r){return v.F._putsF(n,r,t[e<<1]),r+t[1+(e<<1)]},v.F.inflate=function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=v.F,i=r._bitsF,o=r._bitsE,s=r._decodeTiny,a=r.makeCodes,c=r.codes2map,u=r._get17,l=r.U,d=null==t;d&&(t=new n(e.length>>>2<<3));for(var h,p,f,m,g=0,_=0,E=p=0,y=0;0==g;)if(g=i(e,y,1),h=i(e,y+1,2),y+=3,0==h)0!=(7&y)&&(y+=8-(7&y)),h=e[(y=4+(y>>>3))-4]|e[y-3]<<8,d&&(t=v.F._check(t,E+h)),t.set(new n(e.buffer,e.byteOffset+y,h),E),y=y+h<<3,E+=h;else{if(d&&(t=v.F._check(t,E+131072)),1==h&&(f=l.flmap,m=l.fdmap,_=511,p=31),2==h){for(p=o(e,y,5)+257,h=o(e,y+5,5)+1,f=o(e,y+10,4)+4,y+=14,m=0;38>m;m+=2)l.itree[m]=0,l.itree[m+1]=0;for(_=1,m=0;m<f;m++){var b=o(e,y+3*m,3);l.itree[1+(l.ordr[m]<<1)]=b,b>_&&(_=b)}y+=3*f,a(l.itree,_),c(l.itree,_,l.imap),f=l.lmap,m=l.dmap,y=s(l.imap,(1<<_)-1,p+h,e,y,l.ttree),_=(1<<(b=r._copyOut(l.ttree,0,p,l.ltree)))-1,p=(1<<(h=r._copyOut(l.ttree,p,h,l.dtree)))-1,a(l.ltree,b),c(l.ltree,b,f),a(l.dtree,h),c(l.dtree,h,m)}for(;;)if(y+=15&(h=f[u(e,y)&_]),0==(b=h>>>4)>>>8)t[E++]=b;else{if(256==b)break;h=E+b-254,264<b&&(h=E+((b=l.ldef[b-257])>>>3)+o(e,y,7&b),y+=7&b),y+=15&(b=m[u(e,y)&p]);var T=((b=l.ddef[b>>>4])>>>4)+i(e,y,15&b);for(y+=15&b,d&&(t=v.F._check(t,E+131072));E<h;)t[E]=t[E++-T],t[E]=t[E++-T],t[E]=t[E++-T],t[E]=t[E++-T];E=h}}return t.length==E?t:t.slice(0,E)},v.F._check=function(e,t){var n=e.length;return t<=n?e:((t=new Uint8Array(Math.max(n<<1,t))).set(e,0),t)},v.F._decodeTiny=function(e,t,n,r,i,o){for(var s=v.F._bitsE,a=v.F._get17,c=0;c<n;){var u=e[a(r,i)&t];i+=15&u;var l=u>>>4;if(15>=l)o[c]=l,c++;else{var d=u=0;for(16==l?(d=3+s(r,i,2),i+=2,u=o[c-1]):17==l?(d=3+s(r,i,3),i+=3):18==l&&(d=11+s(r,i,7),i+=7),l=c+d;c<l;)o[c]=u,c++}}return i},v.F._copyOut=function(e,t,n,r){for(var i=0,o=0,s=r.length>>>1;o<n;){var a=e[o+t];r[o<<1]=0,r[1+(o<<1)]=a,a>i&&(i=a),o++}for(;o<s;)r[o<<1]=0,r[1+(o<<1)]=0,o++;return i},v.F.makeCodes=function(e,t){var n,r,i=v.F.U,o=e.length,s=i.bl_count;for(n=0;n<=t;n++)s[n]=0;for(n=1;n<o;n+=2)s[e[n]]++;for(i=i.next_code,n=0,s[0]=0,r=1;r<=t;r++)n=n+s[r-1]<<1,i[r]=n;for(t=0;t<o;t+=2)0!=(s=e[t+1])&&(e[t]=i[s],i[s]++)},v.F.codes2map=function(e,t,n){for(var r=e.length,i=v.F.U.rev15,o=0;o<r;o+=2)if(0!=e[o+1]){var s=e[o+1],a=o>>1<<4|s,c=t-s;for(c=(s=e[o]<<c)+(1<<c);s!=c;)n[i[s]>>>15-t]=a,s++}},v.F.revCodes=function(e,t){for(var n=v.F.U.rev15,r=15-t,i=0;i<e.length;i+=2)e[i]=n[e[i]<<t-e[i+1]]>>>r},v.F._putsE=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8},v.F._putsF=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8,e[t+2]|=n>>>16},v.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},v.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},v.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},v.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},v.F.U=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(e,t,n){for(;0!=t--;)e.push(0,n)}for(var t=v.F.U,n=0;32768>n;n++){var r=n;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,t.rev15[n]=(r>>>16|r<<16)>>>17}for(n=0;32>n;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];e(t.fltree,144,8),e(t.fltree,112,9),e(t.fltree,24,7),e(t.fltree,8,8),v.F.makeCodes(t.fltree,9),v.F.codes2map(t.fltree,9,t.flmap),v.F.revCodes(t.fltree,9),e(t.fdtree,32,5),v.F.makeCodes(t.fdtree,5),v.F.codes2map(t.fdtree,5,t.fdmap),v.F.revCodes(t.fdtree,5),e(t.itree,19,0),e(t.ltree,286,0),e(t.dtree,30,0),e(t.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,s,"Session");return m(n(a),"chatManager",void 0),m(n(a),"joinedChannels",new Set),m(n(a),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(a),"startTime",Date.now()),m(n(a),"seq",U.fromNumber(1,!0)),m(n(a),"userJoinOptions",new is(!1)),m(n(a),"seqSentStatuses",[!1,!1]),m(n(a),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(a),"loggedOut",!1),m(n(a),"messageSentTimes",[]),m(n(a),"curLoginSockets",[void 0,void 0]),m(n(a),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(a),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(a),"dialPendingMsgSubjectMap",new Map),m(n(a),"context",void 0),m(n(a),"connection",void 0),m(n(a),"instanceId",void 0),m(n(a),"registerSocketsFailureListener",(function(){a.connection.once("socketsFailure",(function(){a.log("socketsFailure, creating a new connection"),ad((function(){return a.connection.removeAllListeners(),a.connection=new Yr(a.context,a.logger,!0),a.loginHandler(15e3,!0)})).pipe(oe((function(e){return e.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))})),ob(a.connection.apClient.apFinish$)).subscribe((function(){a.log("new connection connected")}))})),0===a.connection.listenerCount("tokenExpired")&&a.connection.on("tokenExpired",(function(){a.emit("tokenExpired")}))})),a.context=e,a.connection=i,a.instanceId=o,a.chatManager=new hD(s),a.log("The instanceId is %s",a.instanceId.toString()),a}la(t,e);var r=ma(t);return Ha(t,[{key:"fetchFileUploadIndexGet",value:function(e){var n=e.hash,r=e.size;if(0===(e=this.getLoginSockets()).length)throw new K("Client is not logged in");var i=this.incGetSeq();return e.forEach((function(e){e.sendPacket("FileUploadIndexGet",{seq:i,hash:n,size:r})})),{ret:Ca.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexRet").pipe(aa((function(e){return i.eq(e.seq)})))})))),fin:Ca.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa((function(e){return i.eq(e.seq)})))})))),err:Xb.apply(void 0,G(e.map((function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The media message upload failure, code %d",e.code],lg)})))})))),timeout:t.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(e){var n=e.hash,r=e.unit,i=e.servers;if(0===(e=this.getLoginSockets()).length)throw new K("Client is not logged in");var o=this.incGetSeq();return e.forEach((function(e){e.sendPacket("FileUploadIndexSet",{seq:o,servers:i,hash:n,unit:r})})),Ca.apply(void 0,[t.genTimeoutError(Lh)].concat(G(e.map((function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["FileUploadIndexSet failure, code %d",e.code],lg)})))}))),G(e.map((function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestFileDownloadIndexGet",value:function(e){var n=e.size,r=e.zone,i=e.unit,o=e.hash,s=this.getLoginSockets();if(0===s.length)throw new K("Client is not logged in");var a=this.incGetSeq();return s.forEach((function(e){e.sendPacket("FileDownloadIndexGet",{seq:a,size:n,zone:r,unit:i,hash:o})})),e=Ca.apply(void 0,G(s.map((function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa((function(e){return a.eq(e.seq)})))})))).pipe(ba((function(e){var t=e.backups,n=e.servers;return e=ff(e,iD),ua({backupList:t.map((function(e){return[e]})),serverList:n.map((function(e){return[e]}))},e)})),cd(500)),s=jm(s.map((function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa((function(e){return a.eq(e.seq)})))}))),Ca(e,s.pipe(ba((function(e){return e.reduce((function(e,t){var n=e.backupList,r=e.serverList;e=t.backups;var i=t.servers;return t=ff(t,jD),ua({backupList:e.map((function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(n[t])?n[t]:[]))})),serverList:i.map((function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(r[t])?r[t]:[]))}))},t)}),{})}))),t.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2e4,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.loggedOut&&n)throw new K("Already logged out, request ignored");n&&this.registerSocketsFailureListener(),this.connection.initConnection();var r=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),i=Date.now();return r.forEach((function(t,r){var o=e.loginSocketSubs[r].login;void 0!==o&&o.unsubscribe(),e.loginSocketSubs[r].login=t.pipe(ca((function(t){var o;e.curLoginSockets[r]=t;var s=Date.now();eb("Link",{ackedServerIp:t.address,destServerIp:t.ip,ec:0,sc:0,elapse:fb(e.startTime),lts:U.fromNumber(s),responseTime:i-s,sid:Xa(e.instanceId),userId:e.context.uid},null!==(o=e.context.config.enableCloudProxy)&&void 0!==o&&o),e.emit("userJoined",t.env),n&&e.connection.apClient.apFinish$.next(void 0)}))).subscribe(e.lastLoginSockets[r])})),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(r).concat([gb(this.connection,"connectionInitFailure").pipe(ca((function(e){if(sa(e)||Sa(e))throw e;throw new da("Login failure",{code:Zq,originalError:e})})))])).pipe(Ka(1),hb(t),Ga((function(t){return t instanceof pb&&e.warn("Client login timeout"),t&&t.code===Kh&&(e.connection.emit("tokenExpired"),e.connection.apClient.apFinish$.next(void 0)),e.clearSockets(0,n),Z(t)})),ca((function(){n||e.registerSocketsFailureListener()})),wg((function(){n||e.connection.apClient.apFinish$.next(void 0)})))}},{key:"logoutHandler",value:function(){var e=J(w.mark((function e(){var t,n,r,i=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),t=this.getLoginSockets(),n=t.map((function(e){return e.sendPacket("UserQuit",{}),i.connection.waitClosing(e)})),this.clearSockets(5e3),r=t.map((function(e){return e.env})),[0,1].filter((function(e){return!r.includes(e)})).forEach((function(e){i.connection.closeSocket(e,0)})),e.abrupt("return",Xb.apply(void 0,G(n)).toPromise());case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.getLoginSockets().length){e.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return r=gb(this,"channelLeft").pipe(wb((function(e){return e===t})),Ka(1)),i=this.incGetSeq(),(o=this.lastLoginSockets.map((function(e){return e.pipe(Cc((function(e,t){0!==t&&s.incSeqIfNeeded(e.env);var r=0===t?i:s.seq;return e.sendPacket("GroupEnter",{account:n,seq:r}),e.fromReceived("GroupReply").pipe(aa((function(e){return r.eq(e.seq)})),ca((function(e){if(0!==(e=e.code))throw new da(["Channel join failure. The response code is %d",e],Rq)})))})),ob(r),pe())}))).forEach((function(e,n){var r=function(){return s.loginSocketSubs[n].channels.delete(t.channelId)};s.loginSocketSubs[n].channels.set(t.channelId,e.subscribe({error:r,complete:r}))})),e.next=8,Xb.apply(void 0,G(o)).pipe(Ka(1),hb(1e4),Ga((function(e){return e instanceof pb&&s.warn("Channel join timeout"),Z(e)}))).toPromise();case 8:this.joinedChannels.add(t);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(e,t){this.emit("channelLeft",e),this.joinedChannels.delete(e),this.getLoginSockets().forEach((function(e){e.sendPacket("GroupLeave",{account:t})}))}},{key:"requestChannelMemberList",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in. Cannot get the channel members",cA);var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAllUsersList",{group:e,pageNumber:0,pageSize:200,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Pq)].concat(G(n.map((function(t){return t.fromReceived("GroupAllUsersResult").pipe(aa((function(t){var n=t.seq;return t.group===e&&r.eq(n)})))})))))}},{key:"requestPeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserStatusList",{users:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(oA)].concat(G(n.map((function(e){return e.fromReceived("UserStatusResult").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSetLocalUserAttributes",value:function(e,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t,i){void 0!==n&&i!==n||t.sendPacket("UserAttributeSet",{account:r.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:o})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["The user attributes set failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestSetChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeSet",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:o})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["The group attributes set failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeMod",{account:n.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:i})})),Ca.apply(void 0,G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The user attributes add or update failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeMod",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=ra(e,2))[0],value:e[1]}})),seq:o})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["The group attributes add or update failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeDel",{account:n.context.uid,attributes:e,seq:i})})),Ca.apply(void 0,G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The user attributes delete failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeDel",{group:e,broadcast:r,attributes:n,seq:o})})),Ca.apply(void 0,G(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return o.eq(e.seq)})),ba((function(e){throw new da(["The channel attributes delete failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return o.eq(e.seq)})))})))))}},{key:"requestClearLocalUserAttributes",value:function(){var e=this,n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeSet",{account:e.context.uid,seq:r,attributeInfos:[]})})),Ca.apply(void 0,G(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ba((function(e){throw new da(["The user attributes clear failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(n.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestClearChannelAttributes",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeSet",{group:e,seq:i,attributeInfos:[],broadcast:n})})),Ca.apply(void 0,G(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The channel attributes clear failure, code %d",e.code],Sb)})))}))).concat([t.genTimeoutError(Tb)],G(r.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeGet",{account:e,seq:i,attributes:n})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Lq);throw new Wc(["User attribute operation unknown error code: %d",e],Sb)})))}))),G(r.map((function(e){return e.fromReceived("UserAttributeRet").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeGet",{group:e,seq:i,attributes:n})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return i.eq(e.seq)})),ba((function(e){throw new da(["The channel attributes get failure, code %d",e.code],Sb)})))}))),G(r.map((function(e){return e.fromReceived("GroupAttributeRet").pipe(aa((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributeKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeKeysGet",{account:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ba((function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Lq);throw new Wc(["User attribute operation unknown error code: %d",e],Sb)})))}))),G(n.map((function(e){return e.fromReceived("UserAttributeKeysRet").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAttributeKeysGet",{group:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(n.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(aa((function(e){return r.eq(e.seq)})),ba((function(e){throw new Wc(["Channel attribute operation unknown error code: %d",e.code],Sb)})))}))),G(n.map((function(e){return e.fromReceived("GroupAttributeKeysRet").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelMemberCount",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupStatusList",{groups:e,seq:r})})),Ca.apply(void 0,[t.genTimeoutError(Pq)].concat(G(n.map((function(e){return e.fromReceived("GroupStatusResult").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSubscribePeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("SubscribeUserStatus",{seq:r,users:e})})),Ca.apply(void 0,[t.genTimeoutError(vA)].concat(G(n.map((function(e){return e.fromReceived("SubscribeResponse").pipe(aa((function(e){return r.eq(e.seq)})))})))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(e){var t=this.getLoginSockets();if(0===t.length)throw new K("Client is not logged in");var n=this.incGetSeq();t.forEach((function(t){t.sendPacket("UnsubscribeUserStatus",{seq:n,users:e})}))}},{key:"sendInvitationMessage",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,u,l,d,h,p,f=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerId,r=t.callId,i=t.extra,o=t.isAcceptAck,s=t.channelId,a=t.type,c={callId:r},void 0===o){e.next=6;break}if("CallAccept"===a){e.next=5;break}throw Error("invalid invitation type");case 5:c.type=o?"ack":"request";case 6:return c.channel=s,("CallInvite"===a||"CallCancel"===a||"CallReject"===a||"CallAccept"===a&&!1===o)&&void 0!==i&&(c.extra=i),u=Bg(),this.log("The sent invitation body is %o",c),l=function(e){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:u,instance:f.instanceId,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,MessageType:a}).toLong(),payload:(new TextEncoder).encode(JSON.stringify(c)),src:f.context.uid}},e.next=14,Kb(this.sendMessageToRetry(l,!0)).pipe(hb(1e4),Ga((function(e){return e instanceof pb&&f.warn("Send invitation timeout"),Z(e)}))).toPromise();case 14:return d=e.sent,h=d.code,p=d.retryTimes,e.abrupt("return",{hasPeerReceived:0===h,hasReSent:0!==p});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var e=J(w.mark((function e(t,n,r,i,o,s){var a,c,u,l,d,h,p,f,g,_,E,v,y,b,T,S,R,C,A,O,N,k,D,P,L,M,x,F,j,V=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=n.width,u=void 0===c?0:c,l=n.height,d=void 0===l?0:l,h=n.fileName,p=void 0===h?"":h,f=n.description,g=void 0===f?"":f,_=n.thumbnail,E=void 0===_?new Blob:_,v=n.thumbnailHeight,y=void 0===v?0:v,b=n.thumbnailWidth,T=void 0===b?0:b,S=n.size,R=void 0===S?0:S,C=n.mediaId,A=o.enableOfflineMessaging,O=o.enableHistoricalMessaging,za(r)){e.next=4;break}throw new I("The send message arguments are not valid",i?$k:hg);case 4:if(!(32768<new Blob([p,E,g]).size)){e.next=6;break}throw new I("The size of message overflowed ",i?ve:Hh);case 6:return N=this.chatManager.getChatInfo(r),k=N.dialogue,D=N.sequence,P=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(P,"-").concat(k,"#").concat(D,'"'),i?" peer":" channel",oa(r)),m(a={},"media_description",g),m(a,"media_width",u),m(a,"media_height",d),m(a,"media_thumbnailwidth",T),m(a,"media_thumbnailheight",y),m(a,"media_size",R),m(a,"media_id",C),m(a,"media_filename",p),L=uc(a,(function(e){return(new TextEncoder).encode(e.toString())})),e.t0=Uint8Array,e.next=14,Ji(E);case 14:return e.t1=e.sent,L.media_thumbnail=new e.t0(e.t1),M=i&&"IMAGE"===t?"PeerImageMessage":i&&"FILE"===t?"PeerFileMessage":i||"IMAGE"!==t?"ChannelFileMessage":"ChannelImageMessage",x=function(e){return{MiscMap:L,sequence:D,dialogue:k,instance:P,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:"Uncompressed",MessageType:M,ToCache:A,ToArchive:O}).toLong(),payload:new Uint8Array,src:V.context.uid}},e.next=20,Kb(this.sendMessageToRetry(x,!0)).pipe(hb(void 0===s?1e4:s),Ga((function(e){return e instanceof pb&&V.warn("Send message timeout"),Z(e)}))).toPromise();case 20:if(F=e.sent,2!==(j=F.code)){e.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return e.abrupt("return",{hasPeerReceived:0===j});case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,s){return e.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var e=J(w.mark((function e(t,n,r,i,o,s){var a,c,u,l,d,h,p,f,m,g,_=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.enableOfflineMessaging,c=o.enableHistoricalMessaging,za(r)&&t instanceof Uint8Array&&"string"==typeof n){e.next=3;break}throw new I("The send message arguments are not valid",i?$k:hg);case 3:if(!(32768<t.byteLength+new Blob([n]).size)){e.next=5;break}throw new ib("The message size is over the 32KB limit",i?ve:Hh);case 5:return u=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=t.byteLength,l=this.chatManager.getChatInfo(r),d=l.dialogue,h=l.sequence,p=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(p,"-").concat(d,"#").concat(h,'"'),u?" compressed":"",i?"peer":"channel",oa(r)),f=function(e){return{MiscMap:{description:(new TextEncoder).encode(n)},sequence:h,dialogue:d,instance:p,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:u?"Zlib":"Uncompressed",MessageType:i?"PeerRawMessage":"ChannelRawMessage",ToCache:a,ToArchive:c}).toLong(),payload:u?ks(t):t,src:_.context.uid}},e.next=12,Kb(this.sendMessageToRetry(f,!0)).pipe(hb(void 0===s?1e4:s),Ga((function(e){return e instanceof pb&&_.warn("Send message timeout"),Z(e)}))).toPromise();case 12:return m=e.sent,g=m.code,e.abrupt("return",{hasPeerReceived:0===g});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,s){return e.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var e=J(w.mark((function e(t,n,r,i,o){var s,a,c,u,l,d,h,p,f,m,g,_=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i.enableOfflineMessaging,a=i.enableHistoricalMessaging,za(n)){e.next=3;break}throw new I("The send message arguments are not valid",r?$k:hg);case 3:if(!(32768<new Blob([t]).size)){e.next=5;break}throw new ib("The message size is over the 32KB limit",r?ve:Hh);case 5:return c=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([t]).size,u=this.chatManager.getChatInfo(n),l=u.dialogue,d=u.sequence,h=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(h,"-").concat(l,"#").concat(d,'"'),c?" compressed":"",r?"peer":"channel",oa(n)),p=(new TextEncoder).encode(t),f=function(e){return{MiscMap:{},sequence:d,dialogue:l,instance:h,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:c?"Zlib":"Uncompressed",MessageType:r?"PeerTextMessage":"ChannelTextMessage",ToCache:s,ToArchive:a}).toLong(),payload:c?ks(p):p,src:_.context.uid}},e.next=13,Kb(this.sendMessageToRetry(f,!0)).pipe(hb(void 0===o?1e4:o),Ga((function(e){return e instanceof pb&&_.warn("Send message timeout"),Z(e)}))).toPromise();case 13:return m=e.sent,g=m.code,e.abrupt("return",{hasPeerReceived:0===g});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(e,t){Object.entries(this.loginSocketSubs[e]).forEach((function(e){var n=(e=ra(e,2))[1];"channels"===e[0]&&t||(Array.isArray(n)||n instanceof Map?n.forEach((function(e){return e.unsubscribe()})):n&&n.unsubscribe())})),this.loginSocketSubs[e]={channels:t?this.loginSocketSubs[e].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,u,l,d,h=this,p=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<p.length&&void 0!==p[2]?p[2]:0,this.log("Attempt to send the message ".concat(n?" with retrying, %o":"without retrying"),{retryTimes:r}),0!==(i=this.getLoginSockets()).length){e.next=5;break}throw Error("no logged-in sockets");case 5:return o=t(r),i.forEach((function(e){e.sendPacket("Message",o)})),s=o.dialogue,a=o.sequence,c=o.instance,u=i.map((function(e){return e.fromReceived("Ack").pipe(wb((function(e){return s.eq(e.dialogue)&&a.eq(e.sequence)&&c.eq(e.instance)})))})),e.prev=9,e.next=12,Xb.apply(void 0,G(u)).pipe(hb(6e3),Ga((function(e){return Sa(e)&&h.warn("Message send timeout, retry times %d",r),Z(e)})),Ka(1)).toPromise();case 12:return l=e.sent,d=l.code,this.log("The message has been acked, %o",{code:d}),e.abrupt("return",{code:d,retryTimes:r});case 18:if(e.prev=18,e.t0=e.catch(9),!(e.t0 instanceof pb&&n)){e.next=22;break}return e.abrupt("return",this.sendMessageToRetry(t,!1,r+1));case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return Bc(0,2750).pipe(ca((function(){e.incSeqIfNeeded(t.env),t.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:e.seq})})))})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAlive;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAlive=t.subscribe({error:function(){}})}))}},{key:"initKeepAliveReconnector",value:function(){var e=this;this.lastLoginSockets.map((function(e){return e.pipe(Cc((function(e){var t,n=!1,r=e.userJoin$.pipe(ca((function(){n=!0}))),i=e.input$.pipe(ca((function(e){"Ping"!==Li[e.uri].slice(0,-3)&&(n=!1)})));return Xb(Bc(15e3,1e4).pipe(Pt(e.receivedPacket),ca((function(r){r=ra(r,2),r=ra(r[1],2)[1],t!==r||n||e.forceReconnect(),t=r}))),r,i)})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAliveReconnector;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAliveReconnector=t.subscribe({error:function(){}})}))}},{key:"initLoginReceiver",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Cc((function(t){return Xb(gb(t,"reconnect").pipe(ca(e.onSocketReconnect(t))),t.fromReceived("Message").pipe(ca(e.onMessage(t))),t.fromReceived("GroupEnterNotice").pipe(ca(e.onGroupEnterNotice())),t.fromReceived("GroupLeaveNotice").pipe(ca(e.onGroupLeaveNotice())),t.fromReceived("GroupCountNotice").pipe(ca(e.onGroupCountNotice())),t.fromReceived("GroupAttributeAlt").pipe(ca(e.onGroupAttributeAlt())),t.fromReceived("UserJoinNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.ONLINE))),t.fromReceived("UserQuitNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.OFFLINE))),t.fromReceived("UserWaitNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))})))})).forEach((function(t,n){e.loginSocketSubs[n].receivers.push(t.subscribe({error:function(){}}))}))}},{key:"requestSocketLogin",value:function(e,t,n){var r=this;return im(ad((function(){r.userJoinOptions=new is(t),e.sendPacket("UserJoin",{account:r.context.uid,instance:r.instanceId,opt:r.userJoinOptions.toLong(),seq:n,ticket:e.ticket})})),e.fromReceived("UserResp").pipe(aa((function(e){return n.eq(e.seq)})),ca((function(t){if(0!==(t=t.code))throw r.clearSockets(),r.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",t],jg);r.log("ENV_%d logged in",e.env)})),qf(e),hb(15e3))).pipe(wb((function(e){return void 0!==e})),Ga((function(e){return e instanceof pb&&r.warn("Login response timeout, rejoin: %s",t),Z(e)})))}},{key:"getSocketLoginObservables",value:function(e,t){var n=this;return e.map((function(e){return e.pipe(ca((function(e){0===e.listenerCount("socketUserDrop")&&e.on("socketUserDrop",(function(t){return n.onUserDrop(t,e)}))})),Cc((function(e,r){return n.incSeqIfNeeded(e.env),n.requestSocketLogin(e,0!==r,0===r?t:n.seq)})),pe())}))}},{key:"incSeqIfNeeded",value:function(e){if(![0,1].includes(e))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[e]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[e]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var e=this.curLoginSockets,t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i}},{key:"emitMessage",value:function(e,n){var r=e.options,i=e.payload,o=e.src,s=e.dst,a=e.instance,c=e.dialogue,u=e.sequence,l=e.ms,d=e.MiscMap;this.dialogueSequenceLru.set(c.toString(),u),a="".concat(a,"-").concat(c,"#").concat(u),this.msgDedupLru.has(a)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",n,a):(this.msgDedupLru.set(a,void 0),n=new ae(r),this.lastLoginSockets.forEach(function(){var n=J(w.mark((function n(r){var i;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.pipe(Ka(1)).toPromise();case 2:i=n.sent,t.sendMessageAck(e,i);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),r=n.isZlibCompressed(),n.isInvitation()?(s=pa(r?nl(Xm(i,Uint8Array.of(0,0,0,0))):i),s=JSON.parse(s),this.log("The received invitation body is %o",s),this.emit("invitationMessage",{body:s,type:n.getInvitationType(),peerId:o,serverReceivedTs:l.toNumber()})):n.isTextMessage()?(d=n.isPeerTextMessage(),i=pa(r?nl(Xm(i,Uint8Array.of(0,0,0,0))):i),this.info("Received a %s %s text message from %s to %s, %s",r?" compressed":"",d?"peer":"channel",oa(o),oa(s),a),d?(o={text:i,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerTextMessage",o)):this.emit("channelTextMessage",{channelId:s,memberId:o,text:i,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):n.isRawMessage()?(c=n.isRawPeerMessage(),d=void 0===(d=d.description)?"":pa(d),i=r?nl(i):i,this.info("Received a %s %s raw message from %s to %s, %s",r?" compressed":"",c?"peer":"channel",oa(o),oa(s),a),c?(o={desc:d,raw:i,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerRawMessage",o)):this.emit("channelRawMessage",{desc:d,raw:i,channelId:s,memberId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):(n.isImageMessage()||n.isFileMessage())&&(i=n.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",i?"peer":"channel",oa(o),oa(s),a),i?this.emit("peerMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}}):this.emit("channelMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,memberId:o,channelId:s,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}})))}},{key:"onSocketReconnect",value:function(e){var t=this;return function(){var n=[0,1].filter((function(t){return t!==e.env}))[0];(n=t.connection.curOpenSockets[n])&&!n.loggedIn&&t.emit("connectionLost")}}},{key:"onUserDrop",value:function(e,t){var n;e=e.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(t.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:t.address,serverCode:e,sid:Xa(this.instanceId),userId:this.context.uid},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),10006===e||10001===e?this.warn("Login too often and kicked off, reconnect and login"):10009===e?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(e)&&(this.emit("userDrop",e),this.clearSockets())}},{key:"clearSockets",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];[0,1].forEach((function(r){e.cleanLoginSubs(r,n),e.connection.closeSocket(r,t)}))}},{key:"onMessage",value:function(e){var t=this;return function(n){var r=n.dialogue,i=n.instance,o=n.sequence,s=n.options;if(n.src===t.context.uid)t.log("The message is from the local account, ignored");else{var a=r.toString(),c=t.dialPendingMsgSubjectMap.get(a);if(r="".concat(i,"-").concat(r,"#").concat(o),c)c.next(n),t.log("Env_%d: The dialogue has pending messages, next: %s",e.env,r);else{var u=t.dialogueSequenceLru.get(a);if(c=!u&&o.eq(1),i=void 0!==u&&o.sub(u).eq(1),c||i)t.emitMessage(n,e.env);else{if(u){if(o.lte(u))return;t.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",e.env,r)}else t.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",e.env,r);o=new Pa,t.dialPendingMsgSubjectMap.set(a,o);var l=o.pipe(Qs(Pk),xg((function(e,t){return[].concat(G(e),[t])}),[]),ba((function(e){return G(e).sort((function(e,t){return e=e.sequence,t=t.sequence,e.eq(t)?0:e.gt(t)?1:-1}))})),sm(1));s=!(s=new ae(s)).isFromCache()&&!s.isBufferedMessage(),l.pipe(ob(Bc(s?750:1500)),aa((function(e){if(2>e.length)return!1;for(var t=void 0===u?U.fromNumber(1,!0):u.add(1),n=0;n<e.length;t=t.add(1),n++)if(!e[n].sequence.eq(t))return!1;return!0})),wg((function(){t.dialPendingMsgSubjectMap.delete(a)}))).subscribe((function(n){n.forEach((function(n){t.emitMessage(n,e.env),t.log("Env_%d: The message queue has fully ordered, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence))}))}),(function(n){n instanceof vg&&l.pipe(Ka(1)).subscribe((function(n){return n.forEach((function(n){t.log("Env_%d: The message pending queue expired, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence)),t.emitMessage(n,e.env)}))}))})),o.next(n)}}}}}},{key:"onGroupEnterNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberJoined",size:t.size})}}},{key:"onGroupLeaveNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberLeft",size:t.size})}}},{key:"onGroupCountNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,type:"MemberCountUpdated",size:t.size})}}},{key:"onGroupAttributeAlt",value:function(){var e=this;return function(t){var n=t.group;t=ff(t,kD),e.emit("channelAttributesUpdated",ua({channelId:n},t))}}},{key:"onUserNotice",value:function(e){var t=this;return function(n){t.emit("peerOnlineStatusChanged",{peerId:n.user,instance:n.instance,seq:n.seq,state:e})}}}],[{key:"sendMessageAck",value:function(e,t){var n=new ae(e.options);(n.isInvitation()||n.isPeerMessage())&&t.sendPacket("Ack",{code:0,dialogue:e.dialogue,instance:e.instance,sequence:e.sequence})}}]),t}(tb());m(ls,"genTimeoutError",(function(e,t){return bb(void 0).pipe(cd(void 0===t?1e4:t),ba((function(){throw new db(["Request timed out after %ds",void 0===t?1e4:t],e)})))}));var ms,ol,pl=0,ql=0;Ud.v1=function(e,t,n){n=t&&n||0;var r=t||[],i=(e=e||{}).node||ms,o=void 0!==e.clockseq?e.clockseq:ol;if(null==i||null==o){var s=Jq();null==i&&(i=ms=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==o&&(o=ol=16383&(s[6]<<8|s[7]))}s=void 0!==e.msecs?e.msecs:(new Date).getTime();var a=void 0!==e.nsecs?e.nsecs:ql+1,c=s-pl+(a-ql)/1e4;if(0>c&&void 0===e.clockseq&&(o=o+1&16383),(0>c||s>pl)&&void 0===e.nsecs&&(a=0),1e4<=a)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=s,ql=a,ol=o,e=(1e4*(268435455&(s+=122192928e5))+a)%4294967296,r[n++]=e>>>24&255,r[n++]=e>>>16&255,r[n++]=e>>>8&255,r[n++]=255&e,e=s/4294967296*1e4&268435455,r[n++]=e>>>8&255,r[n++]=255&e,r[n++]=e>>>24&15|16,r[n++]=e>>>16&255,r[n++]=o>>>8|128,r[n++]=255&o,o=0;6>o;++o)r[n+o]=i[o];return t||Kq(r)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(e){function t(e,i,o){W(this,t);var s=r.call(this,o,"RtmLocalInvitation",!0);return m(n(s),"state",Ba.IDLE),m(n(s),"localInvitationEnd$",Ca(gb(n(s),"LocalInvitationAccepted"),gb(n(s),"LocalInvitationRefused"),gb(n(s),"LocalInvitationFailure"),gb(n(s),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(s),"callId",Ud.v4()),m(n(s),"_content",""),m(n(s),"_channelId",""),m(n(s),"_response",""),m(n(s),"calleeId",void 0),m(n(s),"logger",void 0),m(n(s),"getSession",void 0),s.calleeId=e,s.getSession=i,s.logger=o,s}la(t,e);var r=ma(t);return Ha(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=e)}},{key:"content",get:function(){return this._content},set:function(e){this.log("set content for %s",this.callId),this._content=e}},{key:"response",get:function(){return this._response},set:function(e){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var e,t=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark((function n(){var r,i,o;return w.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getSession().sendInvitationMessage({peerId:t.calleeId,callId:t.callId,extra:t._content,type:"CallInvite",channelId:t._channelId});case 2:if(r=n.sent,i=r.hasPeerReceived,o=r.hasReSent,!t.isLocalInvitationEnd()){n.next=7;break}throw new db("send invitation timeout");case 7:if(t.log("The local invitation has sent to the callee"),i||o){n.next=11;break}throw e=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(i){n.next=14;break}throw e=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return n.stop()}}),n)})))).pipe(oe((function(e){return e.pipe(ca((function(e){if(!(e instanceof rl))throw e})),cd(2e3))})),hb(3e4),Ga((function(e){return Sa(e)&&t.warn("local invitation ack timed out"),Z(e)})),ob(this.localInvitationEnd$)).subscribe({next:function(){t.state===Ba.RECEIVED_BY_REMOTE?t.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):t.state!==Ba.SENT_TO_REMOTE?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(t.info("The peer received the local invitation %s.",t.callId),t.state=Ba.RECEIVED_BY_REMOTE,t.emit("LocalInvitationReceivedByPeer"),t.localInvitationEnd$.pipe(hb(6e4),Ga((function(e){return Sa(e)&&t.warn("local invitation expired"),Z(e)}))).subscribe({error:function(){t.state=Ba.FAILURE,t.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(n){t.isLocalInvitationEnd()?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(t.state=Ba.FAILURE,Sa(n)&&e?"PEER_NOT_ONLINE"===e.code?t.emit("LocalInvitationFailure",bf.PEER_OFFLINE):"RESENT_AND_OFFLINE"===e.code&&t.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(n)?t.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):"RtmInvalidStatusError"===n.name?t.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):t.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(e){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=e,this.emit("LocalInvitationAccepted",e))}}},{key:"onRefuseReceived",value:function(e){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=e,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",e)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),t}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(e){function t(e){var i=e.invitationChannel,o=e.extraContent,s=e.callId,a=e.callerId,c=e.logger;e=e.getSession,W(this,t);var u=r.call(this,c,"RtmRemoteInvitation",!0);return m(n(u),"state",kb.INVITATION_RECEIVED),m(n(u),"remoteInvitationEnd$",Ca(gb(n(u),"RemoteInvitationCanceled"),gb(n(u),"RemoteInvitationRefused"),gb(n(u),"RemoteInvitationAccepted"),gb(n(u),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(u),"callerId",void 0),m(n(u),"callId",void 0),m(n(u),"_getSession",void 0),m(n(u),"logger",void 0),m(n(u),"_content",void 0),m(n(u),"_channelId",void 0),m(n(u),"_response",""),u._channelId=i,u._content=o,u.callId=s,u.callerId=a,u._getSession=e,u.logger=c,u.remoteInvitationEnd$.pipe(hb(6e4),Ga((function(e){return Sa(e)&&u.warn("Remote invitation expired"),Z(e)}))).subscribe({error:function(){u.state=kb.FAILURE,u.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),u}la(t,e);var r=ma(t);return Ha(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(e){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(e){this._response=e}},{key:"accept",value:function(){var e,t=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb((function(){return ad(J(w.mark((function e(){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._getSession().sendInvitationMessage({peerId:t.callerId,callId:t.callId,extra:t.response,type:"CallAccept",isAcceptAck:!1,channelId:t.channelId}));case 1:case"end":return e.stop()}}),e)}))))})),wb((function(t){return e=t.hasPeerReceived})),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(n){if(t.logError(n),t.state=kb.FAILURE,Sa(n))switch(e){case void 0:case!0:return void t.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void t.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}t.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xd7 1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(e){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=e,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",e))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),t}(tb()),nD=function(e){function t(e,i){W(this,t);var o=r.call(this,i,"InvitationManager");return m(n(o),"getSession",void 0),m(n(o),"invitationDispatcher",new ea.EventEmitter),m(n(o),"outgoingLocalInvitations",new Map),m(n(o),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(o),"logger",void 0),o.getSession=cn(e),o.logger=i,o.invitationDispatcher.on("remoteInvitationToManager",(function(e){var t=e.callId,n=e.extra,r=e.callerId;e=e.channelId,o.receivedRemoteInvitations.has(t)||((n=new mD({callerId:r,callId:t,getSession:o.getSession,logger:i,extraContent:n,invitationChannel:e})).remoteInvitationEnd$.subscribe((function(){o.receivedRemoteInvitations.delete(t)})),o.receivedRemoteInvitations.set(t,n),o.emit("remoteInvitationInstance",n))})),o.invitationDispatcher.on("acceptAckToRemoteInvitation",(function(e){(e=o.receivedRemoteInvitations.get(e.callId))&&e.onAcceptAckReceived()})),o.invitationDispatcher.on("cancelToRemoteInvitation",(function(e){var t=e.extra;(e=o.receivedRemoteInvitations.get(e.callId))&&e.onCancelReceived(t)})),o.invitationDispatcher.on("acceptToLocalInvitation",(function(e){var t=e.extra;(e=o.outgoingLocalInvitations.get(e.callId))&&e.onAcceptReceived(t)})),o.invitationDispatcher.on("refuseToLocalInvitation",(function(e){var t=e.extra;(e=o.outgoingLocalInvitations.get(e.callId))&&e.onRefuseReceived(t)})),o}la(t,e);var r=ma(t);return Ha(t,[{key:"invitationMessageHandler",value:function(e){var t=e.body,n=t.callId,r=t.extra;r=void 0===r?"":r;var i=t.type,o=void 0===(t=t.channel)?"":t,s=e.type;switch(t=e.peerId,e=e.serverReceivedTs,s){case"CallAccept":"ack"===i?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:n}):"request"===i&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:n,extra:r});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:n,callerId:t,extra:r,channelId:o});break;case"CallCancel":if("0"===n){n="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(o,"_").concat(r),this.getSession().emit("peerTextMessage",{peerId:t,properties:{serverReceivedTs:e,isOfflineMessage:!1},text:n});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:n,extra:r});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:n,extra:r});break;default:throw Im("invitationType",s)}}},{key:"genLocalInvitation",value:function(e){var t=this,n=new lD(e,this.getSession,this.logger);return n.localInvitationEnd$.subscribe((function(){t.outgoingLocalInvitations.delete(n.callId)})),this.outgoingLocalInvitations.set(n.callId,n),n}}]),t}(tb()),oD=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return lb(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),qC(e,t,{leading:r,maxWait:t,trailing:i})},ub,cf;!function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"}(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,s,"RtmChannel",!0);return m(n(a),"onMemberCountUpdated",oD((function(e){e!==a.memberCount&&(a.memberCount=e,a.emit("MemberCountUpdated",e))}),1e3)),m(n(a),"getSession",void 0),m(n(a),"memberCount",0),m(n(a),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(a),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(a),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(a),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(a),"channelId",void 0),m(n(a),"client",void 0),m(n(a),"onAttributesUpdated",(function(e){var t=e.channelId,n=e.attributeMaps,r=e.seq;e=e.instance.toString();var i=a.attributesSeqLru.get(e);if((!i||r.greaterThan(i))&&(a.attributesSeqLru.set(e,r),t===a.channelId)){for(t={},r=0;r<n.length;r++){var o=n[r];e=o.key,i=o.ms;var s=o.value;if(o=o.origin,"string"!=typeof e||!U.isLong(i)||"string"!=typeof s||!za(o))break;t[e]={value:s,lastUpdateUserId:o,lastUpdateTs:i.toNumber()}}a.emit("AttributesUpdated",t)}})),m(n(a),"onChannelTextMessage",(function(e){var t=e.memberId,n=e.text,r=e.properties;e.channelId===a.channelId&&a.emit("ChannelMessage",{text:n,messageType:S.MessageType.TEXT},t,r)})),m(n(a),"onChannelMediaMessage",(function(e){var t=e.memberId,n=e.properties,r=e.details,i=e.messageType;e.channelId===a.channelId&&("FILE"===i?a.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(r.media_size),10),description:pa(r.media_description),fileName:pa(r.media_filename),mediaId:pa(r.media_id),thumbnail:new Blob([r.media_thumbnail])},t,n):"IMAGE"===i&&a.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(r.media_size),10),description:pa(r.media_description),fileName:pa(r.media_filename),mediaId:pa(r.media_id),thumbnail:new Blob([r.media_thumbnail]),height:parseInt(pa(r.media_height),10),width:parseInt(pa(r.media_width),10),thumbnailHeight:parseInt(pa(r.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(r.media_thumbnailwidth),10)},t,n))})),m(n(a),"onChannelRawMessage",(function(e){var t=e.desc,n=e.raw,r=e.memberId,i=e.properties;e.channelId===a.channelId&&a.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:n,description:t},r,i)})),m(n(a),"onMemberNotice",(function(e){var t=e.memberId,n=e.type,r=e.size;if(e.channelId===a.channelId){var i=e.instance.toString();e=e.seq.toString();var o={MemberLeft:a.memberLeftLru,MemberJoined:a.memberJoinedLru,MemberCountUpdated:void 0}[n];if(o){if(o.has(i+e))return void a.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",n,e,oa(a.channelId),oa(t||""));if(o.set(i+e,void 0),"string"!=typeof t)return;if(t!==a.getSession().context.uid){if((i=a.memberJoinStateLru.get(t))===cf.JOINED&&"MemberJoined"===n)return void a.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,oa(a.channelId),oa(t||""));if(i===cf.LEFT&&"MemberLeft"===n)return void a.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,oa(a.channelId),oa(t||""))}a.memberJoinStateLru.set(t,"MemberJoined"===n?cf.JOINED:cf.LEFT)}a.info("Channel %s - %s, memberId: %s",n,oa(a.channelId),"MemberCountUpdated"===n?"[unknown]":oa(t||"")),i=t===a.getSession().context.uid,"MemberLeft"===n&&za(t)||"MemberJoined"===n&&za(t)?(i||a.emit(n,t),a.onMemberCountUpdated(r)):"MemberCountUpdated"===n&&"number"==typeof r&&a.onMemberCountUpdated(r)}})),a.getSession=cn(i),a.channelId=e,a.client=o,a.info("A channel created, id %s",oa(e)),a}la(t,e);var r=ma(t);return Ha(t,[{key:"join",value:function(){var e=J(w.mark((function e(){var t,n,r,i,o,s,a;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(za(this.channelId)){e.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:e.prev=2,t=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!t.joinedChannels.has(this)){e.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Uq,sid:Xa(t.instanceId)},null!==(n=this.client.context.config.enableCloudProxy)&&void 0!==n&&n),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(e.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){e.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Wq,sid:Xa(t.instanceId)},null!==(o=this.client.context.config.enableCloudProxy)&&void 0!==o&&o),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(20!==t.joinedChannels.size){e.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Tq,sid:Xa(t.instanceId)},null!==(s=this.client.context.config.enableCloudProxy)&&void 0!==s&&s),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:0,sid:Xa(t.instanceId)},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),e.next=23,t.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(t.startTime),errCode:0,sid:Xa(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),this.info("The channel %s joined successfully",oa(this.channelId)),t.on("channelTextMessage",this.onChannelTextMessage),t.on("channelRawMessage",this.onChannelRawMessage),t.on("channelMediaMessage",this.onChannelMediaMessage),t.on("memberNotice",this.onMemberNotice),t.on("channelAttributesUpdated",this.onAttributesUpdated),e.next=41;break;case 32:if(e.prev=32,e.t1=e.catch(12),this.logError(e.t1),!sa(e.t1)){e.next=37;break}throw e.t1;case 37:if(!Sa(e.t1)){e.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(t.startTime),errCode:Sq,sid:Xa(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(a=this.client.context.config.enableCloudProxy)&&void 0!==a&&a),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:e.t1});case 41:case"end":return e.stop()}}),e,this,[[2,6],[12,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=J(w.mark((function e(){var t,n,r,i;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getSession(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(n.joinedChannels.has(this)){e.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:e.prev=9,n.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,n.removeListener("channelTextMessage",this.onChannelTextMessage),n.removeListener("channelRawMessage",this.onChannelRawMessage),n.removeListener("channelMediaMessage",this.onChannelMediaMessage),n.removeListener("memberNotice",this.onMemberNotice),n.removeListener("channelAttributesUpdated",this.onAttributesUpdated),e.next=32;break;case 23:if(e.prev=23,e.t1=e.catch(9),this.logError(e.t1),!sa(e.t1)){e.next=30;break}throw void 0===e.t1.code&&(e.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:Yq,sid:Xa(n.instanceId),userId:n.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),e.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:Xq,sid:Xa(n.instanceId),userId:n.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),new Wc("The channel leave failure",{code:Xq,originalError:e.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:0,sid:Xa(n.instanceId),userId:n.context.uid},null!==(t=this.client.context.config.enableCloudProxy)&&void 0!==t&&t);case 33:case"end":return e.stop()}}),e,this,[[0,4],[9,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s=this,a=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(1<a.length&&void 0!==a[1]?a[1]:{}).enableHistoricalMessaging,r=void 0!==n&&n,Tm(t,Hh),e.prev=2,i=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(i.joinedChannels.has(this)){e.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){e.next=16;break}return o=Date.now(),e.next=15,new Promise((function(e,n){var i=function(){var i=J(w.mark((function i(){var c;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return c=Date.now()-o,i.prev=1,i.next=4,Gg({message:t,peerId:s.channelId,toPeer:!1,session:s.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:c,logger:s.logger,options:{enableHistoricalMessaging:r,enableOfflineMessaging:!1}});case 4:e(),i.next=12;break;case 7:i.prev=7,i.t0=i.catch(1),Sa(i.t0)&&n(new db(Yd(s.name,"sendMessageToPeer",1e4),Yk)),sa(i.t0)&&n(i.t0),n(new da("Channel message send failure",{code:hg,originalError:i.t0}));case 12:return i.prev=12,clearTimeout(a),i.finish(12);case 15:case"end":return i.stop()}}),i,null,[[1,7,12,15]])})));return function(){return i.apply(this,arguments)}}();s.client.internalEmitter.once("RECONNECTED",i);var a=setTimeout((function(){s.client.internalEmitter.off("RECONNECTED",i),n(new db(Yd(s.name,"sendMessageToPeer",1e4),Yk))}),9e3)}));case 15:return e.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){e.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return e.prev=18,e.next=21,Gg({message:t,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:r,enableOfflineMessaging:!1}});case 21:e.next=31;break;case 23:if(e.prev=23,e.t1=e.catch(18),!Sa(e.t1)){e.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(e.t1)){e.next=30;break}throw this.logError(e.t1),e.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return e.stop()}}),e,this,[[2,6],[18,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMembers",value:function(){var e=J(w.mark((function e(){var t,n,r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.prev=1,t=this.getSession(),e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(t.joinedChannels.has(this)){e.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return n=this.getSession().requestChannelMemberList(this.channelId),e.next=13,n.pipe(ba((function(e){return e.memberInfos.map((function(e){return e.account}))}))).toPromise();case 13:return r=e.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),r.map(oa)),e.abrupt("return",r);case 18:if(e.prev=18,e.t1=e.catch(0),!sa(e.t1)){e.next=23;break}throw this.logError(e.t1),e.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return e.stop()}}),e,this,[[0,18],[1,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var e=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some((function(t){return t.channelId===e.channelId}))}}]),t}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(e){function t(e,i,o,s){W(this,t);var a=r.call(this,i,"RtmClient",!0);return m(n(a),"connectionState",T.DISCONNECTED),m(n(a),"internalEmitter",new ea),m(n(a),"context",void 0),m(n(a),"attributes",{}),m(n(a),"loginPromise",void 0),m(n(a),"attributeDrafts",new Set),m(n(a),"session",void 0),m(n(a),"lastLoginTime",void 0),m(n(a),"reconnId",0),m(n(a),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(a),"invitationManager",void 0),m(n(a),"subscribedPeerStatusCache",{}),m(n(a),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(a),"peerUnreachableTimers",{}),m(n(a),"mediaTaskManager",void 0),m(n(a),"setParameters",void 0),m(n(a),"updateConfig",void 0),m(n(a),"userDropHandler",(function(e){if(a.connectionState!==T.ABORTED)switch(e){case 11:a.logError("Kicked off by remote session"),a.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:a.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[e])),a.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:a.logError("User kicked off for unknown code: ".concat(e)),a.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}})),a.context=new ZC(e,o,i),a.mediaTaskManager=new fs(i),a.context.config=o,a.internalEmitter.setMaxListeners(512),a.setParameters=s.bind(n(a)),a.updateConfig=s.bind(n(a)),a.invitationManager=new nD((function(){return a.session}),i),a.invitationManager.on("remoteInvitationInstance",(function(e){a.emit("RemoteInvitationReceived",e)})),a}la(t,e);var r=ma(t);return Ha(t,[{key:"renewToken",value:function(){var e=J(w.mark((function e(t){var n,r,i,o=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&0!==t.length){e.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){e.next=5;break}return e.next=5,new Promise((function(){}));case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){e.next=7;break}throw new K("The client is not logged in",uA);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,n=this.context.token,this.context.token=t,e.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd((function(){return Error("No available edge address to connect")})),oe((function(e){return e.pipe(ca((function(e){if(sa(e))throw e})),cd(2500),Ka(4))})),Ka(1),hb(2e4),Ga((function(e){return Sa(e)&&o.warn("renewToken timed out"),Z(e)}))).toPromise();case 14:r=e.sent,i=r.ticket,e.next=27;break;case 18:if(e.prev=18,e.t0=e.catch(9),this.context.token=n,e.t0.code!==$q&&e.t0.code!==ar){e.next=23;break}throw new Ye("Invalid token",tA);case 23:if(e.t0.code!==Kh){e.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(e.t0)){e.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter((function(e){return void 0!==e})).forEach((function(e){return e.ticket=i}));case 28:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var e=J(w.mark((function e(t){var n,r,i=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",pA);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(t)||0===t.length||t.some((function(e){return!za(e)}))||256<t.length)){e.next=6;break}throw new I("invalid arguments",er);case 6:return e.next=8,this.session.requestPeersOnlineStatus(t).toPromise();case 8:return n=e.sent,r=uc(Jk(n.userInfos,"account"),(function(e){return!!e.ts})),Object.keys(r).forEach((function(e){if(e in i.subscribedPeerStatusCache&&i.subscribedPeerStatusCache[e]!==S.PeerOnlineState.UNREACHABLE){var t=r[e]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;i.emit("PeersOnlineStatusChanged",m({},e,t)),i.subscribedPeerStatusCache[e]=t}})),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,u=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",aA);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&t.every((function(e){return"string"==typeof e}))&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<t.length)){e.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:n=0;case 9:if(!(n<t.length)){e.next=16;break}if(za(r=t[n])){e.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",r],Oq);case 13:n++,e.next=9;break;case 16:return e.next=18,this.session.requestGetChannelMemberCount(t).toPromise();case 18:for(i=e.sent,o=i.groupInfos,s={},a=function(e){var t=(e=o[e]).group,n=e.memberCount;za(t)&&"number"==typeof n&&(u.session.joinedChannels.forEach((function(e){e.channelId===t&&e.onMemberCountUpdated(n)})),s[t]=n)},c=0;c<o.length;c++)a(c);return e.abrupt("return",s);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var e=J(w.mark((function e(t){var n,r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(void 0!==this.session){e.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return n=this.session.requestSetLocalUserAttributes(t).toPromise(),r={attribute:t,promise:n},this.attributeDrafts.add(r),e.prev=8,e.next=11,n;case 11:this.attributes=t,e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(8),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return e.prev=19,this.attributeDrafts.delete(r),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[8,14,19,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(2<a.length&&void 0!==a[2]?a[2]:{}).enableNotificationToChannelMembers,i=void 0!==r&&r,uf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return o=this.session.requestSetChannelAttributes(t,n,i).toPromise(),e.prev=7,e.next=10,o;case 10:s=uc(n,(function(e){return new Blob([e]).size})),this.channelAttributesCacheLru.set(t,s),e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(7),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ua(ua({},this.attributes),t),uf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(void 0!==this.session){e.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return r=this.session.requestAddOrUpdateLocalUserAttributes(t).toPromise(),i={attribute:n,promise:r},this.attributeDrafts.add(i),e.prev=10,e.next=13,r;case 13:this.attributes=n,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",er);case 21:return e.prev=21,this.attributeDrafts.delete(i),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[10,16,21,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,u=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(2<u.length&&void 0!==u[2]?u[2]:{}).enableNotificationToChannelMembers,i=void 0!==r&&r,o=this.channelAttributesCacheLru.get(t,{}),s=uc(n,(function(e){return new Blob([e]).size})),a=ua(ua({},o),s),uf({attributes:n,attrSizeMap:a,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return c=this.session.requestAddOrUpdateChannelAttributes(t,n,i).toPromise(),e.prev=10,e.next=13,c;case 13:this.channelAttributesCacheLru.set(t,a),e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var e=J(w.mark((function e(t){var n,r,i,o;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&0!==t.length&&!t.some((function(e){return 0===e.length}))){e.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return n=this.session.requestDeleteLocalUserAttributesByKeys(t).toPromise(),r={attribute:Gk(this.attributes,t),promise:n},this.attributeDrafts.add(r),e.prev=9,e.next=12,n;case 12:for(i=0;i<t.length;i++)o=t[i],delete this.attributes[o];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(9),!sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return e.prev=20,this.attributeDrafts.delete(r),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[9,15,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,u=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(2<u.length&&void 0!==u[2]?u[2]:{}).enableNotificationToChannelMembers,i=void 0!==r&&r,Array.isArray(n)&&0!==n.length&&za(t)&&!n.some((function(e){return 0===e.length||512<e.length}))){e.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){e.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(void 0!==this.session){e.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return o=this.session.requestDeleteChannelAttributesByKeys(t,n,i).toPromise(),e.prev=8,e.next=11,o;case 11:if(s=this.channelAttributesCacheLru.get(t))for(a=0;a<n.length;a++)c=n[a],delete s[c];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(8),!sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return e.stop()}}),e,this,[[8,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var e=J(w.mark((function e(){var t,n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return t=this.session.requestClearLocalUserAttributes().toPromise(),n={attribute:{},promise:t},this.attributeDrafts.add(n),e.prev=7,e.next=10,t;case 10:this.attributes={},e.next=18;break;case 13:if(e.prev=13,e.t0=e.catch(7),!sa(e.t0)){e.next=17;break}throw e.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return e.prev=18,this.attributeDrafts.delete(n),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[7,13,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i,o=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(1<o.length&&void 0!==o[1]?o[1]:{}).enableNotificationToChannelMembers,r=void 0!==n&&n,this.connectionState===T.CONNECTED){e.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(void 0!==this.session){e.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return i=this.session.requestClearChannelAttributes(t,r).toPromise(),e.prev=6,e.next=9,i;case 9:this.channelAttributesCacheLru.delete(t),e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(6),!sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(za(t)){e.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetUserAttributeKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetUserAttributesByKeys(t,r.slice(0,512)).toPromise();case 13:i=e.sent,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(6),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return e.abrupt("return",Yp(i.attributeInfos.map((function(e){return[e.key,e.value]}))));case 22:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,u,l,d,h;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(za(t)){e.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetChannelAttributesKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetChannelAttributesByKeys(t,r).toPromise();case 13:i=e.sent,o=i.attributeMaps,e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(6),!sa(e.t0)){e.next=21;break}throw e.t0;case 21:throw new I("arguments is not valid",Ja);case 22:s={},a=0;case 24:if(!(a<o.length)){e.next=32;break}if(c=o[a],u=c.key,l=c.ms,d=c.value,h=c.origin,"string"==typeof u&&U.isLong(l)&&"string"==typeof d&&za(h)){e.next=28;break}return e.abrupt("break",32);case 28:s[u]={value:d,lastUpdateUserId:h,lastUpdateTs:l.toNumber()};case 29:a++,e.next=24;break;case 32:return this.channelAttributesCacheLru.set(t,uc(s,(function(e){return new Blob([e.value]).size}))),e.abrupt("return",s);case 34:case"end":return e.stop()}}),e,this,[[6,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,u,l,d,h;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(t,n),e.prev=5,e.next=8,this.session.requestGetChannelAttributesByKeys(t,n).toPromise();case 8:r=e.sent,i=r.attributeMaps,e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(5),!sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new I("arguments is not valid",Ja);case 17:o={},s=this.channelAttributesCacheLru.get(t,{}),a=0;case 20:if(!(a<i.length)){e.next=29;break}if(c=i[a],u=c.key,l=c.ms,d=c.value,h=c.origin,"string"==typeof u&&U.isLong(l)&&"string"==typeof d&&za(h)){e.next=24;break}return e.abrupt("break",29);case 24:s[u]=new Blob([d]).size,o[u]={value:d,lastUpdateUserId:h,lastUpdateTs:l.toNumber()};case 26:a++,e.next=20;break;case 29:return this.channelAttributesCacheLru.set(t,s),e.abrupt("return",o);case 31:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var e=J(w.mark((function e(t,n){var r;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(t,n),e.prev=5,e.next=8,this.session.requestGetUserAttributesByKeys(t,n).toPromise();case 8:r=e.sent,e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(5),!sa(e.t0)){e.next=15;break}throw e.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return e.abrupt("return",Yp(r.attributeInfos.map((function(e){return[e.key,e.value]}))));case 17:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Uk=!0,n=Bg(),r=t.token,t.token===this.context.appId&&(r=void 0),setTimeout((function(){var e;eb("Session",{appId:s.context.appId,did:navigator.userAgent,elapse:fb(s.session&&s.session.startTime),index:{index1:t.uid,index2:s.context.appId,index3:"enableLogUpload=".concat(s.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(n),token:r||"",userId:t.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},null!==(e=s.context.config.enableCloudProxy)&&void 0!==e&&e)}),1e4),yd(t)&&za(t.uid)){e.next=7;break}throw new I("not a valid user id",Jh);case 7:if("string"!=typeof r||!r){e.next=11;break}this.context.token=r,e.next=13;break;case 11:if("string"==typeof r||null==r){e.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return i=Date.now(),this.context.sid=Xa(n),this.loginPromise=this.loginImpl({uid:t.uid,instanceId:n}),this.info("RTM Client logging in as ".concat(oa(t.uid))),e.prev=17,e.next=20,this.loginPromise;case 20:e.next=27;break;case 22:throw e.prev=22,e.t0=e.catch(17),sa(e.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:e.t0.code||1,sc:e.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-i,sid:Xa(n),userId:t.uid},null!==(o=this.context.config.enableCloudProxy)&&void 0!==o&&o),this.context.token=void 0,e.t0;case 27:return e.prev=27,this.loginPromise=void 0,e.finish(27);case 30:Uk=!1;case 31:case"end":return e.stop()}}),e,this,[[17,22,27,30]])})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=J(w.mark((function e(){var t;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loginPromise){e.next=3;break}return e.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){e.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){e.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),e.abrupt("return");case 10:if(void 0!==this.session){e.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),e.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),e.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var e,t=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):void 0!==this.session&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},null!==(e=this.context.config.enableCloudProxy)&&void 0!==e&&e),this.session.logoutHandler().then((function(){t.log("Log out success")}))),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var e=J(w.mark((function e(t,n){var r,i,o,s,a,c,u=this,l=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(r=2<l.length&&void 0!==l[2]?l[2]:{}).enableOfflineMessaging,o=void 0!==i&&i,s=r.enableHistoricalMessaging,a=void 0!==s&&s,Tm(t,ve),this.connectionState!==T.RECONNECTING){e.next=5;break}return c=Date.now(),e.abrupt("return",new Promise((function(e,r){var i=function(){var i=J(w.mark((function i(){var l;return w.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0!==u.session){i.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return l=Date.now()-c,i.prev=3,i.t0=e,i.next=7,Gg({message:t,peerId:n,toPeer:!0,session:u.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:l,logger:u.logger,options:{enableHistoricalMessaging:a,enableOfflineMessaging:o}});case 7:i.t1=i.sent,(0,i.t0)(i.t1),i.next=16;break;case 11:i.prev=11,i.t2=i.catch(3),Sa(i.t2)&&r(new db(Yd(u.name,"sendMessageToPeer",1e4),Zk)),sa(i.t2)&&r(i.t2),r(new da("Peer-to-peer message send failure",{code:cr,originalError:i.t2}));case 16:return i.prev=16,clearTimeout(s),i.finish(16);case 19:case"end":return i.stop()}}),i,null,[[3,11,16,19]])})));return function(){return i.apply(this,arguments)}}();u.internalEmitter.once("RECONNECTED",i);var s=setTimeout((function(){u.internalEmitter.off("RECONNECTED",i),r(new db(Yd(u.name,"sendMessageToPeer",1e4),Zk))}),9e3)})));case 5:if(this.connectionState===T.CONNECTED){e.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,e.next=12,Gg({message:t,peerId:n,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:a,enableOfflineMessaging:o}});case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(9),!Sa(e.t0)){e.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(e.t0)){e.next=21;break}throw e.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:e.t0});case 22:case"end":return e.stop()}}),e,this,[[9,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(e){var t=this;if(!za(e))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:e})[0]],Zz);return new pD(e,(function(){return t.session}),this,this.logger)}},{key:"createLocalInvitation",value:function(e){if(!za(e))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:e})[0]],xc);return this.invitationManager.genLocalInvitation(e)}},{key:"subscribePeersOnlineStatus",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,u,l,d,h,p,f,m=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(za(r=t[n])){e.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",r],kg);case 11:n++,e.next=7;break;case 14:if(!(512<(i=t&&t.length?vk(t):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){e.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return e.next=19,this.session.requestSubscribePeersOnlineStatus(i).toPromise();case 19:o=e.sent,s=o.errors,a=[],c=[],u=0;case 24:if(!(u<s.length)){e.next=32;break}if(l=s[u],d=l.code,"string"==typeof(h=l.account)){e.next=28;break}throw new da("Returned account is invalid",fr);case 28:0!==d&&a.push(h);case 29:u++,e.next=24;break;case 32:for(p=0;p<i.length;p++)f=i[p],a.includes(f)||(c.push(f),this.subscribedPeerStatusCache[f]=void 0);if(this.session.requestPeersOnlineStatus(c).pipe(ba((function(e){return uc(Jk(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=uc(e,(function(e,t){return e=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,m.subscribedPeerStatusCache[t]=e})),m.emit("PeersOnlineStatusChanged",e)})),0===a.length){e.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(za(r=t[n])){e.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",r],kg);case 11:n++,e.next=7;break;case 14:if(!(512<t.length)){e.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(i=t&&t.length?vk(t):[],this.session.requestUnsubscribePeersOnlineStatus(i),o=0;o<i.length;o++)s=i[o],delete this.subscribedPeerStatusCache[s];case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var e=J(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(t!==S.PeerSubscriptionOption.ONLINE_STATUS){e.next=4;break}return e.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createMessage",value:function(e){return"IMAGE"===e.messageType?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},e):"FILE"===e.messageType?ua({fileName:"",description:"",thumbnail:new Blob,size:0},e):e}},{key:"downloadMedia",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,u,l,d,h,p,f,m,g=this,_=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<_.length&&void 0!==_[1]?_[1]:{},"string"==typeof t){e.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(e.prev=3,r=t.split("z"),i=ra(r,3),o=i[0],s=i[1],a=i[2],c=o.slice(1,65),u=bD(c),l=parseInt(o.slice(65),10),d=parseInt(s,10),h=parseInt(a,10),!(Number.isNaN(l)||Number.isNaN(d)||Number.isNaN(h))){e.next=12;break}throw new I("Invalid mediaId content",cl);case 12:e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(3),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:e.t0});case 19:if(this.connectionState===T.CONNECTED){e.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(void 0!==this.session){e.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return p=this.mediaTaskManager.addDownloadTask({unit:d,zone:l,hashHexStr:c,size:h},(function(){if(void 0===g.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return g.session.requestFileDownloadIndexGet({hash:u,zone:l,unit:d,size:h}).toPromise()}),n),e.next=26,this.mediaTaskManager.waitMediaTask(p);case 26:return f=e.sent,m=f.payload,e.abrupt("return",m);case 29:case"end":return e.stop()}}),e,this,[[3,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s,a,c,u,l,d,h,p,f,m,g,_,E,v,y,b,S,R,C,A,O=this,N=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<N.length&&void 0!==N[2]?N[2]:{},yd(n=1<N.length&&void 0!==N[1]?N[1]:{})){e.next=4;break}throw new I("Invalid params",wf);case 4:if(i="thumbnailWidth"in n||"thumbnailHeight"in n||"width"in n||"height"in n,o=n.messageType,s=void 0===o?i?"IMAGE":"FILE":o,a=n.description,c=void 0===a?"":a,u=n.fileName,l=void 0===u?"":u,d=n.thumbnail,"string"==typeof n.messageType&&"string"==typeof c&&"string"==typeof l&&(Pm(d)||void 0===d)&&Pm(t)){e.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!i||"FILE"!==s){e.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(h=t.size))){e.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return e.next=15,Ji(t);case 15:return p=e.sent,e.next=18,aD(p);case 18:if(f=e.sent,this.connectionState===T.CONNECTED){e.next=21;break}throw new K("The client is not logged in",yA);case 21:if("IMAGE"!==s){e.next=29;break}return e.next=24,Xt(n,p);case 24:m=e.sent,g=m.height,_=m.width,E=m.thumbnailWidth,v=m.thumbnailHeight;case 29:return y=this.mediaTaskManager.addUploadTask({file:new Uint8Array(p),hash:f},(function(){if(void 0===O.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return O.session.fetchFileUploadIndexGet({hash:f,size:h})}),(function(e,t){if(void 0===O.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return O.session.requestFileUploadIndexSet({hash:f,unit:e,servers:t}).toPromise()}),r),e.next=32,this.mediaTaskManager.waitMediaTask(y);case 32:if(b=e.sent,S=b.zone,R=b.retUnit,"IMAGE"!==s){e.next=38;break}return C={height:g,width:_,fileName:l,size:h,description:c,thumbnail:d,messageType:s,thumbnailWidth:E,thumbnailHeight:v,mediaId:"0".concat($r(f)).concat(S,"z").concat(R,"z").concat(h,"z").concat(g,"z").concat(_)},e.abrupt("return",C);case 38:return A={fileName:l,size:h,description:c,mediaId:"0".concat($r(f)).concat(S,"z").concat(R,"z").concat(h),thumbnail:d,messageType:s},e.abrupt("return",A);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var e=J(w.mark((function e(t){var n,r,i,o,s=this;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uid,r=t.instanceId,!(void 0!==this.lastLoginTime&&500>Date.now()-this.lastLoginTime)){e.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){e.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:e.prev=6,this.context.uid=n,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:n})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=i=new ls(this.context,new Yr(this.context,this.logger,!1),r,this.logger),o=function(){s.connectionState===T.CONNECTED&&(s.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),s.session)&&s.session.once("userJoined",(function(){s.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)}))},i.on("connectionLost",o),i.on("tokenExpired",(function(){s.emit("TokenExpired")})),i.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",(function(e){s.emit("MessageFromPeer",{text:e.text,messageType:S.MessageType.TEXT},e.peerId,e.properties)})),this.session.on("peerMediaMessage",(function(e){var t=e.peerId,n=e.properties,r=e.messageType;e=e.details,"FILE"===r?s.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(e.media_size),10),description:pa(e.media_description),fileName:pa(e.media_filename),mediaId:pa(e.media_id),thumbnail:new Blob([e.media_thumbnail])},t,n):"IMAGE"===r&&s.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(e.media_size),10),description:pa(e.media_description),fileName:pa(e.media_filename),mediaId:pa(e.media_id),thumbnail:new Blob([e.media_thumbnail]),height:parseInt(pa(e.media_height),10),width:parseInt(pa(e.media_width),10),thumbnailHeight:parseInt(pa(e.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(e.media_thumbnailwidth),10)},t,n)})),this.session.on("peerRawMessage",(function(e){s.emit("MessageFromPeer",{rawMessage:e.raw,description:e.desc,messageType:S.MessageType.RAW},e.peerId,e.properties)})),i.on("instanceChanged",(function(e){return r=e})),i.on("peerOnlineStatusChanged",(function(e){var t=e.instance.toString()+e.state,n=s.peerStatusSeqLru.get(t);!n||e.seq.greaterThan(n)?(s.peerStatusSeqLru.set(t,e.seq),e.state!==s.subscribedPeerStatusCache[e.peerId]&&s.emit("PeersOnlineStatusChanged",m({},e.peerId,e.state)),s.subscribedPeerStatusCache[e.peerId]=e.state,clearTimeout(s.peerUnreachableTimers[t]),e.state===S.PeerOnlineState.UNREACHABLE&&(s.peerUnreachableTimers[t]=setTimeout((function(){s.subscribedPeerStatusCache[e.peerId]===S.PeerOnlineState.UNREACHABLE&&(s.subscribedPeerStatusCache[e.peerId]=S.PeerOnlineState.ONLINE,s.emit("PeersOnlineStatusChanged",m({},e.peerId,S.PeerOnlineState.ONLINE)))}),3e4))):s.log("peerOnlineStatusChanged dedup for %s, %d",t,e.seq.toNumber())})),i.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),i.on("channelAttributesUpdated",(function(e){var t=e.channelId;e=e.attributeMaps;for(var n={},r=0;r<e.length;r++){var i=e[r],o=i.key,a=i.ms,c=i.value;if(i=i.origin,"string"!=typeof o||!U.isLong(a)||"string"!=typeof c||!za(i))break;n[o]=new Blob([c]).size}s.channelAttributesCacheLru.set(t,n)})),i.on("userJoined",(function(e){if(0!==Object.keys(s.attributes).length){if(void 0===s.session)return;s.session.requestSetLocalUserAttributes(s.attributes,e).toPromise()}if(0!==s.attributeDrafts.size)for(var t=function(t,n){var r=(t=n[t]).attribute;t.promise.then((function(){void 0!==s.session&&s.session.requestSetLocalUserAttributes(r,e).toPromise()}))},n=0,r=Array.from(s.attributeDrafts);n<r.length;n++)t(n,r);0!==Object.keys(s.subscribedPeerStatusCache).length&&i.requestSubscribePeersOnlineStatus(Object.keys(s.subscribedPeerStatusCache))})),this.lastLoginTime=Date.now(),e.prev=29,e.next=32,i.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:i.connection.curOpenSockets.filter((function(e){return void 0!==e}))[0].ticket,instance:i.instanceId,useNewDomain:.5<=Math.random(),loginOpt:i.userJoinOptions.toLong()}),e.next=44;break;case 35:if(e.prev=35,e.t1=e.catch(29),!Sa(e.t1)){e.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(e.t1)){e.next=43;break}throw e.t1;case 43:throw new da("Login failure",{code:Zq,originalError:e.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return e.stop()}}),e,this,[[6,10],[29,35]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(e,t){var n,r=this;e===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[e],oldState:os[this.connectionState],reason:qD[t],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),this.connectionState===T.RECONNECTING&&e===T.CONNECTED&&(0!==Object.keys(this.subscribedPeerStatusCache).length&&void 0!==this.session&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba((function(e){return uc(Jk(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=uc(e,(function(e,t){return e=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,r.subscribedPeerStatusCache[t]=e})),r.emit("PeersOnlineStatusChanged",e)})),this.internalEmitter.emit("RECONNECTED")),this.connectionState=e,e!==T.ABORTED&&e!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",e),this.emit("ConnectionStateChanged",e,t)}}]),t}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new I(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Nq);var r=Object.keys(t).filter((function(e){return!(e in qs)}));if(0!==r.length)throw new I("Invalid RTM config: ".concat(r.join(", ")),Nq);var i=ua(ua({},qs),t);if(void 0!==n&&(!Array.isArray(n)||0===n.length))throw new I("Invalid area config");if(null!=n){if(!n.every((function(e){return e in S.LegacyAreaCode})))throw new I("Invalid area codes: ".concat(n.filter((function(e){return!(e in S)})).join(", ")));M=xe(n.map((function(e){return zC[e]})))}n=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var o=DC(i);r=EC(i);var s=FC(i),a=GC(n,i),c=Tr(n,i),u=c("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=i,o("The Agora RTM Web SDK version is %s","1.4.3-203"),t.enableCloudProxy&&o("RTM cloud proxy enabled"),t.enableLogUpload&&o("Log upload enabled"),M&&u("Area is set to %s",Array.from(M.CODES).map((function(e){return xf(F).find((function(t){return F[t]===e}))})).join(", ")),u("Creating an RtmClient instance"),u('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),u("The App ID is %s",Um(e,4,10,"*".repeat(6))),o("The process ID is %s",gg),u("The build is %s","v1.4.3-17-g1e27aa38"),u("NODE_ENV is %s","production"),new rD(e,{genLogger:c,genTracker:a,info:o,warn:r,logError:s,loggerId:n},i,(function(e){for(var t=0,n=xf(e);t<n.length;t++){var r=n[t];try{var s=e[r];null!=s&&(e.enableCloudProxy&&o("RTM cloud proxy enabled"),e.enableLogUpload&&o("Log upload enabled"),i[r]=s)}catch(e){throw new I(["The %s in the arguments is invalid",r],void 0)}}}))},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(e,t){Object.keys(Nc).includes(e)&&(Nc[e]=t)},getParameter:function(e){return Nc[e]},setArea:function(e){var t=e.areaCodes;if(e=e.excludedArea,!Array.isArray(t)||0===t.length||!t.every((function(e){return e in S.AreaCode})))throw new I("Invalid area config");if(void 0!==e&&e===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(void 0===e)M=xe(t.map((function(e){return F[e]})));else{if(t.includes(e))throw new I("Excluded area cannot be in areaCodes");if(!(e in F))throw new I("Invalid excludedArea:",e);M=bu({areas:t.map((function(e){return F[e]})),excludedArea:F[e]})}}});return Zd},module.exports=t()},730:(e,t,n)=>{"use strict";var r=n(43),i=n(853);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function c(e,t){u(e,t),u(e+"Capture",t)}function u(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function E(e){return e[1].toUpperCase()}function v(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_,E);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,E);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,E);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),T=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),C=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),O=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var P=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function M(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var x,U=Object.assign;function F(e){if(void 0===x)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);x=t&&t[1]||""}return"\n"+x+e}var j=!1;function V(e,t){if(!e||j)return"";j=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&"string"===typeof u.stack){for(var i=u.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a]){var c="\n"+i[s].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=s&&0<=a);break}}}finally{j=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function B(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case T:return"Portal";case R:return"Profiler";case w:return"StrictMode";case O:return"Suspense";case N:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case I:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===w?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function W(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function z(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function J(e,t){var n=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=W(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function Z(e,t){Q(e,t);var n=W(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,W(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+W(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:W(n)}}function oe(e,t){var n=W(t.value),r=W(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ce(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ue,le,de=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ue=ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var _e=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ee(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ye=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Te=null,Se=null,we=null;function Re(e){if(e=vi(e)){if("function"!==typeof Te)throw Error(o(280));var t=e.stateNode;t&&(t=bi(t),Te(e.stateNode,e.type,t))}}function Ie(e){Se?we?we.push(e):we=[e]:Se=e}function Ce(){if(Se){var e=Se,t=we;if(we=Se=null,Re(e),t)for(e=0;e<t.length;e++)Re(t[e])}}function Ae(e,t){return e(t)}function Oe(){}var Ne=!1;function ke(e,t,n){if(Ne)return e(t,n);Ne=!0;try{return Ae(e,t,n)}finally{Ne=!1,(null!==Se||null!==we)&&(Oe(),Ce())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var r=bi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Pe=!1;if(l)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Pe=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(le){Pe=!1}function Me(e,t,n,r,i,o,s,a,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(l){this.onError(l)}}var xe=!1,Ue=null,Fe=!1,je=null,Ve={onError:function(e){xe=!0,Ue=e}};function Be(e,t,n,r,i,o,s,a,c){xe=!1,Ue=null,Me.apply(Ve,arguments)}function Ge(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function We(e){if(Ge(e)!==e)throw Error(o(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ge(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return We(i),e;if(s===r)return We(i),t;s=s.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,c=i.child;c;){if(c===n){a=!0,n=i,r=s;break}if(c===r){a=!0,r=i,n=s;break}c=c.sibling}if(!a){for(c=s.child;c;){if(c===n){a=!0,n=s,r=i;break}if(c===r){a=!0,r=s,n=i;break}c=c.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?Ke(e):null}function Ke(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ke(e);if(null!==t)return t;e=e.sibling}return null}var ze=i.unstable_scheduleCallback,Ye=i.unstable_cancelCallback,Je=i.unstable_shouldYield,Xe=i.unstable_requestPaint,Qe=i.unstable_now,Ze=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/ct|0)|0},at=Math.log,ct=Math.LN2;var ut=64,lt=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~i;0!==a?r=dt(a):0!==(o&=s)&&(r=dt(o))}else 0!==(s=n&~i)?r=dt(s):0!==o&&(r=dt(o));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ut;return 0===(4194240&(ut<<=1))&&(ut=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function _t(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function Et(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var vt=0;function yt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,Tt,St,wt,Rt,It=!1,Ct=[],At=null,Ot=null,Nt=null,kt=new Map,Dt=new Map,Pt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mt(e,t){switch(e){case"focusin":case"focusout":At=null;break;case"dragenter":case"dragleave":Ot=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function xt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=vi(t))&&Tt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ut(e){var t=Ei(e.target);if(null!==t){var n=Ge(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=qe(n)))return e.blockedOn=t,void Rt(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=vi(n))&&Tt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);ye=r,n.target.dispatchEvent(r),ye=null,t.shift()}return!0}function jt(e,t,n){Ft(e)&&n.delete(t)}function Vt(){It=!1,null!==At&&Ft(At)&&(At=null),null!==Ot&&Ft(Ot)&&(Ot=null),null!==Nt&&Ft(Nt)&&(Nt=null),kt.forEach(jt),Dt.forEach(jt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,It||(It=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Vt)))}function Gt(e){function t(t){return Bt(t,e)}if(0<Ct.length){Bt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==At&&Bt(At,e),null!==Ot&&Bt(Ot,e),null!==Nt&&Bt(Nt,e),kt.forEach(t),Dt.forEach(t),n=0;n<Pt.length;n++)(r=Pt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Pt.length&&null===(n=Pt[0]).blockedOn;)Ut(n),null===n.blockedOn&&Pt.shift()}var qt=y.ReactCurrentBatchConfig,Wt=!0;function Ht(e,t,n,r){var i=vt,o=qt.transition;qt.transition=null;try{vt=1,zt(e,t,n,r)}finally{vt=i,qt.transition=o}}function Kt(e,t,n,r){var i=vt,o=qt.transition;qt.transition=null;try{vt=4,zt(e,t,n,r)}finally{vt=i,qt.transition=o}}function zt(e,t,n,r){if(Wt){var i=Jt(e,t,n,r);if(null===i)Wr(e,t,r,Yt,n),Mt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return At=xt(At,e,t,n,r,i),!0;case"dragenter":return Ot=xt(Ot,e,t,n,r,i),!0;case"mouseover":return Nt=xt(Nt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return kt.set(o,xt(kt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Dt.set(o,xt(Dt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Mt(e,r),4&t&&-1<Lt.indexOf(e)){for(;null!==i;){var o=vi(i);if(null!==o&&bt(o),null===(o=Jt(e,t,n,r))&&Wr(e,t,r,Yt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Wr(e,t,r,null,n)}}var Yt=null;function Jt(e,t,n,r){if(Yt=null,null!==(e=Ei(e=be(r))))if(null===(t=Ge(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=qe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Qt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,r=n.length,i="value"in Qt?Qt.value:Qt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,cn,un={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=on(un),dn=U({},un,{view:0,detail:0}),hn=on(dn),pn=U({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(sn=e.screenX-cn.screenX,an=e.screenY-cn.screenY):an=sn=0,cn=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),fn=on(pn),mn=on(U({},pn,{dataTransfer:0})),gn=on(U({},dn,{relatedTarget:0})),_n=on(U({},un,{animationName:0,elapsedTime:0,pseudoElement:0})),En=U({},un,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vn=on(En),yn=on(U({},un,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function Rn(){return wn}var In=U({},dn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Tn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=on(In),An=on(U({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),On=on(U({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rn})),Nn=on(U({},un,{propertyName:0,elapsedTime:0,pseudoElement:0})),kn=U({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=on(kn),Pn=[9,13,27,32],Ln=l&&"CompositionEvent"in window,Mn=null;l&&"documentMode"in document&&(Mn=document.documentMode);var xn=l&&"TextEvent"in window&&!Mn,Un=l&&(!Ln||Mn&&8<Mn&&11>=Mn),Fn=String.fromCharCode(32),jn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Pn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Gn=!1;var qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qn[e.type]:"textarea"===t}function Hn(e,t,n,r){Ie(r),0<(t=Kr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Kn=null,zn=null;function Yn(e){Fr(e,0)}function Jn(e){if(z(yi(e)))return e}function Xn(e,t){if("change"===e)return t}var Qn=!1;if(l){var Zn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Zn=$n}else Zn=!1;Qn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){Kn&&(Kn.detachEvent("onpropertychange",nr),zn=Kn=null)}function nr(e){if("value"===e.propertyName&&Jn(zn)){var t=[];Hn(t,zn,e,be(e)),ke(Yn,t)}}function rr(e,t,n){"focusin"===e?(tr(),zn=n,(Kn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Jn(zn)}function or(e,t){if("click"===e)return Jn(t)}function sr(e,t){if("input"===e||"change"===e)return Jn(t)}var ar="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function cr(e,t){if(ar(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!ar(e[i],t[i]))return!1}return!0}function ur(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=ur(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ur(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=lr(n,o);var s=lr(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=l&&"documentMode"in document&&11>=document.documentMode,gr=null,_r=null,Er=null,vr=!1;function yr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;vr||null==gr||gr!==Y(r)||("selectionStart"in(r=gr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},Er&&cr(Er,r)||(Er=r,0<(r=Kr(_r,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function br(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Tr={animationend:br("Animation","AnimationEnd"),animationiteration:br("Animation","AnimationIteration"),animationstart:br("Animation","AnimationStart"),transitionend:br("Transition","TransitionEnd")},Sr={},wr={};function Rr(e){if(Sr[e])return Sr[e];if(!Tr[e])return e;var t,n=Tr[e];for(t in n)if(n.hasOwnProperty(t)&&t in wr)return Sr[e]=n[t];return e}l&&(wr=document.createElement("div").style,"AnimationEvent"in window||(delete Tr.animationend.animation,delete Tr.animationiteration.animation,delete Tr.animationstart.animation),"TransitionEvent"in window||delete Tr.transitionend.transition);var Ir=Rr("animationend"),Cr=Rr("animationiteration"),Ar=Rr("animationstart"),Or=Rr("transitionend"),Nr=new Map,kr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(e,t){Nr.set(e,t),c(t,[e])}for(var Pr=0;Pr<kr.length;Pr++){var Lr=kr[Pr];Dr(Lr.toLowerCase(),"on"+(Lr[0].toUpperCase()+Lr.slice(1)))}Dr(Ir,"onAnimationEnd"),Dr(Cr,"onAnimationIteration"),Dr(Ar,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(Or,"onTransitionEnd"),u("onMouseEnter",["mouseout","mouseover"]),u("onMouseLeave",["mouseout","mouseover"]),u("onPointerEnter",["pointerout","pointerover"]),u("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mr));function Ur(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,a,c,u){if(Be.apply(this,arguments),xe){if(!xe)throw Error(o(198));var l=Ue;xe=!1,Ue=null,Fe||(Fe=!0,je=l)}}(r,t,void 0,e),e.currentTarget=null}function Fr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],c=a.instance,u=a.currentTarget;if(a=a.listener,c!==o&&i.isPropagationStopped())break e;Ur(i,a,u),o=c}else for(s=0;s<r.length;s++){if(c=(a=r[s]).instance,u=a.currentTarget,a=a.listener,c!==o&&i.isPropagationStopped())break e;Ur(i,a,u),o=c}}}if(Fe)throw e=je,Fe=!1,je=null,e}function jr(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(qr(t,e,2,!1),n.add(r))}function Vr(e,t,n){var r=0;t&&(r|=4),qr(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Gr(e){if(!e[Br]){e[Br]=!0,s.forEach((function(t){"selectionchange"!==t&&(xr.has(t)||Vr(t,!1,e),Vr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,Vr("selectionchange",!1,t))}}function qr(e,t,n,r){switch(Xt(t)){case 1:var i=Ht;break;case 4:i=Kt;break;default:i=zt}n=i.bind(null,t,n,e),i=void 0,!Pe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Wr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var c=s.tag;if((3===c||4===c)&&((c=s.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=Ei(a)))return;if(5===(c=s.tag)||6===c){r=o=s;continue e}a=a.parentNode}}r=r.return}ke((function(){var r=o,i=be(n),s=[];e:{var a=Nr.get(e);if(void 0!==a){var c=ln,u=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":c=Cn;break;case"focusin":u="focus",c=gn;break;case"focusout":u="blur",c=gn;break;case"beforeblur":case"afterblur":c=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=On;break;case Ir:case Cr:case Ar:c=_n;break;case Or:c=Nn;break;case"scroll":c=hn;break;case"wheel":c=Dn;break;case"copy":case"cut":case"paste":c=vn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=An}var l=0!==(4&t),d=!l&&"scroll"===e,h=l?null!==a?a+"Capture":null:a;l=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=De(f,h))&&l.push(Hr(f,m,p)))),d)break;f=f.return}0<l.length&&(a=new c(a,u,null,n,i),s.push({event:a,listeners:l}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===ye||!(u=n.relatedTarget||n.fromElement)||!Ei(u)&&!u[fi])&&(c||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?Ei(u):null)&&(u!==(d=Ge(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(c=null,u=r),c!==u)){if(l=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(l=An,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==c?a:yi(c),p=null==u?a:yi(u),(a=new l(m,f+"leave",c,n,i)).target=d,a.relatedTarget=p,m=null,Ei(i)===r&&((l=new l(h,f+"enter",u,n,i)).target=p,l.relatedTarget=d,m=l),d=m,c&&u)e:{for(h=u,f=0,p=l=c;p;p=zr(p))f++;for(p=0,m=h;m;m=zr(m))p++;for(;0<f-p;)l=zr(l),f--;for(;0<p-f;)h=zr(h),p--;for(;f--;){if(l===h||null!==h&&l===h.alternate)break e;l=zr(l),h=zr(h)}l=null}else l=null;null!==c&&Yr(s,a,c,l,!1),null!==u&&null!==d&&Yr(s,d,u,l,!0)}if("select"===(c=(a=r?yi(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var g=Xn;else if(Wn(a))if(Qn)g=sr;else{g=ir;var _=rr}else(c=a.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=or);switch(g&&(g=g(e,r))?Hn(s,g,n,i):(_&&_(e,a,r),"focusout"===e&&(_=a._wrapperState)&&_.controlled&&"number"===a.type&&ee(a,"number",a.value)),_=r?yi(r):window,e){case"focusin":(Wn(_)||"true"===_.contentEditable)&&(gr=_,_r=r,Er=null);break;case"focusout":Er=_r=gr=null;break;case"mousedown":vr=!0;break;case"contextmenu":case"mouseup":case"dragend":vr=!1,yr(s,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":yr(s,n,i)}var E;if(Ln)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Gn?Vn(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(Un&&"ko"!==n.locale&&(Gn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Gn&&(E=en()):(Zt="value"in(Qt=i)?Qt.value:Qt.textContent,Gn=!0)),0<(_=Kr(r,v)).length&&(v=new yn(v,e,null,n,i),s.push({event:v,listeners:_}),E?v.data=E:null!==(E=Bn(n))&&(v.data=E))),(E=xn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(jn=!0,Fn);case"textInput":return(e=t.data)===Fn&&jn?null:e;default:return null}}(e,n):function(e,t){if(Gn)return"compositionend"===e||!Ln&&Vn(e,t)?(e=en(),$t=Zt=Qt=null,Gn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Un&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Kr(r,"onBeforeInput")).length&&(i=new yn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=E))}Fr(s,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Kr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=De(e,n))&&r.unshift(Hr(e,o,i)),null!=(o=De(e,t))&&r.push(Hr(e,o,i))),e=e.return}return r}function zr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yr(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,c=a.alternate,u=a.stateNode;if(null!==c&&c===r)break;5===a.tag&&null!==u&&(a=u,i?null!=(c=De(n,o))&&s.unshift(Hr(n,c,a)):i||null!=(c=De(n,o))&&s.push(Hr(n,c,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Jr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function Qr(e){return("string"===typeof e?e:""+e).replace(Jr,"\n").replace(Xr,"")}function Zr(e,t,n){if(t=Qr(t),Qr(e)!==t&&n)throw Error(o(425))}function $r(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,si="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(ai)}:ri;function ai(e){setTimeout((function(){throw e}))}function ci(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Gt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Gt(t)}function ui(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function li(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,pi="__reactProps$"+di,fi="__reactContainer$"+di,mi="__reactEvents$"+di,gi="__reactListeners$"+di,_i="__reactHandles$"+di;function Ei(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=li(e);null!==e;){if(n=e[hi])return n;e=li(e)}return t}n=(e=n).parentNode}return null}function vi(e){return!(e=e[hi]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function yi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function bi(e){return e[pi]||null}var Ti=[],Si=-1;function wi(e){return{current:e}}function Ri(e){0>Si||(e.current=Ti[Si],Ti[Si]=null,Si--)}function Ii(e,t){Si++,Ti[Si]=e.current,e.current=t}var Ci={},Ai=wi(Ci),Oi=wi(!1),Ni=Ci;function ki(e,t){var n=e.type.contextTypes;if(!n)return Ci;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Di(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Pi(){Ri(Oi),Ri(Ai)}function Li(e,t,n){if(Ai.current!==Ci)throw Error(o(168));Ii(Ai,t),Ii(Oi,n)}function Mi(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,q(e)||"Unknown",i));return U({},n,r)}function xi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ci,Ni=Ai.current,Ii(Ai,e),Ii(Oi,Oi.current),!0}function Ui(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Mi(e,t,Ni),r.__reactInternalMemoizedMergedChildContext=e,Ri(Oi),Ri(Ai),Ii(Ai,e)):Ri(Oi),Ii(Oi,n)}var Fi=null,ji=!1,Vi=!1;function Bi(e){null===Fi?Fi=[e]:Fi.push(e)}function Gi(){if(!Vi&&null!==Fi){Vi=!0;var e=0,t=vt;try{var n=Fi;for(vt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fi=null,ji=!1}catch(i){throw null!==Fi&&(Fi=Fi.slice(e+1)),ze($e,Gi),i}finally{vt=t,Vi=!1}}return null}var qi=[],Wi=0,Hi=null,Ki=0,zi=[],Yi=0,Ji=null,Xi=1,Qi="";function Zi(e,t){qi[Wi++]=Ki,qi[Wi++]=Hi,Hi=e,Ki=t}function $i(e,t,n){zi[Yi++]=Xi,zi[Yi++]=Qi,zi[Yi++]=Ji,Ji=e;var r=Xi;e=Qi;var i=32-st(r)-1;r&=~(1<<i),n+=1;var o=32-st(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Xi=1<<32-st(t)+i|n<<i|r,Qi=o+e}else Xi=1<<o|n<<i|r,Qi=e}function eo(e){null!==e.return&&(Zi(e,1),$i(e,1,0))}function to(e){for(;e===Hi;)Hi=qi[--Wi],qi[Wi]=null,Ki=qi[--Wi],qi[Wi]=null;for(;e===Ji;)Ji=zi[--Yi],zi[Yi]=null,Qi=zi[--Yi],zi[Yi]=null,Xi=zi[--Yi],zi[Yi]=null}var no=null,ro=null,io=!1,oo=null;function so(e,t){var n=ku(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=ui(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ji?{id:Xi,overflow:Qi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=ku(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function co(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function uo(e){if(io){var t=ro;if(t){var n=t;if(!ao(e,t)){if(co(e))throw Error(o(418));t=ui(n.nextSibling);var r=no;t&&ao(e,t)?so(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(co(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function lo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!io)return lo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(co(e))throw po(),Error(o(418));for(;t;)so(e,t),t=ui(t.nextSibling)}if(lo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ui(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?ui(e.stateNode.nextSibling):null;return!0}function po(){for(var e=ro;e;)e=ui(e.nextSibling)}function fo(){ro=no=null,io=!1}function mo(e){null===oo?oo=[e]:oo.push(e)}var go=y.ReactCurrentBatchConfig;function _o(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Eo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function vo(e){return(0,e._init)(e._payload)}function yo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Pu(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){return null===t||6!==t.tag?((t=Uu(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function u(e,t,n,r){var o=n.type;return o===S?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===D&&vo(o)===t.type)?((r=i(t,n.props)).ref=_o(e,t,n),r.return=e,r):((r=Lu(n.type,n.key,n.props,null,e.mode,r)).ref=_o(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fu(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Mu(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Uu(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Lu(t.type,t.key,t.props,null,e.mode,n)).ref=_o(e,null,t),n.return=e,n;case T:return(t=Fu(t,e.mode,n)).return=e,t;case D:return h(e,(0,t._init)(t._payload),n)}if(te(t)||M(t))return(t=Mu(t,e.mode,n,null)).return=e,t;Eo(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:c(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===i?u(e,t,n,r):null;case T:return n.key===i?l(e,t,n,r):null;case D:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||M(n))return null!==i?null:d(e,t,n,r,null);Eo(e,n)}return null}function f(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return c(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case b:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case T:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i);case D:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||M(r))return d(t,e=e.get(n)||null,r,i,null);Eo(t,r)}return null}function m(i,o,a,c){for(var u=null,l=null,d=o,m=o=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var _=p(i,d,a[m],c);if(null===_){null===d&&(d=g);break}e&&d&&null===_.alternate&&t(i,d),o=s(_,o,m),null===l?u=_:l.sibling=_,l=_,d=g}if(m===a.length)return n(i,d),io&&Zi(i,m),u;if(null===d){for(;m<a.length;m++)null!==(d=h(i,a[m],c))&&(o=s(d,o,m),null===l?u=d:l.sibling=d,l=d);return io&&Zi(i,m),u}for(d=r(i,d);m<a.length;m++)null!==(g=f(d,i,m,a[m],c))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),o=s(g,o,m),null===l?u=g:l.sibling=g,l=g);return e&&d.forEach((function(e){return t(i,e)})),io&&Zi(i,m),u}function g(i,a,c,u){var l=M(c);if("function"!==typeof l)throw Error(o(150));if(null==(c=l.call(c)))throw Error(o(151));for(var d=l=null,m=a,g=a=0,_=null,E=c.next();null!==m&&!E.done;g++,E=c.next()){m.index>g?(_=m,m=null):_=m.sibling;var v=p(i,m,E.value,u);if(null===v){null===m&&(m=_);break}e&&m&&null===v.alternate&&t(i,m),a=s(v,a,g),null===d?l=v:d.sibling=v,d=v,m=_}if(E.done)return n(i,m),io&&Zi(i,g),l;if(null===m){for(;!E.done;g++,E=c.next())null!==(E=h(i,E.value,u))&&(a=s(E,a,g),null===d?l=E:d.sibling=E,d=E);return io&&Zi(i,g),l}for(m=r(i,m);!E.done;g++,E=c.next())null!==(E=f(m,i,g,E.value,u))&&(e&&null!==E.alternate&&m.delete(null===E.key?g:E.key),a=s(E,a,g),null===d?l=E:d.sibling=E,d=E);return e&&m.forEach((function(e){return t(i,e)})),io&&Zi(i,g),l}return function e(r,o,s,c){if("object"===typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case b:e:{for(var u=s.key,l=o;null!==l;){if(l.key===u){if((u=s.type)===S){if(7===l.tag){n(r,l.sibling),(o=i(l,s.props.children)).return=r,r=o;break e}}else if(l.elementType===u||"object"===typeof u&&null!==u&&u.$$typeof===D&&vo(u)===l.type){n(r,l.sibling),(o=i(l,s.props)).ref=_o(r,l,s),o.return=r,r=o;break e}n(r,l);break}t(r,l),l=l.sibling}s.type===S?((o=Mu(s.props.children,r.mode,c,s.key)).return=r,r=o):((c=Lu(s.type,s.key,s.props,null,r.mode,c)).ref=_o(r,o,s),c.return=r,r=c)}return a(r);case T:e:{for(l=s.key;null!==o;){if(o.key===l){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(r,o.sibling),(o=i(o,s.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=Fu(s,r.mode,c)).return=r,r=o}return a(r);case D:return e(r,o,(l=s._init)(s._payload),c)}if(te(s))return m(r,o,s,c);if(M(s))return g(r,o,s,c);Eo(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,s)).return=r,r=o):(n(r,o),(o=Uu(s,r.mode,c)).return=r,r=o),a(r)):n(r,o)}}var bo=yo(!0),To=yo(!1),So=wi(null),wo=null,Ro=null,Io=null;function Co(){Io=Ro=wo=null}function Ao(e){var t=So.current;Ri(So),e._currentValue=t}function Oo(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function No(e,t){wo=e,Io=Ro=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(va=!0),e.firstContext=null)}function ko(e){var t=e._currentValue;if(Io!==e)if(e={context:e,memoizedValue:t,next:null},null===Ro){if(null===wo)throw Error(o(308));Ro=e,wo.dependencies={lanes:0,firstContext:e}}else Ro=Ro.next=e;return t}var Do=null;function Po(e){null===Do?Do=[e]:Do.push(e)}function Lo(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Po(t)):(n.next=i.next,i.next=n),t.interleaved=n,Mo(e,r)}function Mo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var xo=!1;function Uo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function jo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Vo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ac)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Mo(e,n)}return null===(i=r.interleaved)?(t.next=t,Po(r)):(t.next=i.next,i.next=t),r.interleaved=t,Mo(e,n)}function Bo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Et(e,n)}}function Go(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function qo(e,t,n,r){var i=e.updateQueue;xo=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var c=a,u=c.next;c.next=null,null===s?o=u:s.next=u,s=c;var l=e.alternate;null!==l&&((a=(l=l.updateQueue).lastBaseUpdate)!==s&&(null===a?l.firstBaseUpdate=u:a.next=u,l.lastBaseUpdate=c))}if(null!==o){var d=i.baseState;for(s=0,l=u=c=null,a=o;;){var h=a.lane,p=a.eventTime;if((r&h)===h){null!==l&&(l=l.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var f=e,m=a;switch(h=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(p,d,h):f)||void 0===h)break e;d=U({},d,h);break e;case 2:xo=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===l?(u=l=p,c=d):l=l.next=p,s|=h;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(h=a).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===l&&(c=d),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=l,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);xc|=s,e.lanes=s,e.memoizedState=d}}function Wo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var Ho={},Ko=wi(Ho),zo=wi(Ho),Yo=wi(Ho);function Jo(e){if(e===Ho)throw Error(o(174));return e}function Xo(e,t){switch(Ii(Yo,t),Ii(zo,e),Ii(Ko,Ho),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ce(null,"");break;default:t=ce(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ri(Ko),Ii(Ko,t)}function Qo(){Ri(Ko),Ri(zo),Ri(Yo)}function Zo(e){Jo(Yo.current);var t=Jo(Ko.current),n=ce(t,e.type);t!==n&&(Ii(zo,e),Ii(Ko,n))}function $o(e){zo.current===e&&(Ri(Ko),Ri(zo))}var es=wi(0);function ts(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ns=[];function rs(){for(var e=0;e<ns.length;e++)ns[e]._workInProgressVersionPrimary=null;ns.length=0}var is=y.ReactCurrentDispatcher,os=y.ReactCurrentBatchConfig,ss=0,as=null,cs=null,us=null,ls=!1,ds=!1,hs=0,ps=0;function fs(){throw Error(o(321))}function ms(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function gs(e,t,n,r,i,s){if(ss=s,as=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,is.current=null===e||null===e.memoizedState?$s:ea,e=n(r,i),ds){s=0;do{if(ds=!1,hs=0,25<=s)throw Error(o(301));s+=1,us=cs=null,t.updateQueue=null,is.current=ta,e=n(r,i)}while(ds)}if(is.current=Zs,t=null!==cs&&null!==cs.next,ss=0,us=cs=as=null,ls=!1,t)throw Error(o(300));return e}function _s(){var e=0!==hs;return hs=0,e}function Es(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===us?as.memoizedState=us=e:us=us.next=e,us}function vs(){if(null===cs){var e=as.alternate;e=null!==e?e.memoizedState:null}else e=cs.next;var t=null===us?as.memoizedState:us.next;if(null!==t)us=t,cs=e;else{if(null===e)throw Error(o(310));e={memoizedState:(cs=e).memoizedState,baseState:cs.baseState,baseQueue:cs.baseQueue,queue:cs.queue,next:null},null===us?as.memoizedState=us=e:us=us.next=e}return us}function ys(e,t){return"function"===typeof t?t(e):t}function bs(e){var t=vs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=cs,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var c=a=null,u=null,l=s;do{var d=l.lane;if((ss&d)===d)null!==u&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var h={lane:d,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===u?(c=u=h,a=r):u=u.next=h,as.lanes|=d,xc|=d}l=l.next}while(null!==l&&l!==s);null===u?a=r:u.next=c,ar(r,t.memoizedState)||(va=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,as.lanes|=s,xc|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ts(e){var t=vs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{s=e(s,a.action),a=a.next}while(a!==i);ar(s,t.memoizedState)||(va=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Ss(){}function ws(e,t){var n=as,r=vs(),i=t(),s=!ar(r.memoizedState,i);if(s&&(r.memoizedState=i,va=!0),r=r.queue,xs(Cs.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==us&&1&us.memoizedState.tag){if(n.flags|=2048,ks(9,Is.bind(null,n,r,i,t),void 0,null),null===Oc)throw Error(o(349));0!==(30&ss)||Rs(n,t,i)}return i}function Rs(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=as.updateQueue)?(t={lastEffect:null,stores:null},as.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Is(e,t,n,r){t.value=n,t.getSnapshot=r,As(t)&&Os(e)}function Cs(e,t,n){return n((function(){As(t)&&Os(e)}))}function As(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(r){return!0}}function Os(e){var t=Mo(e,1);null!==t&&nu(t,e,1,-1)}function Ns(e){var t=Es();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ys,lastRenderedState:e},t.queue=e,e=e.dispatch=Ys.bind(null,as,e),[t.memoizedState,e]}function ks(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=as.updateQueue)?(t={lastEffect:null,stores:null},as.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ds(){return vs().memoizedState}function Ps(e,t,n,r){var i=Es();as.flags|=e,i.memoizedState=ks(1|t,n,void 0,void 0===r?null:r)}function Ls(e,t,n,r){var i=vs();r=void 0===r?null:r;var o=void 0;if(null!==cs){var s=cs.memoizedState;if(o=s.destroy,null!==r&&ms(r,s.deps))return void(i.memoizedState=ks(t,n,o,r))}as.flags|=e,i.memoizedState=ks(1|t,n,o,r)}function Ms(e,t){return Ps(8390656,8,e,t)}function xs(e,t){return Ls(2048,8,e,t)}function Us(e,t){return Ls(4,2,e,t)}function Fs(e,t){return Ls(4,4,e,t)}function js(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Vs(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ls(4,4,js.bind(null,t,e),n)}function Bs(){}function Gs(e,t){var n=vs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ms(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function qs(e,t){var n=vs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&ms(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Ws(e,t,n){return 0===(21&ss)?(e.baseState&&(e.baseState=!1,va=!0),e.memoizedState=n):(ar(n,t)||(n=mt(),as.lanes|=n,xc|=n,e.baseState=!0),t)}function Hs(e,t){var n=vt;vt=0!==n&&4>n?n:4,e(!0);var r=os.transition;os.transition={};try{e(!1),t()}finally{vt=n,os.transition=r}}function Ks(){return vs().memoizedState}function zs(e,t,n){var r=tu(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Js(e))Xs(t,n);else if(null!==(n=Lo(e,t,n,r))){nu(n,e,r,eu()),Qs(n,t,r)}}function Ys(e,t,n){var r=tu(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Js(e))Xs(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,ar(a,s)){var c=t.interleaved;return null===c?(i.next=i,Po(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(u){}null!==(n=Lo(e,t,i,r))&&(nu(n,e,r,i=eu()),Qs(n,t,r))}}function Js(e){var t=e.alternate;return e===as||null!==t&&t===as}function Xs(e,t){ds=ls=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Qs(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Et(e,n)}}var Zs={readContext:ko,useCallback:fs,useContext:fs,useEffect:fs,useImperativeHandle:fs,useInsertionEffect:fs,useLayoutEffect:fs,useMemo:fs,useReducer:fs,useRef:fs,useState:fs,useDebugValue:fs,useDeferredValue:fs,useTransition:fs,useMutableSource:fs,useSyncExternalStore:fs,useId:fs,unstable_isNewReconciler:!1},$s={readContext:ko,useCallback:function(e,t){return Es().memoizedState=[e,void 0===t?null:t],e},useContext:ko,useEffect:Ms,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ps(4194308,4,js.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ps(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ps(4,2,e,t)},useMemo:function(e,t){var n=Es();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Es();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=zs.bind(null,as,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Es().memoizedState=e},useState:Ns,useDebugValue:Bs,useDeferredValue:function(e){return Es().memoizedState=e},useTransition:function(){var e=Ns(!1),t=e[0];return e=Hs.bind(null,e[1]),Es().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=as,i=Es();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Oc)throw Error(o(349));0!==(30&ss)||Rs(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Ms(Cs.bind(null,r,s,e),[e]),r.flags|=2048,ks(9,Is.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=Es(),t=Oc.identifierPrefix;if(io){var n=Qi;t=":"+t+"R"+(n=(Xi&~(1<<32-st(Xi)-1)).toString(32)+n),0<(n=hs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ps++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ea={readContext:ko,useCallback:Gs,useContext:ko,useEffect:xs,useImperativeHandle:Vs,useInsertionEffect:Us,useLayoutEffect:Fs,useMemo:qs,useReducer:bs,useRef:Ds,useState:function(){return bs(ys)},useDebugValue:Bs,useDeferredValue:function(e){return Ws(vs(),cs.memoizedState,e)},useTransition:function(){return[bs(ys)[0],vs().memoizedState]},useMutableSource:Ss,useSyncExternalStore:ws,useId:Ks,unstable_isNewReconciler:!1},ta={readContext:ko,useCallback:Gs,useContext:ko,useEffect:xs,useImperativeHandle:Vs,useInsertionEffect:Us,useLayoutEffect:Fs,useMemo:qs,useReducer:Ts,useRef:Ds,useState:function(){return Ts(ys)},useDebugValue:Bs,useDeferredValue:function(e){var t=vs();return null===cs?t.memoizedState=e:Ws(t,cs.memoizedState,e)},useTransition:function(){return[Ts(ys)[0],vs().memoizedState]},useMutableSource:Ss,useSyncExternalStore:ws,useId:Ks,unstable_isNewReconciler:!1};function na(e,t){if(e&&e.defaultProps){for(var n in t=U({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ra(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:U({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ia={isMounted:function(e){return!!(e=e._reactInternals)&&Ge(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=eu(),i=tu(e),o=jo(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Vo(e,o,i))&&(nu(t,e,i,r),Bo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=eu(),i=tu(e),o=jo(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Vo(e,o,i))&&(nu(t,e,i,r),Bo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=eu(),r=tu(e),i=jo(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Vo(e,i,r))&&(nu(t,e,r,n),Bo(t,e,r))}};function oa(e,t,n,r,i,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!cr(n,r)||!cr(i,o))}function sa(e,t,n){var r=!1,i=Ci,o=t.contextType;return"object"===typeof o&&null!==o?o=ko(o):(i=Di(t)?Ni:Ai.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?ki(e,i):Ci),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ia,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function aa(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ia.enqueueReplaceState(t,t.state,null)}function ca(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Uo(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=ko(o):(o=Di(t)?Ni:Ai.current,i.context=ki(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(ra(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ia.enqueueReplaceState(i,i.state,null),qo(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function ua(e,t){try{var n="",r=t;do{n+=B(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function la(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ha="function"===typeof WeakMap?WeakMap:Map;function pa(e,t,n){(n=jo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Wc||(Wc=!0,Hc=r),da(0,t)},n}function fa(e,t,n){(n=jo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){da(0,t),"function"!==typeof r&&(null===Kc?Kc=new Set([this]):Kc.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ma(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ha;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Ru.bind(null,e,t,n),t.then(e,e))}function ga(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function _a(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=jo(-1,1)).tag=2,Vo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var Ea=y.ReactCurrentOwner,va=!1;function ya(e,t,n,r){t.child=null===e?To(t,null,n,r):bo(t,e.child,n,r)}function ba(e,t,n,r,i){n=n.render;var o=t.ref;return No(t,i),r=gs(e,t,n,r,o,i),n=_s(),null===e||va?(io&&n&&eo(t),t.flags|=1,ya(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Wa(e,t,i))}function Ta(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Du(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lu(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Sa(e,t,o,r,i))}if(o=e.child,0===(e.lanes&i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:cr)(s,r)&&e.ref===t.ref)return Wa(e,t,i)}return t.flags|=1,(e=Pu(o,r)).ref=t.ref,e.return=t,t.child=e}function Sa(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(cr(o,r)&&e.ref===t.ref){if(va=!1,t.pendingProps=r=o,0===(e.lanes&i))return t.lanes=e.lanes,Wa(e,t,i);0!==(131072&e.flags)&&(va=!0)}}return Ia(e,t,n,r,i)}function wa(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ii(Pc,Dc),Dc|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ii(Pc,Dc),Dc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ii(Pc,Dc),Dc|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ii(Pc,Dc),Dc|=r;return ya(e,t,i,n),t.child}function Ra(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ia(e,t,n,r,i){var o=Di(n)?Ni:Ai.current;return o=ki(t,o),No(t,i),n=gs(e,t,n,r,o,i),r=_s(),null===e||va?(io&&r&&eo(t),t.flags|=1,ya(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Wa(e,t,i))}function Ca(e,t,n,r,i){if(Di(n)){var o=!0;xi(t)}else o=!1;if(No(t,i),null===t.stateNode)qa(e,t),sa(t,n,r),ca(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var c=s.context,u=n.contextType;"object"===typeof u&&null!==u?u=ko(u):u=ki(t,u=Di(n)?Ni:Ai.current);var l=n.getDerivedStateFromProps,d="function"===typeof l||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==r||c!==u)&&aa(t,s,r,u),xo=!1;var h=t.memoizedState;s.state=h,qo(t,r,s,i),c=t.memoizedState,a!==r||h!==c||Oi.current||xo?("function"===typeof l&&(ra(t,n,l,r),c=t.memoizedState),(a=xo||oa(t,n,a,r,h,c,u))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),s.props=r,s.state=c,s.context=u,r=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,Fo(e,t),a=t.memoizedProps,u=t.type===t.elementType?a:na(t.type,a),s.props=u,d=t.pendingProps,h=s.context,"object"===typeof(c=n.contextType)&&null!==c?c=ko(c):c=ki(t,c=Di(n)?Ni:Ai.current);var p=n.getDerivedStateFromProps;(l="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==d||h!==c)&&aa(t,s,r,c),xo=!1,h=t.memoizedState,s.state=h,qo(t,r,s,i);var f=t.memoizedState;a!==d||h!==f||Oi.current||xo?("function"===typeof p&&(ra(t,n,p,r),f=t.memoizedState),(u=xo||oa(t,n,u,r,h,f,c)||!1)?(l||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,f,c),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,f,c)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),s.props=r,s.state=f,s.context=c,r=u):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Aa(e,t,n,r,o,i)}function Aa(e,t,n,r,i,o){Ra(e,t);var s=0!==(128&t.flags);if(!r&&!s)return i&&Ui(t,n,!1),Wa(e,t,o);r=t.stateNode,Ea.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=bo(t,e.child,null,o),t.child=bo(t,null,a,o)):ya(e,t,a,o),t.memoizedState=r.state,i&&Ui(t,n,!0),t.child}function Oa(e){var t=e.stateNode;t.pendingContext?Li(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Li(0,t.context,!1),Xo(e,t.containerInfo)}function Na(e,t,n,r,i){return fo(),mo(i),t.flags|=256,ya(e,t,n,r),t.child}var ka,Da,Pa,La,Ma={dehydrated:null,treeContext:null,retryLane:0};function xa(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ua(e,t,n){var r,i=t.pendingProps,s=es.current,a=!1,c=0!==(128&t.flags);if((r=c)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ii(es,1&s),null===e)return uo(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(c=i.children,e=i.fallback,a?(i=t.mode,a=t.child,c={mode:"hidden",children:c},0===(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=c):a=xu(c,i,0,null),e=Mu(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=xa(n),t.memoizedState=Ma,e):Fa(t,c));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,a){if(n)return 256&t.flags?(t.flags&=-257,ja(e,t,a,r=la(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=xu({mode:"visible",children:r.children},i,0,null),(s=Mu(s,i,a,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&bo(t,e.child,null,a),t.child.memoizedState=xa(a),t.memoizedState=Ma,s);if(0===(1&t.mode))return ja(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var c=r.dgst;return r=c,ja(e,t,a,r=la(s=Error(o(419)),r,void 0))}if(c=0!==(a&e.childLanes),va||c){if(null!==(r=Oc)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|a))?0:i)&&i!==s.retryLane&&(s.retryLane=i,Mo(e,i),nu(r,e,i,-1))}return mu(),ja(e,t,a,r=la(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Cu.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ro=ui(i.nextSibling),no=t,io=!0,oo=null,null!==e&&(zi[Yi++]=Xi,zi[Yi++]=Qi,zi[Yi++]=Ji,Xi=e.id,Qi=e.overflow,Ji=t),t=Fa(t,r.children),t.flags|=4096,t)}(e,t,c,i,r,s,n);if(a){a=i.fallback,c=t.mode,r=(s=e.child).sibling;var u={mode:"hidden",children:i.children};return 0===(1&c)&&t.child!==s?((i=t.child).childLanes=0,i.pendingProps=u,t.deletions=null):(i=Pu(s,u)).subtreeFlags=14680064&s.subtreeFlags,null!==r?a=Pu(r,a):(a=Mu(a,c,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,c=null===(c=e.child.memoizedState)?xa(n):{baseLanes:c.baseLanes|n,cachePool:null,transitions:c.transitions},a.memoizedState=c,a.childLanes=e.childLanes&~n,t.memoizedState=Ma,i}return e=(a=e.child).sibling,i=Pu(a,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Fa(e,t){return(t=xu({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function ja(e,t,n,r){return null!==r&&mo(r),bo(t,e.child,null,n),(e=Fa(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Va(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Oo(e.return,t,n)}function Ba(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function Ga(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(ya(e,t,r.children,n),0!==(2&(r=es.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Va(e,n,t);else if(19===e.tag)Va(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ii(es,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ts(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ba(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ts(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ba(t,!0,n,null,o);break;case"together":Ba(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qa(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wa(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),xc|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Pu(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Pu(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ha(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ka(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function za(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ka(t),null;case 1:case 17:return Di(t.type)&&Pi(),Ka(t),null;case 3:return r=t.stateNode,Qo(),Ri(Oi),Ri(Ai),rs(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(su(oo),oo=null))),Da(e,t),Ka(t),null;case 5:$o(t);var i=Jo(Yo.current);if(n=t.type,null!==e&&null!=t.stateNode)Pa(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Ka(t),null}if(e=Jo(Ko.current),ho(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[hi]=t,r[pi]=s,e=0!==(1&t.mode),n){case"dialog":jr("cancel",r),jr("close",r);break;case"iframe":case"object":case"embed":jr("load",r);break;case"video":case"audio":for(i=0;i<Mr.length;i++)jr(Mr[i],r);break;case"source":jr("error",r);break;case"img":case"image":case"link":jr("error",r),jr("load",r);break;case"details":jr("toggle",r);break;case"input":X(r,s),jr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},jr("invalid",r);break;case"textarea":ie(r,s),jr("invalid",r)}for(var c in Ee(n,s),i=null,s)if(s.hasOwnProperty(c)){var u=s[c];"children"===c?"string"===typeof u?r.textContent!==u&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,u,e),i=["children",u]):"number"===typeof u&&r.textContent!==""+u&&(!0!==s.suppressHydrationWarning&&Zr(r.textContent,u,e),i=["children",""+u]):a.hasOwnProperty(c)&&null!=u&&"onScroll"===c&&jr("scroll",r)}switch(n){case"input":K(r),$(r,s,!0);break;case"textarea":K(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=$r)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{c=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=c.createElement(n,{is:r.is}):(e=c.createElement(n),"select"===n&&(c=e,r.multiple?c.multiple=!0:r.size&&(c.size=r.size))):e=c.createElementNS(e,n),e[hi]=t,e[pi]=r,ka(e,t,!1,!1),t.stateNode=e;e:{switch(c=ve(n,r),n){case"dialog":jr("cancel",e),jr("close",e),i=r;break;case"iframe":case"object":case"embed":jr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Mr.length;i++)jr(Mr[i],e);i=r;break;case"source":jr("error",e),i=r;break;case"img":case"image":case"link":jr("error",e),jr("load",e),i=r;break;case"details":jr("toggle",e),i=r;break;case"input":X(e,r),i=J(e,r),jr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=U({},r,{value:void 0}),jr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),jr("invalid",e)}for(s in Ee(n,i),u=i)if(u.hasOwnProperty(s)){var l=u[s];"style"===s?ge(e,l):"dangerouslySetInnerHTML"===s?null!=(l=l?l.__html:void 0)&&de(e,l):"children"===s?"string"===typeof l?("textarea"!==n||""!==l)&&he(e,l):"number"===typeof l&&he(e,""+l):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=l&&"onScroll"===s&&jr("scroll",e):null!=l&&v(e,s,l,c))}switch(n){case"input":K(e),$(e,r,!1);break;case"textarea":K(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+W(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ka(t),null;case 6:if(e&&null!=t.stateNode)La(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(n=Jo(Yo.current),Jo(Ko.current),ho(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(s=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return Ka(t),null;case 13:if(Ri(es),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))po(),fo(),t.flags|=98560,s=!1;else if(s=ho(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[hi]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ka(t),s=!1}else null!==oo&&(su(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&es.current)?0===Lc&&(Lc=3):mu())),null!==t.updateQueue&&(t.flags|=4),Ka(t),null);case 4:return Qo(),Da(e,t),null===e&&Gr(t.stateNode.containerInfo),Ka(t),null;case 10:return Ao(t.type._context),Ka(t),null;case 19:if(Ri(es),null===(s=t.memoizedState))return Ka(t),null;if(r=0!==(128&t.flags),null===(c=s.rendering))if(r)Ha(s,!1);else{if(0!==Lc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(c=ts(e))){for(t.flags|=128,Ha(s,!1),null!==(r=c.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(c=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,e=c.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ii(es,1&es.current|2),t.child}e=e.sibling}null!==s.tail&&Qe()>Gc&&(t.flags|=128,r=!0,Ha(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ts(c))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ha(s,!0),null===s.tail&&"hidden"===s.tailMode&&!c.alternate&&!io)return Ka(t),null}else 2*Qe()-s.renderingStartTime>Gc&&1073741824!==n&&(t.flags|=128,r=!0,Ha(s,!1),t.lanes=4194304);s.isBackwards?(c.sibling=t.child,t.child=c):(null!==(n=s.last)?n.sibling=c:t.child=c,s.last=c)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Qe(),t.sibling=null,n=es.current,Ii(es,r?1&n|2:1&n),t):(Ka(t),null);case 22:case 23:return du(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Dc)&&(Ka(t),6&t.subtreeFlags&&(t.flags|=8192)):Ka(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Ya(e,t){switch(to(t),t.tag){case 1:return Di(t.type)&&Pi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Qo(),Ri(Oi),Ri(Ai),rs(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return $o(t),null;case 13:if(Ri(es),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ri(es),null;case 4:return Qo(),null;case 10:return Ao(t.type._context),null;case 22:case 23:return du(),null;default:return null}}ka=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Da=function(){},Pa=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Jo(Ko.current);var o,s=null;switch(n){case"input":i=J(e,i),r=J(e,r),s=[];break;case"select":i=U({},i,{value:void 0}),r=U({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in Ee(n,r),n=null,i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&null!=i[l])if("style"===l){var c=i[l];for(o in c)c.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(a.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in r){var u=r[l];if(c=null!=i?i[l]:void 0,r.hasOwnProperty(l)&&u!==c&&(null!=u||null!=c))if("style"===l)if(c){for(o in c)!c.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in u)u.hasOwnProperty(o)&&c[o]!==u[o]&&(n||(n={}),n[o]=u[o])}else n||(s||(s=[]),s.push(l,n)),n=u;else"dangerouslySetInnerHTML"===l?(u=u?u.__html:void 0,c=c?c.__html:void 0,null!=u&&c!==u&&(s=s||[]).push(l,u)):"children"===l?"string"!==typeof u&&"number"!==typeof u||(s=s||[]).push(l,""+u):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(a.hasOwnProperty(l)?(null!=u&&"onScroll"===l&&jr("scroll",e),s||c===u||(s=[])):(s=s||[]).push(l,u))}n&&(s=s||[]).push("style",n);var l=s;(t.updateQueue=l)&&(t.flags|=4)}},La=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ja=!1,Xa=!1,Qa="function"===typeof WeakSet?WeakSet:Set,Za=null;function $a(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){wu(e,t,r)}else n.current=null}function ec(e,t,n){try{n()}catch(r){wu(e,t,r)}}var tc=!1;function nc(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&ec(t,n,o)}i=i.next}while(i!==r)}}function rc(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ic(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function oc(e){var t=e.alternate;null!==t&&(e.alternate=null,oc(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[pi],delete t[mi],delete t[gi],delete t[_i])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sc(e){return 5===e.tag||3===e.tag||4===e.tag}function ac(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(cc(e,t,n),e=e.sibling;null!==e;)cc(e,t,n),e=e.sibling}function uc(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(uc(e,t,n),e=e.sibling;null!==e;)uc(e,t,n),e=e.sibling}var lc=null,dc=!1;function hc(e,t,n){for(n=n.child;null!==n;)pc(e,t,n),n=n.sibling}function pc(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(a){}switch(n.tag){case 5:Xa||$a(n,t);case 6:var r=lc,i=dc;lc=null,hc(e,t,n),dc=i,null!==(lc=r)&&(dc?(e=lc,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lc.removeChild(n.stateNode));break;case 18:null!==lc&&(dc?(e=lc,n=n.stateNode,8===e.nodeType?ci(e.parentNode,n):1===e.nodeType&&ci(e,n),Gt(e)):ci(lc,n.stateNode));break;case 4:r=lc,i=dc,lc=n.stateNode.containerInfo,dc=!0,hc(e,t,n),lc=r,dc=i;break;case 0:case 11:case 14:case 15:if(!Xa&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&ec(n,t,s),i=i.next}while(i!==r)}hc(e,t,n);break;case 1:if(!Xa&&($a(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){wu(n,t,a)}hc(e,t,n);break;case 21:hc(e,t,n);break;case 22:1&n.mode?(Xa=(r=Xa)||null!==n.memoizedState,hc(e,t,n),Xa=r):hc(e,t,n);break;default:hc(e,t,n)}}function fc(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Qa),t.forEach((function(t){var r=Au.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function mc(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,a=t,c=a;e:for(;null!==c;){switch(c.tag){case 5:lc=c.stateNode,dc=!1;break e;case 3:case 4:lc=c.stateNode.containerInfo,dc=!0;break e}c=c.return}if(null===lc)throw Error(o(160));pc(s,a,i),lc=null,dc=!1;var u=i.alternate;null!==u&&(u.return=null),i.return=null}catch(l){wu(i,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gc(t,e),t=t.sibling}function gc(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(mc(t,e),_c(e),4&r){try{nc(3,e,e.return),rc(3,e)}catch(g){wu(e,e.return,g)}try{nc(5,e,e.return)}catch(g){wu(e,e.return,g)}}break;case 1:mc(t,e),_c(e),512&r&&null!==n&&$a(n,n.return);break;case 5:if(mc(t,e),_c(e),512&r&&null!==n&&$a(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(g){wu(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,c=e.type,u=e.updateQueue;if(e.updateQueue=null,null!==u)try{"input"===c&&"radio"===s.type&&null!=s.name&&Q(i,s),ve(c,a);var l=ve(c,s);for(a=0;a<u.length;a+=2){var d=u[a],h=u[a+1];"style"===d?ge(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):v(i,d,h,l)}switch(c){case"input":Z(i,s);break;case"textarea":oe(i,s);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ne(i,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[pi]=s}catch(g){wu(e,e.return,g)}}break;case 6:if(mc(t,e),_c(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(g){wu(e,e.return,g)}}break;case 3:if(mc(t,e),_c(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Gt(t.containerInfo)}catch(g){wu(e,e.return,g)}break;case 4:default:mc(t,e),_c(e);break;case 13:mc(t,e),_c(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(Bc=Qe())),4&r&&fc(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Xa=(l=Xa)||d,mc(t,e),Xa=l):mc(t,e),_c(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!d&&0!==(1&e.mode))for(Za=e,d=e.child;null!==d;){for(h=Za=d;null!==Za;){switch(f=(p=Za).child,p.tag){case 0:case 11:case 14:case 15:nc(4,p,p.return);break;case 1:$a(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){wu(r,n,g)}}break;case 5:$a(p,p.return);break;case 22:if(null!==p.memoizedState){bc(h);continue}}null!==f?(f.return=p,Za=f):bc(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,l?"function"===typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(c=h.stateNode,a=void 0!==(u=h.memoizedProps.style)&&null!==u&&u.hasOwnProperty("display")?u.display:null,c.style.display=me("display",a))}catch(g){wu(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(g){wu(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:mc(t,e),_c(e),4&r&&fc(e);case 21:}}function _c(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sc(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),uc(e,ac(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;cc(e,ac(e),s);break;default:throw Error(o(161))}}catch(a){wu(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ec(e,t,n){Za=e,vc(e,t,n)}function vc(e,t,n){for(var r=0!==(1&e.mode);null!==Za;){var i=Za,o=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Ja;if(!s){var a=i.alternate,c=null!==a&&null!==a.memoizedState||Xa;a=Ja;var u=Xa;if(Ja=s,(Xa=c)&&!u)for(Za=i;null!==Za;)c=(s=Za).child,22===s.tag&&null!==s.memoizedState?Tc(i):null!==c?(c.return=s,Za=c):Tc(i);for(;null!==o;)Za=o,vc(o,t,n),o=o.sibling;Za=i,Ja=a,Xa=u}yc(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,Za=o):yc(e)}}function yc(e){for(;null!==Za;){var t=Za;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Xa||rc(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Xa)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:na(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Wo(t,s,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Wo(t,a,n)}break;case 5:var c=t.stateNode;if(null===n&&4&t.flags){n=c;var u=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var d=l.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Gt(h)}}}break;default:throw Error(o(163))}Xa||512&t.flags&&ic(t)}catch(p){wu(t,t.return,p)}}if(t===e){Za=null;break}if(null!==(n=t.sibling)){n.return=t.return,Za=n;break}Za=t.return}}function bc(e){for(;null!==Za;){var t=Za;if(t===e){Za=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Za=n;break}Za=t.return}}function Tc(e){for(;null!==Za;){var t=Za;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rc(4,t)}catch(c){wu(t,n,c)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(c){wu(t,i,c)}}var o=t.return;try{ic(t)}catch(c){wu(t,o,c)}break;case 5:var s=t.return;try{ic(t)}catch(c){wu(t,s,c)}}}catch(c){wu(t,t.return,c)}if(t===e){Za=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Za=a;break}Za=t.return}}var Sc,wc=Math.ceil,Rc=y.ReactCurrentDispatcher,Ic=y.ReactCurrentOwner,Cc=y.ReactCurrentBatchConfig,Ac=0,Oc=null,Nc=null,kc=0,Dc=0,Pc=wi(0),Lc=0,Mc=null,xc=0,Uc=0,Fc=0,jc=null,Vc=null,Bc=0,Gc=1/0,qc=null,Wc=!1,Hc=null,Kc=null,zc=!1,Yc=null,Jc=0,Xc=0,Qc=null,Zc=-1,$c=0;function eu(){return 0!==(6&Ac)?Qe():-1!==Zc?Zc:Zc=Qe()}function tu(e){return 0===(1&e.mode)?1:0!==(2&Ac)&&0!==kc?kc&-kc:null!==go.transition?(0===$c&&($c=mt()),$c):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function nu(e,t,n,r){if(50<Xc)throw Xc=0,Qc=null,Error(o(185));_t(e,n,r),0!==(2&Ac)&&e===Oc||(e===Oc&&(0===(2&Ac)&&(Uc|=n),4===Lc&&au(e,kc)),ru(e,r),1===n&&0===Ac&&0===(1&t.mode)&&(Gc=Qe()+500,ji&&Gi()))}function ru(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,c=i[s];-1===c?0!==(a&n)&&0===(a&r)||(i[s]=pt(a,t)):c<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var r=ht(e,e===Oc?kc:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){ji=!0,Bi(e)}(cu.bind(null,e)):Bi(cu.bind(null,e)),si((function(){0===(6&Ac)&&Gi()})),n=null;else{switch(yt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ou(n,iu.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function iu(e,t){if(Zc=-1,$c=0,0!==(6&Ac))throw Error(o(327));var n=e.callbackNode;if(Tu()&&e.callbackNode!==n)return null;var r=ht(e,e===Oc?kc:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gu(e,r);else{t=r;var i=Ac;Ac|=2;var s=fu();for(Oc===e&&kc===t||(qc=null,Gc=Qe()+500,hu(e,t));;)try{Eu();break}catch(c){pu(e,c)}Co(),Rc.current=s,Ac=i,null!==Nc?t=0:(Oc=null,kc=0,t=Lc)}if(0!==t){if(2===t&&(0!==(i=ft(e))&&(r=i,t=ou(e,i))),1===t)throw n=Mc,hu(e,0),au(e,r),ru(e,Qe()),n;if(6===t)au(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!ar(o(),i))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gu(e,r))&&(0!==(s=ft(e))&&(r=s,t=ou(e,s))),1===t))throw n=Mc,hu(e,0),au(e,r),ru(e,Qe()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:bu(e,Vc,qc);break;case 3:if(au(e,r),(130023424&r)===r&&10<(t=Bc+500-Qe())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){eu(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(bu.bind(null,e,Vc,qc),t);break}bu(e,Vc,qc);break;case 4:if(au(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-st(r);s=1<<a,(a=t[a])>i&&(i=a),r&=~s}if(r=i,10<(r=(120>(r=Qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*wc(r/1960))-r)){e.timeoutHandle=ri(bu.bind(null,e,Vc,qc),r);break}bu(e,Vc,qc);break;default:throw Error(o(329))}}}return ru(e,Qe()),e.callbackNode===n?iu.bind(null,e):null}function ou(e,t){var n=jc;return e.current.memoizedState.isDehydrated&&(hu(e,t).flags|=256),2!==(e=gu(e,t))&&(t=Vc,Vc=n,null!==t&&su(t)),e}function su(e){null===Vc?Vc=e:Vc.push.apply(Vc,e)}function au(e,t){for(t&=~Fc,t&=~Uc,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function cu(e){if(0!==(6&Ac))throw Error(o(327));Tu();var t=ht(e,0);if(0===(1&t))return ru(e,Qe()),null;var n=gu(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=ou(e,r))}if(1===n)throw n=Mc,hu(e,0),au(e,t),ru(e,Qe()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bu(e,Vc,qc),ru(e,Qe()),null}function uu(e,t){var n=Ac;Ac|=1;try{return e(t)}finally{0===(Ac=n)&&(Gc=Qe()+500,ji&&Gi())}}function lu(e){null!==Yc&&0===Yc.tag&&0===(6&Ac)&&Tu();var t=Ac;Ac|=1;var n=Cc.transition,r=vt;try{if(Cc.transition=null,vt=1,e)return e()}finally{vt=r,Cc.transition=n,0===(6&(Ac=t))&&Gi()}}function du(){Dc=Pc.current,Ri(Pc)}function hu(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Nc)for(n=Nc.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Pi();break;case 3:Qo(),Ri(Oi),Ri(Ai),rs();break;case 5:$o(r);break;case 4:Qo();break;case 13:case 19:Ri(es);break;case 10:Ao(r.type._context);break;case 22:case 23:du()}n=n.return}if(Oc=e,Nc=e=Pu(e.current,null),kc=Dc=t,Lc=0,Mc=null,Fc=Uc=xc=0,Vc=jc=null,null!==Do){for(t=0;t<Do.length;t++)if(null!==(r=(n=Do[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var s=o.next;o.next=i,r.next=s}n.pending=r}Do=null}return e}function pu(e,t){for(;;){var n=Nc;try{if(Co(),is.current=Zs,ls){for(var r=as.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ls=!1}if(ss=0,us=cs=as=null,ds=!1,hs=0,Ic.current=null,null===n||null===n.return){Lc=1,Mc=t,Nc=null;break}e:{var s=e,a=n.return,c=n,u=t;if(t=kc,c.flags|=32768,null!==u&&"object"===typeof u&&"function"===typeof u.then){var l=u,d=c,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=ga(a);if(null!==f){f.flags&=-257,_a(f,a,c,0,t),1&f.mode&&ma(s,l,t),u=l;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(u),t.updateQueue=g}else m.add(u);break e}if(0===(1&t)){ma(s,l,t),mu();break e}u=Error(o(426))}else if(io&&1&c.mode){var _=ga(a);if(null!==_){0===(65536&_.flags)&&(_.flags|=256),_a(_,a,c,0,t),mo(ua(u,c));break e}}s=u=ua(u,c),4!==Lc&&(Lc=2),null===jc?jc=[s]:jc.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Go(s,pa(0,u,t));break e;case 1:c=u;var E=s.type,v=s.stateNode;if(0===(128&s.flags)&&("function"===typeof E.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Kc||!Kc.has(v)))){s.flags|=65536,t&=-t,s.lanes|=t,Go(s,fa(s,c,t));break e}}s=s.return}while(null!==s)}yu(n)}catch(y){t=y,Nc===n&&null!==n&&(Nc=n=n.return);continue}break}}function fu(){var e=Rc.current;return Rc.current=Zs,null===e?Zs:e}function mu(){0!==Lc&&3!==Lc&&2!==Lc||(Lc=4),null===Oc||0===(268435455&xc)&&0===(268435455&Uc)||au(Oc,kc)}function gu(e,t){var n=Ac;Ac|=2;var r=fu();for(Oc===e&&kc===t||(qc=null,hu(e,t));;)try{_u();break}catch(i){pu(e,i)}if(Co(),Ac=n,Rc.current=r,null!==Nc)throw Error(o(261));return Oc=null,kc=0,Lc}function _u(){for(;null!==Nc;)vu(Nc)}function Eu(){for(;null!==Nc&&!Je();)vu(Nc)}function vu(e){var t=Sc(e.alternate,e,Dc);e.memoizedProps=e.pendingProps,null===t?yu(e):Nc=t,Ic.current=null}function yu(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=za(n,t,Dc)))return void(Nc=n)}else{if(null!==(n=Ya(n,t)))return n.flags&=32767,void(Nc=n);if(null===e)return Lc=6,void(Nc=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nc=t);Nc=t=e}while(null!==t);0===Lc&&(Lc=5)}function bu(e,t,n){var r=vt,i=Cc.transition;try{Cc.transition=null,vt=1,function(e,t,n,r){do{Tu()}while(null!==Yc);if(0!==(6&Ac))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,s),e===Oc&&(Nc=Oc=null,kc=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||zc||(zc=!0,Ou(tt,(function(){return Tu(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Cc.transition,Cc.transition=null;var a=vt;vt=1;var c=Ac;Ac|=4,Ic.current=null,function(e,t){if(ei=Wt,pr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(b){n=null;break e}var a=0,c=-1,u=-1,l=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==i&&3!==h.nodeType||(c=a+i),h!==s||0!==r&&3!==h.nodeType||(u=a+r),3===h.nodeType&&(a+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++l===i&&(c=a),p===s&&++d===r&&(u=a),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===c||-1===u?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Wt=!1,Za=t;null!==Za;)if(e=(t=Za).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Za=e;else for(;null!==Za;){t=Za;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,_=m.memoizedState,E=t.stateNode,v=E.getSnapshotBeforeUpdate(t.elementType===t.type?g:na(t.type,g),_);E.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(o(163))}}catch(b){wu(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,Za=e;break}Za=t.return}m=tc,tc=!1}(e,n),gc(n,e),fr(ti),Wt=!!ei,ti=ei=null,e.current=n,Ec(n,e,i),Xe(),Ac=c,vt=a,Cc.transition=s}else e.current=n;if(zc&&(zc=!1,Yc=e,Jc=i),s=e.pendingLanes,0===s&&(Kc=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ru(e,Qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Wc)throw Wc=!1,e=Hc,Hc=null,e;0!==(1&Jc)&&0!==e.tag&&Tu(),s=e.pendingLanes,0!==(1&s)?e===Qc?Xc++:(Xc=0,Qc=e):Xc=0,Gi()}(e,t,n,r)}finally{Cc.transition=i,vt=r}return null}function Tu(){if(null!==Yc){var e=yt(Jc),t=Cc.transition,n=vt;try{if(Cc.transition=null,vt=16>e?16:e,null===Yc)var r=!1;else{if(e=Yc,Yc=null,Jc=0,0!==(6&Ac))throw Error(o(331));var i=Ac;for(Ac|=4,Za=e.current;null!==Za;){var s=Za,a=s.child;if(0!==(16&Za.flags)){var c=s.deletions;if(null!==c){for(var u=0;u<c.length;u++){var l=c[u];for(Za=l;null!==Za;){var d=Za;switch(d.tag){case 0:case 11:case 15:nc(8,d,s)}var h=d.child;if(null!==h)h.return=d,Za=h;else for(;null!==Za;){var p=(d=Za).sibling,f=d.return;if(oc(d),d===l){Za=null;break}if(null!==p){p.return=f,Za=p;break}Za=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(null!==g)}}Za=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,Za=a;else e:for(;null!==Za;){if(0!==(2048&(s=Za).flags))switch(s.tag){case 0:case 11:case 15:nc(9,s,s.return)}var E=s.sibling;if(null!==E){E.return=s.return,Za=E;break e}Za=s.return}}var v=e.current;for(Za=v;null!==Za;){var y=(a=Za).child;if(0!==(2064&a.subtreeFlags)&&null!==y)y.return=a,Za=y;else e:for(a=v;null!==Za;){if(0!==(2048&(c=Za).flags))try{switch(c.tag){case 0:case 11:case 15:rc(9,c)}}catch(T){wu(c,c.return,T)}if(c===a){Za=null;break e}var b=c.sibling;if(null!==b){b.return=c.return,Za=b;break e}Za=c.return}}if(Ac=i,Gi(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(T){}r=!0}return r}finally{vt=n,Cc.transition=t}}return!1}function Su(e,t,n){e=Vo(e,t=pa(0,t=ua(n,t),1),1),t=eu(),null!==e&&(_t(e,1,t),ru(e,t))}function wu(e,t,n){if(3===e.tag)Su(e,e,n);else for(;null!==t;){if(3===t.tag){Su(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Kc||!Kc.has(r))){t=Vo(t,e=fa(t,e=ua(n,e),1),1),e=eu(),null!==t&&(_t(t,1,e),ru(t,e));break}}t=t.return}}function Ru(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=eu(),e.pingedLanes|=e.suspendedLanes&n,Oc===e&&(kc&n)===n&&(4===Lc||3===Lc&&(130023424&kc)===kc&&500>Qe()-Bc?hu(e,0):Fc|=n),ru(e,t)}function Iu(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=eu();null!==(e=Mo(e,t))&&(_t(e,t,n),ru(e,n))}function Cu(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Iu(e,n)}function Au(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Iu(e,n)}function Ou(e,t){return ze(e,t)}function Nu(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ku(e,t,n,r){return new Nu(e,t,n,r)}function Du(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pu(e,t){var n=e.alternate;return null===n?((n=ku(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lu(e,t,n,r,i,s){var a=2;if(r=e,"function"===typeof e)Du(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case S:return Mu(n.children,i,s,t);case w:a=8,i|=8;break;case R:return(e=ku(12,n,t,2|i)).elementType=R,e.lanes=s,e;case O:return(e=ku(13,n,t,i)).elementType=O,e.lanes=s,e;case N:return(e=ku(19,n,t,i)).elementType=N,e.lanes=s,e;case P:return xu(n,i,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case I:a=10;break e;case C:a=9;break e;case A:a=11;break e;case k:a=14;break e;case D:a=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=ku(a,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function Mu(e,t,n,r){return(e=ku(7,e,r,t)).lanes=n,e}function xu(e,t,n,r){return(e=ku(22,e,r,t)).elementType=P,e.lanes=n,e.stateNode={isHidden:!1},e}function Uu(e,t,n){return(e=ku(6,e,null,t)).lanes=n,e}function Fu(e,t,n){return(t=ku(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ju(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Vu(e,t,n,r,i,o,s,a,c){return e=new ju(e,t,n,a,c),1===t?(t=1,!0===o&&(t|=8)):t=0,o=ku(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uo(o),e}function Bu(e){if(!e)return Ci;e:{if(Ge(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Di(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Di(n))return Mi(e,n,t)}return t}function Gu(e,t,n,r,i,o,s,a,c){return(e=Vu(n,r,!0,e,0,o,0,a,c)).context=Bu(null),n=e.current,(o=jo(r=eu(),i=tu(n))).callback=void 0!==t&&null!==t?t:null,Vo(n,o,i),e.current.lanes=i,_t(e,i,r),ru(e,r),e}function qu(e,t,n,r){var i=t.current,o=eu(),s=tu(i);return n=Bu(n),null===t.context?t.context=n:t.pendingContext=n,(t=jo(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Vo(i,t,s))&&(nu(e,i,s,o),Bo(e,i,s)),s}function Wu(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Ku(e,t){Hu(e,t),(e=e.alternate)&&Hu(e,t)}Sc=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Oi.current)va=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return va=!1,function(e,t,n){switch(t.tag){case 3:Oa(t),fo();break;case 5:Zo(t);break;case 1:Di(t.type)&&xi(t);break;case 4:Xo(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ii(So,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ii(es,1&es.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ua(e,t,n):(Ii(es,1&es.current),null!==(e=Wa(e,t,n))?e.sibling:null);Ii(es,1&es.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ga(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ii(es,es.current),r)break;return null;case 22:case 23:return t.lanes=0,wa(e,t,n)}return Wa(e,t,n)}(e,t,n);va=0!==(131072&e.flags)}else va=!1,io&&0!==(1048576&t.flags)&&$i(t,Ki,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;qa(e,t),e=t.pendingProps;var i=ki(t,Ai.current);No(t,n),i=gs(null,t,r,e,i,n);var s=_s();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Di(r)?(s=!0,xi(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Uo(t),i.updater=ia,t.stateNode=i,i._reactInternals=t,ca(t,r,e,n),t=Aa(null,t,r,!0,s,n)):(t.tag=0,io&&s&&eo(t),ya(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(qa(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Du(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===k)return 14}return 2}(r),e=na(r,e),i){case 0:t=Ia(null,t,r,e,n);break e;case 1:t=Ca(null,t,r,e,n);break e;case 11:t=ba(null,t,r,e,n);break e;case 14:t=Ta(null,t,r,na(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ia(e,t,r,i=t.elementType===r?i:na(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ca(e,t,r,i=t.elementType===r?i:na(r,i),n);case 3:e:{if(Oa(t),null===e)throw Error(o(387));r=t.pendingProps,i=(s=t.memoizedState).element,Fo(e,t),qo(t,r,null,n);var a=t.memoizedState;if(r=a.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Na(e,t,r,n,i=ua(Error(o(423)),t));break e}if(r!==i){t=Na(e,t,r,n,i=ua(Error(o(424)),t));break e}for(ro=ui(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=To(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fo(),r===i){t=Wa(e,t,n);break e}ya(e,t,r,n)}t=t.child}return t;case 5:return Zo(t),null===e&&uo(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,a=i.children,ni(r,i)?a=null:null!==s&&ni(r,s)&&(t.flags|=32),Ra(e,t),ya(e,t,a,n),t.child;case 6:return null===e&&uo(t),null;case 13:return Ua(e,t,n);case 4:return Xo(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=bo(t,null,r,n):ya(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,ba(e,t,r,i=t.elementType===r?i:na(r,i),n);case 7:return ya(e,t,t.pendingProps,n),t.child;case 8:case 12:return ya(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value,Ii(So,r._currentValue),r._currentValue=a,null!==s)if(ar(s.value,a)){if(s.children===i.children&&!Oi.current){t=Wa(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var c=s.dependencies;if(null!==c){a=s.child;for(var u=c.firstContext;null!==u;){if(u.context===r){if(1===s.tag){(u=jo(-1,n&-n)).tag=2;var l=s.updateQueue;if(null!==l){var d=(l=l.shared).pending;null===d?u.next=u:(u.next=d.next,d.next=u),l.pending=u}}s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Oo(s.return,n,t),c.lanes|=n;break}u=u.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Oo(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}ya(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,No(t,n),r=r(i=ko(i)),t.flags|=1,ya(e,t,r,n),t.child;case 14:return i=na(r=t.type,t.pendingProps),Ta(e,t,r,i=na(r.type,i),n);case 15:return Sa(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:na(r,i),qa(e,t),t.tag=1,Di(r)?(e=!0,xi(t)):e=!1,No(t,n),sa(t,r,i),ca(t,r,i,n),Aa(null,t,r,!0,e,n);case 19:return Ga(e,t,n);case 22:return wa(e,t,n)}throw Error(o(156,t.tag))};var zu="function"===typeof reportError?reportError:function(e){console.error(e)};function Yu(e){this._internalRoot=e}function Ju(e){this._internalRoot=e}function Xu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Qu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zu(){}function $u(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof i){var a=i;i=function(){var e=Wu(s);a.call(e)}}qu(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"===typeof r){var o=r;r=function(){var e=Wu(s);o.call(e)}}var s=Gu(t,r,e,0,null,!1,0,"",Zu);return e._reactRootContainer=s,e[fi]=s.current,Gr(8===e.nodeType?e.parentNode:e),lu(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var a=r;r=function(){var e=Wu(c);a.call(e)}}var c=Vu(e,0,!1,null,0,!1,0,"",Zu);return e._reactRootContainer=c,e[fi]=c.current,Gr(8===e.nodeType?e.parentNode:e),lu((function(){qu(t,c,n,r)})),c}(n,t,e,i,r);return Wu(s)}Ju.prototype.render=Yu.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));qu(e,t,null,null)},Ju.prototype.unmount=Yu.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lu((function(){qu(null,e,null,null)})),t[fi]=null}},Ju.prototype.unstable_scheduleHydration=function(e){if(e){var t=wt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Pt.length&&0!==t&&t<Pt[n].priority;n++);Pt.splice(n,0,e),0===n&&Ut(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(Et(t,1|n),ru(t,Qe()),0===(6&Ac)&&(Gc=Qe()+500,Gi()))}break;case 13:lu((function(){var t=Mo(e,1);if(null!==t){var n=eu();nu(t,e,1,n)}})),Ku(e,1)}},Tt=function(e){if(13===e.tag){var t=Mo(e,134217728);if(null!==t)nu(t,e,134217728,eu());Ku(e,134217728)}},St=function(e){if(13===e.tag){var t=tu(e),n=Mo(e,t);if(null!==n)nu(n,e,t,eu());Ku(e,t)}},wt=function(){return vt},Rt=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}},Te=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=bi(r);if(!i)throw Error(o(90));z(r),Z(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ae=uu,Oe=lu;var el={usingClientEntryPoint:!1,Events:[vi,yi,bi,Ie,Ce,uu]},tl={findFiberByHostInstance:Ei,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nl={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rl.isDisabled&&rl.supportsFiber)try{it=rl.inject(nl),ot=rl}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=el,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Xu(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:T,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Xu(e))throw Error(o(299));var n=!1,r="",i=zu;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Vu(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Gr(8===e.nodeType?e.parentNode:e),new Yu(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return lu(e)},t.hydrate=function(e,t,n){if(!Qu(t))throw Error(o(200));return $u(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Xu(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",a=zu;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Gu(t,null,e,1,null!=n?n:null,i,0,s,a),e[fi]=t.current,Gr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Ju(t)},t.render=function(e,t,n){if(!Qu(t))throw Error(o(200));return $u(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Qu(e))throw Error(o(40));return!!e._reactRootContainer&&(lu((function(){$u(null,null,e,!1,(function(){e._reactRootContainer=null,e[fi]=null}))})),!0)},t.unstable_batchedUpdates=uu,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Qu(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return $u(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},391:(e,t,n)=>{"use strict";var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)},153:(e,t,n)=>{"use strict";var r=n(43),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var r,o={},u=null,l=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(l=t.ref),t)s.call(t,r)&&!c.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:u,ref:l,props:o,_owner:a.current}}t.jsx=u,t.jsxs=u},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function E(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},E.prototype=_.prototype;var y=v.prototype=new E;y.constructor=v,m(y,_.prototype),y.isPureReactComponent=!0;var b=Array.isArray,T=Object.prototype.hasOwnProperty,S={current:null},w={key:!0,ref:!0,__self:!0,__source:!0};function R(e,t,r){var i,o={},s=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)T.call(t,i)&&!w.hasOwnProperty(i)&&(o[i]=t[i]);var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];o.children=u}if(e&&e.defaultProps)for(i in c=e.defaultProps)void 0===o[i]&&(o[i]=c[i]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:S.current}}function I(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,i,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var c=!1;if(null===e)c=!0;else switch(a){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case n:case r:c=!0}}if(c)return s=s(c=e),e=""===o?"."+A(c,0):o,b(s)?(i="",null!=e&&(i=e.replace(C,"$&/")+"/"),O(s,t,i,"",(function(e){return e}))):null!=s&&(I(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(C,"$&/")+"/")+e)),t.push(s)),1;if(c=0,o=""===o?".":o+":",b(e))for(var u=0;u<e.length;u++){var l=o+A(a=e[u],u);c+=O(a,t,i,l,s)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),u=0;!(a=e.next()).done;)c+=O(a=a.value,t,i,l=o+A(a,u++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function N(e,t,n){if(null==e)return e;var r=[],i=0;return O(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},P={transition:null},L={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:P,ReactCurrentOwner:S};function M(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:N,forEach:function(e,t,n){N(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return N(e,(function(){t++})),t},toArray:function(e){return N(e,(function(e){return e}))||[]},only:function(e){if(!I(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=i,t.Profiler=s,t.PureComponent=v,t.StrictMode=o,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.act=M,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)T.call(t,u)&&!w.hasOwnProperty(u)&&(i[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){c=Array(u);for(var l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}return{$$typeof:n,type:e.type,key:o,ref:s,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=R,t.createFactory=function(e){var t=R.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:u,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=P.transition;P.transition={};try{e()}finally{P.transition=t}},t.unstable_act=M,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},43:(e,t,n)=>{"use strict";e.exports=n(202)},579:(e,t,n)=>{"use strict";e.exports=n(153)},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var a=2*(r+1)-1,c=e[a],u=a+1,l=e[u];if(0>o(c,n))u<i&&0>o(l,c)?(e[r]=l,e[u]=n,r=u):(e[r]=c,e[a]=n,r=a);else{if(!(u<i&&0>o(l,n)))break e;e[r]=l,e[u]=n,r=u}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,c=a.now();t.unstable_now=function(){return a.now()-c}}var u=[],l=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,_="function"===typeof setTimeout?setTimeout:null,E="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function y(e){for(var t=r(l);null!==t;){if(null===t.callback)i(l);else{if(!(t.startTime<=e))break;i(l),t.sortIndex=t.expirationTime,n(u,t)}t=r(l)}}function b(e){if(g=!1,y(e),!m)if(null!==r(u))m=!0,P(T);else{var t=r(l);null!==t&&L(b,t.startTime-e)}}function T(e,n){m=!1,g&&(g=!1,E(I),I=-1),f=!0;var o=p;try{for(y(n),h=r(u);null!==h&&(!(h.expirationTime>n)||e&&!O());){var s=h.callback;if("function"===typeof s){h.callback=null,p=h.priorityLevel;var a=s(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===r(u)&&i(u),y(n)}else i(u);h=r(u)}if(null!==h)var c=!0;else{var d=r(l);null!==d&&L(b,d.startTime-n),c=!1}return c}finally{h=null,p=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,w=!1,R=null,I=-1,C=5,A=-1;function O(){return!(t.unstable_now()-A<C)}function N(){if(null!==R){var e=t.unstable_now();A=e;var n=!0;try{n=R(!0,e)}finally{n?S():(w=!1,R=null)}}else w=!1}if("function"===typeof v)S=function(){v(N)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,D=k.port2;k.port1.onmessage=N,S=function(){D.postMessage(null)}}else S=function(){_(N,0)};function P(e){R=e,w||(w=!0,S())}function L(e,n){I=_((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,P(T))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(u)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(l,e),null===r(u)&&e===r(l)&&(g?(E(I),I=-1):g=!0,L(b,o-s))):(e.sortIndex=a,n(u,e),m||f||(m=!0,P(T))),e},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},853:(e,t,n)=>{"use strict";e.exports=n(234)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;__webpack_require__.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var i=Object.create(null);__webpack_require__.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&r&&n;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>n[e]));return o.default=()=>n,__webpack_require__.d(i,o),i}})(),__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,n)=>(__webpack_require__.f[n](e,t),t)),[])),__webpack_require__.u=e=>"static/js/"+e+".a6a97343.chunk.js",__webpack_require__.miniCssF=e=>{},__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="app:";__webpack_require__.l=(n,r,i,o)=>{if(e[n])e[n].push(r);else{var s,a;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var l=c[u];if(l.getAttribute("src")==n||l.getAttribute("data-webpack")==t+i){s=l;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,__webpack_require__.nc&&s.setAttribute("nonce",__webpack_require__.nc),s.setAttribute("data-webpack",t+i),s.src=n),e[n]=[r];var d=(t,r)=>{s.onerror=s.onload=null,clearTimeout(h);var i=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(r))),t)return t(r)},h=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),a&&document.head.appendChild(s)}}})(),__webpack_require__.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),__webpack_require__.p="/chat-app/",(()=>{var e={792:0};__webpack_require__.f.j=(t,n)=>{var r=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=i);var o=__webpack_require__.p+__webpack_require__.u(t),s=new Error;__webpack_require__.l(o,(n=>{if(__webpack_require__.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,r[1](s)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,i,o=n[0],s=n[1],a=n[2],c=0;if(o.some((t=>0!==e[t]))){for(r in s)__webpack_require__.o(s,r)&&(__webpack_require__.m[r]=s[r]);if(a)a(__webpack_require__)}for(t&&t(n);c<o.length;c++)i=o[c],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunkapp=self.webpackChunkapp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var __webpack_exports__={};(()=>{"use strict";var e,t=__webpack_require__(43),n=__webpack_require__.t(t,2),r=__webpack_require__(391);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const o="popstate";function s(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function a(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function c(e,t){return{usr:e.state,key:e.key,idx:t}}function u(e,t,n,r){return void 0===n&&(n=null),i({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?d(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function l(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function d(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function h(t,n,r,a){void 0===a&&(a={});let{window:d=document.defaultView,v5Compat:h=!1}=a,p=d.history,f=e.Pop,m=null,g=_();function _(){return(p.state||{idx:null}).idx}function E(){f=e.Pop;let t=_(),n=null==t?null:t-g;g=t,m&&m({action:f,location:y.location,delta:n})}function v(e){let t="null"!==d.location.origin?d.location.origin:d.location.href,n="string"===typeof e?e:l(e);return n=n.replace(/ $/,"%20"),s(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,p.replaceState(i({},p.state,{idx:g}),""));let y={get action(){return f},get location(){return t(d,p)},listen(e){if(m)throw new Error("A history only accepts one active listener");return d.addEventListener(o,E),m=e,()=>{d.removeEventListener(o,E),m=null}},createHref:e=>n(d,e),createURL:v,encodeLocation(e){let t=v(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){f=e.Push;let i=u(y.location,t,n);r&&r(i,t),g=_()+1;let o=c(i,g),s=y.createHref(i);try{p.pushState(o,"",s)}catch(a){if(a instanceof DOMException&&"DataCloneError"===a.name)throw a;d.location.assign(s)}h&&m&&m({action:f,location:y.location,delta:1})},replace:function(t,n){f=e.Replace;let i=u(y.location,t,n);r&&r(i,t),g=_();let o=c(i,g),s=y.createHref(i);p.replaceState(o,"",s),h&&m&&m({action:f,location:y.location,delta:0})},go:e=>p.go(e)};return y}var p;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(p||(p={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function f(e,t,n){void 0===n&&(n="/");let r=A(("string"===typeof t?d(t):t).pathname||"/",n);if(null==r)return null;let i=m(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(i);let o=null;for(let s=0;null==o&&s<i.length;++s){let e=C(r);o=R(i[s],e)}return o}function m(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,o)=>{let a={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(s(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let c=P([r,a.relativePath]),u=n.concat(a);e.children&&e.children.length>0&&(s(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+c+'".'),m(e.children,t,u,c)),(null!=e.path||e.index)&&t.push({path:c,score:w(c,e.index),routesMeta:u})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of g(e.path))i(e,t,r);else i(e,t)})),t}function g(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===r.length)return i?[o,""]:[o];let s=g(r.join("/")),a=[];return a.push(...s.map((e=>""===e?o:[o,e].join("/")))),i&&a.push(...s),a.map((t=>e.startsWith("/")&&""===t?"/":t))}const _=/^:[\w-]+$/,E=3,v=2,y=1,b=10,T=-2,S=e=>"*"===e;function w(e,t){let n=e.split("/"),r=n.length;return n.some(S)&&(r+=T),t&&(r+=v),n.filter((e=>!S(e))).reduce(((e,t)=>e+(_.test(t)?E:""===t?y:b)),r)}function R(e,t){let{routesMeta:n}=e,r={},i="/",o=[];for(let s=0;s<n.length;++s){let e=n[s],a=s===n.length-1,c="/"===i?t:t.slice(i.length)||"/",u=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:a},c);if(!u)return null;Object.assign(r,u.params);let l=e.route;o.push({params:r,pathname:P([i,u.pathname]),pathnameBase:L(P([i,u.pathnameBase])),route:l}),"/"!==u.pathnameBase&&(i=P([i,u.pathnameBase]))}return o}function I(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);a("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let o=new RegExp(i,t?void 0:"i");return[o,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),c=i.slice(1);return{params:r.reduce(((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=c[n]||"";s=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const a=c[n];return e[r]=i&&!a?void 0:(a||"").replace(/%2F/g,"/"),e}),{}),pathname:o,pathnameBase:s,pattern:e}}function C(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return a(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function A(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function O(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function N(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function k(e,t){let n=N(e);return t?n.map(((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)):n.map((e=>e.pathnameBase))}function D(e,t,n,r){let o;void 0===r&&(r=!1),"string"===typeof e?o=d(e):(o=i({},e),s(!o.pathname||!o.pathname.includes("?"),O("?","pathname","search",o)),s(!o.pathname||!o.pathname.includes("#"),O("#","pathname","hash",o)),s(!o.search||!o.search.includes("#"),O("#","search","hash",o)));let a,c=""===e||""===o.pathname,u=c?"/":o.pathname;if(null==u)a=n;else{let e=t.length-1;if(!r&&u.startsWith("..")){let t=u.split("/");for(;".."===t[0];)t.shift(),e-=1;o.pathname=t.join("/")}a=e>=0?t[e]:"/"}let l=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:i=""}="string"===typeof e?d(e):e,o=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:o,search:M(r),hash:x(i)}}(o,a),h=u&&"/"!==u&&u.endsWith("/"),p=(c||"."===u)&&n.endsWith("/");return l.pathname.endsWith("/")||!h&&!p||(l.pathname+="/"),l}const P=e=>e.join("/").replace(/\/\/+/g,"/"),L=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),M=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",x=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function U(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const F=["post","put","patch","delete"],j=(new Set(F),["get",...F]);new Set(j),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},V.apply(this,arguments)}const B=t.createContext(null);const G=t.createContext(null);const q=t.createContext(null);const W=t.createContext(null);const H=t.createContext({outlet:null,matches:[],isDataRoute:!1});const K=t.createContext(null);function z(){return null!=t.useContext(W)}function Y(){return z()||s(!1),t.useContext(W).location}function J(e){t.useContext(q).static||t.useLayoutEffect(e)}function X(){let{isDataRoute:e}=t.useContext(H);return e?function(){let{router:e}=se(ie.UseNavigateStable),n=ce(oe.UseNavigateStable),r=t.useRef(!1);return J((()=>{r.current=!0})),t.useCallback((function(t,i){void 0===i&&(i={}),r.current&&("number"===typeof t?e.navigate(t):e.navigate(t,V({fromRouteId:n},i)))}),[e,n])}():function(){z()||s(!1);let e=t.useContext(B),{basename:n,future:r,navigator:i}=t.useContext(q),{matches:o}=t.useContext(H),{pathname:a}=Y(),c=JSON.stringify(k(o,r.v7_relativeSplatPath)),u=t.useRef(!1);return J((()=>{u.current=!0})),t.useCallback((function(t,r){if(void 0===r&&(r={}),!u.current)return;if("number"===typeof t)return void i.go(t);let o=D(t,JSON.parse(c),a,"path"===r.relative);null==e&&"/"!==n&&(o.pathname="/"===o.pathname?n:P([n,o.pathname])),(r.replace?i.replace:i.push)(o,r.state,r)}),[n,i,c,a,e])}()}function Q(e,n){let{relative:r}=void 0===n?{}:n,{future:i}=t.useContext(q),{matches:o}=t.useContext(H),{pathname:s}=Y(),a=JSON.stringify(k(o,i.v7_relativeSplatPath));return t.useMemo((()=>D(e,JSON.parse(a),s,"path"===r)),[e,a,s,r])}function Z(n,r,i,o){z()||s(!1);let{navigator:a}=t.useContext(q),{matches:c}=t.useContext(H),u=c[c.length-1],l=u?u.params:{},h=(u&&u.pathname,u?u.pathnameBase:"/");u&&u.route;let p,m=Y();if(r){var g;let e="string"===typeof r?d(r):r;"/"===h||(null==(g=e.pathname)?void 0:g.startsWith(h))||s(!1),p=e}else p=m;let _=p.pathname||"/",E=_;if("/"!==h){let e=h.replace(/^\//,"").split("/");E="/"+_.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=f(n,{pathname:E});let y=re(v&&v.map((e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:P([h,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?h:P([h,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),c,i,o);return r&&y?t.createElement(W.Provider,{value:{location:V({pathname:"/",search:"",hash:"",state:null,key:"default"},p),navigationType:e.Pop}},y):y}function $(){let e=function(){var e;let n=t.useContext(K),r=ae(oe.UseRouteError),i=ce(oe.UseRouteError);if(void 0!==n)return n;return null==(e=r.errors)?void 0:e[i]}(),n=U(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:i};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:o},r):null,null)}const ee=t.createElement($,null);class te extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(H.Provider,{value:this.props.routeContext},t.createElement(K.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ne(e){let{routeContext:n,match:r,children:i}=e,o=t.useContext(B);return o&&o.static&&o.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(H.Provider,{value:n},i)}function re(e,n,r,i){var o;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),null==e){var a;if(null==(a=r)||!a.errors)return null;e=r.matches}let c=e,u=null==(o=r)?void 0:o.errors;if(null!=u){let e=c.findIndex((e=>e.route.id&&void 0!==(null==u?void 0:u[e.route.id])));e>=0||s(!1),c=c.slice(0,Math.min(c.length,e+1))}let l=!1,d=-1;if(r&&i&&i.v7_partialHydration)for(let t=0;t<c.length;t++){let e=c[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(d=t),e.route.id){let{loaderData:t,errors:n}=r,i=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||i){l=!0,c=d>=0?c.slice(0,d+1):[c[0]];break}}}return c.reduceRight(((e,i,o)=>{let s,a=!1,h=null,p=null;var f;r&&(s=u&&i.route.id?u[i.route.id]:void 0,h=i.route.errorElement||ee,l&&(d<0&&0===o?(f="route-fallback",!1||ue[f]||(ue[f]=!0),a=!0,p=null):d===o&&(a=!0,p=i.route.hydrateFallbackElement||null)));let m=n.concat(c.slice(0,o+1)),g=()=>{let n;return n=s?h:a?p:i.route.Component?t.createElement(i.route.Component,null):i.route.element?i.route.element:e,t.createElement(ne,{match:i,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:n})};return r&&(i.route.ErrorBoundary||i.route.errorElement||0===o)?t.createElement(te,{location:r.location,revalidation:r.revalidation,component:h,error:s,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var ie=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ie||{}),oe=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(oe||{});function se(e){let n=t.useContext(B);return n||s(!1),n}function ae(e){let n=t.useContext(G);return n||s(!1),n}function ce(e){let n=function(e){let n=t.useContext(H);return n||s(!1),n}(),r=n.matches[n.matches.length-1];return r.route.id||s(!1),r.route.id}const ue={};n.startTransition;function le(e){let{to:n,replace:r,state:i,relative:o}=e;z()||s(!1);let{future:a,static:c}=t.useContext(q),{matches:u}=t.useContext(H),{pathname:l}=Y(),d=X(),h=D(n,k(u,a.v7_relativeSplatPath),l,"path"===o),p=JSON.stringify(h);return t.useEffect((()=>d(JSON.parse(p),{replace:r,state:i,relative:o})),[d,p,o,r,i]),null}function de(e){s(!1)}function he(n){let{basename:r="/",children:i=null,location:o,navigationType:a=e.Pop,navigator:c,static:u=!1,future:l}=n;z()&&s(!1);let h=r.replace(/^\/*/,"/"),p=t.useMemo((()=>({basename:h,navigator:c,static:u,future:V({v7_relativeSplatPath:!1},l)})),[h,l,c,u]);"string"===typeof o&&(o=d(o));let{pathname:f="/",search:m="",hash:g="",state:_=null,key:E="default"}=o,v=t.useMemo((()=>{let e=A(f,h);return null==e?null:{location:{pathname:e,search:m,hash:g,state:_,key:E},navigationType:a}}),[h,f,m,g,_,E,a]);return null==v?null:t.createElement(q.Provider,{value:p},t.createElement(W.Provider,{children:i,value:v}))}function pe(e){let{children:t,location:n}=e;return Z(fe(t),n)}new Promise((()=>{}));t.Component;function fe(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,((e,i)=>{if(!t.isValidElement(e))return;let o=[...n,i];if(e.type===t.Fragment)return void r.push.apply(r,fe(e.props.children,o));e.type!==de&&s(!1),e.props.index&&e.props.children&&s(!1);let a={id:e.props.id||o.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=fe(e.props.children,o)),r.push(a)})),r}var me=__webpack_require__(950),ge=__webpack_require__.t(me,2);function _e(){return _e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_e.apply(this,arguments)}function Ee(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const ve=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(Jg){}new Map;const ye=n.startTransition;ge.flushSync,n.useId;function be(e){let{basename:n,children:r,future:i,window:o}=e,s=t.useRef();var a;null==s.current&&(s.current=(void 0===(a={window:o,v5Compat:!0})&&(a={}),h((function(e,t){let{pathname:n,search:r,hash:i}=e.location;return u("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:l(t)}),null,a)));let c=s.current,[d,p]=t.useState({action:c.action,location:c.location}),{v7_startTransition:f}=i||{},m=t.useCallback((e=>{f&&ye?ye((()=>p(e))):p(e)}),[p,f]);return t.useLayoutEffect((()=>c.listen(m)),[c,m]),t.createElement(he,{basename:n,children:r,location:d.location,navigationType:d.action,navigator:c,future:i})}const Te="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Se=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,we=t.forwardRef((function(e,n){let r,{onClick:i,relative:o,reloadDocument:a,replace:c,state:u,target:d,to:h,preventScrollReset:p,unstable_viewTransition:f}=e,m=Ee(e,ve),{basename:g}=t.useContext(q),_=!1;if("string"===typeof h&&Se.test(h)&&(r=h,Te))try{let e=new URL(window.location.href),t=h.startsWith("//")?new URL(e.protocol+h):new URL(h),n=A(t.pathname,g);t.origin===e.origin&&null!=n?h=n+t.search+t.hash:_=!0}catch(Jg){}let E=function(e,n){let{relative:r}=void 0===n?{}:n;z()||s(!1);let{basename:i,navigator:o}=t.useContext(q),{hash:a,pathname:c,search:u}=Q(e,{relative:r}),l=c;return"/"!==i&&(l="/"===c?i:P([i,c])),o.createHref({pathname:l,search:u,hash:a})}(h,{relative:o}),v=function(e,n){let{target:r,replace:i,state:o,preventScrollReset:s,relative:a,unstable_viewTransition:c}=void 0===n?{}:n,u=X(),d=Y(),h=Q(e,{relative:a});return t.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,r)){t.preventDefault();let n=void 0!==i?i:l(d)===l(h);u(e,{replace:n,state:o,preventScrollReset:s,relative:a,unstable_viewTransition:c})}}),[d,u,h,i,o,r,e,s,a,c])}(h,{replace:c,state:u,target:d,preventScrollReset:p,relative:o,unstable_viewTransition:f});return t.createElement("a",_e({},m,{href:r||E,onClick:_||a?i:function(e){i&&i(e),e.defaultPrevented||v(e)},ref:n,target:d}))}));var Re,Ie;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Re||(Re={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ie||(Ie={}));const Ce=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},Ae={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],o=i+1<e.length,s=o?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,u=t>>2,l=(3&t)<<4|s>>4;let d=(15&s)<<2|c>>6,h=63&c;a||(h=64,o||(d=64)),r.push(n[u],n[l],n[d],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Ce(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){const o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{const o=e[n++],s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0;++i;const s=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==o||null==s||null==a)throw new Oe;const c=t<<2|o>>4;if(r.push(c),64!==s){const e=o<<4&240|s>>2;if(r.push(e),64!==a){const e=s<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Oe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ne=function(e){return function(e){const t=Ce(e);return Ae.encodeByteArray(t,!0)}(e).replace(/\./g,"")},ke=function(e){try{return Ae.decodeString(e,!0)}catch(Jg){console.error("base64Decode failed: ",Jg)}return null};const De=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof __webpack_require__.g)return __webpack_require__.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,Pe=()=>{try{return De()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/chat-app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(Jg){return}const t=e&&ke(e[1]);return t&&JSON.parse(t)})()}catch(Jg){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(Jg))}},Le=e=>{var t,n;return null===(n=null===(t=Pe())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},Me=e=>{const t=Le(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},xe=()=>{var e;return null===(e=Pe())||void 0===e?void 0:e.config},Ue=e=>{var t;return null===(t=Pe())||void 0===t?void 0:t["_".concat(e)]};class Fe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function je(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Ne(JSON.stringify({alg:"none",type:"JWT"})),Ne(JSON.stringify(o)),""].join(".")}function Ve(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function Be(){return!function(){var e;const t=null===(e=Pe())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(__webpack_require__.g.process)}catch(Jg){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ge(){try{return"object"===typeof indexedDB}catch(Jg){return!1}}class qe extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,qe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,We.prototype.create)}}class We{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(He,((e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}(r,t):"Error",o="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new qe(n,o,t)}}const He=/\{\$([^}]+)}/g;function Ke(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],o=t[i];if(ze(n)&&ze(o)){if(!Ke(n,o))return!1}else if(n!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function ze(e){return null!==e&&"object"===typeof e}function Ye(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Je(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function Xe(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Qe{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Ze),void 0===r.error&&(r.error=Ze),void 0===r.complete&&(r.complete=Ze);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(Jg){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(Jg){"undefined"!==typeof console&&console.error&&console.error(Jg)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function Ze(){}function $e(e){return e&&e._delegate?e._delegate:e}class et{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const tt="[DEFAULT]";class nt{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Fe;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(Jg){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(Jg){if(r)return null;throw Jg}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:tt})}catch(Jg){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(Jg){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tt;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tt;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tt;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&o.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===tt?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(o){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:tt;return this.component?this.component.multipleInstances?e:tt:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class rt{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new nt(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const it=[];var ot;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(ot||(ot={}));const st={debug:ot.DEBUG,verbose:ot.VERBOSE,info:ot.INFO,warn:ot.WARN,error:ot.ERROR,silent:ot.SILENT},at=ot.INFO,ct={[ot.DEBUG]:"log",[ot.VERBOSE]:"log",[ot.INFO]:"info",[ot.WARN]:"warn",[ot.ERROR]:"error"},ut=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=ct[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];console[r]("[".concat(n,"]  ").concat(e.name,":"),...o)};class lt{constructor(e){this.name=e,this._logLevel=at,this._logHandler=ut,this._userLogHandler=null,it.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ot))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?st[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.DEBUG,...t),this._logHandler(this,ot.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.VERBOSE,...t),this._logHandler(this,ot.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.INFO,...t),this._logHandler(this,ot.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.WARN,...t),this._logHandler(this,ot.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ot.ERROR,...t),this._logHandler(this,ot.ERROR,...t)}}const dt=(e,t)=>t.some((t=>e instanceof t));let ht,pt;const ft=new WeakMap,mt=new WeakMap,gt=new WeakMap,_t=new WeakMap,Et=new WeakMap;let vt={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return mt.get(e);if("objectStoreNames"===t)return e.objectStoreNames||gt.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Tt(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function yt(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(pt||(pt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(St(this),n),Tt(ft.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Tt(e.apply(St(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const o=e.call(St(this),t,...r);return gt.set(o,t.sort?t.sort():[t]),Tt(o)}}function bt(e){return"function"===typeof e?yt(e):(e instanceof IDBTransaction&&function(e){if(mt.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));mt.set(e,t)}(e),dt(e,ht||(ht=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,vt):e)}function Tt(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(Tt(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&ft.set(t,e)})).catch((()=>{})),Et.set(t,e),t}(e);if(_t.has(e))return _t.get(e);const t=bt(e);return t!==e&&(_t.set(e,t),Et.set(t,e)),t}const St=e=>Et.get(e);const wt=["get","getKey","getAll","getAllKeys","count"],Rt=["put","add","delete","clear"],It=new Map;function Ct(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(It.get(t))return It.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Rt.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!wt.includes(n))return;const o=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let o=t.store;for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];return r&&(o=o.index(a.shift())),(await Promise.all([o[n](...a),i&&t.done]))[0]};return It.set(t,o),o}vt=(e=>({...e,get:(t,n,r)=>Ct(t,n)||e.get(t,n,r),has:(t,n)=>!!Ct(t,n)||e.has(t,n)}))(vt);class At{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((e=>e)).join(" ")}}const Ot="@firebase/app",Nt="0.10.5",kt=new lt("@firebase/app"),Dt="@firebase/app-compat",Pt="@firebase/analytics-compat",Lt="@firebase/analytics",Mt="@firebase/app-check-compat",xt="@firebase/app-check",Ut="@firebase/auth",Ft="@firebase/auth-compat",jt="@firebase/database",Vt="@firebase/database-compat",Bt="@firebase/functions",Gt="@firebase/functions-compat",qt="@firebase/installations",Wt="@firebase/installations-compat",Ht="@firebase/messaging",Kt="@firebase/messaging-compat",zt="@firebase/performance",Yt="@firebase/performance-compat",Jt="@firebase/remote-config",Xt="@firebase/remote-config-compat",Qt="@firebase/storage",Zt="@firebase/storage-compat",$t="@firebase/firestore",en="@firebase/vertexai-preview",tn="@firebase/firestore-compat",nn="firebase",rn="[DEFAULT]",on={[Ot]:"fire-core",[Dt]:"fire-core-compat",[Lt]:"fire-analytics",[Pt]:"fire-analytics-compat",[xt]:"fire-app-check",[Mt]:"fire-app-check-compat",[Ut]:"fire-auth",[Ft]:"fire-auth-compat",[jt]:"fire-rtdb",[Vt]:"fire-rtdb-compat",[Bt]:"fire-fn",[Gt]:"fire-fn-compat",[qt]:"fire-iid",[Wt]:"fire-iid-compat",[Ht]:"fire-fcm",[Kt]:"fire-fcm-compat",[zt]:"fire-perf",[Yt]:"fire-perf-compat",[Jt]:"fire-rc",[Xt]:"fire-rc-compat",[Qt]:"fire-gcs",[Zt]:"fire-gcs-compat",[$t]:"fire-fst",[tn]:"fire-fst-compat",[en]:"fire-vertex","fire-js":"fire-js",[nn]:"fire-js-all"},sn=new Map,an=new Map,cn=new Map;function un(e,t){try{e.container.addComponent(t)}catch(Jg){kt.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),Jg)}}function ln(e){const t=e.name;if(cn.has(t))return kt.debug("There were multiple attempts to register component ".concat(t,".")),!1;cn.set(t,e);for(const n of sn.values())un(n,e);for(const n of an.values())un(n,e);return!0}function dn(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function hn(e){return void 0!==e.settings}const pn=new We("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class fn{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new et("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw pn.create("app-deleted",{appName:this._name})}}const mn="10.12.2";function gn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const r=Object.assign({name:rn,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw pn.create("bad-app-name",{appName:String(i)});if(n||(n=xe()),!n)throw pn.create("no-options");const o=sn.get(i);if(o){if(Ke(n,o.options)&&Ke(r,o.config))return o;throw pn.create("duplicate-app",{appName:i})}const s=new rt(i);for(const c of cn.values())s.addComponent(c);const a=new fn(n,r,s);return sn.set(i,a),a}function _n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rn;const t=sn.get(e);if(!t&&e===rn&&xe())return gn();if(!t)throw pn.create("no-app",{appName:e});return t}function En(e,t,n){var r;let i=null!==(r=on[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));const o=i.match(/\s|\//),s=t.match(/\s|\//);if(o||s){const e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return o&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),o&&s&&e.push("and"),s&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void kt.warn(e.join(" "))}ln(new et("".concat(i,"-version"),(()=>({library:i,version:t})),"VERSION"))}const vn="firebase-heartbeat-database",yn=1,bn="firebase-heartbeat-store";let Tn=null;function Sn(){return Tn||(Tn=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),a=Tt(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(Tt(s.result),e.oldVersion,e.newVersion,Tt(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{o&&e.addEventListener("close",(()=>o())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(vn,yn,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(bn)}catch(Jg){console.warn(Jg)}}}).catch((e=>{throw pn.create("idb-open",{originalErrorMessage:e.message})}))),Tn}async function wn(e,t){try{const n=(await Sn()).transaction(bn,"readwrite"),r=n.objectStore(bn);await r.put(t,Rn(e)),await n.done}catch(Jg){if(Jg instanceof qe)kt.warn(Jg.message);else{const t=pn.create("idb-set",{originalErrorMessage:null===Jg||void 0===Jg?void 0:Jg.message});kt.warn(t.message)}}}function Rn(e){return"".concat(e.name,"!").concat(e.options.appId)}class In{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new An(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Cn();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Cn(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),On(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),On(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=Ne(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Cn(){return(new Date).toISOString().substring(0,10)}class An{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Ge()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Sn()).transaction(bn),n=await t.objectStore(bn).get(Rn(e));return await t.done,n}catch(Jg){if(Jg instanceof qe)kt.warn(Jg.message);else{const t=pn.create("idb-get",{originalErrorMessage:null===Jg||void 0===Jg?void 0:Jg.message});kt.warn(t.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return wn(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return wn(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function On(e){return Ne(JSON.stringify({version:2,heartbeats:e})).length}var Nn;Nn="",ln(new et("platform-logger",(e=>new At(e)),"PRIVATE")),ln(new et("heartbeat",(e=>new In(e)),"PRIVATE")),En(Ot,Nt,Nn),En(Ot,Nt,"esm2017"),En("fire-js","");function kn(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function Dn(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Pn=Dn,Ln=new We("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Mn=new lt("@firebase/auth");function xn(e){if(Mn.logLevel<=ot.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Mn.error("Auth (".concat(mn,"): ").concat(e),...n)}}function Un(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Bn(e,...n)}function Fn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Bn(e,...n)}function jn(e,t,n){const r=Object.assign(Object.assign({},Pn()),{[t]:n});return new We("auth","Firebase",r).create(t,{appName:e.name})}function Vn(e){return jn(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Bn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return Ln.create(e,...n)}function Gn(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw Bn(t,...r)}}function qn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw xn(t),new Error(t)}function Wn(e,t){e||qn(t)}function Hn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Kn(){return"http:"===zn()||"https:"===zn()}function zn(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function Yn(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Kn()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Jn{constructor(e,t){this.shortDelay=e,this.longDelay=t,Wn(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ve())||"object"===typeof navigator&&"ReactNative"===navigator.product}get(){return Yn()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Xn(e,t){Wn(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class Qn{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void qn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void qn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void qn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Zn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},$n=new Jn(3e4,6e4);function er(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function tr(e,t,n,r){return nr(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},(async()=>{let i={},o={};r&&("GET"===t?o=r:i={body:JSON.stringify(r)});const s=Ye(Object.assign({key:e.config.apiKey},o)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Qn.fetch()(ir(e,e.config.apiHost,n,s),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function nr(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Zn),t);try{const t=new sr(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw ar(e,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const t=i.ok?o.errorMessage:o.error.message,[n,s]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ar(e,"credential-already-in-use",o);if("EMAIL_EXISTS"===n)throw ar(e,"email-already-in-use",o);if("USER_DISABLED"===n)throw ar(e,"user-disabled",o);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(s)throw jn(e,a,s);Un(e,a)}}catch(Jg){if(Jg instanceof qe)throw Jg;Un(e,"network-request-failed",{message:String(Jg)})}}async function rr(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const o=await tr(e,t,n,r,i);return"mfaPendingCredential"in o&&Un(e,"multi-factor-auth-required",{_serverResponse:o}),o}function ir(e,t,n,r){const i="".concat(t).concat(n,"?").concat(r);return e.config.emulator?Xn(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}function or(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class sr{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Fn(this.auth,"network-request-failed"))),$n.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ar(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Fn(e,t,r);return i.customData._tokenResponse=n,i}function cr(e){return void 0!==e&&void 0!==e.enterprise}class ur{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return or(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function lr(e,t){return tr(e,"GET","/v2/recaptchaConfig",er(e,t))}async function dr(e,t){return tr(e,"POST","/v1/accounts:lookup",t)}function hr(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(Jg){}}function pr(e){return 1e3*Number(e)}function fr(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return xn("JWT malformed, contained fewer than 3 sections"),null;try{const e=ke(n);return e?JSON.parse(e):(xn("Failed to decode base64 JWT payload"),null)}catch(Jg){return xn("Caught error parsing JWT payload as JSON",null===Jg||void 0===Jg?void 0:Jg.toString()),null}}function mr(e){const t=fr(e);return Gn(t,"internal-error"),Gn("undefined"!==typeof t.exp,"internal-error"),Gn("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function gr(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(Jg){throw Jg instanceof qe&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(Jg)&&e.auth.currentUser===e&&await e.auth.signOut(),Jg}}class _r{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(Jg){return void((null===Jg||void 0===Jg?void 0:Jg.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class Er{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=hr(this.lastLoginAt),this.creationTime=hr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function vr(e){var t;const n=e.auth,r=await e.getIdToken(),i=await gr(e,dr(n,{idToken:r}));Gn(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const o=i.users[0];e._notifyReloadListener(o);const s=(null===(t=o.providerUserInfo)||void 0===t?void 0:t.length)?yr(o.providerUserInfo):[],a=(c=e.providerData,u=s,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,d=!(e.email&&o.passwordHash)&&!(null===a||void 0===a?void 0:a.length),h=!!l&&d,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:a,metadata:new Er(o.createdAt,o.lastLoginAt),isAnonymous:h};Object.assign(e,p)}function yr(e){return e.map((e=>{var{providerId:t}=e,n=kn(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class br{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Gn(e.idToken,"internal-error"),Gn("undefined"!==typeof e.idToken,"internal-error"),Gn("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):mr(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Gn(0!==e.length,"internal-error");const t=mr(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(Gn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await nr(e,{},(async()=>{const n=Ye({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,o=ir(e,r,"/v1/token","key=".concat(i)),s=await e._getAdditionalHeaders();return s["Content-Type"]="application/x-www-form-urlencoded",Qn.fetch()(o,{method:"POST",headers:s,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,o=new br;return n&&(Gn("string"===typeof n,"internal-error",{appName:e}),o.refreshToken=n),r&&(Gn("string"===typeof r,"internal-error",{appName:e}),o.accessToken=r),i&&(Gn("number"===typeof i,"internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new br,this.toJSON())}_performRefresh(){return qn("not implemented")}}function Tr(e,t){Gn("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Sr{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=kn(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new _r(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Er(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await gr(this,this.stsTokenManager.getToken(this.auth,e));return Gn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=$e(e),r=await n.getIdToken(t),i=fr(r);Gn(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o="object"===typeof i.firebase?i.firebase:void 0,s=null===o||void 0===o?void 0:o.sign_in_provider;return{claims:i,token:r,authTime:hr(pr(i.auth_time)),issuedAtTime:hr(pr(i.iat)),expirationTime:hr(pr(i.exp)),signInProvider:s||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=$e(e);await vr(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Gn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Sr(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Gn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await vr(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hn(this.auth.app))return Promise.reject(Vn(this.auth));const e=await this.getIdToken();return await gr(this,async function(e,t){return tr(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,o,s,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(r=t.email)&&void 0!==r?r:void 0,h=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(o=t.photoURL)&&void 0!==o?o:void 0,f=null!==(s=t.tenantId)&&void 0!==s?s:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,_=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:E,emailVerified:v,isAnonymous:y,providerData:b,stsTokenManager:T}=t;Gn(E&&T,e,"internal-error");const S=br.fromJSON(this.name,T);Gn("string"===typeof E,e,"internal-error"),Tr(l,e.name),Tr(d,e.name),Gn("boolean"===typeof v,e,"internal-error"),Gn("boolean"===typeof y,e,"internal-error"),Tr(h,e.name),Tr(p,e.name),Tr(f,e.name),Tr(m,e.name),Tr(g,e.name),Tr(_,e.name);const w=new Sr({uid:E,auth:e,email:d,emailVerified:v,displayName:l,isAnonymous:y,photoURL:p,phoneNumber:h,tenantId:f,stsTokenManager:S,createdAt:g,lastLoginAt:_});return b&&Array.isArray(b)&&(w.providerData=b.map((e=>Object.assign({},e)))),m&&(w._redirectEventId=m),w}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new br;r.updateFromServerResponse(t);const i=new Sr({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await vr(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];Gn(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?yr(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length),s=new br;s.updateFromIdToken(n);const a=new Sr({uid:r.localId,auth:e,stsTokenManager:s,isAnonymous:o}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Er(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length)};return Object.assign(a,c),a}}const wr=new Map;function Rr(e){Wn(e instanceof Function,"Expected a class definition");let t=wr.get(e);return t?(Wn(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,wr.set(e,t),t)}class Ir{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ir.type="NONE";const Cr=Ir;function Ar(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class Or{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Ar(this.userKey,r.apiKey,i),this.fullPersistenceKey=Ar("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Sr._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new Or(Rr(Cr),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||Rr(Cr);const o=Ar(n,e.config.apiKey,e.name);let s=null;for(const u of t)try{const t=await u._get(o);if(t){const n=Sr._fromJSON(e,t);u!==i&&(s=n),i=u;break}}catch(c){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],s&&await i._set(o,s.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(o)}catch(c){}}))),new Or(i,e,n)):new Or(i,e,n)}}function Nr(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Lr(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(kr(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(xr(t))return"Blackberry";if(Ur(t))return"Webos";if(Dr(t))return"Safari";if((t.includes("chrome/")||Pr(t))&&!t.includes("edge/"))return"Chrome";if(Mr(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function kr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve();return/firefox\//i.test(e)}function Dr(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Pr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve();return/crios\//i.test(e)}function Lr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve();return/iemobile/i.test(e)}function Mr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve();return/android/i.test(e)}function xr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve();return/blackberry/i.test(e)}function Ur(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve();return/webos/i.test(e)}function Fr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function jr(){return function(){const e=Ve();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Vr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve();return Fr(e)||Mr(e)||Ur(e)||xr(e)||/windows phone/i.test(e)||Lr(e)}function Br(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=Nr(Ve());break;case"Worker":t="".concat(Nr(Ve()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(mn,"/").concat(r)}class Gr{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(Jg){r(Jg)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(Jg){t.reverse();for(const r of t)try{r()}catch(n){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===Jg||void 0===Jg?void 0:Jg.message})}}}class qr{constructor(e){var t,n,r,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=o.minPasswordLength)&&void 0!==t?t:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,o,s;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(o=a.containsNumericCharacter)||void 0===o||o),a.isValid&&(a.isValid=null===(s=a.containsNonAlphanumericCharacter)||void 0===s||s),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Wr{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Kr(this),this.idTokenSubscription=new Kr(this),this.beforeStateQueue=new Gr(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ln,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Rr(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Or.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(Jg){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await dr(this,{idToken:e}),n=await Sr._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(hn(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,o=null===r||void 0===r?void 0:r._redirectEventId,s=await this.tryRedirectSignIn(e);n&&n!==o||!(null===s||void 0===s?void 0:s.user)||(r=s.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(Jg){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(Jg)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Gn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(Jg){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await vr(e)}catch(Jg){if((null===Jg||void 0===Jg?void 0:Jg.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(hn(this.app))return Promise.reject(Vn(this));const t=e?$e(e):null;return t&&Gn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&Gn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return hn(this.app)?Promise.reject(Vn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return hn(this.app)?Promise.reject(Vn(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Rr(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return tr(e,"GET","/v2/passwordPolicy",er(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new qr(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new We("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return tr(e,"POST","/v2/accounts:revokeToken",er(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Rr(e)||this._popupRedirectResolver;Gn(t,this,"argument-error"),this.redirectPersistenceManager=await Or.create(this,[Rr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let o=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(Gn(s,this,"internal-error"),s.then((()=>{o||i(this.currentUser)})),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{o=!0,i()}}{const n=e.addObserver(t);return()=>{o=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Gn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Br(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(Mn.logLevel<=ot.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Mn.warn("Auth (".concat(mn,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function Hr(e){return $e(e)}class Kr{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new Qe(e,t);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Gn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let zr={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Yr(e){return zr.loadJS(e)}function Jr(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class Xr{constructor(e){this.type="recaptcha-enterprise",this.auth=Hr(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;cr(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{lr(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new ur(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&cr(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=zr.recaptchaEnterpriseScript;0!==t.length&&(t+=i),Yr(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Qr(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=new Xr(e);let o;try{o=await i.verify(n)}catch(a){o=await i.verify(n,!0)}const s=Object.assign({},t);return r?Object.assign(s,{captchaResp:o}):Object.assign(s,{captchaResponse:o}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function Zr(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Qr(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if(i.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const i=await Qr(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}function $r(e,t,n){const r=Hr(e);Gn(r._canInitEmulator,r,"emulator-config-failed"),Gn(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),o=ei(t),{host:s,port:a}=function(e){const t=ei(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:ti(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:ti(t)}}}(t),c=null===a?"":":".concat(a);r.config.emulator={url:"".concat(o,"//").concat(s).concat(c,"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:s,port:a,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function ei(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ti(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class ni{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return qn("not implemented")}_getIdTokenResponse(e){return qn("not implemented")}_linkToIdToken(e,t){return qn("not implemented")}_getReauthenticationResolver(e){return qn("not implemented")}}async function ri(e,t){return tr(e,"POST","/v1/accounts:signUp",t)}async function ii(e,t){return rr(e,"POST","/v1/accounts:signInWithPassword",er(e,t))}class oi extends ni{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new oi(e,t,"password")}static _fromEmailAndCode(e,t){return new oi(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Zr(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",ii);case"emailLink":return async function(e,t){return rr(e,"POST","/v1/accounts:signInWithEmailLink",er(e,t))}(e,{email:this._email,oobCode:this._password});default:Un(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Zr(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ri);case"emailLink":return async function(e,t){return rr(e,"POST","/v1/accounts:signInWithEmailLink",er(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Un(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function si(e,t){return rr(e,"POST","/v1/accounts:signInWithIdp",er(e,t))}class ai extends ni{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ai(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Un("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=kn(t,["providerId","signInMethod"]);if(!n||!r)return null;const o=new ai(n,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){return si(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,si(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,si(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ye(t)}return e}}const ci={USER_NOT_FOUND:"user-not-found"};class ui extends ni{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ui({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ui({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return rr(e,"POST","/v1/accounts:signInWithPhoneNumber",er(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await rr(e,"POST","/v1/accounts:signInWithPhoneNumber",er(e,t));if(n.temporaryProof)throw ar(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return rr(e,"POST","/v1/accounts:signInWithPhoneNumber",er(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ci)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new ui({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class li{constructor(e){var t,n,r,i,o,s;const a=Je(Xe(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Gn(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(o=a.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(s=a.tenantId)&&void 0!==s?s:null}static parseLink(e){const t=function(e){const t=Je(Xe(e)).link,n=t?Je(Xe(t)).deep_link_id:null,r=Je(Xe(e)).deep_link_id;return(r?Je(Xe(r)).link:null)||r||n||t||e}(e);try{return new li(t)}catch(n){return null}}}class di{constructor(){this.providerId=di.PROVIDER_ID}static credential(e,t){return oi._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=li.parseLink(t);return Gn(n,"argument-error"),oi._fromEmailAndCode(e,n.code,n.tenantId)}}di.PROVIDER_ID="password",di.EMAIL_PASSWORD_SIGN_IN_METHOD="password",di.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class hi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class pi extends hi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class fi extends pi{constructor(){super("facebook.com")}static credential(e){return ai._fromParams({providerId:fi.PROVIDER_ID,signInMethod:fi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fi.credentialFromTaggedObject(e)}static credentialFromError(e){return fi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return fi.credential(t.oauthAccessToken)}catch(n){return null}}}fi.FACEBOOK_SIGN_IN_METHOD="facebook.com",fi.PROVIDER_ID="facebook.com";class mi extends pi{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ai._fromParams({providerId:mi.PROVIDER_ID,signInMethod:mi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return mi.credentialFromTaggedObject(e)}static credentialFromError(e){return mi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return mi.credential(n,r)}catch(i){return null}}}mi.GOOGLE_SIGN_IN_METHOD="google.com",mi.PROVIDER_ID="google.com";class gi extends pi{constructor(){super("github.com")}static credential(e){return ai._fromParams({providerId:gi.PROVIDER_ID,signInMethod:gi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gi.credentialFromTaggedObject(e)}static credentialFromError(e){return gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return gi.credential(t.oauthAccessToken)}catch(n){return null}}}gi.GITHUB_SIGN_IN_METHOD="github.com",gi.PROVIDER_ID="github.com";class _i extends pi{constructor(){super("twitter.com")}static credential(e,t){return ai._fromParams({providerId:_i.PROVIDER_ID,signInMethod:_i.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return _i.credentialFromTaggedObject(e)}static credentialFromError(e){return _i.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return _i.credential(n,r)}catch(i){return null}}}async function Ei(e,t){return rr(e,"POST","/v1/accounts:signUp",er(e,t))}_i.TWITTER_SIGN_IN_METHOD="twitter.com",_i.PROVIDER_ID="twitter.com";class vi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await Sr._fromIdTokenResponse(e,n,r),o=yi(n);return new vi({user:i,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=yi(n);return new vi({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function yi(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class bi extends qe{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,bi.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new bi(e,t,n,r)}}function Ti(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw bi._fromErrorAndOperation(e,n,t,r);throw n}))}async function Si(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await gr(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return vi._forOperation(e,"link",r)}async function wi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if(hn(r.app))return Promise.reject(Vn(r));const i="reauthenticate";try{const o=await gr(e,Ti(r,i,t,e),n);Gn(o.idToken,r,"internal-error");const s=fr(o.idToken);Gn(s,r,"internal-error");const{sub:a}=s;return Gn(e.uid===a,r,"user-mismatch"),vi._forOperation(e,i,o)}catch(Jg){throw(null===Jg||void 0===Jg?void 0:Jg.code)==="auth/".concat("user-not-found")&&Un(r,"user-mismatch"),Jg}}async function Ri(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(hn(e.app))return Promise.reject(Vn(e));const r="signIn",i=await Ti(e,r,t),o=await vi._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(o.user),o}async function Ii(e,t){return Ri(Hr(e),t)}async function Ci(e){const t=Hr(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}new WeakMap;const Ai="__sak";class Oi{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ai,"1"),this.storage.removeItem(Ai),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ni extends Oi{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=Ve();return Dr(e)||Fr(e)}()&&function(){try{return!(!window||window===window.top)}catch(Jg){return!1}}(),this.fallbackToPolling=Vr(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);jr()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Ni.type="LOCAL";const ki=Ni;class Di extends Oi{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Di.type="SESSION";const Pi=Di;class Li{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Li(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!(null===o||void 0===o?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const s=Array.from(o).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(s);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Mi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Li.receivers=[];class xi{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise(((s,a)=>{const c=Mi("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);o={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),s(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{o&&this.removeMessageHandler(o)}))}}function Ui(){return window}function Fi(){return"undefined"!==typeof Ui().WorkerGlobalScope&&"function"===typeof Ui().importScripts}const ji="firebaseLocalStorageDb",Vi="firebaseLocalStorage",Bi="fbase_key";class Gi{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function qi(e,t){return e.transaction([Vi],t?"readwrite":"readonly").objectStore(Vi)}function Wi(){const e=indexedDB.open(ji,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Vi,{keyPath:Bi})}catch(Jg){n(Jg)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Vi)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(ji);return new Gi(e).toPromise()}(),t(await Wi()))}))}))}async function Hi(e,t,n){const r=qi(e,!0).put({[Bi]:t,value:n});return new Gi(r).toPromise()}function Ki(e,t){const n=qi(e,!0).delete(t);return new Gi(n).toPromise()}class zi{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Wi()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(Jg){if(t++>3)throw Jg;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Fi()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Li._getInstance(Fi()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new xi(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Wi();return await Hi(e,Ai,"1"),await Ki(e,Ai),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Hi(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=qi(e,!1).get(t),r=await new Gi(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Ki(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=qi(e,!1).getAll();return new Gi(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}zi.type="LOCAL";const Yi=zi;Jr("rcb"),new Jn(3e4,6e4);const Ji="recaptcha";async function Xi(e,t,n){var r;const i=await n.verify();try{let o;if(Gn("string"===typeof i,e,"argument-error"),Gn(n.type===Ji,e,"argument-error"),o="string"===typeof t?{phoneNumber:t}:t,"session"in o){const t=o.session;if("phoneNumber"in o){Gn("enroll"===t.type,e,"internal-error");const n=await function(e,t){return tr(e,"POST","/v2/accounts/mfaEnrollment:start",er(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{Gn("signin"===t.type,e,"internal-error");const n=(null===(r=o.multiFactorHint)||void 0===r?void 0:r.uid)||o.multiFactorUid;Gn(n,e,"missing-multi-factor-info");const s=await function(e,t){return tr(e,"POST","/v2/accounts/mfaSignIn:start",er(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return s.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return tr(e,"POST","/v1/accounts:sendVerificationCode",er(e,t))}(e,{phoneNumber:o.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class Qi{constructor(e){this.providerId=Qi.PROVIDER_ID,this.auth=Hr(e)}verifyPhoneNumber(e,t){return Xi(this.auth,e,$e(t))}static credential(e,t){return ui._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Qi.credentialFromTaggedObject(t)}static credentialFromError(e){return Qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?ui._fromTokenResponse(n,r):null}}function Zi(e,t){return t?Rr(t):(Gn(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Qi.PROVIDER_ID="phone",Qi.PHONE_SIGN_IN_METHOD="phone";class $i extends ni{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return si(e,this._buildIdpRequest())}_linkToIdToken(e,t){return si(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return si(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function eo(e){return Ri(e.auth,new $i(e),e.bypassAuthState)}function to(e){const{auth:t,user:n}=e;return Gn(n,t,"internal-error"),wi(n,new $i(e),e.bypassAuthState)}async function no(e){const{auth:t,user:n}=e;return Gn(n,t,"internal-error"),Si(n,new $i(e),e.bypassAuthState)}class ro{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(Jg){this.reject(Jg)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:o,type:s}=e;if(o)return void this.reject(o);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(a))}catch(Jg){this.reject(Jg)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return eo;case"linkViaPopup":case"linkViaRedirect":return no;case"reauthViaPopup":case"reauthViaRedirect":return to;default:Un(this.auth,"internal-error")}}resolve(e){Wn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Wn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const io=new Jn(2e3,1e4);class oo extends ro{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,oo.currentPopupAction&&oo.currentPopupAction.cancel(),oo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Gn(e,this.auth,"internal-error"),e}async onExecution(){Wn(1===this.filter.length,"Popup operations only handle one event");const e=Mi();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Fn(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Fn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,oo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Fn(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,io.get())};e()}}oo.currentPopupAction=null;const so="pendingRedirect",ao=new Map;class co extends ro{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=ao.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=ho(t),r=lo(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(Jg){e=()=>Promise.reject(Jg)}ao.set(this.auth._key(),e)}return this.bypassAuthState||ao.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function uo(e,t){ao.set(e._key(),t)}function lo(e){return Rr(e._redirectPersistence)}function ho(e){return Ar(so,e.config.apiKey,e.name)}async function po(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(hn(e.app))return Promise.reject(Vn(e));const r=Hr(e),i=Zi(r,t),o=new co(r,i,n),s=await o.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}class fo{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return go(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!go(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Fn(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(mo(e))}saveEventToCache(e){this.cachedEventUids.add(mo(e)),this.lastProcessedEventTime=Date.now()}}function mo(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function go(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const _o=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Eo=/^https?/;async function vo(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return tr(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(yo(r))return}catch(n){}Un(e,"unauthorized-domain")}function yo(e){const t=Hn(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Eo.test(n))return!1;if(_o.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const bo=new Jn(3e4,6e4);function To(){const e=Ui().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function So(e){return new Promise(((t,n)=>{var r,i,o;function s(){To(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{To(),n(Fn(e,"network-request-failed"))},timeout:bo.get()})}if(null===(i=null===(r=Ui().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(o=Ui().gapi)||void 0===o?void 0:o.load)){const t=Jr("iframefcb");return Ui()[t]=()=>{gapi.load?s():n(Fn(e,"network-request-failed"))},Yr("".concat(zr.gapiScript,"?onload=").concat(t)).catch((e=>n(e)))}s()}})).catch((e=>{throw wo=null,e}))}let wo=null;const Ro=new Jn(5e3,15e3),Io="__/auth/iframe",Co="emulator/auth/iframe",Ao={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Oo=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function No(e){const t=e.config;Gn(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Xn(t,Co):"https://".concat(e.config.authDomain,"/").concat(Io),r={apiKey:t.apiKey,appName:e.name,v:mn},i=Oo.get(e.config.apiHost);i&&(r.eid=i);const o=e._getFrameworks();return o.length&&(r.fw=o.join(",")),"".concat(n,"?").concat(Ye(r).slice(1))}async function ko(e){const t=await function(e){return wo=wo||So(e),wo}(e),n=Ui().gapi;return Gn(n,e,"internal-error"),t.open({where:document.body,url:No(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ao,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Fn(e,"network-request-failed"),o=Ui().setTimeout((()=>{r(i)}),Ro.get());function s(){Ui().clearTimeout(o),n(t)}t.ping(s).then(s,(()=>{r(i)}))}))))}const Do={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Po{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(Jg){}}}function Lo(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const o=Math.max((window.screen.availHeight-i)/2,0).toString(),s=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Do),{width:r.toString(),height:i.toString(),top:o,left:s}),u=Ve().toLowerCase();n&&(a=Pr(u)?"_blank":n),kr(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")}),"");if(function(){var e;return Fr(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ve())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new Po(null);const d=window.open(t||"",a,l);Gn(d,e,"popup-blocked");try{d.focus()}catch(Jg){}return new Po(d)}const Mo="__/auth/handler",xo="emulator/auth/handler",Uo=encodeURIComponent("fac");async function Fo(e,t,n,r,i,o){Gn(e.config.authDomain,e,"auth-domain-config-required"),Gn(e.config.apiKey,e,"invalid-api-key");const s={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:mn,eventId:i};if(t instanceof hi){t.setDefaultLanguage(e.languageCode),s.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(s.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(o||{}))s[e]=t}if(t instanceof pi){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(s.scopes=e.join(","))}e.tenantId&&(s.tid=e.tenantId);const a=s;for(const l of Object.keys(a))void 0===a[l]&&delete a[l];const c=await e._getAppCheckToken(),u=c?"#".concat(Uo,"=").concat(encodeURIComponent(c)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(Mo);return Xn(t,xo)}(e),"?").concat(Ye(a).slice(1)).concat(u)}const jo="webStorageSupport";const Vo=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Pi,this._completeRedirectFn=po,this._overrideRedirectResult=uo}async _openPopup(e,t,n,r){var i;Wn(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return Lo(e,await Fo(e,t,n,Hn(),r),Mi())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Ui().location.href=e}(await Fo(e,t,n,Hn(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Wn(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await ko(e),n=new fo(e);return t.register("authEvent",(t=>{Gn(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(jo,{type:jo},(n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[jo];void 0!==i&&t(!!i),Un(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=vo(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Vr()||Dr()||Fr()}};var Bo="@firebase/auth",Go="1.7.4";class qo{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Gn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Wo=Ue("authIdTokenMaxAge")||300;let Ho=null;var Ko;zr={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Fn("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Ko="Browser",ln(new et("auth",((e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:s,authDomain:a}=r.options;Gn(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:s,authDomain:a,clientPlatform:Ko,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Br(Ko)},u=new Wr(r,i,o,c);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Rr);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(u,n),u}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ln(new et("auth-internal",(e=>(e=>new qo(e))(Hr(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),En(Bo,Go,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Ko)),En(Bo,Go,"esm2017");En("firebase","10.12.2","app");const zo="firebasestorage.googleapis.com",Yo="storageBucket";class Jo extends qe{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(Zo(e),"Firebase Storage: ".concat(t," (").concat(Zo(e),")")),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Jo.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Zo(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}var Xo,Qo;function Zo(e){return"storage/"+e}function $o(){return new Jo(Xo.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function es(){return new Jo(Xo.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ts(){return new Jo(Xo.CANCELED,"User canceled the upload/download.")}function ns(e){return new Jo(Xo.INVALID_ARGUMENT,e)}function rs(){return new Jo(Xo.APP_DELETED,"The Firebase app was deleted.")}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Xo||(Xo={}));class is{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=is.makeFromUrl(e,t)}catch(Jg){return new is(e,"")}if(""===n.path)return n;throw r=e,new Jo(Xo.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function o(e){e.path_=decodeURIComponent(e.path)}const s=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(s,"/").concat("v[A-Za-z0-9_]+","/b/").concat(r,"/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:o},{regex:new RegExp("^https?://".concat(t===zo?"(?:storage.googleapis.com|storage.cloud.google.com)":t,"/").concat(r,"/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:o}];for(let c=0;c<a.length;c++){const t=a[c],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let i=r[t.indices.path];i||(i=""),n=new is(e,i),t.postModify(n);break}}if(null==n)throw function(e){return new Jo(Xo.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class os{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function ss(e,t,n,r){if(r<t)throw ns("Invalid value for '".concat(e,"'. Expected ").concat(t," or greater."));if(r>n)throw ns("Invalid value for '".concat(e,"'. Expected ").concat(n," or less."))}function as(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}function cs(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Qo||(Qo={}));class us{constructor(e,t,n,r,i,o,s,a,c,u,l){let d=!(arguments.length>11&&void 0!==arguments[11])||arguments[11];this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=s,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=l,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new ls(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Qo.NO_ERROR,i=n.getStatus();if(!t||cs(i,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Qo.ABORT;return void e(!1,new ls(!1,null,t))}const o=-1!==this.successCodes_.indexOf(i);e(!0,new ls(o,n))}))},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(Jg){r(Jg)}else if(null!==i){const e=$o();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else if(t.canceled){r(this.appDelete_?rs():ts())}else{r(es())}};this.canceled_?t(0,new ls(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,o=null,s=!1,a=0;function c(){return 2===a}let u=!1;function l(){if(!u){u=!0;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];t.apply(null,n)}}function d(t){i=setTimeout((()=>{i=null,e(p,c())}),t)}function h(){o&&clearTimeout(o)}function p(e){if(u)return void h();for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(e)return h(),void l.call(null,e,...n);if(c()||s)return h(),void l.call(null,e,...n);let o;r<64&&(r*=2),1===a?(a=2,o=0):o=1e3*(r+Math.random()),d(o)}let f=!1;function m(e){f||(f=!0,h(),u||(null!==i?(e||(a=2),clearTimeout(i),d(0)):e||(a=1)))}return d(0),o=setTimeout((()=>{s=!0,m(!0)}),n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class ls{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function ds(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}class hs{constructor(e,t){this._service=e,this._location=t instanceof is?t:is.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new hs(e,t)}get root(){const e=new is(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ds(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new is(this._location.bucket,e);return new hs(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Jo(Xo.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function ps(e,t){const n=null===t||void 0===t?void 0:t[Yo];return null==n?null:is.makeFromBucketSpec(n,e)}class fs{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=zo,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?is.makeFromBucketSpec(r,this._host):ps(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=is.makeFromBucketSpec(this._url,e):this._bucket=ps(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){ss("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){ss("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new hs(this,e)}_makeRequest(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new os(rs());{const o=function(e,t,n,r,i,o){let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const a=as(e.urlParams),c=e.url+a,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(u,o),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,r),new us(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,s)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then((()=>this._requests.delete(o)),(()=>this._requests.delete(o))),o}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const ms="@firebase/storage",gs="0.12.5",_s="storage";function Es(e,t){let{instanceIdentifier:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return new fs(r,i,o,n,mn)}ln(new et(_s,Es,"PUBLIC").setMultipleInstances(!0)),En(ms,gs,""),En(ms,gs,"esm2017");var vs,ys,bs="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Ts={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var o=e.g[3],s=t+(o^n&(i^o))+r[0]+3614090360&4294967295;s=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=n+(s<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[3]+3250441966&4294967295)<<22&4294967295|s>>>10))+((s=t+(o^n&(i^o))+r[4]+4118548399&4294967295)<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[7]+4249261313&4294967295)<<22&4294967295|s>>>10))+((s=t+(o^n&(i^o))+r[8]+1770035416&4294967295)<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[11]+2304563134&4294967295)<<22&4294967295|s>>>10))+((s=t+(o^n&(i^o))+r[12]+1804603682&4294967295)<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[15]+1236535329&4294967295)<<22&4294967295|s>>>10))+((s=t+(i^o&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[11]+643717713&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[0]+3921069994&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^o&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[15]+3634488961&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[4]+3889429448&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^o&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[3]+4107603335&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[8]+1163531501&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^o&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[7]+1735328473&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[12]+2368359562&4294967295)<<20&4294967295|s>>>12))+((s=t+(n^i^o)+r[5]+4294588738&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[14]+4259657740&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^o)+r[1]+2763975236&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[10]+3200236656&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^o)+r[13]+681279174&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[6]+76029189&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^o)+r[9]+3654602809&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[15]+530742520&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[2]+3299628645&4294967295)<<23&4294967295|s>>>9))+((s=t+(i^(n|~o))+r[0]+4096336452&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(o|~n))+r[14]+2878612391&4294967295)<<15&4294967295|s>>>17))+((s=n+(o^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|s>>>11))+((s=t+(i^(n|~o))+r[12]+1700485571&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(o|~n))+r[10]+4293915773&4294967295)<<15&4294967295|s>>>17))+((s=n+(o^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|s>>>11))+((s=t+(i^(n|~o))+r[8]+1873313359&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(o|~n))+r[6]+2734768916&4294967295)<<15&4294967295|s>>>17))+((s=n+(o^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|s>>>11))+((o=(t=n+((s=t+(i^(n|~o))+r[4]+4149444226&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|s>>>22))^((i=o+((s=i+(t^(o|~n))+r[2]+718787259&4294967295)<<15&4294967295|s>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(s<<21&4294967295|s>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+o&4294967295}function r(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var o=0|e[i];r&&o==t||(n[i]=o,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,o=this.h,s=0;s<t;){if(0==o)for(;s<=r;)n(this,e,s),s+=this.blockSize;if("string"===typeof e){for(;s<t;)if(i[o++]=e.charCodeAt(s++),o==this.blockSize){n(this,i),o=0;break}}else for(;s<t;)if(i[o++]=e[s++],o==this.blockSize){n(this,i),o=0;break}}this.h=o,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var i={};function o(e){return-128<=e&&128>e?function(e,t){var n=i;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new r([0|e],0>e?-1:0)})):new r([0|e],0>e?-1:0)}function s(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return h(s(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var a=o(0),c=o(1),u=o(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function h(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(c)}function p(e,t){return e.add(h(t))}function f(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(l(t))throw Error("division by zero");if(l(e))return new m(a,a);if(d(e))return t=g(h(e),t),new m(h(t.g),h(t.h));if(d(t))return t=g(e,h(t)),new m(h(t.g),t.h);if(30<e.g.length){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=t;0>=r.l(e);)n=_(n),r=_(r);var i=E(n,1),o=E(r,1);for(r=E(r,2),n=E(n,2);!l(r);){var u=o.add(r);0>=u.l(e)&&(i=i.add(n),o=u),r=E(r,1),n=E(n,1)}return t=p(e,i.j(t)),new m(i,t)}for(i=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(o=s(n)).j(t);d(u)||0<u.l(e);)u=(o=s(n-=r)).j(t);l(o)&&(o=c),i=i.add(o),e=p(e,u)}return new m(i,e)}function _(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function E(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,o=[],s=0;s<i;s++)o[s]=0<t?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new r(o,e.h)}(e=r.prototype).m=function(){if(d(this))return-h(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(d(this))return"-"+h(this).toString(e);for(var t=s(Math.pow(e,6)),n=this,r="";;){var i=g(n,t).g,o=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(l(n=i))return o+r;for(;6>o.length;)o="0"+o;r=o+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return d(e=p(this,e))?-1:l(e)?0:1},e.abs=function(){return d(this)?h(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,o=0;o<=t;o++){var s=i+(65535&this.i(o))+(65535&e.i(o)),a=(s>>>16)+(this.i(o)>>>16)+(e.i(o)>>>16);i=a>>>16,s&=65535,a&=65535,n[o]=a<<16|s}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return a;if(d(this))return d(e)?h(this).j(h(e)):h(h(this).j(e));if(d(e))return h(this.j(h(e)));if(0>this.l(u)&&0>e.l(u))return s(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var o=0;o<e.g.length;o++){var c=this.i(i)>>>16,p=65535&this.i(i),m=e.i(o)>>>16,g=65535&e.i(o);n[2*i+2*o]+=p*g,f(n,2*i+2*o),n[2*i+2*o+1]+=c*g,f(n,2*i+2*o+1),n[2*i+2*o+1]+=p*m,f(n,2*i+2*o+1),n[2*i+2*o+2]+=c*m,f(n,2*i+2*o+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return g(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,ys=Ts.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=s,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return h(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=s(Math.pow(n,8)),i=a,o=0;o<t.length;o+=8){var c=Math.min(8,t.length-o),u=parseInt(t.substring(o,o+c),n);8>c?(c=s(Math.pow(n,c)),i=i.j(c).add(s(u))):i=(i=i.j(r)).add(s(u))}return i},vs=Ts.Integer=r}).apply("undefined"!==typeof bs?bs:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var Ss,ws,Rs,Is,Cs,As,Os,Ns,ks,Ds="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Ps={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ds&&Ds];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var o=0;o<e.length-1;o++){var s=e[o];if(!(s in i))break e;i=i[s]}(r=r(o=i[e=e[e.length-1]]))!=o&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var r=r||{},i=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function s(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function u(e,t,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[n].apply(e,i)}}function h(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function p(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(o(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function f(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function g(e){return g[" "](e),e}g[" "]=function(){};var _=-1!=m().indexOf("Gecko")&&!(-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge"))&&!(-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE"))&&-1==m().indexOf("Edge");function E(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function v(e){const t={};for(const n in e)t[n]=e[n];return t}const y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<y.length;t++)n=y[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function T(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function S(e){i.setTimeout((()=>{throw e}),0)}function w(){var e=O;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var R=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new I),(e=>e.reset()));class I{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let C,A=!1,O=new class{constructor(){this.h=this.g=null}add(e,t){const n=R.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{const e=i.Promise.resolve(void 0);C=()=>{e.then(k)}};var k=()=>{for(var e;e=w();){try{e.h.call(e.g)}catch(n){S(n)}var t=R;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}A=!1};function D(){this.s=this.s,this.C=this.C}function P(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}D.prototype.s=!1,D.prototype.ma=function(){this.s||(this.s=!0,this.N())},D.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},P.prototype.h=function(){this.defaultPrevented=!0};var L=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function M(e,t){if(P.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(_){e:{try{g(t.nodeName);var i=!0;break e}catch(o){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:x[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&M.aa.h.call(this)}}d(M,P);var x={2:"touch",3:"pen",4:"mouse"};M.prototype.h=function(){M.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),F=0;function j(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++F,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function B(e){this.src=e,this.g={},this.h=0}function G(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],o=Array.prototype.indexOf.call(i,t,void 0);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(V(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function q(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.da&&o.listener==t&&o.capture==!!n&&o.ha==r)return i}return-1}B.prototype.add=function(e,t,n,r,i){var o=e.toString();(e=this.g[o])||(e=this.g[o]=[],this.h++);var s=q(e,t,r,i);return-1<s?(t=e[s],n||(t.fa=!1)):((t=new j(t,this.src,o,!!r,i)).fa=n,e.push(t)),t};var W="closure_lm_"+(1e6*Math.random()|0),H={};function K(e,t,n,r,i){if(r&&r.once)return Y(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)K(e,t[o],n,r,i);return null}return n=te(n),e&&e[U]?e.K(t,n,s(r)?!!r.capture:!!r,i):z(e,t,n,!1,r,i)}function z(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var a=s(i)?!!i.capture:!!i,c=$(e);if(c||(e[W]=c=new B(e)),(n=c.add(t,n,r,a,o)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=Z;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)L||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Q(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Y(e,t,n,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;o++)Y(e,t[o],n,r,i);return null}return n=te(n),e&&e[U]?e.L(t,n,s(r)?!!r.capture:!!r,i):z(e,t,n,!0,r,i)}function J(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)J(e,t[o],n,r,i);else r=s(r)?!!r.capture:!!r,n=te(n),e&&e[U]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=q(o=e.g[t],n,r,i))&&(V(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete e.g[t],e.h--)))):e&&(e=$(e))&&(t=e.g[t.toString()],e=-1,t&&(e=q(t,n,r,i)),(n=-1<e?t[e]:null)&&X(n))}function X(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])G(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Q(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=$(t))?(G(n,e),0==n.h&&(n.src=null,t[W]=null)):V(e)}}}function Q(e){return e in H?H[e]:H[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new M(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&X(e),e=n.call(r,t)}return e}function $(e){return(e=e[W])instanceof B?e:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function te(e){return"function"===typeof e?e:(e[ee]||(e[ee]=function(t){return e.handleEvent(t)}),e[ee])}function ne(){D.call(this),this.i=new B(this),this.M=this,this.F=null}function re(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new P(t,e);else if(t instanceof P)t.target=t.target||e;else{var i=t;b(t=new P(r,e),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=t.g=n[o];i=ie(s,r,!0,t)&&i}if(i=ie(s=t.g=e,r,!0,t)&&i,i=ie(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)i=ie(s=t.g=n[o],r,!1,t)&&i}function ie(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var s=t[o];if(s&&!s.da&&s.capture==n){var a=s.listener,c=s.ha||s.src;s.fa&&G(e.i,s),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function oe(e,t,n){if("function"===typeof e)n&&(e=u(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=u(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function se(e){e.g=oe((()=>{e.g=null,e.i&&(e.i=!1,se(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}d(ne,D),ne.prototype[U]=!0,ne.prototype.removeEventListener=function(e,t,n,r){J(this,e,t,n,r)},ne.prototype.N=function(){if(ne.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)V(n[r]);delete t.g[e],t.h--}}this.F=null},ne.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ne.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ae extends D{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:se(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ce(e){D.call(this),this.h=e,this.g={}}d(ce,D);var ue=[];function le(e){E(e.g,(function(e,t){this.g.hasOwnProperty(t)&&X(e)}),e),e.g={}}ce.prototype.N=function(){ce.aa.N.call(this),le(this)},ce.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var de=i.JSON.stringify,he=i.JSON.parse,pe=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function fe(){}function me(e){return e.h||(e.h=e.i())}function ge(){}fe.prototype.h=null;var _e={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ee(){P.call(this,"d")}function ve(){P.call(this,"c")}d(Ee,P),d(ve,P);var ye={},be=null;function Te(){return be=be||new ne}function Se(e){P.call(this,ye.La,e)}function we(e){const t=Te();re(t,new Se(t))}function Re(e,t){P.call(this,ye.STAT_EVENT,e),this.stat=t}function Ie(e){const t=Te();re(t,new Re(t,e))}function Ce(e,t){P.call(this,ye.Ma,e),this.size=t}function Ae(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function Oe(){this.g=!0}function Ne(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return de(n)}catch(a){return t}}(e,n)+(r?" "+r:"")}))}ye.La="serverreachability",d(Se,P),ye.STAT_EVENT="statevent",d(Re,P),ye.Ma="timingevent",d(Ce,P),Oe.prototype.xa=function(){this.g=!1},Oe.prototype.info=function(){};var ke,De={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Le(){}function Me(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ce(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xe}function xe(){this.i=null,this.g="",this.h=!1}d(Le,fe),Le.prototype.g=function(){return new XMLHttpRequest},Le.prototype.i=function(){return{}},ke=new Le;var Ue={},Fe={};function je(e,t,n){e.L=1,e.v=dt(st(t)),e.m=n,e.P=!0,Ve(e,null)}function Ve(e,t){e.F=Date.now(),qe(e),e.A=st(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Rt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new xe,e.g=pn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ae(u(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(ue[0]=i.toString()),i=ue);for(var o=0;o<i.length;o++){var s=K(n,i[o],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}t=e.H?v(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),we(),function(e,t,n,r,i,o){e.info((function(){if(e.g)if(o)for(var s="",a=o.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var d=l.split("_");s=2<=d.length&&"type"==d[1]?s+(l+"=")+u+"&":s+(l+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+s}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Be(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Ge(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Fe:(n=Number(t.substring(n,r)),isNaN(n)?Ue:(r+=1)+n>t.length?Fe:(t=t.slice(r,r+n),e.C=r+n,t))}function qe(e){e.S=Date.now()+e.I,We(e,e.I)}function We(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ae(u(e.ba,e),t)}function He(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function Ke(e){0==e.j.G||e.J||cn(e.j,e)}function ze(e){He(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,le(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function Ye(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||$e(n.h,e)))if(!e.K&&$e(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(l){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;an(n),Xt(n)}rn(n),Ie(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ae(u(n.Za,n),6e3));if(1>=Ze(n.h)&&n.ca){try{n.ca()}catch(l){}n.ca=void 0}}else ln(n,11)}else if((e.K||n.g==e)&&an(n),!f(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=u[5];null!=l&&"number"===typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var o=r.h;o.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(o.j=o.l,o.g=new Set,o.h&&(et(o,o.h),o.h=null))}if(r.D){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,lt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var s=e;if((r=n).qa=hn(r,r.J?r.ia:null,r.W),s.K){tt(r.h,s);var a=s,c=r.L;c&&(a.I=c),a.B&&(He(a),qe(a)),r.g=s}else nn(r);0<n.i.length&&Zt(n)}else"stop"!=u[0]&&"close"!=u[0]||ln(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ln(n,7):Jt(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}we()}catch(l){}}Me.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Ht(e)?t.j():this.Y(e)},Me.prototype.Y=function(e){try{if(e==this.g)e:{const h=Ht(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||Kt(this.g)))){this.J||4!=h||7==t||we(),He(this);var n=this.g.Z();this.X=n;t:if(Be(this)){var r=Kt(this.g);e="";var o=r.length,s=4==Ht(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){ze(this),Ke(this);var a="";break t}this.h.i=new i.TextDecoder}for(t=0;t<o;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==o-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,o,s){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+o+" "+s}))}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!f(c)){var l=c;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,Ie(12),ze(this),Ke(this);break e}Ne(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ye(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=Ge(this,a),e==Fe){4==h&&(this.s=4,Ie(14),n=!1),Ne(this.i,this.l,null,"[Incomplete Response]");break}if(e==Ue){this.s=4,Ie(15),Ne(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Ne(this.i,this.l,e,null),Ye(this,e)}if(Be(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=a.length||this.h.h||(this.s=1,Ie(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),on(d),d.M=!0,Ie(11))}}else Ne(this.i,this.l,a,"[Invalid Chunked Response]"),ze(this),Ke(this)}else Ne(this.i,this.l,a,null),Ye(this,a);4==h&&ze(this),this.o&&!this.J&&(4==h?cn(this.j,this):(this.o=!1,qe(this)))}else(function(e){const t={};e=(e.g&&2<=Ht(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(f(e[r]))continue;var n=T(e[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const o=t[i]||[];t[i]=o,o.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Ie(12)):(this.s=0,Ie(13)),ze(this),Ke(this)}}}catch(h){}},Me.prototype.cancel=function(){this.J=!0,ze(this)},Me.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(we(),Ie(17)),ze(this),this.s=2,Ke(this)):We(this,this.S-e)};var Je=class{constructor(e,t){this.g=e,this.map=t}};function Xe(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ze(e){return e.h?1:e.g?e.g.size:0}function $e(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return h(e.i)}function rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(o(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(o(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}Xe.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ot(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof ot){this.h=e.h,at(this,e.j),this.o=e.o,this.g=e.g,ct(this,e.s),this.l=e.l;var t=e.i,n=new bt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ut(this,n),this.m=e.m}else e&&(t=String(e).match(it))?(this.h=!1,at(this,t[1]||"",!0),this.o=ht(t[2]||""),this.g=ht(t[3]||"",!0),ct(this,t[4]),this.l=ht(t[5]||"",!0),ut(this,t[6]||"",!0),this.m=ht(t[7]||"")):(this.h=!1,this.i=new bt(null,this.h))}function st(e){return new ot(e)}function at(e,t,n){e.j=n?ht(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ct(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ut(e,t,n){t instanceof bt?(e.i=t,function(e,t){t&&!e.j&&(Tt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(St(this,t),Rt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=pt(t,vt)),e.i=new bt(t,e.h))}function lt(e,t,n){e.i.set(t,n)}function dt(e){return lt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ht(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function pt(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,ft),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ft(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ot.prototype.toString=function(){var e=[],t=this.j;t&&e.push(pt(t,gt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(pt(t,gt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(pt(n,"/"==n.charAt(0)?Et:_t,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",pt(n,yt)),e.join("")};var mt,gt=/[#\/\?@]/g,_t=/[#\?:]/g,Et=/[#\?]/g,vt=/[#\?@]/g,yt=/#/g;function bt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Tt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function St(e,t){Tt(e),t=It(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function wt(e,t){return Tt(e),t=It(e,t),e.g.has(t)}function Rt(e,t,n){St(e,t),0<n.length&&(e.i=null,e.g.set(It(e,t),h(n)),e.h+=n.length)}function It(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ct(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(o){}}function At(){this.g=new pe}function Ot(e,t,n){const r=n||"";try{rt(e,(function(e,n){let i=e;s(e)&&(i=de(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(Jg){throw t.push(r+"type="+encodeURIComponent("_badmap")),Jg}}function Nt(e){this.l=e.Ub||null,this.j=e.eb||!1}function kt(e,t){ne.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Dt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Pt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Lt(e)}function Lt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Mt(e){let t="";return E(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function xt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Mt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):lt(e,t,n))}function Ut(e){ne.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=bt.prototype).add=function(e,t){Tt(this),this.i=null,e=It(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Tt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){Tt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){Tt(this);let t=[];if("string"===typeof e)wt(this,e)&&(t=t.concat(this.g.get(It(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Tt(this),this.i=null,wt(this,e=It(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const o=encodeURIComponent(String(r)),s=this.V(r);for(r=0;r<s.length;r++){var i=o;""!==s[r]&&(i+="="+encodeURIComponent(String(s[r]))),e.push(i)}}return this.i=e.join("&")},d(Nt,fe),Nt.prototype.g=function(){return new kt(this.l,this.j)},Nt.prototype.i=(mt={},function(){return mt}),d(kt,ne),(e=kt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Lt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Pt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Lt(this)),this.g&&(this.readyState=3,Lt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Dt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Pt(this):Lt(this),3==this.readyState&&Dt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Pt(this))},e.Qa=function(e){this.g&&(this.response=e,Pt(this))},e.ga=function(){this.g&&Pt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(kt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),d(Ut,ne);var Ft=/^https?$/i,jt=["POST","PUT"];function Vt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Bt(e),qt(e)}function Bt(e){e.A||(e.A=!0,re(e,"complete"),re(e,"error"))}function Gt(e){if(e.h&&"undefined"!=typeof r&&(!e.v[1]||4!=Ht(e)||2!=e.Z()))if(e.u&&4==Ht(e))oe(e.Ea,0,e);else if(re(e,"readystatechange"),4==Ht(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var o;if(o=0===r){var s=String(e.D).match(it)[1]||null;!s&&i.self&&i.self.location&&(s=i.self.location.protocol.slice(0,-1)),o=!Ft.test(s?s.toLowerCase():"")}n=o}if(n)re(e,"complete"),re(e,"success");else{e.m=6;try{var a=2<Ht(e)?e.g.statusText:""}catch(c){a=""}e.l=a+" ["+e.Z()+"]",Bt(e)}}finally{qt(e)}}}function qt(e,t){if(e.g){Wt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||re(e,"ready");try{n.onreadystatechange=r}catch(Jg){}}}function Wt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function Ht(e){return e.g?e.g.readyState:0}function Kt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(xs){return null}}function zt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Yt(e){this.Aa=0,this.i=[],this.j=new Oe,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=zt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=zt("baseRetryDelayMs",5e3,e),this.cb=zt("retryDelaySeedMs",1e4,e),this.Wa=zt("forwardChannelMaxRetries",2,e),this.wa=zt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Xe(e&&e.concurrentRequestLimit),this.Da=new At,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Jt(e){if(Qt(e),3==e.G){var t=e.U++,n=st(e.I);if(lt(n,"SID",e.K),lt(n,"RID",t),lt(n,"TYPE","terminate"),en(e,n),(t=new Me(e,e.j,t)).L=2,t.v=dt(st(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=pn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),qe(t)}dn(e)}function Xt(e){e.g&&(on(e),e.g.cancel(),e.g=null)}function Qt(e){Xt(e),e.u&&(i.clearTimeout(e.u),e.u=null),an(e),e.h.cancel(),e.s&&("number"===typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Zt(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;C||N(),A||(C(),A=!0),O.add(t,e),e.B=0}}function $t(e,t){var n;n=t?t.l:e.U++;const r=st(e.I);lt(r,"SID",e.K),lt(r,"RID",n),lt(r,"AID",e.T),en(e,r),e.m&&e.o&&xt(r,e.m,e.o),n=new Me(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),je(n,r,t)}function en(e,t){e.H&&E(e.H,(function(e,n){lt(t,n,e)})),e.l&&rt({},(function(e,n){lt(t,n,e)}))}function tn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?u(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g;const c=i[a].map;if(n-=t,0>n)t=Math.max(0,i[a].g-100),s=!1;else try{Ot(c,e,"req"+n+"_")}catch(o){r&&r(c)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function nn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;C||N(),A||(C(),A=!0),O.add(t,e),e.v=0}}function rn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Ae(u(e.Fa,e),un(e,e.v)),e.v++,!0)}function on(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function sn(e){e.g=new Me(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=st(e.qa);lt(t,"RID","rpc"),lt(t,"SID",e.K),lt(t,"AID",e.T),lt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&lt(t,"TO",e.ja),lt(t,"TYPE","xmlhttp"),en(e,t),e.m&&e.o&&xt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=dt(st(t)),n.m=null,n.P=!0,Ve(n,e)}function an(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function cn(e,t){var n=null;if(e.g==t){an(e),on(e),e.g=null;var r=2}else{if(!$e(e.h,t))return;n=t.D,tt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;re(r=Te(),new Ce(r,n)),Zt(e)}else nn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(Ze(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Ae(u(e.Ga,e,t),un(e,e.B)),e.B++,!0))}(e,t)||2==r&&rn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:ln(e,5);break;case 4:ln(e,10);break;case 3:ln(e,6);break;default:ln(e,2)}}function un(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function ln(e,t){if(e.j.info("Error code "+t),2==t){var n=u(e.fb,e),r=e.Xa;const t=!r;r=new ot(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||at(r,"https"),dt(r),t?function(e,t){const n=new Oe;if(i.Image){const r=new Image;r.onload=l(Ct,n,"TestLoadImage: loaded",!0,t,r),r.onerror=l(Ct,n,"TestLoadImage: error",!1,t,r),r.onabort=l(Ct,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=l(Ct,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Oe;const n=new AbortController,r=setTimeout((()=>{n.abort(),Ct(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?Ct(0,0,!0,t):Ct(0,0,!1,t)})).catch((()=>{clearTimeout(r),Ct(0,0,!1,t)}))}(r.toString(),n)}else Ie(2);e.G=0,e.l&&e.l.sa(t),dn(e),Qt(e)}function dn(e){if(e.G=0,e.ka=[],e.l){const t=nt(e.h);0==t.length&&0==e.i.length||(p(e.ka,t),p(e.ka,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.ra()}}function hn(e,t,n){var r=n instanceof ot?st(n):new ot(n);if(""!=r.g)t&&(r.g=t+"."+r.g),ct(r,r.s);else{var o=i.location;r=o.protocol,t=t?t+"."+o.hostname:o.hostname,o=+o.port;var s=new ot(null);r&&at(s,r),t&&(s.g=t),o&&ct(s,o),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&lt(r,n,t),lt(r,"VER",e.la),en(e,r),r}function pn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ut(new Nt({eb:n})):new Ut(e.pa)).Ha(e.J),t}function fn(){}function mn(){}function gn(e,t){ne.call(this),this.g=new Yt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!f(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!f(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new vn(this)}function _n(e){Ee.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function En(){ve.call(this),this.status=1}function vn(e){this.g=e}(e=Ut.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ke.g(),this.v=this.o?me(this.o):me(ke),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(s){return void Vt(this,s)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var o in r)n.set(o,r[o]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),o=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(jt,t,void 0))||r||o||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Wt(this),this.u=!0,this.g.send(e),this.u=!1}catch(s){Vt(this,s)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,re(this,"complete"),re(this,"abort"),qt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qt(this,!0)),Ut.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Gt(this):this.bb())},e.bb=function(){Gt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Ht(this)?this.g.status:-1}catch(mt){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(mt){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),he(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=Yt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Ie(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=hn(this,null,this.W),Zt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Me(this,this.j,e);let o=this.o;if(this.S&&(o?(o=v(o),b(o,this.S)):o=this.S),null!==this.m||this.O||(i.H=o,o=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tn(this,i,t),lt(n=st(this.I),"RID",e),lt(n,"CVER",22),this.D&&lt(n,"X-HTTP-Session-Id",this.D),en(this,n),o&&(this.O?t="headers="+encodeURIComponent(String(Mt(o)))+"&"+t:this.m&&xt(n,this.m,o)),et(this.h,i),this.Ua&&lt(n,"TYPE","init"),this.P?(lt(n,"$req",t),lt(n,"SID","null"),i.T=!0,je(i,n,null)):je(i,n,t),this.G=2}}else 3==this.G&&(e?$t(this,e):0==this.i.length||Qe(this.h)||$t(this))},e.Fa=function(){if(this.u=null,sn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ae(u(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ie(10),Xt(this),sn(this))},e.Za=function(){null!=this.C&&(this.C=null,Xt(this),rn(this),Ie(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ie(2)):(this.j.info("Failed to ping google.com"),Ie(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=fn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},mn.prototype.g=function(e,t){return new gn(e,t)},d(gn,ne),gn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},gn.prototype.close=function(){Jt(this.g)},gn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=de(e),e=n);t.i.push(new Je(t.Ya++,e)),3==t.G&&Zt(t)},gn.prototype.N=function(){this.g.l=null,delete this.j,Jt(this.g),delete this.g,gn.aa.N.call(this)},d(_n,Ee),d(En,ve),d(vn,fn),vn.prototype.ua=function(){re(this.g,"a")},vn.prototype.ta=function(e){re(this.g,new _n(e))},vn.prototype.sa=function(e){re(this.g,new En)},vn.prototype.ra=function(){re(this.g,"b")},mn.prototype.createWebChannel=mn.prototype.g,gn.prototype.send=gn.prototype.o,gn.prototype.open=gn.prototype.m,gn.prototype.close=gn.prototype.close,ks=Ps.createWebChannelTransport=function(){return new mn},Ns=Ps.getStatEventTarget=function(){return Te()},Os=Ps.Event=ye,As=Ps.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},De.NO_ERROR=0,De.TIMEOUT=8,De.HTTP_ERROR=6,Cs=Ps.ErrorCode=De,Pe.COMPLETE="complete",Is=Ps.EventType=Pe,ge.EventType=_e,_e.OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",ne.prototype.listen=ne.prototype.K,Rs=Ps.WebChannel=ge,ws=Ps.FetchXmlHttpFactory=Nt,Ut.prototype.listenOnce=Ut.prototype.L,Ut.prototype.getLastError=Ut.prototype.Ka,Ut.prototype.getLastErrorCode=Ut.prototype.Ba,Ut.prototype.getStatus=Ut.prototype.Z,Ut.prototype.getResponseJson=Ut.prototype.Oa,Ut.prototype.getResponseText=Ut.prototype.oa,Ut.prototype.send=Ut.prototype.ea,Ut.prototype.setWithCredentials=Ut.prototype.Ha,Ss=Ps.XhrIo=Ut}).apply("undefined"!==typeof Ds?Ds:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const Ls="@firebase/firestore";class Ms{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ms.UNAUTHENTICATED=new Ms(null),Ms.GOOGLE_CREDENTIALS=new Ms("google-credentials-uid"),Ms.FIRST_PARTY=new Ms("first-party-uid"),Ms.MOCK_USER=new Ms("mock-user");let xs="10.12.1";const Us=new lt("@firebase/firestore");function Fs(){return Us.logLevel}function js(e){if(Us.logLevel<=ot.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Gs);Us.debug("Firestore (".concat(xs,"): ").concat(e),...i)}}function Vs(e){if(Us.logLevel<=ot.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Gs);Us.error("Firestore (".concat(xs,"): ").concat(e),...i)}}function Bs(e){if(Us.logLevel<=ot.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(Gs);Us.warn("Firestore (".concat(xs,"): ").concat(e),...i)}}function Gs(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function qs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(xs,") INTERNAL ASSERTION FAILED: ")+e;throw Vs(t),new Error(t)}function Ws(e,t){e||qs()}function Hs(e,t){return e}const Ks={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class zs extends qe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class Ys{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Js{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class Xs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ms.UNAUTHENTICATED)))}shutdown(){}}class Qs{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Zs{constructor(e){this.t=e,this.currentUser=Ms.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Ys;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ys,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},s=e=>{js("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit((e=>s(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?s(e):(js("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ys)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(js("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Ws("string"==typeof t.accessToken),new Js(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Ws(null===e||"string"==typeof e),new Ms(e)}}class $s{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ms.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ea{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new $s(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Ms.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ta{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class na{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&js("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.R;return this.R=e.token,js("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{js("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):js("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Ws("string"==typeof e.token),this.R=e.token,new ta(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ra(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class ia{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=ra(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function oa(e,t){return e<t?-1:e>t?1:0}function sa(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class aa{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new zs(Ks.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new zs(Ks.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new zs(Ks.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new zs(Ks.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return aa.fromMillis(Date.now())}static fromDate(e){return aa.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new aa(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?oa(this.nanoseconds,e.nanoseconds):oa(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ca{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ca(e)}static min(){return new ca(new aa(0,0))}static max(){return new ca(new aa(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ua{constructor(e,t,n){void 0===t?t=0:t>e.length&&qs(),void 0===n?n=e.length-t:n>e.length-t&&qs(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ua.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ua?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class la extends ua{construct(e,t,n){return new la(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new zs(Ks.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));e.push(...i.split("/").filter((e=>e.length>0)))}return new la(e)}static emptyPath(){return new la([])}}const da=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ha extends ua{construct(e,t,n){return new ha(e,t,n)}static isValidIdentifier(e){return da.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ha.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ha(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new zs(Ks.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let o=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new zs(Ks.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new zs(Ks.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(o=!o,r++):"."!==t||o?(n+=t,r++):(i(),r++)}if(i(),o)throw new zs(Ks.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ha(t)}static emptyPath(){return new ha([])}}class pa{constructor(e){this.path=e}static fromPath(e){return new pa(la.fromString(e))}static fromName(e){return new pa(la.fromString(e).popFirst(5))}static empty(){return new pa(la.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===la.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return la.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new pa(new la(e.slice()))}}class fa{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}fa.UNKNOWN_ID=-1;function ma(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=ca.fromTimestamp(1e9===r?new aa(n+1,0):new aa(n,r));return new _a(i,pa.empty(),t)}function ga(e){return new _a(e.readTime,e.key,-1)}class _a{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new _a(ca.min(),pa.empty(),-1)}static max(){return new _a(ca.max(),pa.empty(),-1)}}function Ea(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=pa.comparator(e.documentKey,t.documentKey),0!==n?n:oa(e.largestBatchId,t.largestBatchId))}const va="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ya{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function ba(e){if(e.code!==Ks.FAILED_PRECONDITION||e.message!==va)throw e;js("LocalStore","Unexpectedly lost primary lease")}class Ta{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&qs(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ta(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ta?t:Ta.resolve(t)}catch(e){return Ta.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ta.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ta.reject(t)}static resolve(e){return new Ta(((t,n)=>{t(e)}))}static reject(e){return new Ta(((t,n)=>{n(e)}))}static waitFor(e){return new Ta(((t,n)=>{let r=0,i=0,o=!1;e.forEach((e=>{++r,e.next((()=>{++i,o&&i===r&&t()}),(e=>n(e)))})),o=!0,i===r&&t()}))}static or(e){let t=Ta.resolve(!1);for(const n of e)t=t.next((e=>e?Ta.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Ta(((n,r)=>{const i=e.length,o=new Array(i);let s=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{o[c]=e,++s,s===i&&n(o)}),(e=>r(e)))}}))}static doWhile(e,t){return new Ta(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}function Sa(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function wa(e){return"IndexedDbTransactionError"===e.name}class Ra{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function Ia(e){return null==e}function Ca(e){return 0===e&&1/e==-1/0}function Aa(e){return"number"==typeof e&&Number.isInteger(e)&&!Ca(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}Ra.oe=-1;const Oa=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Na=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ka=Na;function Da(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Pa(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function La(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ma{constructor(e,t){this.comparator=e,this.root=t||Ua.EMPTY}insert(e,t){return new Ma(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ua.BLACK,null,null))}remove(e){return new Ma(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ua.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push("".concat(t,":").concat(n)),!1))),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new xa(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new xa(this.root,e,this.comparator,!1)}getReverseIterator(){return new xa(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new xa(this.root,e,this.comparator,!0)}}class xa{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ua{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Ua.RED,this.left=null!=r?r:Ua.EMPTY,this.right=null!=i?i:Ua.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Ua(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ua.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Ua.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ua.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ua.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw qs();if(this.right.isRed())throw qs();const e=this.left.check();if(e!==this.right.check())throw qs();return e+(this.isRed()?0:1)}}Ua.EMPTY=null,Ua.RED=!0,Ua.BLACK=!1,Ua.EMPTY=new class{constructor(){this.size=0}get key(){throw qs()}get value(){throw qs()}get color(){throw qs()}get left(){throw qs()}get right(){throw qs()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Ua(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Fa{constructor(e){this.comparator=e,this.data=new Ma(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ja(this.data.getIterator())}getIteratorFrom(e){return new ja(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Fa))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Fa(this.comparator);return t.data=e,t}}class ja{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Va{constructor(e){this.fields=e,e.sort(ha.comparator)}static empty(){return new Va([])}unionWith(e){let t=new Fa(ha.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Va(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return sa(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Ba extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ga{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Ba("Invalid base64 string: "+e):e}}(e);return new Ga(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ga(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return oa(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ga.EMPTY_BYTE_STRING=new Ga("");const qa=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wa(e){if(Ws(!!e),"string"==typeof e){let t=0;const n=qa.exec(e);if(Ws(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Ha(e.seconds),nanos:Ha(e.nanos)}}function Ha(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ka(e){return"string"==typeof e?Ga.fromBase64String(e):Ga.fromUint8Array(e)}function za(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ya(e){const t=e.mapValue.fields.__previous_value__;return za(t)?Ya(t):t}function Ja(e){const t=Wa(e.mapValue.fields.__local_write_time__.timestampValue);return new aa(t.seconds,t.nanos)}class Xa{constructor(e,t,n,r,i,o,s,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.longPollingOptions=a,this.useFetchStreams=c}}class Qa{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Qa("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Qa&&e.projectId===this.projectId&&e.database===this.database}}const Za={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function $a(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?za(e)?4:pc(e)?9007199254740991:10:qs()}function ec(e,t){if(e===t)return!0;const n=$a(e);if(n!==$a(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ja(e).isEqual(Ja(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Wa(e.timestampValue),r=Wa(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ka(e.bytesValue).isEqual(Ka(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ha(e.geoPointValue.latitude)===Ha(t.geoPointValue.latitude)&&Ha(e.geoPointValue.longitude)===Ha(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ha(e.integerValue)===Ha(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Ha(e.doubleValue),r=Ha(t.doubleValue);return n===r?Ca(n)===Ca(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return sa(e.arrayValue.values||[],t.arrayValue.values||[],ec);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Da(n)!==Da(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ec(n[i],r[i])))return!1;return!0}(e,t);default:return qs()}}function tc(e,t){return void 0!==(e.values||[]).find((e=>ec(e,t)))}function nc(e,t){if(e===t)return 0;const n=$a(e),r=$a(t);if(n!==r)return oa(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return oa(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Ha(e.integerValue||e.doubleValue),r=Ha(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return rc(e.timestampValue,t.timestampValue);case 4:return rc(Ja(e),Ja(t));case 5:return oa(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ka(e),r=Ka(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=oa(n[i],r[i]);if(0!==e)return e}return oa(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=oa(Ha(e.latitude),Ha(t.latitude));return 0!==n?n:oa(Ha(e.longitude),Ha(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=nc(n[i],r[i]);if(e)return e}return oa(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Za.mapValue&&t===Za.mapValue)return 0;if(e===Za.mapValue)return 1;if(t===Za.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},o=Object.keys(i);r.sort(),o.sort();for(let s=0;s<r.length&&s<o.length;++s){const e=oa(r[s],o[s]);if(0!==e)return e;const t=nc(n[r[s]],i[o[s]]);if(0!==t)return t}return oa(r.length,o.length)}(e.mapValue,t.mapValue);default:throw qs()}}function rc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return oa(e,t);const n=Wa(e),r=Wa(t),i=oa(n.seconds,r.seconds);return 0!==i?i:oa(n.nanos,r.nanos)}function ic(e){return oc(e)}function oc(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Wa(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Ka(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return pa.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=oc(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+="".concat(i,":").concat(oc(e.fields[i]));return n+"}"}(e.mapValue):qs()}function sc(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function ac(e){return!!e&&"integerValue"in e}function cc(e){return!!e&&"arrayValue"in e}function uc(e){return!!e&&"nullValue"in e}function lc(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function dc(e){return!!e&&"mapValue"in e}function hc(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Pa(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=hc(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=hc(e.arrayValue.values[n]);return t}return Object.assign({},e)}function pc(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class fc{constructor(e){this.value=e}static empty(){return new fc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!dc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hc(t)}setAll(e){let t=ha.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=hc(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());dc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ec(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];dc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Pa(t,((t,n)=>e[t]=n));for(const r of n)delete e[r]}clone(){return new fc(hc(this.value))}}function mc(e){const t=[];return Pa(e.fields,((e,n)=>{const r=new ha([e]);if(dc(n)){const e=mc(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Va(t)}class gc{constructor(e,t,n,r,i,o,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=o,this.documentState=s}static newInvalidDocument(e){return new gc(e,0,ca.min(),ca.min(),ca.min(),fc.empty(),0)}static newFoundDocument(e,t,n,r){return new gc(e,1,t,ca.min(),n,r,0)}static newNoDocument(e,t){return new gc(e,2,t,ca.min(),ca.min(),fc.empty(),0)}static newUnknownDocument(e,t){return new gc(e,3,t,ca.min(),ca.min(),fc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ca.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=fc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=fc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ca.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof gc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new gc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class _c{constructor(e,t){this.position=e,this.inclusive=t}}function Ec(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const o=t[i],s=e.position[i];if(r=o.field.isKeyField()?pa.comparator(pa.fromName(s.referenceValue),n.key):nc(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return r}function vc(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ec(e.position[n],t.position[n]))return!1;return!0}class yc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function bc(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Tc{}class Sc extends Tc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new kc(e,t,n):"array-contains"===t?new Mc(e,n):"in"===t?new xc(e,n):"not-in"===t?new Uc(e,n):"array-contains-any"===t?new Fc(e,n):new Sc(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Dc(e,n):new Pc(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(nc(t,this.value)):null!==t&&$a(this.value)===$a(t)&&this.matchesComparison(nc(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return qs()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class wc extends Tc{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new wc(e,t)}matches(e){return Rc(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Rc(e){return"and"===e.op}function Ic(e){return Cc(e)&&Rc(e)}function Cc(e){for(const t of e.filters)if(t instanceof wc)return!1;return!0}function Ac(e){if(e instanceof Sc)return e.field.canonicalString()+e.op.toString()+ic(e.value);if(Ic(e))return e.filters.map((e=>Ac(e))).join(",");{const t=e.filters.map((e=>Ac(e))).join(",");return"".concat(e.op,"(").concat(t,")")}}function Oc(e,t){return e instanceof Sc?function(e,t){return t instanceof Sc&&e.op===t.op&&e.field.isEqual(t.field)&&ec(e.value,t.value)}(e,t):e instanceof wc?function(e,t){return t instanceof wc&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&Oc(n,t.filters[r])),!0)}(e,t):void qs()}function Nc(e){return e instanceof Sc?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(ic(e.value))}(e):e instanceof wc?function(e){return e.op.toString()+" {"+e.getFilters().map(Nc).join(" ,")+"}"}(e):"Filter"}class kc extends Sc{constructor(e,t,n){super(e,t,n),this.key=pa.fromName(n.referenceValue)}matches(e){const t=pa.comparator(e.key,this.key);return this.matchesComparison(t)}}class Dc extends Sc{constructor(e,t){super(e,"in",t),this.keys=Lc("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Pc extends Sc{constructor(e,t){super(e,"not-in",t),this.keys=Lc("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Lc(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>pa.fromName(e.referenceValue)))}class Mc extends Sc{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return cc(t)&&tc(t.arrayValue,this.value)}}class xc extends Sc{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&tc(this.value.arrayValue,t)}}class Uc extends Sc{constructor(e,t){super(e,"not-in",t)}matches(e){if(tc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!tc(this.value.arrayValue,t)}}class Fc extends Sc{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!cc(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>tc(this.value.arrayValue,e)))}}class jc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.ue=null}}function Vc(e){return new jc(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Bc(e){const t=Hs(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Ac(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Ia(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>ic(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>ic(e))).join(",")),t.ue=e}return t.ue}function Gc(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!bc(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Oc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!vc(e.startAt,t.startAt)&&vc(e.endAt,t.endAt)}function qc(e){return pa.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Wc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Hc(e,t,n,r,i,o,s,a){return new Wc(e,t,n,r,i,o,s,a)}function Kc(e){return new Wc(e)}function zc(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Yc(e){return null!==e.collectionGroup}function Jc(e){const t=Hs(e);if(null===t.ce){t.ce=[];const e=new Set;for(const i of t.explicitOrderBy)t.ce.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Fa(ha.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new yc(r,n))})),e.has(ha.keyField().canonicalString())||t.ce.push(new yc(ha.keyField(),n))}return t.ce}function Xc(e){const t=Hs(e);return t.le||(t.le=Qc(t,Jc(e))),t.le}function Qc(e,t){if("F"===e.limitType)return Vc(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new yc(e.field,t)}));const n=e.endAt?new _c(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new _c(e.startAt.position,e.startAt.inclusive):null;return Vc(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Zc(e,t){const n=e.filters.concat([t]);return new Wc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function $c(e,t,n){return new Wc(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function eu(e,t){return Gc(Xc(e),Xc(t))&&e.limitType===t.limitType}function tu(e){return"".concat(Bc(Xc(e)),"|lt:").concat(e.limitType)}function nu(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((e=>Nc(e))).join(", "),"]")),Ia(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e))).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>ic(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>ic(e))).join(",")),"Target(".concat(t,")")}(Xc(e)),"; limitType=").concat(e.limitType,")")}function ru(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):pa.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Jc(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Ec(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Jc(e),t))&&!(e.endAt&&!function(e,t,n){const r=Ec(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Jc(e),t))}(e,t)}function iu(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function ou(e){return(t,n)=>{let r=!1;for(const i of Jc(e)){const e=su(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function su(e,t,n){const r=e.field.isKeyField()?pa.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?nc(r,i):qs()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return qs()}}class au{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Pa(this.inner,((t,n)=>{for(const[r,i]of n)e(r,i)}))}isEmpty(){return La(this.inner)}size(){return this.innerSize}}const cu=new Ma(pa.comparator);function uu(){return cu}const lu=new Ma(pa.comparator);function du(){let e=lu;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.insert(i.key,i);return e}function hu(e){let t=lu;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function pu(){return mu()}function fu(){return mu()}function mu(){return new au((e=>e.toString()),((e,t)=>e.isEqual(t)))}const gu=new Ma(pa.comparator),_u=new Fa(pa.comparator);function Eu(){let e=_u;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.add(i);return e}const vu=new Fa(oa);function yu(){return vu}function bu(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ca(t)?"-0":t}}function Tu(e){return{integerValue:""+e}}function Su(e,t){return Aa(t)?Tu(t):bu(e,t)}class wu{constructor(){this._=void 0}}function Ru(e,t,n){return e instanceof Au?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&za(t)&&(t=Ya(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Ou?Nu(e,t):e instanceof ku?Du(e,t):function(e,t){const n=Cu(e,t),r=Lu(n)+Lu(e.Pe);return ac(n)&&ac(e.Pe)?Tu(r):bu(e.serializer,r)}(e,t)}function Iu(e,t,n){return e instanceof Ou?Nu(e,t):e instanceof ku?Du(e,t):n}function Cu(e,t){return e instanceof Pu?function(e){return ac(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Au extends wu{}class Ou extends wu{constructor(e){super(),this.elements=e}}function Nu(e,t){const n=Mu(t);for(const r of e.elements)n.some((e=>ec(e,r)))||n.push(r);return{arrayValue:{values:n}}}class ku extends wu{constructor(e){super(),this.elements=e}}function Du(e,t){let n=Mu(t);for(const r of e.elements)n=n.filter((e=>!ec(e,r)));return{arrayValue:{values:n}}}class Pu extends wu{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Lu(e){return Ha(e.integerValue||e.doubleValue)}function Mu(e){return cc(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class xu{constructor(e,t){this.field=e,this.transform=t}}class Uu{constructor(e,t){this.version=e,this.transformResults=t}}class Fu{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Fu}static exists(e){return new Fu(void 0,e)}static updateTime(e){return new Fu(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ju(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Vu{}function Bu(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Qu(e.key,Fu.none()):new Ku(e.key,e.data,Fu.none());{const n=e.data,r=fc.empty();let i=new Fa(ha.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new zu(e.key,r,new Va(i.toArray()),Fu.none())}}function Gu(e,t,n){e instanceof Ku?function(e,t,n){const r=e.value.clone(),i=Ju(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof zu?function(e,t,n){if(!ju(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Ju(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Yu(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function qu(e,t,n,r){return e instanceof Ku?function(e,t,n,r){if(!ju(e.precondition,t))return n;const i=e.value.clone(),o=Xu(e.fieldTransforms,r,t);return i.setAll(o),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof zu?function(e,t,n,r){if(!ju(e.precondition,t))return n;const i=Xu(e.fieldTransforms,r,t),o=t.data;return o.setAll(Yu(e)),o.setAll(i),t.convertToFoundDocument(t.version,o).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return ju(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Wu(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Cu(r.transform,e||null);null!=i&&(null===n&&(n=fc.empty()),n.set(r.field,i))}return n||null}function Hu(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&sa(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ou&&t instanceof Ou||e instanceof ku&&t instanceof ku?sa(e.elements,t.elements,ec):e instanceof Pu&&t instanceof Pu?ec(e.Pe,t.Pe):e instanceof Au&&t instanceof Au}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ku extends Vu{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class zu extends Vu{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Yu(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Ju(e,t,n){const r=new Map;Ws(e.length===n.length);for(let i=0;i<n.length;i++){const o=e[i],s=o.transform,a=t.data.field(o.field);r.set(o.field,Iu(s,a,n[i]))}return r}function Xu(e,t,n){const r=new Map;for(const i of e){const e=i.transform,o=n.data.field(i.field);r.set(i.field,Ru(e,o,t))}return r}class Qu extends Vu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Zu extends Vu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $u{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Gu(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=qu(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=qu(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=fu();return this.mutations.forEach((r=>{const i=e.get(r.key),o=i.overlayedDocument;let s=this.applyToLocalView(o,i.mutatedFields);s=t.has(r.key)?null:s;const a=Bu(o,s);null!==a&&n.set(r.key,a),o.isValidDocument()||o.convertToNoDocument(ca.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Eu())}isEqual(e){return this.batchId===e.batchId&&sa(this.mutations,e.mutations,((e,t)=>Hu(e,t)))&&sa(this.baseMutations,e.baseMutations,((e,t)=>Hu(e,t)))}}class el{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Ws(e.mutations.length===n.length);let r=gu;const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new el(e,t,n,r)}}class tl{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class nl{constructor(e,t){this.count=e,this.unchangedNames=t}}var rl,il;function ol(e){switch(e){default:return qs();case Ks.CANCELLED:case Ks.UNKNOWN:case Ks.DEADLINE_EXCEEDED:case Ks.RESOURCE_EXHAUSTED:case Ks.INTERNAL:case Ks.UNAVAILABLE:case Ks.UNAUTHENTICATED:return!1;case Ks.INVALID_ARGUMENT:case Ks.NOT_FOUND:case Ks.ALREADY_EXISTS:case Ks.PERMISSION_DENIED:case Ks.FAILED_PRECONDITION:case Ks.ABORTED:case Ks.OUT_OF_RANGE:case Ks.UNIMPLEMENTED:case Ks.DATA_LOSS:return!0}}function sl(e){if(void 0===e)return Vs("GRPC error has no .code"),Ks.UNKNOWN;switch(e){case rl.OK:return Ks.OK;case rl.CANCELLED:return Ks.CANCELLED;case rl.UNKNOWN:return Ks.UNKNOWN;case rl.DEADLINE_EXCEEDED:return Ks.DEADLINE_EXCEEDED;case rl.RESOURCE_EXHAUSTED:return Ks.RESOURCE_EXHAUSTED;case rl.INTERNAL:return Ks.INTERNAL;case rl.UNAVAILABLE:return Ks.UNAVAILABLE;case rl.UNAUTHENTICATED:return Ks.UNAUTHENTICATED;case rl.INVALID_ARGUMENT:return Ks.INVALID_ARGUMENT;case rl.NOT_FOUND:return Ks.NOT_FOUND;case rl.ALREADY_EXISTS:return Ks.ALREADY_EXISTS;case rl.PERMISSION_DENIED:return Ks.PERMISSION_DENIED;case rl.FAILED_PRECONDITION:return Ks.FAILED_PRECONDITION;case rl.ABORTED:return Ks.ABORTED;case rl.OUT_OF_RANGE:return Ks.OUT_OF_RANGE;case rl.UNIMPLEMENTED:return Ks.UNIMPLEMENTED;case rl.DATA_LOSS:return Ks.DATA_LOSS;default:return qs()}}(il=rl||(rl={}))[il.OK=0]="OK",il[il.CANCELLED=1]="CANCELLED",il[il.UNKNOWN=2]="UNKNOWN",il[il.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",il[il.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",il[il.NOT_FOUND=5]="NOT_FOUND",il[il.ALREADY_EXISTS=6]="ALREADY_EXISTS",il[il.PERMISSION_DENIED=7]="PERMISSION_DENIED",il[il.UNAUTHENTICATED=16]="UNAUTHENTICATED",il[il.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",il[il.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",il[il.ABORTED=10]="ABORTED",il[il.OUT_OF_RANGE=11]="OUT_OF_RANGE",il[il.UNIMPLEMENTED=12]="UNIMPLEMENTED",il[il.INTERNAL=13]="INTERNAL",il[il.UNAVAILABLE=14]="UNAVAILABLE",il[il.DATA_LOSS=15]="DATA_LOSS";let al=null;function cl(){return new TextEncoder}const ul=new vs([4294967295,4294967295],0);function ll(e){const t=cl().encode(e),n=new ys;return n.update(t),new Uint8Array(n.digest())}function dl(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new vs([n,r],0),new vs([i,o],0)]}class hl{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new pl("Invalid padding: ".concat(t));if(n<0)throw new pl("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new pl("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new pl("Invalid padding when bitmap length is 0: ".concat(t));this.Ie=8*e.length-t,this.Te=vs.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(vs.fromNumber(n)));return 1===r.compare(ul)&&(r=new vs([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=ll(e),[n,r]=dl(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,r,i);if(!this.de(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new hl(i,r,t);return n.forEach((e=>o.insert(e))),o}insert(e){if(0===this.Ie)return;const t=ll(e),[n,r]=dl(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,r,i);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class pl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class fl{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ml.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new fl(ca.min(),r,new Ma(oa),uu(),Eu())}}class ml{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ml(n,t,Eu(),Eu(),Eu())}}class gl{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class _l{constructor(e,t){this.targetId=e,this.me=t}}class El{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ga.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class vl{constructor(){this.fe=0,this.ge=Tl(),this.pe=Ga.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=Eu(),t=Eu(),n=Eu();return this.ge.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:qs()}})),new ml(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=Tl()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ws(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class yl{constructor(e){this.Le=e,this.Be=new Map,this.ke=uu(),this.qe=bl(),this.Qe=new Ma(oa)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:qs()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach(((e,n)=>{this.ze(n)&&t(n)}))}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){const i=r.target;if(qc(i))if(0===n){const e=new pa(i.path);this.Ue(t,e,gc.newNoDocument(e,ca.min()))}else Ws(1===n);else{const r=this.Ye(t);if(r!==n){const n=this.Ze(e),i=n?this.Xe(n,e,r):1;if(0!==i){this.je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}null==al||al.et(function(e,t,n,r,i){var o,s,a,c,u,l;const d={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(d.bloomFilter={applied:0===i,hashCount:null!==(o=null==h?void 0:h.hashCount)&&void 0!==o?o:0,bitmapLength:null!==(c=null===(a=null===(s=null==h?void 0:h.bits)||void 0===s?void 0:s.bitmap)||void 0===a?void 0:a.length)&&void 0!==c?c:0,padding:null!==(l=null===(u=null==h?void 0:h.bits)||void 0===u?void 0:u.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),d}(r,e.me,this.Le.tt(),n,i))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let o,s;try{o=Ka(n).toUint8Array()}catch(e){if(e instanceof Ba)return Bs("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{s=new hl(o,r,i)}catch(e){return Bs(e instanceof pl?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===s.Ie?null:s}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Le.tt(),o="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());e.mightContain(o)||(this.Ue(t,n,null),r++)})),r}rt(e){const t=new Map;this.Be.forEach(((n,r)=>{const i=this.Je(r);if(i){if(n.current&&qc(i.target)){const t=new pa(i.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,gc.newNoDocument(t,e))}n.be&&(t.set(r,n.Ce()),n.ve())}}));let n=Eu();this.qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.ke.forEach(((t,n)=>n.setReadTime(e)));const r=new fl(e,t,this.Qe,this.ke,n);return this.ke=uu(),this.qe=bl(),this.Qe=new Ma(oa),r}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new vl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Fa(oa),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||js("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new vl),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function bl(){return new Ma(pa.comparator)}function Tl(){return new Ma(pa.comparator)}const Sl={asc:"ASCENDING",desc:"DESCENDING"},wl={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Rl={and:"AND",or:"OR"};class Il{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Cl(e,t){return e.useProto3Json||Ia(t)?t:{value:t}}function Al(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ol(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Nl(e,t){return Al(e,t.toTimestamp())}function kl(e){return Ws(!!e),ca.fromTimestamp(function(e){const t=Wa(e);return new aa(t.seconds,t.nanos)}(e))}function Dl(e,t){return Pl(e,t).canonicalString()}function Pl(e,t){const n=function(e){return new la(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Ll(e){const t=la.fromString(e);return Ws(ed(t)),t}function Ml(e,t){return Dl(e.databaseId,t.path)}function xl(e,t){const n=Ll(t);if(n.get(1)!==e.databaseId.projectId)throw new zs(Ks.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new zs(Ks.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new pa(Vl(n))}function Ul(e,t){return Dl(e.databaseId,t)}function Fl(e){const t=Ll(e);return 4===t.length?la.emptyPath():Vl(t)}function jl(e){return new la(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Vl(e){return Ws(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Bl(e,t,n){return{name:Ml(e,t),fields:n.value.mapValue.fields}}function Gl(e,t){let n;if(t instanceof Ku)n={update:Bl(e,t.key,t.value)};else if(t instanceof Qu)n={delete:Ml(e,t.key)};else if(t instanceof zu)n={update:Bl(e,t.key,t.data),updateMask:$l(t.fieldMask)};else{if(!(t instanceof Zu))return qs();n={verify:Ml(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Au)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ou)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ku)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Pu)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw qs()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Nl(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:qs()}(e,t.precondition)),n}function ql(e,t){return{documents:[Ul(e,t.path)]}}function Wl(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Ul(e,i);const o=function(e){if(0!==e.length)return Zl(wc.create(e,"and"))}(t.filters);o&&(n.structuredQuery.where=o);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Xl(e.field),direction:zl(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const a=Cl(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:i}}function Hl(e){let t=Fl(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Ws(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let o=[];n.where&&(o=function(e){const t=Kl(e);return t instanceof wc&&Ic(t)?t.getFilters():[t]}(n.where));let s=[];n.orderBy&&(s=function(e){return e.map((e=>function(e){return new yc(Ql(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ia(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new _c(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new _c(n,t)}(n.endAt)),Hc(t,i,s,o,a,"F",c,u)}function Kl(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Ql(e.unaryFilter.field);return Sc.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Ql(e.unaryFilter.field);return Sc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ql(e.unaryFilter.field);return Sc.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ql(e.unaryFilter.field);return Sc.create(i,"!=",{nullValue:"NULL_VALUE"});default:return qs()}}(e):void 0!==e.fieldFilter?function(e){return Sc.create(Ql(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return qs()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return wc.create(e.compositeFilter.filters.map((e=>Kl(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return qs()}}(e.compositeFilter.op))}(e):qs()}function zl(e){return Sl[e]}function Yl(e){return wl[e]}function Jl(e){return Rl[e]}function Xl(e){return{fieldPath:e.canonicalString()}}function Ql(e){return ha.fromServerFormat(e.fieldPath)}function Zl(e){return e instanceof Sc?function(e){if("=="===e.op){if(lc(e.value))return{unaryFilter:{field:Xl(e.field),op:"IS_NAN"}};if(uc(e.value))return{unaryFilter:{field:Xl(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(lc(e.value))return{unaryFilter:{field:Xl(e.field),op:"IS_NOT_NAN"}};if(uc(e.value))return{unaryFilter:{field:Xl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xl(e.field),op:Yl(e.op),value:e.value}}}(e):e instanceof wc?function(e){const t=e.getFilters().map((e=>Zl(e)));return 1===t.length?t[0]:{compositeFilter:{op:Jl(e.op),filters:t}}}(e):qs()}function $l(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function ed(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class td{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ca.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ca.min(),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ga.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s,this.expectedCount=a}withSequenceNumber(e){return new td(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new td(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new td(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new td(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class nd{constructor(e){this.ct=e}}function rd(e){const t=Hl({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?$c(t,t.limit,"L"):t}class id{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Ha(e.integerValue));else if("doubleValue"in e){const n=Ha(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),Ca(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n&&(n=Wa(n)),t.At("".concat(n.seconds||"")),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Ka(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?pc(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):qs()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const r of Object.keys(n))this.Rt(r,t),this.It(n[r],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const r of n)this.It(r,t)}gt(e,t){this.Et(t,37),pa.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}id.bt=new id;class od{constructor(){this._n=new sd}addToCollectionParentIndex(e,t){return this._n.add(t),Ta.resolve()}getCollectionParents(e,t){return Ta.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Ta.resolve()}deleteFieldIndex(e,t){return Ta.resolve()}deleteAllFieldIndexes(e){return Ta.resolve()}createTargetIndexes(e,t){return Ta.resolve()}getDocumentsMatchingTarget(e,t){return Ta.resolve(null)}getIndexType(e,t){return Ta.resolve(0)}getFieldIndexes(e,t){return Ta.resolve([])}getNextCollectionGroupToUpdate(e){return Ta.resolve(null)}getMinOffset(e,t){return Ta.resolve(_a.min())}getMinOffsetFromCollectionGroup(e,t){return Ta.resolve(_a.min())}updateCollectionGroup(e,t,n){return Ta.resolve()}updateIndexEntries(e,t){return Ta.resolve()}}class sd{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Fa(la.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Fa(la.comparator)).toArray()}}new Uint8Array(0);class ad{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ad(e,ad.DEFAULT_COLLECTION_PERCENTILE,ad.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}ad.DEFAULT_COLLECTION_PERCENTILE=10,ad.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ad.DEFAULT=new ad(41943040,ad.DEFAULT_COLLECTION_PERCENTILE,ad.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ad.DISABLED=new ad(-1,0,0);class cd{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new cd(0)}static Ln(){return new cd(-1)}}class ud{constructor(){this.changes=new au((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,gc.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Ta.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ld{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class dd{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&qu(n.mutation,e,Va.empty(),aa.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Eu()).next((()=>t))))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Eu();const r=pu();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=du();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=pu();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Eu())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=uu();const o=mu(),s=mu();return t.forEach(((e,t)=>{const s=n.get(t.key);r.has(t.key)&&(void 0===s||s.mutation instanceof zu)?i=i.insert(t.key,t):void 0!==s?(o.set(t.key,s.mutation.getFieldMask()),qu(s.mutation,t,s.mutation.getFieldMask(),aa.now())):o.set(t.key,Va.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>o.set(e,t))),t.forEach(((e,t)=>{var n;return s.set(e,new ld(t,null!==(n=o.get(e))&&void 0!==n?n:null))})),s)))}recalculateAndSaveOverlays(e,t){const n=mu();let r=new Ma(((e,t)=>e-t)),i=Eu();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const o=t.get(e);if(null===o)return;let s=n.get(e)||Va.empty();s=i.applyToLocalView(o,s),n.set(e,s);const a=(r.get(i.batchId)||Eu()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const o=[],s=r.getReverseIterator();for(;s.hasNext();){const r=s.getNext(),a=r.key,c=r.value,u=fu();c.forEach((e=>{if(!i.has(e)){const r=Bu(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),o.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Ta.waitFor(o)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return pa.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Yc(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Ta.resolve(pu());let s=-1,a=i;return o.next((t=>Ta.forEach(t,((t,n)=>(s<n.largestBatchId&&(s=n.largestBatchId),i.get(t)?Ta.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,Eu()))).next((e=>({batchId:s,changes:hu(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new pa(t)).next((e=>{let t=du();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let o=du();return this.indexManager.getCollectionParents(e,i).next((s=>Ta.forEach(s,(s=>{const a=function(e,t){return new Wc(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{o=o.insert(e,t)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,gc.newInvalidDocument(r)))}));let n=du();return e.forEach(((e,r)=>{const o=i.get(e);void 0!==o&&qu(o.mutation,r,Va.empty(),aa.now()),ru(t,r)&&(n=n.insert(e,r))})),n}))}}class hd{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Ta.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:kl(e.createTime)}}(t)),Ta.resolve()}getNamedQuery(e,t){return Ta.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:rd(e.bundledQuery),readTime:kl(e.readTime)}}(t)),Ta.resolve()}}class pd{constructor(){this.overlays=new Ma(pa.comparator),this.hr=new Map}getOverlay(e,t){return Ta.resolve(this.overlays.get(t))}getOverlays(e,t){const n=pu();return Ta.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),Ta.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),Ta.resolve()}getOverlaysForCollection(e,t,n){const r=pu(),i=t.length+1,o=new pa(t.child("")),s=this.overlays.getIteratorFrom(o);for(;s.hasNext();){const e=s.getNext().value,o=e.getKey();if(!t.isPrefixOf(o.path))break;o.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Ta.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Ma(((e,t)=>e-t));const o=this.overlays.getIterator();for(;o.hasNext();){const e=o.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=pu(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const s=pu(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>s.set(e,t))),!(s.size()>=r)););return Ta.resolve(s)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new tl(t,n));let i=this.hr.get(t);void 0===i&&(i=Eu(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class fd{constructor(){this.Pr=new Fa(md.Ir),this.Tr=new Fa(md.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new md(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new md(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new pa(new la([])),n=new md(t,e),r=new md(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new pa(new la([])),n=new md(t,e),r=new md(t,e+1);let i=Eu();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new md(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class md{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return pa.comparator(e.key,t.key)||oa(e.pr,t.pr)}static Er(e,t){return oa(e.pr,t.pr)||pa.comparator(e.key,t.key)}}class gd{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Fa(md.Ir)}checkEmpty(e){return Ta.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new $u(i,t,n,r);this.mutationQueue.push(o);for(const s of r)this.wr=this.wr.add(new md(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast());return Ta.resolve(o)}lookupMutationBatch(e,t){return Ta.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return Ta.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Ta.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Ta.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new md(t,0),r=new md(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),Ta.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Fa(oa);return t.forEach((e=>{const t=new md(e,0),r=new md(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),Ta.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;pa.isDocumentKey(i)||(i=i.child(""));const o=new md(new pa(i),0);let s=new Fa(oa);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e.pr)),!0)}),o),Ta.resolve(this.Dr(s))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Ws(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Ta.forEach(t.mutations,(r=>{const i=new md(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new md(t,0),r=this.wr.firstAfterOrEqual(n);return Ta.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ta.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class _d{constructor(e){this.vr=e,this.docs=new Ma(pa.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,o=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ta.resolve(n?n.document.mutableCopy():gc.newInvalidDocument(t))}getEntries(e,t){let n=uu();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():gc.newInvalidDocument(e))})),Ta.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=uu();const o=t.path,s=new pa(o.child("")),a=this.docs.getIteratorFrom(s);for(;a.hasNext();){const{key:e,value:{document:s}}=a.getNext();if(!o.isPrefixOf(e.path))break;e.path.length>o.length+1||Ea(ga(s),n)<=0||(r.has(s.key)||ru(t,s))&&(i=i.insert(s.key,s.mutableCopy()))}return Ta.resolve(i)}getAllFromCollectionGroup(e,t,n,r){qs()}Fr(e,t){return Ta.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Ed(this)}getSize(e){return Ta.resolve(this.size)}}class Ed extends ud{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),Ta.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class vd{constructor(e){this.persistence=e,this.Mr=new au((e=>Bc(e)),Gc),this.lastRemoteSnapshotVersion=ca.min(),this.highestTargetId=0,this.Or=0,this.Nr=new fd,this.targetCount=0,this.Lr=cd.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),Ta.resolve()}getLastRemoteSnapshotVersion(e){return Ta.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ta.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),Ta.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Ta.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new cd(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Ta.resolve()}updateTargetData(e,t){return this.qn(t),Ta.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Ta.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((o,s)=>{s.sequenceNumber<=t&&null===n.get(s.targetId)&&(this.Mr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,s.targetId)),r++)})),Ta.waitFor(i).next((()=>r))}getTargetCount(e){return Ta.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Ta.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Ta.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Ta.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Ta.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Ta.resolve(n)}containsKey(e,t){return Ta.resolve(this.Nr.containsKey(t))}}class yd{constructor(e,t){this.Br={},this.overlays={},this.kr=new Ra(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new vd(this),this.indexManager=new od,this.remoteDocumentCache=function(e){return new _d(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new nd(t),this.$r=new hd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new pd,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new gd(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){js("MemoryPersistence","Starting transaction:",e);const r=new bd(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return Ta.or(Object.values(this.Br).map((n=>()=>n.containsKey(e,t))))}}class bd extends ya{constructor(e){super(),this.currentSequenceNumber=e}}class Td{constructor(e){this.persistence=e,this.zr=new fd,this.jr=null}static Hr(e){return new Td(e)}get Jr(){if(this.jr)return this.jr;throw qs()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Ta.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Ta.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Ta.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ta.forEach(this.Jr,(n=>{const r=pa.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,ca.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return Ta.or([()=>Ta.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Sd{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=Eu(),r=Eu();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Sd(e,t.fromCache,n,r)}}class wd{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Rd{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=Be()?8:Sa(Ve())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new wd;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(Fs()<=ot.DEBUG&&js("QueryEngine","SDK will not create cache indexes for query:",nu(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Ta.resolve()):(Fs()<=ot.DEBUG&&js("QueryEngine","Query:",nu(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Fs()<=ot.DEBUG&&js("QueryEngine","The SDK decides to create cache indexes for query:",nu(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Xc(t))):Ta.resolve())}ji(e,t){if(zc(t))return Ta.resolve(null);let n=Xc(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=$c(t,null,"F"),n=Xc(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=Eu(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const o=this.Zi(t,r);return this.Xi(t,o,i,n.readTime)?this.ji(e,$c(t,null,"F")):this.es(e,o,t,n)}))))})))))}Hi(e,t,n,r){return zc(t)||r.isEqual(ca.min())?Ta.resolve(null):this.zi.getDocuments(e,n).next((i=>{const o=this.Zi(t,i);return this.Xi(t,o,n,r)?Ta.resolve(null):(Fs()<=ot.DEBUG&&js("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),nu(t)),this.es(e,o,t,ma(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new Fa(ou(e));return t.forEach(((t,r)=>{ru(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return Fs()<=ot.DEBUG&&js("QueryEngine","Using full collection scan to execute query:",nu(t)),this.zi.getDocumentsMatchingQuery(e,t,_a.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Id{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new Ma(oa),this.rs=new au((e=>Bc(e)),Gc),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new dd(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}function Cd(e,t,n,r){return new Id(e,t,n,r)}async function Ad(e,t){const n=Hs(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],o=[];let s=Eu();for(const e of r){i.push(e.batchId);for(const t of e.mutations)s=s.add(t.key)}for(const e of t){o.push(e.batchId);for(const t of e.mutations)s=s.add(t.key)}return n.localDocuments.getDocuments(e,s).next((e=>({us:e,removedBatchIds:i,addedBatchIds:o})))}))}))}function Od(e){const t=Hs(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function Nd(e,t,n){let r=Eu(),i=Eu();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=uu();return n.forEach(((n,o)=>{const s=e.get(n);o.isFoundDocument()!==s.isFoundDocument()&&(i=i.add(n)),o.isNoDocument()&&o.version.isEqual(ca.min())?(t.removeEntry(n,o.readTime),r=r.insert(n,o)):!s.isValidDocument()||o.version.compareTo(s.version)>0||0===o.version.compareTo(s.version)&&s.hasPendingWrites?(t.addEntry(o),r=r.insert(n,o)):js("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",o.version)})),{cs:r,ls:i}}))}function kd(e,t){const n=Hs(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function Dd(e,t){const n=Hs(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,Ta.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new td(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}async function Pd(e,t,n){const r=Hs(e),i=r.ns.get(t),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!wa(e))throw e;js("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e))}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function Ld(e,t,n){const r=Hs(e);let i=ca.min(),o=Eu();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=Hs(e),i=r.rs.get(n);return void 0!==i?Ta.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,Xc(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{o=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:ca.min(),n?o:Eu()))).next((e=>(Md(r,iu(t),e),{documents:e,hs:o})))))}function Md(e,t,n){let r=e.ss.get(t)||ca.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}class xd{constructor(){this.activeTargetIds=yu()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ud{constructor(){this.no=new xd,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new xd,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Fd{io(e){}shutdown(){}}class jd{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){js("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){js("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Vd=null;function Bd(){return null===Vd?Vd=268435456+Math.round(2147483648*Math.random()):Vd++,"0x"+Vd.toString(16)}const Gd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class qd{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}const Wd="WebChannelConnection";class Hd extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.wo=t+"://"+e.host,this.So="projects/".concat(n,"/databases/").concat(r),this.bo="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}get Do(){return!1}Co(e,t,n,r,i){const o=Bd(),s=this.vo(e,t.toUriEncodedString());js("RestConnection","Sending RPC '".concat(e,"' ").concat(o,":"),s,n);const a={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(a,r,i),this.Mo(e,s,a,n).then((t=>(js("RestConnection","Received RPC '".concat(e,"' ").concat(o,": "),t),t)),(t=>{throw Bs("RestConnection","RPC '".concat(e,"' ").concat(o," failed with error: "),t,"url: ",s,"request:",n),t}))}xo(e,t,n,r,i,o){return this.Co(e,t,n,r,i)}Fo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+xs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}vo(e,t){const n=Gd[e];return"".concat(this.wo,"/v1/").concat(t,":").concat(n)}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,r){const i=Bd();return new Promise(((o,s)=>{const a=new Ss;a.setWithCredentials(!0),a.listenOnce(Is.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Cs.NO_ERROR:const t=a.getResponseJson();js(Wd,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),o(t);break;case Cs.TIMEOUT:js(Wd,"RPC '".concat(e,"' ").concat(i," timed out")),s(new zs(Ks.DEADLINE_EXCEEDED,"Request time out"));break;case Cs.HTTP_ERROR:const n=a.getStatus();if(js(Wd,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Ks).indexOf(t)>=0?t:Ks.UNKNOWN}(t.status);s(new zs(e,t.message))}else s(new zs(Ks.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new zs(Ks.UNAVAILABLE,"Connection failed."));break;default:qs()}}finally{js(Wd,"RPC '".concat(e,"' ").concat(i," completed."))}}));const c=JSON.stringify(r);js(Wd,"RPC '".concat(e,"' ").concat(i," sending request:"),r),a.send(t,"POST",c,n,15)}))}Oo(e,t,n){const r=Bd(),i=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=ks(),s=Ns(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new ws({})),this.Fo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");js(Wd,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(u),a);const l=o.createWebChannel(u,a);let d=!1,h=!1;const p=new qd({lo:t=>{h?js(Wd,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(d||(js(Wd,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),l.open(),d=!0),js(Wd,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),l.send(t))},ho:()=>l.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(l,Rs.EventType.OPEN,(()=>{h||(js(Wd,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),p.mo())})),f(l,Rs.EventType.CLOSE,(()=>{h||(h=!0,js(Wd,"RPC '".concat(e,"' stream ").concat(r," transport closed")),p.po())})),f(l,Rs.EventType.ERROR,(t=>{h||(h=!0,Bs(Wd,"RPC '".concat(e,"' stream ").concat(r," transport errored:"),t),p.po(new zs(Ks.UNAVAILABLE,"The operation could not be completed")))})),f(l,Rs.EventType.MESSAGE,(t=>{var n;if(!h){const i=t.data[0];Ws(!!i);const o=i,s=o.error||(null===(n=o[0])||void 0===n?void 0:n.error);if(s){js(Wd,"RPC '".concat(e,"' stream ").concat(r," received error:"),s);const t=s.status;let n=function(e){const t=rl[e];if(void 0!==t)return sl(t)}(t),i=s.message;void 0===n&&(n=Ks.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),h=!0,p.po(new zs(n,i)),l.close()}else js(Wd,"RPC '".concat(e,"' stream ").concat(r," received:"),i),p.yo(i)}})),f(s,Os.STAT_EVENT,(t=>{t.stat===As.PROXY?js(Wd,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===As.NOPROXY&&js(Wd,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))})),setTimeout((()=>{p.fo()}),0),p}}function Kd(){return"undefined"!=typeof document?document:null}function zd(e){return new Il(e,!0)}class Yd{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.oi=e,this.timerId=t,this.No=n,this.Lo=r,this.Bo=i,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();const t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),r=Math.max(0,t-n);r>0&&js("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.ko," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.qo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Qo=Date.now(),e()))),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class Jd{constructor(e,t,n,r,i,o,s,a){this.oi=e,this.Go=n,this.zo=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=a,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new Yd(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}async stop(){this.Zo()&&await this.close(0)}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,(()=>this.r_())))}i_(e){this.s_(),this.stream.send(e)}async r_(){if(this.Xo())return this.close(0)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}async close(e,t){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,4!==e?this.Yo.reset():t&&t.code===Ks.RESOURCE_EXHAUSTED?(Vs(t.toString()),Vs("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===Ks.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.__(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ao(t)}__(){}auth(){this.state=1;const e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((e=>{let[n,r]=e;this.jo===t&&this.u_(n,r)}),(t=>{e((()=>{const e=new zs(Ks.UNKNOWN,"Fetching auth token failed: "+t.message);return this.c_(e)}))}))}u_(e,t){const n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po((()=>{n((()=>this.listener.Po()))})),this.stream.To((()=>{n((()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,(()=>(this.Xo()&&(this.state=3),Promise.resolve()))),this.listener.To())))})),this.stream.Ao((e=>{n((()=>this.c_(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}e_(){this.state=5,this.Yo.$o((async()=>{this.state=0,this.start()}))}c_(e){return js("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget((()=>this.jo===e?t():(js("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Xd extends Jd{constructor(e,t,n,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,o),this.serializer=i}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:qs()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(Ws(void 0===t||"string"==typeof t),Ga.fromBase64String(t||"")):(Ws(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Ga.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),s=t.targetChange.cause,a=s&&function(e){const t=void 0===e.code?Ks.UNKNOWN:sl(e.code);return new zs(t,e.message||"")}(s);n=new El(r,i,o,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=xl(e,r.document.name),o=kl(r.document.updateTime),s=r.document.createTime?kl(r.document.createTime):ca.min(),a=new fc({mapValue:{fields:r.document.fields}}),c=gc.newFoundDocument(i,o,s,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new gl(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=xl(e,r.document),o=r.readTime?kl(r.readTime):ca.min(),s=gc.newNoDocument(i,o),a=r.removedTargetIds||[];n=new gl([],a,s.key,s)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=xl(e,r.document),o=r.removedTargetIds||[];n=new gl([],o,i,null)}else{if(!("filter"in t))return qs();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,o=new nl(r,i),s=e.targetId;n=new _l(s,o)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ca.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ca.min():t.readTime?kl(t.readTime):ca.min()}(e);return this.listener.h_(t,n)}P_(e){const t={};t.database=jl(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=qc(r)?{documents:ql(e,r)}:{query:Wl(e,r)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ol(e,t.resumeToken);const r=Cl(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(ca.min())>0){n.readTime=Al(e,t.snapshotVersion.toTimestamp());const r=Cl(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return qs()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.i_(t)}I_(e){const t={};t.database=jl(this.serializer),t.removeTarget=e,this.i_(t)}}class Qd extends Jd{constructor(e,t,n,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,o),this.serializer=i,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){if(Ws(!!e.streamToken),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();const t=function(e,t){return e&&e.length>0?(Ws(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?kl(e.updateTime):kl(t);return n.isEqual(ca.min())&&(n=kl(t)),new Uu(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=kl(e.commitTime);return this.listener.A_(n,t)}return Ws(!e.writeResults||0===e.writeResults.length),this.T_=!0,this.listener.R_()}V_(){const e={};e.database=jl(this.serializer),this.i_(e)}d_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Gl(this.serializer,e)))};this.i_(t)}}class Zd extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.m_=!1}f_(){if(this.m_)throw new zs(Ks.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,r){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((i=>{let[o,s]=i;return this.connection.Co(e,Pl(t,n),r,o,s)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ks.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new zs(Ks.UNKNOWN,e.toString())}))}xo(e,t,n,r,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((o=>{let[s,a]=o;return this.connection.xo(e,Pl(t,n),r,s,a,i)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ks.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new zs(Ks.UNKNOWN,e.toString())}))}terminate(){this.m_=!0,this.connection.terminate()}}class $d{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve()))))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.y_?(Vs(t),this.y_=!1):js("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class eh{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=i,this.O_.io((e=>{n.enqueueAndForget((async()=>{uh(this)&&(js("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Hs(e);t.M_.add(4),await nh(t),t.N_.set("Unknown"),t.M_.delete(4),await th(t)}(this))}))})),this.N_=new $d(n,r)}}async function th(e){if(uh(e))for(const t of e.x_)await t(!0)}async function nh(e){for(const t of e.x_)await t(!1)}function rh(e,t){const n=Hs(e);n.F_.has(t.targetId)||(n.F_.set(t.targetId,t),ch(n)?ah(n):Ah(n).Xo()&&oh(n,t))}function ih(e,t){const n=Hs(e),r=Ah(n);n.F_.delete(t),r.Xo()&&sh(n,t),0===n.F_.size&&(r.Xo()?r.n_():uh(n)&&n.N_.set("Unknown"))}function oh(e,t){if(e.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ca.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ah(e).P_(t)}function sh(e,t){e.L_.xe(t),Ah(e).I_(t)}function ah(e){e.L_=new yl({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.F_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),Ah(e).start(),e.N_.w_()}function ch(e){return uh(e)&&!Ah(e).Zo()&&e.F_.size>0}function uh(e){return 0===Hs(e).M_.size}function lh(e){e.L_=void 0}async function dh(e){e.N_.set("Online")}async function hh(e){e.F_.forEach(((t,n)=>{oh(e,t)}))}async function ph(e,t){lh(e),ch(e)?(e.N_.D_(t),ah(e)):e.N_.set("Unknown")}async function fh(e,t,n){if(e.N_.set("Online"),t instanceof El&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.F_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.F_.delete(r),e.L_.removeTarget(r))}(e,t)}catch(n){js("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await mh(e,n)}else if(t instanceof gl?e.L_.Ke(t):t instanceof _l?e.L_.He(t):e.L_.We(t),!n.isEqual(ca.min()))try{const t=await Od(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.L_.rt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.F_.get(r);i&&e.F_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.F_.get(t);if(!r)return;e.F_.set(t,r.withResumeToken(Ga.EMPTY_BYTE_STRING,r.snapshotVersion)),sh(e,t);const i=new td(r.target,t,n,r.sequenceNumber);oh(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){js("RemoteStore","Failed to raise snapshot:",t),await mh(e,t)}}async function mh(e,t,n){if(!wa(t))throw t;e.M_.add(1),await nh(e),e.N_.set("Offline"),n||(n=()=>Od(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{js("RemoteStore","Retrying IndexedDB access"),await n(),e.M_.delete(1),await th(e)}))}function gh(e,t){return t().catch((n=>mh(e,n,t)))}async function _h(e){const t=Hs(e),n=Oh(t);let r=t.v_.length>0?t.v_[t.v_.length-1].batchId:-1;for(;Eh(t);)try{const e=await kd(t.localStore,r);if(null===e){0===t.v_.length&&n.n_();break}r=e.batchId,vh(t,e)}catch(e){await mh(t,e)}yh(t)&&bh(t)}function Eh(e){return uh(e)&&e.v_.length<10}function vh(e,t){e.v_.push(t);const n=Oh(e);n.Xo()&&n.E_&&n.d_(t.mutations)}function yh(e){return uh(e)&&!Oh(e).Zo()&&e.v_.length>0}function bh(e){Oh(e).start()}async function Th(e){Oh(e).V_()}async function Sh(e){const t=Oh(e);for(const n of e.v_)t.d_(n.mutations)}async function wh(e,t,n){const r=e.v_.shift(),i=el.from(r,t,n);await gh(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await _h(e)}async function Rh(e,t){t&&Oh(e).E_&&await async function(e,t){if(function(e){return ol(e)&&e!==Ks.ABORTED}(t.code)){const n=e.v_.shift();Oh(e).t_(),await gh(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await _h(e)}}(e,t),yh(e)&&bh(e)}async function Ih(e,t){const n=Hs(e);n.asyncQueue.verifyOperationInProgress(),js("RemoteStore","RemoteStore received new credentials");const r=uh(n);n.M_.add(3),await nh(n),r&&n.N_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.M_.delete(3),await th(n)}async function Ch(e,t){const n=Hs(e);t?(n.M_.delete(2),await th(n)):t||(n.M_.add(2),await nh(n),n.N_.set("Unknown"))}function Ah(e){return e.B_||(e.B_=function(e,t,n){const r=Hs(e);return r.f_(),new Xd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:dh.bind(null,e),To:hh.bind(null,e),Ao:ph.bind(null,e),h_:fh.bind(null,e)}),e.x_.push((async t=>{t?(e.B_.t_(),ch(e)?ah(e):e.N_.set("Unknown")):(await e.B_.stop(),lh(e))}))),e.B_}function Oh(e){return e.k_||(e.k_=function(e,t,n){const r=Hs(e);return r.f_(),new Qd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:()=>Promise.resolve(),To:Th.bind(null,e),Ao:Rh.bind(null,e),R_:Sh.bind(null,e),A_:wh.bind(null,e)}),e.x_.push((async t=>{t?(e.k_.t_(),await _h(e)):(await e.k_.stop(),e.v_.length>0&&(js("RemoteStore","Stopping write stream with ".concat(e.v_.length," pending writes")),e.v_=[]))}))),e.k_}class Nh{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ys,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const o=Date.now()+n,s=new Nh(e,t,o,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new zs(Ks.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function kh(e,t){if(Vs("AsyncQueue","".concat(t,": ").concat(e)),wa(e))return new zs(Ks.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class Dh{constructor(e){this.comparator=e?(t,n)=>e(t,n)||pa.comparator(t.key,n.key):(e,t)=>pa.comparator(e.key,t.key),this.keyedMap=du(),this.sortedSet=new Ma(this.comparator)}static emptySet(e){return new Dh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Dh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Dh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ph{constructor(){this.q_=new Ma(pa.comparator)}track(e){const t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):qs():this.q_=this.q_.insert(t,e)}Q_(){const e=[];return this.q_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Lh{constructor(e,t,n,r,i,o,s,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const o=[];return t.forEach((e=>{o.push({type:0,doc:e})})),new Lh(e,t,Dh.emptySet(t),o,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&eu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Mh{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some((e=>e.G_()))}}class xh{constructor(){this.queries=new au((e=>tu(e)),eu),this.onlineState="Unknown",this.z_=new Set}}async function Uh(e,t){const n=Hs(e);let r=3;const i=t.query;let o=n.queries.get(i);o?!o.W_()&&t.G_()&&(r=2):(o=new Mh,r=t.G_()?0:1);try{switch(r){case 0:o.K_=await n.onListen(i,!0);break;case 1:o.K_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=kh(e,"Initialization of query '".concat(nu(t.query),"' failed"));return void t.onError(n)}n.queries.set(i,o),o.U_.push(t),t.j_(n.onlineState),o.K_&&t.H_(o.K_)&&Bh(n)}async function Fh(e,t){const n=Hs(e),r=t.query;let i=3;const o=n.queries.get(r);if(o){const e=o.U_.indexOf(t);e>=0&&(o.U_.splice(e,1),0===o.U_.length?i=t.G_()?0:1:!o.W_()&&t.G_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function jh(e,t){const n=Hs(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.U_)e.H_(i)&&(r=!0);t.K_=i}}r&&Bh(n)}function Vh(e,t,n){const r=Hs(e),i=r.queries.get(t);if(i)for(const o of i.U_)o.onError(n);r.queries.delete(t)}function Bh(e){e.z_.forEach((e=>{e.next()}))}var Gh,qh;(qh=Gh||(Gh={})).J_="default",qh.Cache="cache";class Wh{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Lh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){if(!e.fromCache)return!0;if(!this.G_())return!0;const n="Offline"!==t;return(!this.options.ra||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){if(e.docChanges.length>0)return!0;const t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}na(e){e=Lh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==Gh.Cache}}class Hh{constructor(e){this.key=e}}class Kh{constructor(e){this.key=e}}class zh{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=Eu(),this.mutatedKeys=Eu(),this.Ia=ou(e),this.Ta=new Dh(this.Ia)}get Ea(){return this.la}da(e,t){const n=t?t.Aa:new Ph,r=t?t.Ta:this.Ta;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,s=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=ru(this.query,t)?t:null,d=!!u&&this.mutatedKeys.has(u.key),h=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let p=!1;u&&l?u.data.isEqual(l.data)?d!==h&&(n.track({type:3,doc:l}),p=!0):this.Ra(u,l)||(n.track({type:2,doc:l}),p=!0,(a&&this.Ia(l,a)>0||c&&this.Ia(l,c)<0)&&(s=!0)):!u&&l?(n.track({type:0,doc:l}),p=!0):u&&!l&&(n.track({type:1,doc:u}),p=!0,(a||c)&&(s=!0)),p&&(l?(o=o.add(l),i=h?i.add(e):i.delete(e)):(o=o.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;o.size>this.query.limit;){const e="F"===this.query.limitType?o.last():o.first();o=o.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ta:o,Aa:n,Xi:s,mutatedKeys:i}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;const o=e.Aa.Q_();o.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return qs()}};return n(e)-n(t)}(e.type,t.type)||this.Ia(e.doc,t.doc))),this.Va(n),r=null!=r&&r;const s=t&&!r?this.ma():[],a=0===this.Pa.size&&this.current&&!r?1:0,c=a!==this.ha;return this.ha=a,0!==o.length||c?{snapshot:new Lh(this.query,e.Ta,i,o,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:s}:{fa:s}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new Ph,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach((e=>this.la=this.la.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.la=this.la.delete(e))),this.current=e.current)}ma(){if(!this.current)return[];const e=this.Pa;this.Pa=Eu(),this.Ta.forEach((e=>{this.ga(e.key)&&(this.Pa=this.Pa.add(e.key))}));const t=[];return e.forEach((e=>{this.Pa.has(e)||t.push(new Kh(e))})),this.Pa.forEach((n=>{e.has(n)||t.push(new Hh(n))})),t}pa(e){this.la=e.hs,this.Pa=Eu();const t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return Lh.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class Yh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Jh{constructor(e){this.key=e,this.wa=!1}}class Xh{constructor(e,t,n,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Sa={},this.ba=new au((e=>tu(e)),eu),this.Da=new Map,this.Ca=new Set,this.va=new Ma(pa.comparator),this.Fa=new Map,this.Ma=new fd,this.xa={},this.Oa=new Map,this.Na=cd.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function Qh(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=Ep(e);let i;const o=r.ba.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.ya()):i=await $h(r,t,n,!0),i}async function Zh(e,t){const n=Ep(e);await $h(n,t,!0,!1)}async function $h(e,t,n,r){const i=await Dd(e.localStore,Xc(t)),o=i.targetId,s=n?e.sharedClientState.addLocalQueryTarget(o):"not-current";let a;return r&&(a=await ep(e,t,o,"current"===s,i.resumeToken)),e.isPrimaryClient&&n&&rh(e.remoteStore,i),a}async function ep(e,t,n,r,i){e.Ba=(t,n,r)=>async function(e,t,n,r){let i=t.view.da(n);i.Xi&&(i=await Ld(e.localStore,t.query,!1).then((e=>{let{documents:n}=e;return t.view.da(n,i)})));const o=r&&r.targetChanges.get(t.targetId),s=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,o,s);return hp(e,t.targetId,a.fa),a.snapshot}(e,t,n,r);const o=await Ld(e.localStore,t,!0),s=new zh(t,o.hs),a=s.da(o.documents),c=ml.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=s.applyChanges(a,e.isPrimaryClient,c);hp(e,n,u.fa);const l=new Yh(t,n,s);return e.ba.set(t,l),e.Da.has(n)?e.Da.get(n).push(t):e.Da.set(n,[t]),u.snapshot}async function tp(e,t,n){const r=Hs(e),i=r.ba.get(t),o=r.Da.get(i.targetId);if(o.length>1)return r.Da.set(i.targetId,o.filter((e=>!eu(e,t)))),void r.ba.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Pd(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&ih(r.remoteStore,i.targetId),lp(r,i.targetId)})).catch(ba)):(lp(r,i.targetId),await Pd(r.localStore,i.targetId,!0))}async function np(e,t){const n=Hs(e),r=n.ba.get(t),i=n.Da.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ih(n.remoteStore,r.targetId))}async function rp(e,t){const n=Hs(e);try{const e=await function(e,t){const n=Hs(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const o=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const s=[];t.targetChanges.forEach(((o,a)=>{const c=i.get(a);if(!c)return;s.push(n.Qr.removeMatchingKeys(e,o.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(e,o.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Ga.EMPTY_BYTE_STRING,ca.min()).withLastLimboFreeSnapshotVersion(ca.min()):o.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(o.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,o)&&s.push(n.Qr.updateTargetData(e,u))}));let a=uu(),c=Eu();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),s.push(Nd(e,o,t.documentUpdates).next((e=>{a=e.cs,c=e.ls}))),!r.isEqual(ca.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));s.push(t)}return Ta.waitFor(s).next((()=>o.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Fa.get(t);r&&(Ws(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.wa=!0:e.modifiedDocuments.size>0?Ws(r.wa):e.removedDocuments.size>0&&(Ws(r.wa),r.wa=!1))})),await mp(n,e,t)}catch(e){await ba(e)}}function ip(e,t,n){const r=Hs(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ba.forEach(((n,r)=>{const i=r.view.j_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Hs(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const i of n.U_)i.j_(t)&&(r=!0)})),r&&Bh(n)}(r.eventManager,t),e.length&&r.Sa.h_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function op(e,t,n){const r=Hs(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Fa.get(t),o=i&&i.key;if(o){let e=new Ma(pa.comparator);e=e.insert(o,gc.newNoDocument(o,ca.min()));const n=Eu().add(o),i=new fl(ca.min(),new Map,new Ma(oa),e,n);await rp(r,i),r.va=r.va.remove(o),r.Fa.delete(t),fp(r)}else await Pd(r.localStore,t,!1).then((()=>lp(r,t,n))).catch(ba)}async function sp(e,t){const n=Hs(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Hs(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,o=i.keys();let s=Ta.resolve();return o.forEach((e=>{s=s.next((()=>r.getEntry(t,e))).next((t=>{const o=n.docVersions.get(e);Ws(null!==o),t.version.compareTo(o)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),s.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Eu();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);up(n,r,null),cp(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await mp(n,e)}catch(e){await ba(e)}}async function ap(e,t,n){const r=Hs(e);try{const e=await function(e,t){const n=Hs(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Ws(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);up(r,t,n),cp(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await mp(r,e)}catch(n){await ba(n)}}function cp(e,t){(e.Oa.get(t)||[]).forEach((e=>{e.resolve()})),e.Oa.delete(t)}function up(e,t,n){const r=Hs(e);let i=r.xa[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.xa[r.currentUser.toKey()]=i}}function lp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Da.get(t))e.ba.delete(r),n&&e.Sa.ka(r,n);e.Da.delete(t),e.isPrimaryClient&&e.Ma.Vr(t).forEach((t=>{e.Ma.containsKey(t)||dp(e,t)}))}function dp(e,t){e.Ca.delete(t.path.canonicalString());const n=e.va.get(t);null!==n&&(ih(e.remoteStore,n),e.va=e.va.remove(t),e.Fa.delete(n),fp(e))}function hp(e,t,n){for(const r of n)r instanceof Hh?(e.Ma.addReference(r.key,t),pp(e,r)):r instanceof Kh?(js("SyncEngine","Document no longer in limbo: "+r.key),e.Ma.removeReference(r.key,t),e.Ma.containsKey(r.key)||dp(e,r.key)):qs()}function pp(e,t){const n=t.key,r=n.path.canonicalString();e.va.get(n)||e.Ca.has(r)||(js("SyncEngine","New document in limbo: "+n),e.Ca.add(r),fp(e))}function fp(e){for(;e.Ca.size>0&&e.va.size<e.maxConcurrentLimboResolutions;){const t=e.Ca.values().next().value;e.Ca.delete(t);const n=new pa(la.fromString(t)),r=e.Na.next();e.Fa.set(r,new Jh(n)),e.va=e.va.insert(n,r),rh(e.remoteStore,new td(Xc(Kc(n.path)),r,"TargetPurposeLimboResolution",Ra.oe))}}async function mp(e,t,n){const r=Hs(e),i=[],o=[],s=[];r.ba.isEmpty()||(r.ba.forEach(((e,a)=>{s.push(r.Ba(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient){const t=e&&!e.fromCache;r.sharedClientState.updateQueryState(a.targetId,t?"current":"not-current")}if(e){i.push(e);const t=Sd.Ki(a.targetId,e);o.push(t)}})))})),await Promise.all(s),r.Sa.h_(i),await async function(e,t){const n=Hs(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ta.forEach(t,(t=>Ta.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Ta.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!wa(e))throw e;js("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,i)}}}(r.localStore,o))}async function gp(e,t){const n=Hs(e);if(!n.currentUser.isEqual(t)){js("SyncEngine","User change. New user:",t.toKey());const e=await Ad(n.localStore,t);n.currentUser=t,function(e,t){e.Oa.forEach((e=>{e.forEach((e=>{e.reject(new zs(Ks.CANCELLED,t))}))})),e.Oa.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await mp(n,e.us)}}function _p(e,t){const n=Hs(e),r=n.Fa.get(t);if(r&&r.wa)return Eu().add(r.key);{let e=Eu();const r=n.Da.get(t);if(!r)return e;for(const t of r){const r=n.ba.get(t);e=e.unionWith(r.view.Ea)}return e}}function Ep(e){const t=Hs(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=rp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=_p.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=op.bind(null,t),t.Sa.h_=jh.bind(null,t.eventManager),t.Sa.ka=Vh.bind(null,t.eventManager),t}function vp(e){const t=Hs(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=sp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ap.bind(null,t),t}class yp{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=zd(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Cd(this.persistence,new Rd,e.initialUser,this.serializer)}createPersistence(e){return new yd(Td.Hr,this.serializer)}createSharedClientState(e){return new Ud}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class bp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ip(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=gp.bind(null,this.syncEngine),await Ch(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new xh}createDatastore(e){const t=zd(e.databaseInfo.databaseId),n=function(e){return new Hd(e)}(e.databaseInfo);return function(e,t,n,r){return new Zd(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new eh(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>ip(this.syncEngine,e,0)),jd.D()?new jd:new Fd)}createSyncEngine(e,t){return function(e,t,n,r,i,o,s){const a=new Xh(e,t,n,r,i,o);return s&&(a.La=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=Hs(e);js("RemoteStore","RemoteStore shutting down."),t.M_.add(5),await nh(t),t.O_.shutdown(),t.N_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class Tp{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):Vs("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Sp{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Ms.UNAUTHENTICATED,this.clientId=ia.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{js("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(js("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new zs(Ks.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ys;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=kh(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function wp(e,t){e.asyncQueue.verifyOperationInProgress(),js("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Ad(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Rp(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Cp(e);js("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Ih(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Ih(t.remoteStore,n))),e._onlineComponents=t}function Ip(e){return"FirebaseError"===e.name?e.code===Ks.FAILED_PRECONDITION||e.code===Ks.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function Cp(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){js("FirestoreClient","Using user provided OfflineComponentProvider");try{await wp(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!Ip(n))throw n;Bs("Error using user provided cache. Falling back to memory cache: "+n),await wp(e,new yp)}}else js("FirestoreClient","Using default OfflineComponentProvider"),await wp(e,new yp);return e._offlineComponents}async function Ap(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(js("FirestoreClient","Using user provided OnlineComponentProvider"),await Rp(e,e._uninitializedComponentsProvider._online)):(js("FirestoreClient","Using default OnlineComponentProvider"),await Rp(e,new bp))),e._onlineComponents}function Op(e){return Ap(e).then((e=>e.syncEngine))}async function Np(e){const t=await Ap(e),n=t.eventManager;return n.onListen=Qh.bind(null,t.syncEngine),n.onUnlisten=tp.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Zh.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=np.bind(null,t.syncEngine),n}function kp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new Ys;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const o=new Tp({next:o=>{t.enqueueAndForget((()=>Fh(e,s)));const a=o.docs.has(n);!a&&o.fromCache?i.reject(new zs(Ks.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new zs(Ks.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),s=new Wh(Kc(n.path),o,{includeMetadataChanges:!0,ra:!0});return Uh(e,s)}(await Np(e),e.asyncQueue,t,n,r))),r.promise}function Dp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new Ys;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const o=new Tp({next:n=>{t.enqueueAndForget((()=>Fh(e,s))),n.fromCache&&"server"===r.source?i.reject(new zs(Ks.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),s=new Wh(n,o,{includeMetadataChanges:!0,ra:!0});return Uh(e,s)}(await Np(e),e.asyncQueue,t,n,r))),r.promise}function Pp(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Lp=new Map;function Mp(e,t,n){if(!n)throw new zs(Ks.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function xp(e){if(!pa.isDocumentKey(e))throw new zs(Ks.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Up(e){if(pa.isDocumentKey(e))throw new zs(Ks.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Fp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":qs()}function jp(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new zs(Ks.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Fp(e);throw new zs(Ks.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}class Vp{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new zs(Ks.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new zs(Ks.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new zs(Ks.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Pp(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new zs(Ks.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new zs(Ks.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new zs(Ks.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Bp{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vp({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new zs(Ks.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new zs(Ks.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vp(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Xs;switch(e.type){case"firstParty":return new ea(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new zs(Ks.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Lp.get(e);t&&(js("ComponentProvider","Removing Datastore"),Lp.delete(e),t.terminate())}(this),Promise.resolve()}}class Gp{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Gp(this.firestore,e,this._query)}}class qp{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new qp(this.firestore,e,this._key)}}class Wp extends Gp{constructor(e,t,n){super(e,t,Kc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new qp(this.firestore,null,new pa(e))}withConverter(e){return new Wp(this.firestore,e,this._path)}}function Hp(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=$e(e),1===arguments.length&&(t=ia.newId()),Mp("doc","path",t),e instanceof Bp){const n=la.fromString(t,...r);return xp(n),new qp(e,null,new pa(n))}{if(!(e instanceof qp||e instanceof Wp))throw new zs(Ks.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(la.fromString(t,...r));return xp(n),new qp(e.firestore,e instanceof Wp?e.converter:null,new pa(n))}}class Kp{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new Yd(this,"async_queue_retry"),this.hu=()=>{const e=Kd();e&&js("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Yo.Wo()};const e=Kd();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;const t=Kd();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise((()=>{}));const t=new Ys;return this.Iu((()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.su.push(e),this.Tu())))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Yo.reset()}catch(Jg){if(!wa(Jg))throw Jg;js("AsyncQueue","Operation failed with retryable error: "+Jg)}this.su.length>0&&this.Yo.$o((()=>this.Tu()))}}Iu(e){const t=this.iu.then((()=>(this.uu=!0,e().catch((e=>{this.au=e,this.uu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Vs("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.uu=!1,e))))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);const r=Nh.createAndSchedule(this,e,t,n,(e=>this.Eu(e)));return this._u.push(r),r}Pu(){this.au&&qs()}verifyOperationInProgress(){}async du(){let e;do{e=this.iu,await e}while(e!==this.iu)}Au(e){for(const t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then((()=>{this._u.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this._u)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()}))}Vu(e){this.lu.push(e)}Eu(e){const t=this._u.indexOf(e);this._u.splice(t,1)}}function zp(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class Yp extends Bp{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Kp,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Xp(this),this._firestoreClient.terminate()}}function Jp(e){return e._firestoreClient||Xp(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Xp(e){var t,n,r;const i=e._freezeSettings(),o=function(e,t,n,r){return new Xa(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Pp(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new Sp(e._authCredentials,e._appCheckCredentials,e._queue,o),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Qp{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Qp(Ga.fromBase64String(e))}catch(e){throw new zs(Ks.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Qp(Ga.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Zp{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new zs(Ks.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ha(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class $p{constructor(e){this._methodName=e}}class ef{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new zs(Ks.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new zs(Ks.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return oa(this._lat,e._lat)||oa(this._long,e._long)}}const tf=/^__.*__$/;class nf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new zu(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ku(e,this.data,t,this.fieldTransforms)}}class rf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new zu(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function of(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw qs()}}class sf{constructor(e,t,n,r,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.mu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new sf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.gu({path:n,yu:!1});return r.wu(e),r}Su(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.gu({path:n,yu:!1});return r.mu(),r}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return wf(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(of(this.fu)&&tf.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class af{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||zd(e)}Fu(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new sf({fu:e,methodName:t,vu:n,path:ha.emptyPath(),yu:!1,Cu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cf(e){const t=e._freezeSettings(),n=zd(e._databaseId);return new af(e._databaseId,!!t.ignoreUndefinedProperties,n)}function uf(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const s=e.Fu(o.merge||o.mergeFields?2:0,t,n,i);yf("Data must be an object, but it was:",s,r);const a=Ef(r,s);let c,u;if(o.merge)c=new Va(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){const e=[];for(const r of o.mergeFields){const i=bf(t,r,n);if(!s.contains(i))throw new zs(Ks.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));Rf(e,i)||e.push(i)}c=new Va(e),u=s.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=s.fieldTransforms;return new nf(new fc(a),c,u)}class lf extends $p{_toFieldTransform(e){if(2!==e.fu)throw 1===e.fu?e.Du("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Du("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lf}}function df(e,t,n){return new sf({fu:3,vu:t.settings.vu,methodName:e._methodName,yu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class hf extends $p{_toFieldTransform(e){return new xu(e.path,new Au)}isEqual(e){return e instanceof hf}}class pf extends $p{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){const t=df(this,e,!0),n=this.Mu.map((e=>_f(e,t))),r=new Ou(n);return new xu(e.path,r)}isEqual(e){return e instanceof pf&&Ke(this.Mu,e.Mu)}}function ff(e,t,n,r){const i=e.Fu(1,t,n);yf("Data must be an object, but it was:",i,r);const o=[],s=fc.empty();Pa(r,((e,r)=>{const a=Sf(t,e,n);r=$e(r);const c=i.Su(a);if(r instanceof lf)o.push(a);else{const e=_f(r,c);null!=e&&(o.push(a),s.set(a,e))}}));const a=new Va(o);return new rf(s,a,i.fieldTransforms)}function mf(e,t,n,r,i,o){const s=e.Fu(1,t,n),a=[bf(t,r,n)],c=[i];if(o.length%2!=0)throw new zs(Ks.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let h=0;h<o.length;h+=2)a.push(bf(t,o[h])),c.push(o[h+1]);const u=[],l=fc.empty();for(let h=a.length-1;h>=0;--h)if(!Rf(u,a[h])){const e=a[h];let t=c[h];t=$e(t);const n=s.Su(e);if(t instanceof lf)u.push(e);else{const r=_f(t,n);null!=r&&(u.push(e),l.set(e,r))}}const d=new Va(u);return new rf(l,d,s.fieldTransforms)}function gf(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return _f(n,e.Fu(r?4:3,t))}function _f(e,t){if(vf(e=$e(e)))return yf("Unsupported field value:",t,e),Ef(e,t);if(e instanceof $p)return function(e,t){if(!of(t.fu))throw t.Du("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Du("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.yu&&4!==t.fu)throw t.Du("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=_f(i,t.bu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=$e(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Su(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=aa.fromDate(e);return{timestampValue:Al(t.serializer,n)}}if(e instanceof aa){const n=new aa(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Al(t.serializer,n)}}if(e instanceof ef)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Qp)return{bytesValue:Ol(t.serializer,e._byteString)};if(e instanceof qp){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Du("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:Dl(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Du("Unsupported field value: ".concat(Fp(e)))}(e,t)}function Ef(e,t){const n={};return La(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Pa(e,((e,r)=>{const i=_f(r,t.pu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function vf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof aa||e instanceof ef||e instanceof Qp||e instanceof qp||e instanceof $p)}function yf(e,t,n){if(!vf(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Fp(n);throw"an object"===r?t.Du(e+" a custom object"):t.Du(e+" "+r)}}function bf(e,t,n){if((t=$e(t))instanceof Zp)return t._internalPath;if("string"==typeof t)return Sf(e,t);throw wf("Field path arguments must be of type string or ",e,!1,void 0,n)}const Tf=new RegExp("[~\\*/\\[\\]]");function Sf(e,t,n){if(t.search(Tf)>=0)throw wf("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new Zp(...t.split("."))._internalPath}catch(r){throw wf("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function wf(e,t,n,r,i){const o=r&&!r.isEmpty(),s=void 0!==i;let a="Function ".concat(t,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(o||s)&&(c+=" (found",o&&(c+=" in field ".concat(r)),s&&(c+=" in document ".concat(i)),c+=")"),new zs(Ks.INVALID_ARGUMENT,a+e+c)}function Rf(e,t){return e.some((e=>e.isEqual(t)))}class If{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new qp(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Cf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Af("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Cf extends If{data(){return super.data()}}function Af(e,t){return"string"==typeof t?Sf(e,t):t instanceof Zp?t._internalPath:t._delegate._internalPath}function Of(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new zs(Ks.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Nf{}class kf extends Nf{}class Df extends kf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Df(e,t,n)}_apply(e){const t=this._parse(e);return xf(e._query,t),new Gp(e.firestore,e.converter,Zc(e._query,t))}_parse(e){const t=cf(e.firestore),n=function(e,t,n,r,i,o,s){let a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new zs(Ks.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(o,"' queries on documentId()."));if("in"===o||"not-in"===o){Mf(s,o);const t=[];for(const n of s)t.push(Lf(r,e,n));a={arrayValue:{values:t}}}else a=Lf(r,e,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Mf(s,o),a=gf(n,t,s,"in"===o||"not-in"===o);return Sc.create(i,o,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class Pf extends Nf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Pf(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:wc.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)xf(n,i),n=Zc(n,i)}(e._query,t),new Gp(e.firestore,e.converter,Zc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Lf(e,t,n){if("string"==typeof(n=$e(n))){if(""===n)throw new zs(Ks.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yc(t)&&-1!==n.indexOf("/"))throw new zs(Ks.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=t.path.child(la.fromString(n));if(!pa.isDocumentKey(r))throw new zs(Ks.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return sc(e,new pa(r))}if(n instanceof qp)return sc(e,n._key);throw new zs(Ks.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Fp(n),"."))}function Mf(e,t){if(!Array.isArray(e)||0===e.length)throw new zs(Ks.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function xf(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new zs(Ks.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new zs(Ks.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class Uf{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch($a(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ha(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ka(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw qs()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return Pa(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new ef(Ha(e.latitude),Ha(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ya(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ja(e));default:return null}}convertTimestamp(e){const t=Wa(e);return new aa(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=la.fromString(e);Ws(ed(n));const r=new Qa(n.get(1),n.get(3)),i=new pa(n.popFirst(5));return r.isEqual(t)||Vs("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}function Ff(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class jf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Vf extends If{constructor(e,t,n,r,i,o){super(e,t,n,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Bf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Af("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Bf extends Vf{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class Gf{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new jf(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Bf(this._firestore,this._userDataWriter,n.key,n,new jf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new zs(Ks.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Bf(e._firestore,e._userDataWriter,n.doc.key,n.doc,new jf(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Bf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new jf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,o=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),o=n.indexOf(t.doc.key)),{type:qf(t.type),doc:r,oldIndex:i,newIndex:o}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function qf(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return qs()}}class Wf extends Uf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Qp(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new qp(this.firestore,null,t)}}function Hf(e,t,n){e=jp(e,qp);const r=jp(e.firestore,Yp),i=Ff(e.converter,t,n);return Yf(r,[uf(cf(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Fu.none())])}function Kf(e,t,n){e=jp(e,qp);const r=jp(e.firestore,Yp),i=cf(r);let o;for(var s=arguments.length,a=new Array(s>3?s-3:0),c=3;c<s;c++)a[c-3]=arguments[c];return o="string"==typeof(t=$e(t))||t instanceof Zp?mf(i,"updateDoc",e._key,t,n,a):ff(i,"updateDoc",e._key,t),Yf(r,[o.toMutation(e._key,Fu.exists(!0))])}function zf(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,o,s;e=$e(e);let a={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof n[c]||zp(n[c])||(a=n[c],c++);const u={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(zp(n[c])){const e=n[c];n[c]=null===(i=e.next)||void 0===i?void 0:i.bind(e),n[c+1]=null===(o=e.error)||void 0===o?void 0:o.bind(e),n[c+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let l,d,h;if(e instanceof qp)d=jp(e.firestore,Yp),h=Kc(e._key.path),l={next:t=>{n[c]&&n[c](Jf(d,e,t))},error:n[c+1],complete:n[c+2]};else{const t=jp(e,Gp);d=jp(t.firestore,Yp),h=t._query;const r=new Wf(d);l={next:e=>{n[c]&&n[c](new Gf(d,r,t,e))},error:n[c+1],complete:n[c+2]},Of(e._query)}return function(e,t,n,r){const i=new Tp(r),o=new Wh(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>Uh(await Np(e),o))),()=>{i.$a(),e.asyncQueue.enqueueAndForget((async()=>Fh(await Np(e),o)))}}(Jp(d),h,u,l)}function Yf(e,t){return function(e,t){const n=new Ys;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=vp(e);try{const e=await function(e,t){const n=Hs(e),r=aa.now(),i=t.reduce(((e,t)=>e.add(t.key)),Eu());let o,s;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=uu(),c=Eu();return n.os.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{o=i;const s=[];for(const e of t){const t=Wu(e,o.get(e.key).overlayedDocument);null!=t&&s.push(new zu(e.key,t,mc(t.value.mapValue),Fu.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,s,t)})).next((t=>{s=t;const r=t.applyToLocalDocumentSet(o,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:s.batchId,changes:hu(o)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.xa[e.currentUser.toKey()];r||(r=new Ma(oa)),r=r.insert(t,n),e.xa[e.currentUser.toKey()]=r}(r,e.batchId,n),await mp(r,e.changes),await _h(r.remoteStore)}catch(e){const t=kh(e,"Failed to persist write");n.reject(t)}}(await Op(e),t,n))),n.promise}(Jp(e),t)}function Jf(e,t,n){const r=n.docs.get(t._key),i=new Wf(e);return new Vf(e,i,t._key,r,new jf(n.hasPendingWrites,n.fromCache),t.converter)}function Xf(){return new hf("serverTimestamp")}function Qf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new pf("arrayUnion",t)}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){xs=e}(mn),ln(new et("firestore",((e,n)=>{let{instanceIdentifier:r,options:i}=n;const o=e.getProvider("app").getImmediate(),s=new Yp(new Zs(e.getProvider("auth-internal")),new na(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new zs(Ks.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qa(e.options.projectId,t)}(o,r),o);return i=Object.assign({useFetchStreams:t},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),En(Ls,"4.6.3",e),En(Ls,"4.6.3","esm2017")}();const Zf=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_n();const t=dn(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=dn(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Ke(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;Un(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Vo,persistence:[Yi,ki,Pi]}),r=Ue("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Wo)return;const r=null===t||void 0===t?void 0:t.token;Ho!==r&&(Ho=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:"Bearer ".concat(r)}:{}}))});!function(e,t,n){$e(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,t,n,r){$e(e).onIdTokenChanged(t,n,r)}(n,(e=>t(e)))}}var i;const o=Le("auth");return o&&$r(n,"http://".concat(o)),n}(gn({apiKey:"AIzaSyBGOEsbOvCnmrFyEaQeh3JMuOo6HjrPXRA",authDomain:"chat-app-29349.firebaseapp.com",projectId:"chat-app-29349",storageBucket:"chat-app-29349.appspot.com",messagingSenderId:"4529785736",appId:"1:4529785736:web:2d260f225a3876b76f483d"})),$f=(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_n(),t=arguments.length>1?arguments[1]:void 0;e=$e(e);const n=dn(e,_s).getImmediate({identifier:t}),r=Me("storage");r&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host="".concat(t,":").concat(n),e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"===typeof i?i:je(i,e.app.options.projectId))}(e,t,n,r)}(n,...r)}(),function(e,t){const n="string"==typeof e?e:t||"(default)",r=dn("object"==typeof e?e:_n(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=Me("firestore");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var i;const o=(e=jp(e,Bp))._getSettings(),s="".concat(t,":").concat(n);if("firestore.googleapis.com"!==o.host&&o.host!==s&&Bs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},o),{host:s,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Ms.MOCK_USER;else{t=je(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new zs(Ks.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ms(o)}e._authCredentials=new Qs(new Js(t,n))}}(r,...e)}return r}());var em=__webpack_require__(579);const tm=()=>{const[e,n]=(0,t.useState)(!1),r=X();return(0,em.jsx)("div",{className:"formContainer",children:(0,em.jsxs)("div",{className:"formWrapper",children:[(0,em.jsx)("span",{className:"logo",children:"ATT Chat"}),(0,em.jsx)("span",{className:"title",children:"Login"}),(0,em.jsxs)("form",{onSubmit:async t=>{t.preventDefault();const i=t.target[0].value,o=t.target[1].value;try{await function(e,t,n){return hn(e.app)?Promise.reject(Vn(e)):Ii($e(e),di.credential(t,n)).catch((async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&Ci(e),t}))}(Zf,i,o),r("/")}catch(e){n(!0)}},children:[(0,em.jsx)("input",{type:"email",placeholder:"email"}),(0,em.jsx)("input",{type:"password",placeholder:"password"}),(0,em.jsx)("button",{children:"Sign in"}),e&&(0,em.jsx)("span",{style:{color:"red"},children:"Something went wrong"})]}),(0,em.jsxs)("p",{children:["You don't have an account? ",(0,em.jsx)(we,{to:"/register",children:"Register"})]})]})})},nm=(0,t.createContext)(),rm=e=>{let{children:n}=e;const[r,i]=(0,t.useState)({});return(0,t.useEffect)((()=>{const e=function(e,t,n,r){return $e(e).onAuthStateChanged(t,n,r)}(Zf,(e=>{i(e)}));return()=>{e()}}),[]),(0,em.jsx)(nm.Provider,{value:{currentUser:r},children:n})},im=()=>{const{currentUser:e}=(0,t.useContext)(nm);return(0,em.jsxs)("div",{className:"navbar",children:[(0,em.jsx)("span",{className:"logo",children:"ATT Chat"}),(0,em.jsx)("div",{className:"user",children:(0,em.jsx)("button",{onClick:()=>Zf.signOut(),children:"Logout"})})]})};const om=function(){const[e,n]=(0,t.useState)(""),[r,i]=(0,t.useState)(null),{currentUser:o}=(0,t.useContext)(nm),s=e=>e.split("@")[0];return(0,em.jsxs)("div",{className:"search",children:[(0,em.jsx)("div",{className:"searchForm",children:(0,em.jsx)("input",{type:"text",placeholder:"Find a user",onKeyDown:async t=>{if("Enter"!=t.code)return;const n=function(e,t){let n=[];for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];t instanceof Nf&&n.push(t),n=n.concat(i),function(e){const t=e.filter((e=>e instanceof Pf)).length,n=e.filter((e=>e instanceof Df)).length;if(t>1||t>0&&n>0)throw new zs(Ks.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)e=s._apply(e);return e}(function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=$e(e),Mp("collection","path",t),e instanceof Bp){const n=la.fromString(t,...r);return Up(n),new Wp(e,null,n)}{if(!(e instanceof qp||e instanceof Wp))throw new zs(Ks.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(la.fromString(t,...r));return Up(n),new Wp(e.firestore,null,n)}}($f,"users"),function(e,t,n){const r=t,i=Af("where",e);return Df._create(i,r,n)}("email","==",e));try{const e=await function(e){e=jp(e,Gp);const t=jp(e.firestore,Yp),n=Jp(t),r=new Wf(t);return Of(e._query),Dp(n,e._query).then((n=>new Gf(t,r,e,n)))}(n);e.forEach((e=>{i(e.data())}))}catch(r){console.log(r)}},onChange:e=>n(e.target.value),value:e})}),r&&(0,em.jsx)("div",{className:"userChat",onClick:async()=>{const e=o.uid>r.uid?o.uid+r.uid:r.uid+o.uid;try{(await function(e){e=jp(e,qp);const t=jp(e.firestore,Yp);return kp(Jp(t),e._key).then((n=>Jf(t,e,n)))}(Hp($f,"chats",e))).exists()||(await Hf(Hp($f,"chats",e),{messages:[]}),await Kf(Hp($f,"userChats",o.uid),{[e+".userInfo"]:{uid:r.uid,displayName:s(r.email)},[e+".date"]:Xf()}),await Kf(Hp($f,"userChats",r.uid),{[e+".userInfo"]:{uid:o.uid,displayName:s(o.email)},[e+".date"]:Xf()}))}catch(t){}i(null),n("")},children:(0,em.jsx)("div",{className:"userChatInfo",children:(0,em.jsx)("span",{children:r.email})})})]})},sm=(0,t.createContext)(),am=e=>{let{children:n}=e;const{currentUser:r}=(0,t.useContext)(nm),[i,o]=(0,t.useReducer)(((e,t)=>"CHANGE_USER"===t.type?{user:t.payload,chatId:r.uid>t.payload.uid?r.uid+t.payload.uid:t.payload.uid+r.uid}:e),{chatId:"null",user:{}});return(0,em.jsx)(sm.Provider,{value:{data:i,dispatch:o},children:n})},cm=__webpack_require__.p+"static/media/avt.52b49d765d404e3dd5f7.png";const um=function(){var e;const[n,r]=(0,t.useState)([]),{currentUser:i}=(0,t.useContext)(nm),{dispatch:o}=(0,t.useContext)(sm);return(0,t.useEffect)((()=>{i.uid&&(()=>{const e=zf(Hp($f,"userChats",i.uid),(e=>{r(e.data())}))})()}),[i.uid]),(0,em.jsx)("div",{className:"chats",children:null===(e=Object.entries(n))||void 0===e?void 0:e.sort(((e,t)=>t[1].date-e[1].date)).map((e=>{var t;return(0,em.jsxs)("div",{className:"userChat",onClick:()=>{return t=e[1].userInfo,void o({type:"CHANGE_USER",payload:t});var t},children:[(0,em.jsx)("img",{src:cm,alt:"Avatar"}),(0,em.jsxs)("div",{className:"userChatInfo",children:[(0,em.jsx)("span",{children:e[1].userInfo.displayName}),(0,em.jsx)("p",{children:null===(t=e[1].lastMessage)||void 0===t?void 0:t.text})]})]},e[0])}))})},lm=()=>(0,em.jsxs)("div",{className:"sidebar",children:[(0,em.jsx)(im,{}),(0,em.jsx)(om,{}),(0,em.jsx)(um,{})]});var dm,hm=new Uint8Array(16);function pm(){if(!dm&&!(dm="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return dm(hm)}const fm=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const mm=function(e){return"string"===typeof e&&fm.test(e)};for(var gm=[],_m=0;_m<256;++_m)gm.push((_m+256).toString(16).substr(1));const Em=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(gm[e[t+0]]+gm[e[t+1]]+gm[e[t+2]]+gm[e[t+3]]+"-"+gm[e[t+4]]+gm[e[t+5]]+"-"+gm[e[t+6]]+gm[e[t+7]]+"-"+gm[e[t+8]]+gm[e[t+9]]+"-"+gm[e[t+10]]+gm[e[t+11]]+gm[e[t+12]]+gm[e[t+13]]+gm[e[t+14]]+gm[e[t+15]]).toLowerCase();if(!mm(n))throw TypeError("Stringified UUID is invalid");return n};const vm=function(e,t,n){var r=(e=e||{}).random||(e.rng||pm)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return Em(r)};const ym=function(){const[e,n]=(0,t.useState)(""),{currentUser:r}=(0,t.useContext)(nm),{data:i}=(0,t.useContext)(sm);return(0,em.jsx)("div",{className:"input",children:(0,em.jsx)("input",{type:"text",placeholder:"Type something...",onChange:e=>n(e.target.value),value:e,onKeyDown:async t=>{"Enter"===t.code&&(await Kf(Hp($f,"chats",i.chatId),{messages:Qf({id:vm(),text:e,senderId:r.uid,date:aa.now()})}),await Kf(Hp($f,"userChats",r.uid),{[i.chatId+".lastMessage"]:{text:e},[i.chatId+".date"]:Xf()}),await Kf(Hp($f,"userChats",i.user.uid),{[i.chatId+".lastMessage"]:{text:e},[i.chatId+".date"]:Xf()}),n(""))}})})},bm=e=>{let{message:n}=e;const{currentUser:r}=(0,t.useContext)(nm),i=(0,t.useRef)();return(0,t.useEffect)((()=>{var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[n]),(0,em.jsx)("div",{ref:i,className:"message ".concat(n.senderId===r.uid&&"owner"),children:(0,em.jsx)("div",{className:"messageContent",children:(0,em.jsx)("p",{children:n.text})})})};const Tm=function(){const[e,n]=(0,t.useState)([]),{data:r}=(0,t.useContext)(sm);return(0,t.useEffect)((()=>{const e=zf(Hp($f,"chats",r.chatId),(e=>{e.exists()&&n(e.data().messages)}));return()=>{e()}}),[r.chatId]),(0,em.jsx)("div",{className:"messages",children:e.map((e=>(0,em.jsx)(bm,{message:e},e.id)))})};var Sm,wm=__webpack_require__(635),Rm=__webpack_require__.n(wm);!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(Sm||(Sm={}));var Im=function(e){var n=(0,t.useRef)(null),r=e.videoTrack,i=e.config,o=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,["videoTrack","config"]);return(0,t.useLayoutEffect)((function(){return null!==n.current&&r.play(n.current,i),function(){r.stop()}}),[r]),t.createElement("div",Object.assign({},o,{ref:n}))};const Cm=Rm();var Am,Om=__webpack_require__(621),Nm=__webpack_require__.n(Om);!function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(Am||(Am={}));const km=Nm();function Dm(){return Dm=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Dm.apply(this,arguments)}"undefined"!==typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!==typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function Pm(e,t){try{var n=e()}catch(Jg){return t(Jg)}return n&&n.then?n.then(void 0,t):n}var Lm,Mm,xm,Um=t.createContext({}),Fm=Um.Provider;Um.Consumer;!function(e){e[e.yes=0]="yes",e[e.subbed=1]="subbed",e[e.no=2]="no"}(Lm||(Lm={})),function(e){e[e.grid=0]="grid",e[e.pin=1]="pin"}(Mm||(Mm={})),function(e){e[e.disabled=0]="disabled",e[e.enabled=1]="enabled",e[e.disabling=2]="disabling",e[e.enabling=3]="enabling"}(xm||(xm={}));var jm=t.createContext({rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}}),Vm=jm.Provider,Bm=t.createContext([]),Gm=Bm.Provider,qm=Bm.Consumer,Wm=t.createContext([]),Hm=Wm.Provider,Km=Wm.Consumer,zm=t.createContext({}),Ym=zm.Provider,Jm={max:[{uid:0,hasAudio:Lm.no,hasVideo:Lm.no}],min:[],isScreensharing:!1},Xm=function(e,t){var n=Jm,r=[].concat(e.max,e.min).map((function(e){return e.uid}));switch(t.type){case"Screensharing":n=Dm({},e,{isScreensharing:t.value[0]}),console.log("!Screensharingstate",e,n);break;case"update-user-video":n={min:e.min.map((function(e){return 0===e.uid?{uid:0,hasAudio:Lm.subbed,hasVideo:Lm.subbed}:e})),max:e.max.map((function(e){return 0===e.uid?{uid:0,hasAudio:Lm.subbed,hasVideo:Lm.subbed}:e})),isScreensharing:e.isScreensharing};break;case"user-joined":if(-1===r.indexOf(t.value[0].uid)){var i=[].concat(e.min,[{uid:t.value[0].uid,hasAudio:Lm.no,hasVideo:Lm.no}]);n=1===i.length&&0===e.max[0].uid?{max:i,min:e.max,isScreensharing:e.isScreensharing}:{min:i,max:e.max,isScreensharing:e.isScreensharing}}break;case"user-unpublished":if(e.max[0].uid===t.value[0].uid)n={max:[{uid:t.value[0].uid,hasAudio:"audio"===t.value[1]?Lm.no:e.max[0].hasAudio,hasVideo:"video"===t.value[1]?Lm.no:e.max[0].hasVideo}],min:e.min,isScreensharing:e.isScreensharing};else{var o=e.min.find((function(e){return e.uid===t.value[0].uid}));if(o)n={min:[].concat(e.min.filter((function(e){return e.uid!==t.value[0].uid})),[{uid:t.value[0].uid,hasAudio:"audio"===t.value[1]?Lm.no:o.hasAudio,hasVideo:"video"===t.value[1]?Lm.no:o.hasVideo}]),max:e.max,isScreensharing:e.isScreensharing}}break;case"user-published":n=e.max[0].uid===t.value[0].uid?{max:[{uid:t.value[0].uid,hasAudio:"audio"===t.value[1]?Lm.subbed:e.max[0].hasAudio,hasVideo:"video"===t.value[1]?Lm.subbed:e.max[0].hasVideo}],min:e.min,isScreensharing:e.isScreensharing}:{min:e.min.map((function(e){return e.uid!==t.value[0].uid?e:{uid:e.uid,hasAudio:"audio"===t.value[1]?Lm.subbed:e.hasAudio,hasVideo:"video"===t.value[1]?Lm.subbed:e.hasVideo}})),max:e.max,isScreensharing:e.isScreensharing};break;case"user-left":if(e.max[0].uid===t.value[0].uid){var s=[].concat(e.min);n={max:[s.pop()],min:s,isScreensharing:e.isScreensharing}}else n={min:e.min.filter((function(e){return e.uid!==t.value[0].uid})),max:e.max,isScreensharing:e.isScreensharing};break;case"user-swap":e.max[0].uid===t.value[0].uid||(n={max:[t.value[0]],min:[].concat(e.min.filter((function(e){return e.uid!==t.value[0].uid})),[e.max[0]]),isScreensharing:e.isScreensharing});break;case"local-user-mute-video":n={min:e.min.map((function(e){return 0===e.uid?{uid:0,hasAudio:e.hasAudio,hasVideo:t.value[0]}:e})),max:e.max.map((function(e){return 0===e.uid?{uid:0,hasAudio:e.hasAudio,hasVideo:t.value[0]}:e})),isScreensharing:e.isScreensharing};break;case"local-user-mute-audio":n={min:e.min.map((function(e){return 0===e.uid?{uid:0,hasAudio:t.value[0],hasVideo:e.hasVideo}:e})),max:e.max.map((function(e){return 0===e.uid?{uid:0,hasAudio:t.value[0],hasVideo:e.hasVideo}:e})),isScreensharing:e.isScreensharing};break;case"remote-user-mute-video":n={min:e.min.map((function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasVideo:t.value[1],hasAudio:e.hasAudio}:e})),max:e.max.map((function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasVideo:t.value[1],hasAudio:e.hasAudio}:e})),isScreensharing:e.isScreensharing};break;case"remote-user-mute-audio":n={min:e.min.map((function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasAudio:t.value[1],hasVideo:e.hasVideo}:e})),max:e.max.map((function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasAudio:t.value[1],hasVideo:e.hasVideo}:e})),isScreensharing:e.isScreensharing};break;case"leave-channel":n=Jm;break;case"ActiveSpeaker":n=e.max[0].uid===t.value[0]?Dm({},e):{max:[e.min.find((function(e){return e.uid===t.value[0]}))],min:[].concat(e.min.filter((function(e){return e.uid!==t.value[0]})),[e.max[0]]),isScreensharing:e.isScreensharing}}return console.log("!state-update",Dm({},e,n),n),Dm({},e,n)},Qm=function(e,t,n,r,i,o,s){try{var a=Cm.createClient({mode:"live",role:"host",codec:"vp8"}),c=0,u=i||1,l=!1;return Zm=function(){try{var e=Pm((function(){return n.close(),Promise.resolve(a.leave()).then((function(){a.removeAllListeners()}))}),(function(e){console.log(e)}));return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}},Promise.resolve(function(){try{try{console.log(a),o&&(a.on("token-privilege-will-expire",(function(){try{return console.log("token will expire"),Promise.resolve(fetch(o+"/rtc/"+t+"/publisher/uid/"+u+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtcToken;a.renewToken(t)}))}))}catch(Jg){return Promise.reject(Jg)}})),a.on("token-privilege-did-expire",(function(){try{return Promise.resolve(fetch(o+"/rtc/"+t+"/publisher/uid/"+u+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtcToken;a.renewToken(t)}))}))}catch(Jg){return Promise.reject(Jg)}}))),n.on("track-ended",(function(){a.leave(),a.removeAllListeners()}))}catch(Jg){console.log(Jg)}return Promise.resolve()}catch(Jg){return Promise.reject(Jg)}}()).then((function(){return Promise.resolve(function(){try{a.setClientRole("host");var n=function(){if(!o)return Promise.resolve(a.join(e,t,r||null,u||0)).then((function(e){c=e}));var n=Pm((function(){return Promise.resolve(fetch(o+"/rtc/"+t+"/publisher/uid/"+u+"/")).then((function(n){return Promise.resolve(n.json()).then((function(n){var r=n.rtcToken;return Promise.resolve(a.join(e,t,r,u)).then((function(e){c=e}))}))}))}),(function(e){console.log(e)}));return n&&n.then?n.then((function(){})):void 0}();return Promise.resolve(n&&n.then?n.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}}()).then((function(){return Promise.resolve(function(){try{var e=function(){var e=function(){if(n.enabled){var e=function(){if(!l)return Promise.resolve(a.publish([n]).then((function(){l=!0}))).then((function(){}))}();if(e&&e.then)return e.then((function(){}))}}();if(e&&e.then)return e.then((function(){}))},t=function(){if(s)return Promise.resolve(a.enableDualStream()).then((function(){}))}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(Jg){return Promise.reject(Jg)}}()).then((function(){c&&console.log(c)}))}))}))}catch(Jg){return Promise.reject(Jg)}},Zm=function(){},$m=function(e){var t;return function(){return t||(t=Rm().createClient(e)),t}}({codec:"vp8",mode:"live"}),eg=function(e){var n=(0,t.useRef)(),r=(0,t.useRef)(),i=(0,t.useRef)(!1),o=(0,t.useContext)(zm),s=o.localVideoTrack,a=o.localAudioTrack,c=(0,t.useContext)(jm),u=c.callbacks,l=c.rtcProps,d=(0,t.useState)(!1),h=d[0],p=d[1],f=(0,t.useState)(!1),m=f[0],g=f[1],_=null,E=(0,t.useRef)(new Promise((function(e,t){_=e,console.log(t)}))),v=$m();l.customRtcClient&&(v.removeAllListeners(),v=l.customRtcClient);var y=!1,b=!1,T=(0,t.useRef)({}),S=e.callActive;void 0===S&&(S=!0);var w=(0,t.useReducer)(Xm,Jm),R=w[0],I=w[1];(0,t.useEffect)((function(){return _?(function(){try{try{if(console.log(v),v.on("user-joined",(function(){try{for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[0];return o.uid===e.screenshareUid&&i.current||1===o.uid&&i.current||(T.current[o.uid]={}),I({type:"user-joined",value:n}),Promise.resolve()}catch(Jg){return Promise.reject(Jg)}})),v.on("user-published",(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];try{var o=n[0],s=n[1];return console.log("user-published",o.uid),o.uid===e.screenshareUid&&i.current||1===o.uid&&i.current?I({type:"user-published",value:n}):v.subscribe(o,s).then((function(e){var t;T.current[o.uid][s+"Track"]=o[s+"Track"],"audio"===s?null===(t=o.audioTrack)||void 0===t||t.play():l.enableDualStream&&l.dualStreamMode&&v.setStreamFallbackOption(o.uid,l.dualStreamMode),I({type:"user-published",value:n})})).catch((function(e){return console.log(e)})),Promise.resolve()}catch(Jg){return Promise.reject(Jg)}})),v.on("user-unpublished",(function(){try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i=t[0],o=t[1];return console.log("user-unpublished",i.uid),"audio"===o&&(null===(r=i.audioTrack)||void 0===r||r.stop()),I({type:"user-unpublished",value:t}),Promise.resolve()}catch(Jg){return Promise.reject(Jg)}})),v.on("connection-state-change",(function(){try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],o=t[1],s=t[2];if(console.log("connection",o,r,s),"CONNECTED"===r)g(!0);else if("DISCONNECTED"===r){try{Zm(),i.current=!1}catch(Jg){console.log("stopscreenshare",Jg)}I({type:"leave-channel",value:null})}else g(!1);return Promise.resolve()}catch(Jg){return Promise.reject(Jg)}})),v.on("user-left",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];I({type:"user-left",value:t})})),l.tokenUrl){var t=l.tokenUrl,n=l.channel,r=l.uid;v.on("token-privilege-will-expire",(function(){try{return console.log("token will expire"),Promise.resolve(fetch(t+"/rtc/"+n+"/publisher/uid/"+(r||0)+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtcToken;v.renewToken(t)}))}))}catch(Jg){return Promise.reject(Jg)}})),v.on("token-privilege-did-expire",(function(){try{return Promise.resolve(fetch(t+"/rtc/"+n+"/publisher/uid/"+(r||0)+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtcToken;v.renewToken(t)}))}))}catch(Jg){return Promise.reject(Jg)}}))}u&&Object.keys(u).map((function(e){try{v.on(e,(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];u[e].apply(null,n)}))}catch(e){console.log(e)}})),_(!0),p(!0)}catch(Jg){console.log("!!!",Jg)}return Promise.resolve()}catch(Jg){return Promise.reject(Jg)}}(),function(){try{v.removeAllListeners()}catch(Jg){console.log(Jg)}}):function(){}}),[l.appId]),(0,t.useEffect)((function(){var e=!1;return S?(!function(){try{return Promise.resolve(E.current).then((function(){var t=l.tokenUrl,r=l.channel,i=l.uid,o=l.appId,s=l.token,a=function(){if(v&&!e){"audience"===l.role?v.setClientRole(l.role):v.setClientRole("host");var a=function(){if(!t)return Promise.resolve(v.join(o,r,s||null,i||0)).then((function(e){n.current=e}));var e=Pm((function(){return Promise.resolve(fetch(t+"/rtc/"+r+"/publisher/uid/"+(i||0)+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtcToken;return Promise.resolve(v.join(o,r,t,i||0)).then((function(e){n.current=e}))}))}))}),(function(e){console.log(e)}));return e&&e.then?e.then((function(){})):void 0}();if(a&&a.then)return a.then((function(){}))}else console.error("trying to join before RTC Engine was initialized")}();if(a&&a.then)return a.then((function(){}))}))}catch(Jg){return Promise.reject(Jg)}}(),console.log("Attempted join: ",l.channel)):console.log("In precall - waiting to join"),function(){if(e=!0,S){console.log("Leaving channel");try{Zm(),i.current=!1}catch(Jg){console.log(Jg)}E.current=v.leave().catch((function(e){return console.log(e)}))}}}),[l.channel,l.uid,S,l.tokenUrl]),(0,t.useEffect)((function(){console.log("Publish",s,a,S),S&&function(){try{var e=function(){function e(){var e=function(){if(null!==s&&void 0!==s&&s.enabled&&m){var e=function(){if(!y)return Promise.resolve(v.publish([s]).then((function(){y=!0}))).then((function(){}))}();if(e&&e.then)return e.then((function(){}))}}();if(e&&e.then)return e.then((function(){}))}var t=function(){if(null!==a&&void 0!==a&&a.enabled&&m){var e=function(){if(!b)return Promise.resolve(v.publish([a]).then((function(){b=!0}))).then((function(){}))}();if(e&&e.then)return e.then((function(){}))}}();return t&&t.then?t.then(e):e()},t=function(){if(l.enableDualStream)return Promise.resolve(v.enableDualStream()).then((function(){}))}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(Jg){return Promise.reject(Jg)}}()}),[S,null===s||void 0===s?void 0:s.enabled,null===a||void 0===a?void 0:a.enabled,m]),(0,t.useEffect)((function(){s&&null!==a&&(T.current[0]={audioTrack:a,videoTrack:s},I({type:"update-user-video",value:[a,s]}))}),[l.channel,m]),(0,t.useEffect)((function(){m&&l.token&&v.renewToken(l.token).then((function(e){return console.log("renewed token",e)}))}),[l.token,m]),(0,t.useEffect)((function(){l.role&&v.setClientRole(l.role).then((function(e){return console.log("changed role",e)}))}),[l.role,m]),(0,t.useEffect)((function(){return S&&function(){try{var e=function(){if(l.activeSpeaker&&l.layout!==Mm.grid)return v.on("volume-indicator",(function(e){var t=e.reduce((function(e,t){return null===e||t.level>e.level?t:e}),null),r=t?t.uid:void 0,i=r===n.current?0:r;void 0!==r&&I({type:"ActiveSpeaker",value:[i]})})),Promise.resolve(v.enableAudioVolumeIndicator()).then((function(){}))}();return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}}(),function(){v.removeAllListeners("volume-indicator")}}),[l.activeSpeaker,l.layout]);return t.createElement(Fm,{value:{client:v,mediaStore:T.current,localVideoTrack:s,localAudioTrack:a,dispatch:I,localUid:n,channelJoined:m,toggleScreensharing:function(){try{return i.current?(Zm(),i.current=!1):function(){try{return I({type:"Screensharing",value:[!0]}),Promise.resolve(Cm.createScreenVideoTrack({},"disable")).then((function(e){r.current=e;var t=l.screenshareUid||1;return T.current[t]={videoTrack:r.current},r.current.on("track-ended",(function(){i.current=!1,I({type:"Screensharing",value:[!1]})})),i.current=!0,Promise.resolve(Qm(l.appId,l.channel,r.current,l.screenshareToken,l.screenshareUid,l.tokenUrl,l.enableDualStream)).then((function(){}))}))}catch(Jg){return Promise.reject(Jg)}}(),Promise.resolve()}catch(Jg){return Promise.reject(Jg)}},isScreensharing:i.current}},t.createElement(Gm,{value:R.max},t.createElement(Hm,{value:R.min},h?e.children:null)))},tg={videocam:t.createElement(t.Fragment,null,t.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),t.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:t.createElement(t.Fragment,null,t.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),t.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:t.createElement(t.Fragment,null,t.createElement("polyline",{points:"15 3 21 3 21 9"}),t.createElement("polyline",{points:"9 21 3 21 3 15"}),t.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),t.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:t.createElement(t.Fragment,null,t.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),t.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:t.createElement(t.Fragment,null,t.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),t.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),t.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),t.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:t.createElement(t.Fragment,null,t.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),t.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),t.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),t.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),t.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:t.createElement(t.Fragment,null,t.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),t.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),t.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:t.createElement(t.Fragment,null,t.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},ng=function(e){var n=e.onClick,r=e.name,i=e.disabled,o=e.style,s=(0,t.useContext)(jm).styleProps||{},a=s.theme,c=s.BtnTemplateStyles,u=s.iconSize,l=s.customIcon;return t.createElement("div",{style:Dm({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:i?"auto":"pointer",margin:4},c,o),onClick:n},l?t.createElement("img",{src:l[r],alt:r}):t.createElement("svg",{style:{width:u||24,height:u||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:i?"0.5":"1",stroke:a||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},tg[r]))};function rg(){var e=(0,t.useContext)(jm),n=e.styleProps,r=e.callbacks,i=((n||{}).localBtnStyles||{}).endCall;return t.createElement(ng,{style:i||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(null===r||void 0===r?void 0:r.EndCall)&&r.EndCall()}})}var ig=(0,t.createContext)({}),og=function(e){var n,r=(0,t.useContext)(Bm),i=(0,t.useContext)(Wm);return n=0===r[0].uid?r[0]:i.find((function(e){return 0===e.uid})),t.createElement(ig.Provider,{value:n},e.children)},sg=function(e,t,n,r){try{var i=function(){if(0===e.uid){var i=e.hasAudio,o=function(){if(i===xm.enabled||i===xm.disabled){var e=i===xm.enabled?xm.disabling:xm.enabling;t({type:"local-user-mute-audio",value:[e]}),r&&r["local-user-mute-audio"]&&r["local-user-mute-audio"](e);var o=Pm((function(){return Promise.resolve(null===n||void 0===n?void 0:n.setEnabled(i!==xm.enabled)).then((function(){e=i===xm.enabled?xm.disabled:xm.enabled,r&&r["local-user-mute-audio"]&&r["local-user-mute-audio"](e),t({type:"local-user-mute-audio",value:[i===xm.enabled?xm.disabled:xm.enabled]})}))}),(function(){t({type:"local-user-mute-audio",value:[i]})}));if(o&&o.then)return o.then((function(){}))}}();if(o&&o.then)return o.then((function(){}))}}();return Promise.resolve(i&&i.then?i.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}};function ag(){var e=(0,t.useContext)(jm),n=e.styleProps,r=e.callbacks,i=((n||{}).localBtnStyles||{}).muteLocalAudio,o=(0,t.useContext)(Um),s=o.dispatch,a=o.localAudioTrack,c=(0,t.useContext)(ig);return t.createElement("div",null,t.createElement(ng,{style:i,name:c.hasAudio===xm.enabled?"mic":"micOff",onClick:function(){return a&&sg(c,s,a,r)}}))}function cg(){var e=(((0,t.useContext)(jm).styleProps||{}).localBtnStyles||{}).screenshare,n=(0,t.useContext)(Um),r=n.toggleScreensharing,i=n.isScreensharing;return t.createElement("div",null,t.createElement(ng,{style:e,name:i?"stop":"screen",onClick:function(){return r()}}))}var ug,lg,dg,hg,pg=function(e,t,n,r){try{var i=function(){if(0===e.uid){var i=e.hasVideo,o=function(){if(i===xm.enabled||i===xm.disabled){var e=i===xm.enabled?xm.disabling:xm.enabling;t({type:"local-user-mute-video",value:[e]}),r&&r["local-user-mute-video"]&&r["local-user-mute-video"](e);var o=Pm((function(){return Promise.resolve(null===n||void 0===n?void 0:n.setEnabled(i!==xm.enabled)).then((function(){e=i===xm.enabled?xm.disabled:xm.enabled,r&&r["local-user-mute-video"]&&r["local-user-mute-video"](e),t({type:"local-user-mute-video",value:[e]})}))}),(function(){t({type:"local-user-mute-video",value:[i]})}));if(o&&o.then)return o.then((function(){}))}}();if(o&&o.then)return o.then((function(){}))}}();return Promise.resolve(i&&i.then?i.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}};function fg(){var e=(0,t.useContext)(jm),n=e.styleProps,r=e.callbacks,i=((n||{}).localBtnStyles||{}).muteLocalVideo,o=(0,t.useContext)(Um),s=o.dispatch,a=o.localVideoTrack,c=(0,t.useContext)(ig);return t.createElement("div",null,t.createElement(ng,{style:i,name:c.hasVideo===xm.enabled?"videocam":"videocamOff",onClick:function(){return a&&pg(c,s,a,r)}}))}function mg(){var e=(0,t.useContext)(jm),n=e.styleProps,r=e.rtcProps,i=(n||{}).localBtnContainer;return t.createElement("div",{style:Dm({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},i)},"audience"!==r.role&&t.createElement(fg,null),"audience"!==r.role&&t.createElement(ag,null),"audience"!==r.role&&r.enableScreensharing&&t.createElement(cg,null),t.createElement(rg,null))}!function(e){e[e.initFailed=0]="initFailed",e[e.offline=1]="offline",e[e.initialising=2]="initialising",e[e.loggingIn=3]="loggingIn",e[e.loggedIn=4]="loggedIn",e[e.connected=5]="connected",e[e.loginFailed=6]="loginFailed"}(ug||(ug={})),function(e){e[e.broadcaster=0]="broadcaster",e[e.audience=1]="audience"}(lg||(lg={})),function(e){e[e.camera=0]="camera",e[e.microphone=1]="microphone"}(dg||(dg={})),function(e){e[e.closed=0]="closed",e[e.muteMic=1]="muteMic",e[e.muteCamera=2]="muteCamera",e[e.unmuteMic=3]="unmuteMic",e[e.unmuteCamera=4]="unmuteCamera"}(hg||(hg={}));var gg=(0,t.createContext)(null),_g=gg.Provider;gg.Consumer;function Eg(e){var n=(0,t.useContext)(jm).styleProps,r=(0,t.useContext)(gg),i=r.sendMuteRequest,o=r.uidMap,s=((n||{}).remoteBtnStyles||{}).muteRemoteVideo,a=e.UIKitUser,c=a.hasVideo===Lm.no;return 0!==a.uid&&o[a.uid]?t.createElement("div",null,t.createElement(ng,{name:a.hasVideo===Lm.subbed?"videocam":"videocamOff",style:s,onClick:function(){return i(dg.camera,a.uid,!c)}})):null}function vg(e){var n=((0,t.useContext)(jm).styleProps||{}).remoteBtnStyles,r=(0,t.useContext)(gg),i=r.sendMuteRequest,o=r.uidMap,s=(n||{}).muteRemoteAudio,a=e.UIKitUser,c=a.hasAudio===Lm.no;return 0!==a.uid&&o[a.uid]?t.createElement("div",null,t.createElement(ng,{style:s,name:a.hasAudio===Lm.subbed?"mic":"micOff",onClick:function(){return i(dg.microphone,a.uid,!c)}})):null}function yg(e){var n=(0,t.useContext)(Um).dispatch,r=e.UIKitUser;return t.createElement("div",null,t.createElement(ng,{name:"remoteSwap",onClick:function(){return n({type:"user-swap",value:[r]})}}))}var bg=function(e){var n=(0,t.useContext)(jm),r=n.styleProps,i=n.rtcProps,o=r||{},s=o.maxViewStyles,a=o.maxViewOverlayContainer,c=e.user,u=i.CustomVideoPlaceholder;return u?u&&u(Dm({},e),null):t.createElement("div",{key:c.uid,style:Dm({},Tg.max,s)},t.createElement("div",{style:Tg.imgContainer},t.createElement("img",{style:Tg.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),e.isShown&&t.createElement("div",{style:Dm({},Tg.btnContainer,a)},e.showButtons&&t.createElement(t.Fragment,null,!i.disableRtm&&t.createElement(Eg,{UIKitUser:c}),!i.disableRtm&&t.createElement(vg,{UIKitUser:c}),e.showSwap&&t.createElement(yg,{UIKitUser:c}))))},Tg={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},Sg=function(e){var n=(0,t.useContext)(gg).usernames,r=(0,t.useContext)(jm),i=r.rtmProps,o=r.styleProps,s=e.user;return null!==i&&void 0!==i&&i.displayUsername?t.createElement("p",{style:Dm({},wg.username,null===o||void 0===o?void 0:o.usernameText)},1===s.uid?"Screenshare":n[s.uid]):t.createElement(t.Fragment,null)},wg={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},Rg=function(e){var n=(0,t.useContext)(Um).mediaStore,r=(0,t.useContext)(jm),i=r.styleProps,o=r.rtcProps,s=i||{},a=s.maxViewStyles,c=s.videoMode,u=s.maxViewOverlayContainer,l=null===c||void 0===c?void 0:c.max,d=(0,t.useState)(!1),h=d[0],p=d[1],f=e.user;return t.createElement("div",{style:Dm({},Ig.container,e.style,a),onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)}},1===f.hasVideo?t.createElement("div",{style:Ig.videoContainer},!o.disableRtm&&t.createElement(Sg,{user:f}),t.createElement(Im,{style:Ig.videoplayer,config:{fit:l||"cover"},videoTrack:n[f.uid].videoTrack}),h&&t.createElement("div",{style:Dm({},Ig.overlay,u)},!o.disableRtm&&t.createElement(Eg,{UIKitUser:f}),!o.disableRtm&&t.createElement(vg,{UIKitUser:f}))):t.createElement("div",{style:Ig.videoContainer},!o.disableRtm&&t.createElement(Sg,{user:f}),t.createElement(bg,{user:f,isShown:h,showButtons:!0})))},Ig={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"},username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},Cg=function(e){var n=(0,t.useContext)(Um).mediaStore,r=(0,t.useContext)(jm),i=r.styleProps,o=r.rtcProps,s=i||{},a=s.minViewStyles,c=s.videoMode,u=s.minViewOverlayContainer,l=null===c||void 0===c?void 0:c.min,d=(0,t.useState)(!1),h=d[0],p=d[1],f=e.user;return t.createElement("div",{style:Dm({},{display:"flex",flex:1},a),onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)}},1===f.hasVideo?t.createElement("div",{style:Dm({},{display:"flex",flex:1,position:"relative"})},t.createElement(Im,{style:{flex:10,display:"flex"},config:{fit:void 0!==l?l:"cover"},videoTrack:n[f.uid].videoTrack}),h&&t.createElement("div",{style:Dm({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},u)},!o.disableRtm&&t.createElement(Eg,{UIKitUser:f}),!o.disableRtm&&t.createElement(vg,{UIKitUser:f}),t.createElement(yg,{UIKitUser:f}))):t.createElement(bg,{user:f,isShown:h,showButtons:!0,showSwap:!0}))},Ag="_3Sxu7",Og=function(){var e=(0,t.useContext)(jm),n=e.styleProps,r=e.rtcProps,i=n||{},o=i.minViewContainer,s=i.pinnedVideoContainer,a=i.maxViewContainer,c=i.scrollViewContainer,u=(0,t.useRef)(null),l=(0,t.useState)(0),d=l[0],h=l[1],p=(0,t.useState)(0),f=p[0],m=p[1],g=d>f;return(0,t.useEffect)((function(){var e=function(){u.current&&(h(u.current.offsetWidth),m(u.current.offsetHeight))};return window.addEventListener("resize",e),u.current&&(h(u.current.offsetWidth),m(u.current.offsetHeight)),function(){window.removeEventListener("resize",e)}}),[]),t.createElement("div",{ref:u,style:Dm({},{display:"flex",flex:1,flexDirection:g?"row":"column-reverse",overflow:"hidden"},s)},t.createElement("div",{style:Dm({},{display:"flex",flex:g?5:4},a)},t.createElement(qm,null,(function(e){return"audience"===r.role&&0===e[0].uid?null:t.createElement(Rg,{user:e[0]})}))),t.createElement("div",{className:Ag,style:Dm({},{overflowY:g?"scroll":"hidden",overflowX:g?"hidden":"scroll",display:"flex",flex:1,flexDirection:g?"column":"row"},c)},t.createElement(Km,null,(function(e){return e.map((function(e){return"audience"===r.role&&0===e.uid?null:t.createElement("div",{style:Dm({},{minHeight:g?"35vh":"99%",minWidth:g?"99%":"40vw",margin:2,display:"flex"},o),key:e.uid},t.createElement(Cg,{user:e}))}))}))))},Ng=function(){var e=(0,t.useContext)(jm),n=e.styleProps,r=e.rtcProps,i=n||{},o=i.gridVideoCells,s=i.gridVideoContainer,a=(0,t.useContext)(Bm),c=(0,t.useContext)(Wm),u="audience"===r.role?[].concat(a,c).filter((function(e){return 0!==e.uid})):[].concat(a,c),l=(0,t.useRef)(null),d=(0,t.useState)(window.innerWidth),h=d[0],p=d[1],f=(0,t.useState)(window.innerHeight),m=f[0],g=f[1],_=h>m,E="minmax(0, 1fr) ";return(0,t.useEffect)((function(){var e=function(){l.current&&(p(l.current.offsetWidth),g(l.current.offsetHeight))};return window.addEventListener("resize",e),l.current&&(p(l.current.offsetWidth),g(l.current.offsetHeight)),function(){window.removeEventListener("resize",e)}}),[]),t.createElement("div",{ref:l,style:Dm({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:_?u.length>9?E.repeat(4):u.length>4?E.repeat(3):u.length>1?E.repeat(2):E:u.length>8?E.repeat(3):u.length>2?E.repeat(2):E},s)},u.map((function(e){return t.createElement(Rg,{user:e,style:Dm({},{height:"100%",width:"100%"},o),key:e.uid})})))},kg=function(e,n){var r=null;return function(){var i=(0,t.useState)(!1),o=i[0],s=i[1],a=(0,t.useState)(null),c=a[0],u=a[1],l=(0,t.useRef)(r);return(0,t.useEffect)((function(){return null===l.current?function(){try{return Promise.resolve(Rm().createMicrophoneAndCameraTracks(e,n)).then((function(e){return r=e}))}catch(Jg){return Promise.reject(Jg)}}().then((function(e){l.current=e,s(!0)}),(function(e){u(e)})):s(!0),function(){r=null}}),[]),{ready:o,tracks:l.current,error:c}}}({encoderConfig:{}},{encoderConfig:{}}),Dg=function(e){var n=(0,t.useState)(!1),r=n[0],i=n[1],o=(0,t.useState)(null),s=o[0],a=o[1],c=(0,t.useState)(null),u=c[0],l=c[1],d=kg(),h=d.ready,p=d.tracks,f=d.error,m=(0,t.useRef)({});return(0,t.useEffect)((function(){return null!==p?(l(p[0]),a(p[1]),m.current[0]={audioTrack:p[0],videoTrack:p[1]},i(!0)):f&&(console.error(f),i(!1)),function(){var e,t;p&&(null===(e=p[0])||void 0===e||e.close(),null===(t=p[1])||void 0===t||t.close())}}),[h,f]),t.createElement(Ym,{value:{localVideoTrack:s,localAudioTrack:u}},r?e.children:null)},Pg=function(){var e;return function(t,n){return function(t,n){return e||(e=t.createChannel(n)),e}(t,n)}}(),Lg=function(){var e;return function(t,n,r){return function(t,n,r){return e||(e=Nm().createInstance(t,n,r)),e}(t,n,r)}}(),Mg=function(e){var n=(0,t.useContext)(jm),r=n.rtcProps,i=n.rtmProps,o=(0,t.useState)(!1),s=o[0],a=o[1],c=Lg(r.appId),u=Pg(c,r.channel),l=(0,t.useRef)(""),d=(0,t.useRef)(5),h=(0,t.useContext)(ig),p=(0,t.useContext)(jm).rtmCallbacks,f=(0,t.useState)({}),m=f[0],g=f[1],_=(0,t.useState)({}),E=_[0],v=_[1],y=(0,t.useState)({}),b=y[0],T=y[1],S=(0,t.useState)(hg.closed),w=S[0],R=S[1],I=(0,t.useState)(ug.offline),C=I[0],A=I[1],O=(0,t.useContext)(Um),N=O.localUid,k=O.localAudioTrack,D=O.localVideoTrack,P=O.dispatch,L=O.channelJoined,M=function e(){try{var t=r.tokenUrl,n=function(){if(t){var n=Pm((function(){return Promise.resolve(fetch(t+"/rtm/"+((null===i||void 0===i?void 0:i.uid)||l.current))).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtmToken;return Promise.resolve(c.login({uid:(null===i||void 0===i?void 0:i.uid)||l.current,token:t})).then((function(){d.current=5}))}))}))}),(function(){setTimeout((function(){try{return d.current=d.current+d.current,e(),Promise.resolve()}catch(Jg){return Promise.reject(Jg)}}),1e3*d.current)}));if(n&&n.then)return n.then((function(){}))}else{var r=Pm((function(){return Promise.resolve(c.login({uid:(null===i||void 0===i?void 0:i.uid)||l.current,token:(null===i||void 0===i?void 0:i.token)||void 0})).then((function(){d.current=5}))}),(function(){setTimeout((function(){try{return d.current=d.current+d.current,e(),Promise.resolve()}catch(Jg){return Promise.reject(Jg)}}),1e3*d.current)}));if(r&&r.then)return r.then((function(){}))}}();return Promise.resolve(n&&n.then?n.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}},x=function e(){try{var t=Pm((function(){return Promise.resolve(u.join()).then((function(){d.current=5}))}),(function(){setTimeout((function(){try{return d.current=d.current+d.current,e(),Promise.resolve()}catch(Jg){return Promise.reject(Jg)}}),1e3*d.current)}));return Promise.resolve(t&&t.then?t.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}},U=function(){try{if(A(ug.initialising),r.uid?l.current=String(r.uid):l.current=String((new Date).getTime()),c.on("ConnectionStateChanged",(function(e,t){console.log(e,t)})),c.on("TokenExpired",(function(){try{var e=r.tokenUrl;console.log("token expired - renewing");var t=function(){if(e){var t=Pm((function(){return Promise.resolve(fetch(e+"/rtm/"+((null===i||void 0===i?void 0:i.uid)||l.current))).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtmToken;return Promise.resolve(c.renewToken(t)).then((function(){d.current=5}))}))}))}),(function(e){console.error("TokenExpiredError",e)}));if(t&&t.then)return t.then((function(){}))}}();return Promise.resolve(t&&t.then?t.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}})),c.on("MessageFromPeer",(function(e,t){j(e,t)})),u.on("ChannelMessage",(function(e,t){j(e,t)})),u.on("MemberJoined",(function(e){try{return Promise.resolve(H(F(),e)).then((function(){}))}catch(Jg){return Promise.reject(Jg)}})),u.on("MemberCountUpdated",(function(e){try{return console.log("RTM-MemberCountUpdated: ",e),Promise.resolve()}catch(Jg){return Promise.reject(Jg)}})),null!==p&&void 0!==p&&p.channel?Object.keys(p.channel).map((function(e){p.channel&&u.on(e,p.channel[e])})):null!==p&&void 0!==p&&p.client&&Object.keys(p.client).map((function(e){p.client&&c.on(e,p.client[e])})),r.tokenUrl){var e=r.tokenUrl,t=r.uid;c.on("TokenExpired",(function(){try{return console.log("token expired"),Promise.resolve(fetch(e+"/rtm/"+(t||0)+"/")).then((function(e){return Promise.resolve(e.json()).then((function(e){var t=e.rtmToken;c.renewToken(t)}))}))}catch(Jg){return Promise.reject(Jg)}}))}return A(ug.loggingIn),Promise.resolve(M()).then((function(){return A(ug.loggedIn),Promise.resolve(x()).then((function(){A(ug.connected),v((function(e){return Dm({},e,{0:null===i||void 0===i?void 0:i.username})})),W(F())}))}))}catch(Jg){return Promise.reject(Jg)}},F=function(){return{messageType:"UserData",rtmId:(null===i||void 0===i?void 0:i.uid)||l.current,rtcId:N.current,username:null===i||void 0===i?void 0:i.username,role:"audience"===r.role?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:km.VERSION,rtc:Cm.VERSION}}},j=function(e,t){var n;if("RAW"===e.messageType?n=Ug(e.rawMessage):"TEXT"===e.messageType&&(n=JSON.parse(e.text)),console.log(n,t),n)switch(n.messageType){case"UserData":V(n);break;case"MuteRequest":B(n);break;case"RtmDataRequest":switch(n.type){case"ping":G(t);break;case"userData":q(t);break;default:console.log(t)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},V=function(e){g((function(t){var n;return Dm({},t,((n={})[e.rtcId]=e.rtmId,n))})),v((function(t){var n;return Dm({},t,((n={})[e.rtcId]=e.username,n))})),T((function(t){var n;return Dm({},t,((n={})[e.rtmId]=e,n))}))},B=function(e){N.current===e.rtcId&&(e.isForceful?e.mute?e.device===dg.microphone?k&&sg(h,P,k):e.device===dg.camera&&D&&pg(h,P,D):console.error("cannot force unmute"):e.device===dg.microphone?e.mute?R(hg.muteMic):R(hg.unmuteMic):e.device===dg.camera&&(e.mute?R(hg.muteCamera):R(hg.unmuteCamera)))},G=function(e){H({messageType:"RtmDataRequest",type:"pong"},e)},q=function(e){H(F(),e)},W=function(e){try{var t=c.createMessage({text:JSON.stringify(e),messageType:km.MessageType.TEXT}),n=Pm((function(){return Promise.resolve(u.sendMessage(t)).then((function(){}))}),(function(e){console.error(e)}));return Promise.resolve(n&&n.then?n.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}},H=function(e,t){try{var n=c.createMessage({text:JSON.stringify(e),messageType:km.MessageType.TEXT}),r=Pm((function(){return Promise.resolve(c.sendMessageToPeer(n,String(t))).then((function(){}))}),(function(e){console.error(e)}));return Promise.resolve(r&&r.then?r.then((function(){})):void 0)}catch(Jg){return Promise.reject(Jg)}};return(0,t.useEffect)((function(){return L&&(U(),a(!0)),function(){L&&function(){try{return Promise.resolve(c.logout()).then((function(){return Promise.resolve(c.removeAllListeners()).then((function(){}))}))}catch(Jg){return Promise.reject(Jg)}}()}}),[r.channel,r.appId,L]),t.createElement(_g,{value:{rtmStatus:C,sendPeerMessage:H,sendChannelMessage:W,sendMuteRequest:function(e,t,n){var r=!1===(null===i||void 0===i?void 0:i.showPopUpBeforeRemoteMute),o={messageType:"MuteRequest",device:e,rtcId:t,mute:n,isForceful:r},s=m[t];r&&!n?console.log("cannot send force unmute request"):s?H(o,s):console.log("peer not found")},rtmClient:c,uidMap:m,usernames:E,userDataMap:b,popUpState:w,setPopUpState:R}},s?e.children:t.createElement(t.Fragment,null))},xg=(new TextEncoder,new TextDecoder),Ug=function(e){return JSON.parse(xg.decode(e))};function Fg(){var e=(0,t.useContext)(jm).styleProps,n=(0,t.useContext)(gg),r=n.popUpState,i=n.setPopUpState,o=(e||{}).popUpContainer,s=(0,t.useContext)(Um),a=s.dispatch,c=s.localVideoTrack,u=s.localAudioTrack,l=(0,t.useContext)(ig);return r!==hg.closed?t.createElement("div",{style:Dm({},jg.container,o)},t.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},r===hg.muteCamera||r===hg.muteMic?"Mute ":"Unmute ",r===hg.muteCamera||r===hg.unmuteCamera?"Camera":"Mic","?"),t.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},t.createElement("div",{onClick:function(){switch(r){case hg.muteCamera:l.hasVideo&&c&&pg(l,a,c);break;case hg.muteMic:l.hasAudio&&u&&sg(l,a,u);break;case hg.unmuteCamera:!l.hasVideo&&c&&pg(l,a,c);break;case hg.unmuteMic:!l.hasAudio&&u&&sg(l,a,u)}i(hg.closed)},style:jg.button},"Confirm"),t.createElement("div",{style:jg.buttonClose,onClick:function(){return i(hg.closed)}},"Close"))):null}var jg={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},Vg=function(){var e=(0,t.useContext)(jm).rtcProps;return t.createElement(eg,{callActive:e.callActive},t.createElement(og,null,e.disableRtm?t.createElement(t.Fragment,null,(null===e||void 0===e?void 0:e.layout)===Mm.grid?t.createElement(Ng,null):t.createElement(Og,null),t.createElement(mg,null)):t.createElement(Mg,null,t.createElement(Fg,null),(null===e||void 0===e?void 0:e.layout)===Mm.grid?t.createElement(Ng,null):t.createElement(Og,null),t.createElement(mg,null))))},Bg={display:"flex",flex:1,minHeight:0,flexDirection:"column"};const Gg=function(e){var n=e.styleProps,r=e.rtcProps,i=(n||{}).UIKitContainer;return t.createElement(Vm,{value:e},t.createElement("div",{style:Dm({},Bg,i)},"audience"===r.role?t.createElement(Vg,null):t.createElement(Dg,null,t.createElement(Vg,null))))};const qg=function(){const[e,n]=(0,t.useState)(!0),r={EndCall:()=>n(!1)};return e?(0,em.jsx)("div",{style:{display:"flex",width:"100vw",height:"100vh"},children:(0,em.jsx)(Gg,{rtcProps:{appId:"8267a1bb7b034afe8c1076dc0e68857d",channel:"check",token:"007eJxTYJDNW73hxN3qOaH1ffazzj6KFerkvy92jOFu0kPbxJ6H+7IVGCyMzMwTDZOSzJMMjE0S01Itkg0NzM1Skg1SzSwsTM1TmKoT0xoCGRmy9yxkZmSAQBCflSE5IzU5m4EBALGCIGE="},callbacks:r})}):(0,em.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADmGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDIyLTA4LTMwPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPmRjMjBmNTM2LTJhZjUtNGM3My05ZjZjLTAzMzkwY2JlN2VjMDwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6cGRmPSdodHRwOi8vbnMuYWRvYmUuY29tL3BkZi8xLjMvJz4KICA8cGRmOkF1dGhvcj5MYW1hIERldjwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6eG1wPSdodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvJz4KICA8eG1wOkNyZWF0b3JUb29sPkNhbnZhPC94bXA6Q3JlYXRvclRvb2w+CiA8L3JkZjpEZXNjcmlwdGlvbj4KPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0ncic/PvItxZYAAAKwSURBVFiF7Ze9bhNBFIW/M2s7JqJAUKdKpJS8AwXpkRANzxAJ0cIbREi8AAUSSqBFUNDxBrQoilLTUeQPxzuHYmYdx3Y2tpdYSPGRVusdz5355ufeuQNLLbXUUrdbGi04ODgd+isSggR4Ut0pZRvZOASQoN+HjY07swPaZn//BElIKAQszcs13G5q264GKyRPxFhf716ybY0RKz2AJboS3dTofJLARmXJEagPxh70gR2RiivtxwBDCAGIwOMYvQu0mwBm2xVbP4Et0C/JGU+2jaS7wNFUgDE6ADEEPbJ1HxyB0AAwz5YegreA90ArRp+HACEUOxA/A99zP3HYtq7jMzCS+pI87wOK1dKC2/ltSdi8Ab8En+byMYixGZwAr5H3jHK21aANyX3wjs2LBH+16gCH1cCVL5nG7CRvJbbTN6Gu/UZ7a1bZ/JF4BdpOMydxzeCnncGmKkhh6zWwmYqcw7azU0zmvHFAKcUSCYE2bZy9ugo11EWxG1/iBCTZsk3M3luF6WvtF7UHDdalT2Aa31vAElvpaFMEh6HfmgZwAUucArbtYOurpGPbIQXw/2eJI4DNO+BJ2ocuMmTtTC4IMKWTkh/Y/gY8T2mcA6i8OObGZ3QqQNsNspkq1zU5OGP7A/AsQ7byeT3Rus5JKqhSDbLWbFqCCqDIza7Y/iQpgHZTEgGTIOsAOwC2uzV1plXVz+8M0odY2OxdDCD1di2glCrb/ihpg3+TsHaAwxD0JSG4bLdXOTs7FoS9VqujTqeg1yvrAfNWqzbNjxjj00bbb0ijuyTGSKfT9fl5T1A6xsBgIq8CzMcQpINd6TYW48W5ObcsKdgMEoOyTGlgCIVjNL1eb/LARgsOD09ptUS7DScnxh69gc0qke8d9Ptn2GZ19R5ra81vi0sttdRSt0F/AbV4QUoZ1kOTAAAAAElFTkSuQmCC",alt:"Camera",onClick:()=>n(!0)})};const Wg=function(){var e;const{data:n}=(0,t.useContext)(sm);return(0,em.jsxs)("div",{className:"chat",children:[(0,em.jsxs)("div",{className:"chatInfo",children:[(0,em.jsx)("h3",{children:null===(e=n.user)||void 0===e?void 0:e.displayName}),(0,em.jsx)("div",{className:"chatIcons",children:(0,em.jsx)(qg,{})})]}),(0,em.jsx)(Tm,{}),(0,em.jsx)(ym,{})]})};const Hg=function(){return(0,em.jsx)("div",{className:"home",children:(0,em.jsxs)("div",{className:"container",children:[(0,em.jsx)(lm,{}),(0,em.jsx)(Wg,{})]})})},Kg=()=>{const[e,n]=(0,t.useState)(!1),[r,i]=(0,t.useState)(!1),o=X();return(0,em.jsx)("div",{className:"formContainer",children:(0,em.jsxs)("div",{className:"formWrapper",children:[(0,em.jsx)("span",{className:"logo",children:"Lama Chat"}),(0,em.jsx)("span",{className:"title",children:"Register"}),(0,em.jsxs)("form",{onSubmit:async t=>{i(!0),t.preventDefault();const r=t.target[0].value,s=t.target[1].value,a=t.target[2].value;try{const e=await async function(e,t,n){if(hn(e.app))return Promise.reject(Vn(e));const r=Hr(e),i=Zr(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ei),o=await i.catch((t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&Ci(e),t})),s=await vi._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(s.user),s}(Zf,s,a);await Hf(Hp($f,"users",e.user.uid),{uid:e.user.uid,displayName:r,email:s}),await Hf(Hp($f,"userChats",e.user.uid),{}),o("/")}catch(e){n(!0),i(!1)}},children:[(0,em.jsx)("input",{required:!0,type:"text",placeholder:"display name"}),(0,em.jsx)("input",{required:!0,type:"email",placeholder:"email"}),(0,em.jsx)("input",{required:!0,type:"password",placeholder:"password"}),(0,em.jsx)("button",{disabled:r,children:"Sign up"}),e&&(0,em.jsx)("span",{children:"Something went wrong"})]}),(0,em.jsxs)("p",{children:["You do have an account? ",(0,em.jsx)(we,{to:"/login",children:"Login"})]})]})})};const zg=function(){const{currentUser:e}=(0,t.useContext)(nm),n=t=>{let{children:n}=t;return e?n:(0,em.jsx)(le,{to:"/login"})};return(0,em.jsx)(be,{basename:"/chat-app",children:(0,em.jsx)(pe,{children:(0,em.jsxs)(de,{path:"/",children:[(0,em.jsx)(de,{index:!0,element:(0,em.jsx)(n,{children:(0,em.jsx)(Hg,{})})}),(0,em.jsx)(de,{path:"login",element:(0,em.jsx)(tm,{})}),(0,em.jsx)(de,{path:"register",element:(0,em.jsx)(Kg,{})})]})})})},Yg=e=>{e&&e instanceof Function&&__webpack_require__.e(453).then(__webpack_require__.bind(__webpack_require__,453)).then((t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:o,getTTFB:s}=t;n(e),r(e),i(e),o(e),s(e)}))};r.createRoot(document.getElementById("root")).render((0,em.jsx)(rm,{children:(0,em.jsx)(am,{children:(0,em.jsx)(zg,{})})})),Yg()})()})();
//# sourceMappingURL=main.a787d9fb.js.map